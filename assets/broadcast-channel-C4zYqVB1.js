import{f as H,a as N,ab as Ne,h as G,o as Oe,e as O,a1 as $e,m as We,K as xe,a3 as Ue,a2 as ze,_ as ne}from"./rx-query-helper-B5IGKrLX.js";import{o as Fe,d as ae,ab as je,a6 as se,j as ie,a9 as qe,Q as me,s as He,A as oe,U as Ke,D as m,P as Ve}from"./rx-query-FXZmDUEV.js";var Je=Object.defineProperty,Qe=(e,t,n)=>t in e?Je(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,I=(e,t,n)=>(Qe(e,typeof t!="symbol"?t+"":t,n),n);class E{constructor(t,n){I(this,"words"),I(this,"sigBytes"),t=this.words=t||[],this.sigBytes=n===void 0?t.length*4:n}toString(t){return(t||Xe).stringify(this)}concat(t){if(this.clamp(),this.sigBytes%4)for(let n=0;n<t.sigBytes;n++){const r=t.words[n>>>2]>>>24-n%4*8&255;this.words[this.sigBytes+n>>>2]|=r<<24-(this.sigBytes+n)%4*8}else for(let n=0;n<t.sigBytes;n+=4)this.words[this.sigBytes+n>>>2]=t.words[n>>>2];return this.sigBytes+=t.sigBytes,this}clamp(){this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4)}clone(){return new E([...this.words])}}const Xe={stringify(e){const t=[];for(let n=0;n<e.sigBytes;n++){const r=e.words[n>>>2]>>>24-n%4*8&255;t.push((r>>>4).toString(16),(r&15).toString(16))}return t.join("")}},Ge={parse(e){const t=e.length,n=[];for(let r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-r%4*8;return new E(n,t)}},Ye={parse(e){return Ge.parse(unescape(encodeURIComponent(e)))}};class Ze{constructor(){I(this,"_data",new E),I(this,"_nDataBytes",0),I(this,"_minBufferSize",0),I(this,"blockSize",512/32)}reset(){this._data=new E,this._nDataBytes=0}_append(t){typeof t=="string"&&(t=Ye.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_doProcessBlock(t,n){}_process(t){let n,r=this._data.sigBytes/(this.blockSize*4);t?r=Math.ceil(r):r=Math.max((r|0)-this._minBufferSize,0);const a=r*this.blockSize,s=Math.min(a*4,this._data.sigBytes);if(a){for(let i=0;i<a;i+=this.blockSize)this._doProcessBlock(this._data.words,i);n=this._data.words.splice(0,a),this._data.sigBytes-=s}return new E(n,s)}}class et extends Ze{update(t){return this._append(t),this._process(),this}finalize(t){t&&this._append(t)}}var tt=Object.defineProperty,rt=(e,t,n)=>t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,nt=(e,t,n)=>(rt(e,t+"",n),n);const ue=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],at=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],R=[];class st extends et{constructor(){super(...arguments),nt(this,"_hash",new E([...ue]))}reset(){super.reset(),this._hash=new E([...ue])}_doProcessBlock(t,n){const r=this._hash.words;let a=r[0],s=r[1],i=r[2],o=r[3],u=r[4],d=r[5],c=r[6],v=r[7];for(let l=0;l<64;l++){if(l<16)R[l]=t[n+l]|0;else{const f=R[l-15],$=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,B=R[l-2],p=(B<<15|B>>>17)^(B<<13|B>>>19)^B>>>10;R[l]=$+R[l-7]+p+R[l-16]}const M=u&d^~u&c,S=a&s^a&i^s&i,w=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),D=(u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25),C=v+D+M+at[l]+R[l],k=w+S;v=c,c=d,d=u,u=o+C|0,o=i,i=s,s=a,a=C+k|0}r[0]=r[0]+a|0,r[1]=r[1]+s|0,r[2]=r[2]+i|0,r[3]=r[3]+o|0,r[4]=r[4]+u|0,r[5]=r[5]+d|0,r[6]=r[6]+c|0,r[7]=r[7]+v|0}finalize(t){super.finalize(t);const n=this._nDataBytes*8,r=this._data.sigBytes*8;return this._data.words[r>>>5]|=128<<24-r%32,this._data.words[(r+64>>>9<<4)+14]=Math.floor(n/4294967296),this._data.words[(r+64>>>9<<4)+15]=n,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}}function it(e){return new st().finalize(e).toString()}function ot(e){return Promise.resolve(it(e))}async function ut(e){var t=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.prototype.map.call(new Uint8Array(n),a=>("00"+a.toString(16)).slice(-2)).join("");return r}var ct=typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof crypto.subtle.digest=="function",_r=ct?ut:ot;function wr(e){for(var t=0,n=e.length,r=0;r<n;r++)t=t+e.charCodeAt(r),t|=0;return t}var lt="15.39.0";function dt(e,t){return Fe(function(n,r){var a=null,s=0,i=!1,o=function(){return i&&!a&&r.complete()};n.subscribe(ae(r,function(u){a?.unsubscribe();var d=0,c=s++;je(e(u,c)).subscribe(a=ae(r,function(v){return r.next(t?t(u,v,c,d++):v)},function(){a=null,o()}))},function(){i=!0,o()}))})}var br="_rxdb_internal",Sr="rxdatabase_storage_local";async function ft(e,t){var n=await e.findDocumentsById([t],!1),r=n[0];if(r)return r}async function Br(e,t,n){var r=await e.bulkWrite([t],n);if(r.error.length>0){var a=r.error[0];throw a}else{var s=H(e.schema.primaryKey),i=X(s,[t],r),o=i[0];return o}}function Tr(e,t){var n=ft(e,t),r=e.changeStream().pipe(se(a=>a.events.find(s=>s.documentId===t)),ie(a=>!!a),se(a=>Promise.resolve(O(a).documentData)),qe(n),dt(a=>a),ie(a=>!!a));return r}function kr(e){return Object.assign({},...e)}function Er(e,t,n,r){if(r)throw r.status===409?N("CONFLICT",{collection:e.name,id:t,writeError:r,data:n}):r.status===422?N("VD2",{collection:e.name,id:t,writeError:r,data:n}):r}function Mr(e,t,n,r,a,s,i){for(var o=!!e.schema.attachments,u=[],d=[],c=[],v=Ne(10),l={id:v,events:[],checkpoint:null,context:a,startTime:me(),endTime:0},M=l.events,S=[],w=[],D=[],C=n.size>0,k,f=r.length,$=function(){var p=r[B],g=p.document,h=p.previous,b=g[t],W=g._deleted,re=h&&h._deleted,x=void 0;C&&(x=n.get(b));var P;if(x){var Re=x._rev;if(!h||h&&Re!==h._rev){var Ae={isError:!0,status:409,documentId:b,writeRow:p,documentInDb:x};return c.push(Ae),1}var z=o?J(p):p;o&&(W?h&&Object.keys(h._attachments).forEach(y=>{w.push({documentId:b,attachmentId:y,digest:O(h)._attachments[y].digest})}):(Object.entries(g._attachments).find(([y,_])=>{var q=h?h._attachments[y]:void 0;return!q&&!_.data&&(P={documentId:b,documentInDb:x,isError:!0,status:510,writeRow:p,attachmentId:y}),!0}),P||Object.entries(g._attachments).forEach(([y,_])=>{var q=h?h._attachments[y]:void 0;if(!q)S.push({documentId:b,attachmentId:y,attachmentData:_,digest:_.digest});else{var Ie=z.document._attachments[y].digest;_.data&&q.digest!==Ie&&D.push({documentId:b,attachmentId:y,attachmentData:_,digest:_.digest})}}))),P?c.push(P):(o?(d.push(J(z)),i&&i(g)):(d.push(z),i&&i(g)),k=z);var F=null,V=null,j=null;if(re&&!W)j="INSERT",F=o?A(g):g;else if(h&&!re&&!W)j="UPDATE",F=o?A(g):g,V=h;else if(W)j="DELETE",F=O(g),V=h;else throw N("SNH",{args:{writeRow:p}});var Le={documentId:b,documentData:F,previousDocumentData:V,operation:j};M.push(Le)}else{var Ce=!!W;if(o&&Object.entries(g._attachments).forEach(([y,_])=>{_.data?S.push({documentId:b,attachmentId:y,attachmentData:_,digest:_.digest}):(P={documentId:b,isError:!0,status:510,writeRow:p,attachmentId:y},c.push(P))}),P||(o?(u.push(J(p)),s&&s(g)):(u.push(p),s&&s(g)),k=p),!Ce){var Pe={documentId:b,operation:"INSERT",documentData:o?A(g):g,previousDocumentData:o&&h?A(h):h};M.push(Pe)}}},B=0;B<f;B++)$();return{bulkInsertDocs:u,bulkUpdateDocs:d,newestRow:k,errors:c,eventBulk:l,attachmentsAdd:S,attachmentsRemove:w,attachmentsUpdate:D}}function J(e){return{previous:e.previous,document:A(e.document)}}function mt(e){return atob(e).length}function ht(e){var t=e.data;if(!t)return e;var n={length:mt(t),digest:e.digest,type:e.type};return n}function A(e){if(!e._attachments||Object.keys(e._attachments).length===0)return e;var t=G(e);return t._attachments={},Object.entries(e._attachments).forEach(([n,r])=>{t._attachments[n]=ht(r)}),t}function vt(e){return Object.assign({},e,{_meta:G(e._meta)})}var he=new WeakMap;function Dr(e,t,n){Oe.deepFreezeWhenDevMode(n);var r=H(t.schema.primaryKey),a={originalStorageInstance:t,schema:t.schema,internals:t.internals,collectionName:t.collectionName,databaseName:t.databaseName,options:t.options,bulkWrite(s,i){for(var o=e.token,u=new Array(s.length),d=me(),c=0;c<s.length;c++){var v=s[c],l=vt(v.document);l._meta.lwt=d;var M=v.previous;l._rev=oe(o,M),u[c]={document:l,previous:M}}return Ke("preStorageWrite",{storageInstance:this.originalStorageInstance,rows:u}),e.lockedRun(()=>t.bulkWrite(u,i)).then(S=>{var w={error:[]},D=X(r,u,S);he.set(w,D);var C=S.error.length===0?[]:S.error.filter(f=>f.status===409&&!f.writeRow.previous&&!f.writeRow.document._deleted&&O(f.documentInDb)._deleted?!0:(w.error.push(f),!1));if(C.length>0){var k=C.map(f=>({previous:f.documentInDb,document:Object.assign({},f.writeRow.document,{_rev:oe(e.token,f.documentInDb)})}));return e.lockedRun(()=>t.bulkWrite(k,i)).then(f=>{ne(w.error,f.error);var $=X(r,k,f);return ne(D,$),w})}return w})},query(s){return e.lockedRun(()=>t.query(s))},count(s){return e.lockedRun(()=>t.count(s))},findDocumentsById(s,i){return e.lockedRun(()=>t.findDocumentsById(s,i))},getAttachmentData(s,i,o){return e.lockedRun(()=>t.getAttachmentData(s,i,o))},getChangedDocumentsSince:t.getChangedDocumentsSince?(s,i)=>e.lockedRun(()=>t.getChangedDocumentsSince(O(s),i)):void 0,cleanup(s){return e.lockedRun(()=>t.cleanup(s))},remove(){return e.storageInstances.delete(a),e.lockedRun(()=>t.remove())},close(){return e.storageInstances.delete(a),e.lockedRun(()=>t.close())},changeStream(){return t.changeStream()},conflictResultionTasks(){return t.conflictResultionTasks()},resolveConflictResultionTask(s){if(s.output.isEqual)return t.resolveConflictResultionTask(s);var i=Object.assign({},s.output.documentData,{_meta:ze(),_rev:Ue(),_attachments:{}}),o=G(i);return delete o._meta,delete o._rev,delete o._attachments,t.resolveConflictResultionTask({id:s.id,output:{isEqual:!1,documentData:o}})}};return e.storageInstances.add(a),a}function Cr(e){if(e.schema.keyCompression)throw N("UT5",{args:{params:e}});if(gt(e.schema))throw N("UT6",{args:{params:e}});if(e.schema.attachments&&e.schema.attachments.compression)throw N("UT7",{args:{params:e}})}function gt(e){return!!(e.encrypted&&e.encrypted.length>0||e.attachments&&e.attachments.encrypted)}function pt(e,t,n){var r=H(e.schema.primaryKey),a=n?n.lwt:$e,s=n?n.id:"";return We(e.schema,{selector:{$or:[{"_meta.lwt":{$gt:a}},{"_meta.lwt":{$eq:a},[r]:{$gt:n?s:""}}],"_meta.lwt":{$gte:a}},sort:[{"_meta.lwt":"asc"},{[r]:"asc"}],skip:0,limit:t})}async function Pr(e,t,n){if(e.getChangedDocumentsSince)return e.getChangedDocumentsSince(t,n);var r=H(e.schema.primaryKey),a=He(e.schema,pt(e,t,n)),s=await e.query(a),i=s.documents,o=xe(i);return{documents:i,checkpoint:o?{id:o[r],lwt:o._meta.lwt}:n||{id:"",lwt:0}}}function X(e,t,n){var r=he.get(n);if(r)return r;var a=[];if(n.error.length>0){for(var s=new Set,i=0;i<n.error.length;i++){var o=n.error[i];s.add(o.documentId)}for(var u=0;u<t.length;u++){var d=t[u].document;s.has(d[e])||a.push(A(d))}}else{a.length=t.length-n.error.length;for(var c=0;c<t.length;c++){var v=t[c].document;a[c]=A(v)}}return a}function Rr(e){var t=Ve,n={name:"random-delay-"+e.storage.name,rxdbVersion:lt,async createStorageInstance(r){await m(e.delayTimeBefore());var a=await e.storage.createStorageInstance(r);return await m(e.delayTimeAfter()),{databaseName:a.databaseName,internals:a.internals,options:a.options,schema:a.schema,collectionName:a.collectionName,bulkWrite(s,i){t=t.then(async()=>{await m(e.delayTimeBefore());var u=await a.bulkWrite(s,i);return await m(e.delayTimeAfter()),u});var o=t;return o},async findDocumentsById(s,i){await m(e.delayTimeBefore());var o=await a.findDocumentsById(s,i);return await m(e.delayTimeAfter()),o},async query(s){await m(e.delayTimeBefore());var i=await a.query(s);return i},async count(s){await m(e.delayTimeBefore());var i=await a.count(s);return await m(e.delayTimeAfter()),i},async getAttachmentData(s,i,o){await m(e.delayTimeBefore());var u=await a.getAttachmentData(s,i,o);return await m(e.delayTimeAfter()),u},getChangedDocumentsSince:a.getChangedDocumentsSince?async(s,i)=>{await m(e.delayTimeBefore());var o=await O(a.getChangedDocumentsSince)(s,i);return await m(e.delayTimeAfter()),o}:void 0,changeStream(){return a.changeStream()},conflictResultionTasks(){return a.conflictResultionTasks()},resolveConflictResultionTask(s){return a.resolveConflictResultionTask(s)},async cleanup(s){await m(e.delayTimeBefore());var i=await a.cleanup(s);return await m(e.delayTimeAfter()),i},async close(){await m(e.delayTimeBefore());var s=await a.close();return await m(e.delayTimeAfter()),s},async remove(){await m(e.delayTimeBefore());var s=await a.remove();return await m(e.delayTimeAfter()),s}}}};return n}class ve{ttl;map=new Map;_to=!1;constructor(t){this.ttl=t}has(t){return this.map.has(t)}add(t){this.map.set(t,ge()),this._to||(this._to=!0,setTimeout(()=>{this._to=!1,yt(this)},0))}clear(){this.map.clear()}}function yt(e){const t=ge()-e.ttl,n=e.map[Symbol.iterator]();for(;;){const r=n.next().value;if(!r)return;const a=r[0];if(r[1]<t)e.map.delete(a);else return}}function ge(){return Date.now()}function _t(e){return e&&typeof e.then=="function"}Promise.resolve(!1);var Ar=Promise.resolve(!0),L=Promise.resolve();function pe(e,t){return e||(e=0),new Promise(function(n){return setTimeout(function(){return n(t)},e)})}function wt(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function Y(){return Math.random().toString(36).substring(2)}var Q=0;function U(){var e=Date.now()*1e3;return e<=Q&&(e=Q+1),Q=e,e}function Lr(){return typeof navigator<"u"&&typeof navigator.locks<"u"&&typeof navigator.locks.request=="function"}var bt=U,St="native";function Bt(e){var t={time:U(),messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(n){t.messagesCallback&&t.messagesCallback(n.data)},t}function Tt(e){e.bc.close(),e.subFns=[]}function kt(e,t){try{return e.bc.postMessage(t,!1),L}catch(n){return Promise.reject(n)}}function Et(e,t){e.messagesCallback=t}function Mt(){if(typeof globalThis<"u"&&globalThis.Deno&&globalThis.Deno.args)return!0;if((typeof window<"u"||typeof self<"u")&&typeof BroadcastChannel=="function"){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}else return!1}function Dt(){return 150}var Ct={create:Bt,close:Tt,onMessage:Et,postMessage:kt,canBeUsed:Mt,type:St,averageResponseTime:Dt,microSeconds:bt};function Z(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return typeof t.webWorkerSupport>"u"&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=1e3*45),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&typeof e.idb.onclose=="function"&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=1e3*60),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=1e3*60*2),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),typeof t.node.useFastPath>"u"&&(t.node.useFastPath=!0),t}var Pt=U,Rt="pubkey.broadcast-channel-0-",T="messages",K={durability:"relaxed"},At="idb";function ye(){if(typeof indexedDB<"u")return indexedDB;if(typeof window<"u"){if(typeof window.mozIndexedDB<"u")return window.mozIndexedDB;if(typeof window.webkitIndexedDB<"u")return window.webkitIndexedDB;if(typeof window.msIndexedDB<"u")return window.msIndexedDB}return!1}function ee(e){e.commit&&e.commit()}function Lt(e){var t=ye(),n=Rt+e,r=t.open(n);return r.onupgradeneeded=function(a){var s=a.target.result;s.createObjectStore(T,{keyPath:"id",autoIncrement:!0})},new Promise(function(a,s){r.onerror=function(i){return s(i)},r.onsuccess=function(){a(r.result)}})}function It(e,t,n){var r=Date.now(),a={uuid:t,time:r,data:n},s=e.transaction([T],"readwrite",K);return new Promise(function(i,o){s.oncomplete=function(){return i()},s.onerror=function(d){return o(d)};var u=s.objectStore(T);u.add(a),ee(s)})}function Nt(e,t){var n=e.transaction(T,"readonly",K),r=n.objectStore(T),a=[],s=IDBKeyRange.bound(t+1,1/0);if(r.getAll){var i=r.getAll(s);return new Promise(function(u,d){i.onerror=function(c){return d(c)},i.onsuccess=function(c){u(c.target.result)}})}function o(){try{return s=IDBKeyRange.bound(t+1,1/0),r.openCursor(s)}catch{return r.openCursor()}}return new Promise(function(u,d){var c=o();c.onerror=function(v){return d(v)},c.onsuccess=function(v){var l=v.target.result;l?l.value.id<t+1?l.continue(t+1):(a.push(l.value),l.continue()):(ee(n),u(a))}})}function Ot(e,t){if(e.closed)return Promise.resolve([]);var n=e.db.transaction(T,"readwrite",K),r=n.objectStore(T);return Promise.all(t.map(function(a){var s=r.delete(a);return new Promise(function(i){s.onsuccess=function(){return i()}})}))}function $t(e,t){var n=Date.now()-t,r=e.transaction(T,"readonly",K),a=r.objectStore(T),s=[];return new Promise(function(i){a.openCursor().onsuccess=function(o){var u=o.target.result;if(u){var d=u.value;d.time<n?(s.push(d),u.continue()):(ee(r),i(s))}else i(s)}})}function Wt(e){return $t(e.db,e.options.idb.ttl).then(function(t){return Ot(e,t.map(function(n){return n.id}))})}function xt(e,t){return t=Z(t),Lt(e).then(function(n){var r={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:Y(),eMIs:new ve(t.idb.ttl*2),writeBlockPromise:L,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){r.closed=!0,t.idb.onclose&&t.idb.onclose()},_e(r),r})}function _e(e){e.closed||we(e).then(function(){return pe(e.options.idb.fallbackInterval)}).then(function(){return _e(e)})}function Ut(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}function we(e){return e.closed||!e.messagesCallback?L:Nt(e.db,e.lastCursorId).then(function(t){var n=t.filter(function(r){return!!r}).map(function(r){return r.id>e.lastCursorId&&(e.lastCursorId=r.id),r}).filter(function(r){return Ut(r,e)}).sort(function(r,a){return r.time-a.time});return n.forEach(function(r){e.messagesCallback&&(e.eMIs.add(r.id),e.messagesCallback(r.data))}),L})}function zt(e){e.closed=!0,e.db.close()}function Ft(e,t){return e.writeBlockPromise=e.writeBlockPromise.then(function(){return It(e.db,e.uuid,t)}).then(function(){wt(0,10)===0&&Wt(e)}),e.writeBlockPromise}function jt(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,we(e)}function qt(){return!!ye()}function Ht(e){return e.idb.fallbackInterval*2}var Kt={create:xt,close:zt,onMessage:jt,postMessage:Ft,canBeUsed:qt,type:At,averageResponseTime:Ht,microSeconds:Pt},Vt=U,Jt="pubkey.broadcastChannel-",Qt="localstorage";function be(){var e;if(typeof window>"u")return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch{}return e}function Se(e){return Jt+e}function Xt(e,t){return new Promise(function(n){pe().then(function(){var r=Se(e.channelName),a={token:Y(),time:Date.now(),data:t,uuid:e.uuid},s=JSON.stringify(a);be().setItem(r,s);var i=document.createEvent("Event");i.initEvent("storage",!0,!0),i.key=r,i.newValue=s,window.dispatchEvent(i),n()})})}function Gt(e,t){var n=Se(e),r=function(s){s.key===n&&t(JSON.parse(s.newValue))};return window.addEventListener("storage",r),r}function Yt(e){window.removeEventListener("storage",e)}function Zt(e,t){if(t=Z(t),!Be())throw new Error("BroadcastChannel: localstorage cannot be used");var n=Y(),r=new ve(t.localstorage.removeTimeout),a={channelName:e,uuid:n,eMIs:r};return a.listener=Gt(e,function(s){a.messagesCallback&&s.uuid!==n&&(!s.token||r.has(s.token)||s.data.time&&s.data.time<a.messagesCallbackTime||(r.add(s.token),a.messagesCallback(s.data)))}),a}function er(e){Yt(e.listener)}function tr(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t}function Be(){var e=be();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch{return!1}return!0}function rr(){var e=120,t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?e*2:e}var nr={create:Zt,close:er,onMessage:tr,postMessage:Xt,canBeUsed:Be,type:Qt,averageResponseTime:rr,microSeconds:Vt},Te=U,ar="simulate",te=new Set;function sr(e){var t={time:Te(),name:e,messagesCallback:null};return te.add(t),t}function ir(e){te.delete(e)}var ke=5;function or(e,t){return new Promise(function(n){return setTimeout(function(){var r=Array.from(te);r.forEach(function(a){a.name===e.name&&a!==e&&a.messagesCallback&&a.time<t.time&&a.messagesCallback(t)}),n()},ke)})}function ur(e,t){e.messagesCallback=t}function cr(){return!0}function lr(){return ke}var dr={create:sr,close:ir,onMessage:ur,postMessage:or,canBeUsed:cr,type:ar,averageResponseTime:lr,microSeconds:Te},ce=[Ct,Kt,nr];function fr(e){var t=[].concat(e.methods,ce).filter(Boolean);if(e.type){if(e.type==="simulate")return dr;var n=t.find(function(a){return a.type===e.type});if(n)return n;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter(function(a){return a.type!=="idb"}));var r=t.find(function(a){return a.canBeUsed()});if(r)return r;throw new Error("No usable method found in "+JSON.stringify(ce.map(function(a){return a.type})))}var Ee=new Set,mr=0,Me=function(t,n){this.id=mr++,Ee.add(this),this.name=t,this.options=Z(n),this.method=fr(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,hr(this)};Me._pubkey=!0;Me.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(t));return le(this,"message",t)},postInternal:function(t){return le(this,"internal",t)},set onmessage(e){var t=this.method.microSeconds(),n={time:t,fn:e};fe(this,"message",this._onML),e&&typeof e=="function"?(this._onML=n,de(this,"message",n)):this._onML=null},addEventListener:function(t,n){var r=this.method.microSeconds(),a={time:r,fn:n};de(this,t,a)},removeEventListener:function(t,n){var r=this._addEL[t].find(function(a){return a.fn===n});fe(this,t,r)},close:function(){var t=this;if(!this.closed){Ee.delete(this),this.closed=!0;var n=this._prepP?this._prepP:L;return this._onML=null,this._addEL.message=[],n.then(function(){return Promise.all(Array.from(t._uMP))}).then(function(){return Promise.all(t._befC.map(function(r){return r()}))}).then(function(){return t.method.close(t._state)})}},get type(){return this.method.type},get isClosed(){return this.closed}};function le(e,t,n){var r=e.method.microSeconds(),a={time:r,type:t,data:n},s=e._prepP?e._prepP:L;return s.then(function(){var i=e.method.postMessage(e._state,a);return e._uMP.add(i),i.catch().then(function(){return e._uMP.delete(i)}),i})}function hr(e){var t=e.method.create(e.name,e.options);_t(t)?(e._prepP=t,t.then(function(n){e._state=n})):e._state=t}function De(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function de(e,t,n){e._addEL[t].push(n),vr(e)}function fe(e,t,n){e._addEL[t]=e._addEL[t].filter(function(r){return r!==n}),gr(e)}function vr(e){if(!e._iL&&De(e)){var t=function(a){e._addEL[a.type].forEach(function(s){a.time>=s.time&&s.fn(a.data)})},n=e.method.microSeconds();e._prepP?e._prepP.then(function(){e._iL=!0,e.method.onMessage(e._state,t,n)}):(e._iL=!0,e.method.onMessage(e._state,t,n))}}function gr(e){if(e._iL&&!De(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}export{pe as A,Me as B,Ar as C,br as I,ve as O,L as P,Sr as R,J as a,mt as b,Mr as c,ht as d,A as e,vt as f,ft as g,Dr as h,Cr as i,gt as j,pt as k,Pr as l,X as m,ot as n,Tr as o,ut as p,ct as q,Rr as r,kr as s,Er as t,_r as u,wr as v,Br as w,lt as x,Y as y,Lr as z};
