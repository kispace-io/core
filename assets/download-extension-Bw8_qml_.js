import{F as h}from"./main-BEYAOB-D.js";function y({commandRegistry:f,workspaceService:m,taskService:p,toastError:l,toastInfo:w}){f.registerAll({command:{id:"download",name:"Download File",description:"Download a file from a URL to the workspace",parameters:[{name:"url",description:"the URL of the file to download",required:!0},{name:"filename",description:"optional filename to save as (will be auto-detected if not provided)",required:!1}]},handler:{canExecute:a=>{const n=a.params&&a.params.url;return n?n.startsWith("http://")||n.startsWith("https://"):!1},execute:async a=>{const n=a.params&&a.params.url;if(!n){l("No URL provided.");return}const d=await m.getWorkspace();if(!d){l("No workspace selected.");return}await p.runAsync("Downloading file",async o=>{o.message="Starting download...",o.progress=0;try{const i=await fetch(n,{mode:"cors",credentials:"omit"});if(!i.ok){l("Failed to download file: "+i.statusText);return}let t=a.params&&a.params.filename;if(!t){const s=i.headers.get("content-disposition");if(s){let e=s.match(/filename="([^"]+)"/);e&&e[1]?t=e[1]:(e=s.match(/filename=([^;]+)/),e&&e[1]&&(t=e[1].trim()))}if(!t){const e=new URL(n).pathname.split("/").filter(c=>c.length>0),r=e[e.length-1];r&&r.includes(".")?t=r:t=`downloaded-file-${new Date().toISOString().replace(/[:.]/g,"-").replace("T","_").slice(0,-5)}`}}const u=await d.getResource(t,{create:!0});o.message=`Downloading ${t}...`,o.progress=50,await u.saveContents(i.body,{contentType:h.BINARY}),o.progress=100,w(`File downloaded: ${t}`)}catch(i){throw l("Failed to download file: "+i),i}})}}})}export{y as default};
