import{b as m,t as s,w as p,c as w,F as u,d as h}from"./main-e2lcKaqt.js";m({command:{id:"download",name:"Download File",description:"Download a file from a URL to the workspace",parameters:[{name:"url",description:"the URL of the file to download",required:!0},{name:"filename",description:"optional filename to save as (will be auto-detected if not provided)",required:!1}]},handler:{canExecute:t=>{const o=t.params&&t.params.url;return o?o.startsWith("http://")||o.startsWith("https://"):!1},execute:async t=>{const o=t.params&&t.params.url;if(!o){s("No URL provided.");return}const d=await p.getWorkspace();if(!d){s("No workspace selected.");return}await w.runAsync("Downloading file",async n=>{n.message="Starting download...",n.progress=0;try{const i=await fetch(o,{mode:"cors",credentials:"omit"});if(!i.ok){s("Failed to download file: "+i.statusText);return}let a=t.params&&t.params.filename;if(!a){const r=i.headers.get("content-disposition");if(r){let e=r.match(/filename="([^"]+)"/);e&&e[1]?a=e[1]:(e=r.match(/filename=([^;]+)/),e&&e[1]&&(a=e[1].trim()))}if(!a){const e=new URL(o).pathname.split("/").filter(c=>c.length>0),l=e[e.length-1];l&&l.includes(".")?a=l:a=`downloaded-file-${new Date().toISOString().replace(/[:.]/g,"-").replace("T","_").slice(0,-5)}`}}const f=await d.getResource(a,{create:!0});n.message=`Downloading ${a}...`,n.progress=50,await f.saveContents(i.body,{contentType:u.BINARY}),n.progress=100,h(`File downloaded: ${a}`)}catch(i){throw s("Failed to download file: "+i),i}})}}});
