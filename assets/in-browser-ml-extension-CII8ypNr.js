import{P as g,r as m,a as l,t as u,f as d,N as T,Q as w}from"./main-DA1jwneq.js";import{i as c,M as f,a as b}from"./in-browser-ml-service-Kk2snPCf.js";const E=T("InBrowserML"),_="toolbar:media-viewer",a=g(!1),s=g(!1);function y(){return a.get()||s.get()}function h(r){return!r||typeof r.getMediaUrl!="function"?!1:r.getIsImage?.()===!0}const x=["#0d6efd","#dc3545","#198754","#fd7e14","#6f42c1","#20c997","#e83e8c","#ffc107","#0dcaf0","#6c757d"];function M(r,n){let i=0;for(let e=0;e<r.length;e++)i=i*31+r.charCodeAt(e)>>>0;return n[i%n.length]}function v(r,n,i){const e=n||1,t=i||1;return r.map(o=>({type:"bbox",left:o.box.xmin/e,top:o.box.ymin/t,width:(o.box.xmax-o.box.xmin)/e,height:(o.box.ymax-o.box.ymin)/t,label:`${o.label} ${(o.score*100).toFixed(0)}%`,color:M(o.label,x)}))}m({command:{id:"detect_objects_in_current_image",name:"Detect objects",description:"Runs object detection on the image currently open in the media viewer.",parameters:[],output:[]},handler:{execute:async r=>{const n=r.activeEditor;if(!h(n))return{error:"No image open in the media viewer."};const i=n.getMediaUrl();if(!i)return{error:"No image URL available."};try{return a.set(!0),await l.runAsync("Detecting objects",async()=>{const t=await(await c.getPipeline(f.OBJECT_DETECTION,b.OBJECT_DETECTION_YOLOV9))(i),{width:o,height:p}=n.getImageDimensions();n.setOverlays(v(t,o,p))}),{ok:!0}}catch(e){const t=e instanceof Error?e.message:String(e);return E.error(`Object detection failed: ${t}`),u(t),{error:t}}finally{a.set(!1)}}}});m({command:{id:"segment_image_in_current_image",name:"Segment",description:"Runs image segmentation on the image currently open in the media viewer.",parameters:[],output:[]},handler:{execute:async r=>{const n=r.activeEditor;if(!h(n))return{error:"No image open in the media viewer."};const i=n.getMediaUrl();if(!i)return{error:"No image URL available."};try{return s.set(!0),await l.runAsync("Segmenting image",async()=>{const t=await(await c.getPipeline(f.IMAGE_SEGMENTATION,b.IMAGE_SEGMENTATION))(i,{taskType:"image-segmentation"});n.setOverlays(t)}),{ok:!0}}catch(e){const t=e instanceof Error?e.message:String(e);return E.error(`Segmentation failed: ${t}`),u(t),{error:t}}finally{s.set(!1)}}}});d.registerContribution(_,{label:"Detect objects",icon:"magnifying-glass",command:"detect_objects_in_current_image",disabled:()=>y()});d.registerContribution(_,{label:"Segment",icon:"scissors",command:"segment_image_in_current_image",disabled:()=>y()});const I=({})=>{w.put("inBrowserMLService",c)};export{I as default};
