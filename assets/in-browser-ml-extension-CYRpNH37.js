import{H as l,l as d,I as g,m,a as u,x as f,k as b}from"./main-BbPsMdsl.js";import{i as s,M as x,a as E}from"./in-browser-ml-service-CNQp0UFm.js";const h=f("InBrowserML"),y="toolbar:media-viewer",a=l(!1);function T(o){return!o||typeof o.getMediaUrl!="function"?!1:o.getIsImage?.()===!0}const _=["#0d6efd","#dc3545","#198754","#fd7e14","#6f42c1","#20c997","#e83e8c","#ffc107","#0dcaf0","#6c757d"];function w(o,r){let n=0;for(let e=0;e<o.length;e++)n=n*31+o.charCodeAt(e)>>>0;return r[n%r.length]}function p(o,r,n){const e=r||1,i=n||1;return o.map(t=>({type:"bbox",left:t.box.xmin/e,top:t.box.ymin/i,width:(t.box.xmax-t.box.xmin)/e,height:(t.box.ymax-t.box.ymin)/i,label:`${t.label} ${(t.score*100).toFixed(0)}%`,color:w(t.label,_)}))}d({command:{id:"detect_objects_in_current_image",name:"Detect objects",description:"Runs object detection on the image currently open in the media viewer.",parameters:[],output:[]},handler:{execute:async o=>{const r=o.activeEditor;if(!T(r))return{error:"No image open in the media viewer."};const n=r.getMediaUrl();if(!n)return{error:"No image URL available."};try{return a.set(!0),await g.runAsync("Detecting objects",async()=>{const i=await(await s.getPipeline(x.OBJECT_DETECTION,E.OBJECT_DETECTION_YOLOV9))(n),{width:t,height:c}=r.getImageDimensions();r.setOverlays(p(i,t,c))}),{ok:!0}}catch(e){const i=e instanceof Error?e.message:String(e);return h.error(`Object detection failed: ${i}`),m(i),{error:i}}finally{a.set(!1)}}}});u.registerContribution(y,{label:"Detect objects",icon:"magnifying-glass",command:"detect_objects_in_current_image",disabled:()=>a.get()});const v=({})=>{b.put("inBrowserMLService",s)};export{v as default};
