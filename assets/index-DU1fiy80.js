import{U as Di,V as ji}from"./main-YFahtWAy.js";import{h as Xn,Y as Ur,ao as Vr,aw as Wr,g as Ti,aA as Ci,f as zr,_ as Ri,a0 as Bi,I as qi,d as Ni,a as Mi,e as jr}from"./rx-query-helper-BcrKuOYb.js";import{g as Fi,N as Un,S as Tr}from"./rx-query-DwNc9SXH.js";import{e as Li,g as Ui,d as Vi,f as Wi,R as zi}from"./broadcast-channel-BJ27dWwq.js";import{R as Fn,P as $i,a as Xi}from"./rx-storage-multiinstance-uaBghu3s.js";var Gt={exports:{}},Yi=Gt.exports,Cr;function Gi(){return Cr||(Cr=1,(function(O,E){(function(A,w){O.exports=w()})(Yi,function(){var A=function(e,t){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])})(e,t)},w=function(){return(w=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function M(e,t,n){for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var T=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Di,B=Object.keys,N=Array.isArray;function R(e,t){return typeof t!="object"||B(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>"u"||T.Promise||(T.Promise=Promise);var re=Object.getPrototypeOf,J={}.hasOwnProperty;function X(e,t){return J.call(e,t)}function ee(e,t){typeof t=="function"&&(t=t(re(e))),(typeof Reflect>"u"?B:Reflect.ownKeys)(t).forEach(function(n){$(e,n,t[n])})}var he=Object.defineProperty;function $(e,t,n,r){he(e,t,R(n&&X(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function ue(e){return{from:function(t){return e.prototype=Object.create(t.prototype),$(e.prototype,"constructor",e),{extend:ee.bind(null,e.prototype)}}}}var gt=Object.getOwnPropertyDescriptor,bt=[].slice;function We(e,t,n){return bt.call(e,t,n)}function Ae(e,t){return t(e)}function Ie(e){if(!e)throw new Error("Assertion Failed")}function ze(e){T.setImmediate?setImmediate(e):setTimeout(e,0)}function de(e,t){if(typeof t=="string"&&X(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],r=0,i=t.length;r<i;++r){var a=de(e,t[r]);n.push(a)}return n}var o=t.indexOf(".");if(o!==-1){var u=e[t.substr(0,o)];return u==null?void 0:de(u,t.substr(o+1))}}function ce(e,t,n){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){Ie(typeof n!="string"&&"length"in n);for(var r=0,i=t.length;r<i;++r)ce(e,t[r],n[r])}else{var a,o,u=t.indexOf(".");u!==-1?(a=t.substr(0,u),(o=t.substr(u+1))===""?n===void 0?N(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=n:ce(u=!(u=e[a])||!X(e,a)?e[a]={}:u,o,n)):n===void 0?N(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Yn(e){var t,n={};for(t in e)X(e,t)&&(n[t]=e[t]);return n}var Hr=[].concat;function Gn(e){return Hr.apply([],e)}var we="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Gn([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return T[e]}),Hn=new Set(we.map(function(e){return T[e]})),rt=null;function De(e){return rt=new WeakMap,e=(function t(n){if(!n||typeof n!="object")return n;var r=rt.get(n);if(r)return r;if(N(n)){r=[],rt.set(n,r);for(var i=0,a=n.length;i<a;++i)r.push(t(n[i]))}else if(Hn.has(n.constructor))r=n;else{var o,u=re(n);for(o in r=u===Object.prototype?{}:Object.create(u),rt.set(n,r),n)X(n,o)&&(r[o]=t(n[o]))}return r})(e),rt=null,e}var Qr={}.toString;function Jt(e){return Qr.call(e).slice(8,-1)}var en=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Zr=typeof en=="symbol"?function(e){var t;return e!=null&&(t=e[en])&&t.apply(e)}:function(){return null};function je(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var $e={};function ge(e){var t,n,r,i;if(arguments.length===1){if(N(e))return e.slice();if(this===$e&&typeof e=="string")return[e];if(i=Zr(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(n=new Array(t);t--;)n[t]=e[t];return n}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var tn=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ot=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],pe=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ot),Jr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Xe(e,t){this.name=e,this.message=t}function Qn(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function wt(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Qn(e,t)}function Ye(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=Qn(e,this.failures)}ue(Xe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),ue(wt).from(Xe),ue(Ye).from(Xe);var nn=pe.reduce(function(e,t){return e[t]=t+"Error",e},{}),ei=Xe,q=pe.reduce(function(e,t){var n=t+"Error";function r(i,a){this.name=n,i?typeof i=="string"?(this.message="".concat(i).concat(a?`
 `+a:""),this.inner=a||null):typeof i=="object"&&(this.message="".concat(i.name," ").concat(i.message),this.inner=i):(this.message=Jr[t]||n,this.inner=null)}return ue(r).from(ei),e[t]=r,e},{});q.Syntax=SyntaxError,q.Type=TypeError,q.Range=RangeError;var Zn=ot.reduce(function(e,t){return e[t+"Error"]=q[t],e},{}),_t=pe.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=q[t]),e},{});function Y(){}function it(e){return e}function ti(e,t){return e==null||e===it?t:function(n){return t(e(n))}}function Te(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ni(e,t){return e===Y?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Te(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Te(i,this.onerror):i),a!==void 0?a:n}}function ri(e,t){return e===Y?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Te(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Te(r,this.onerror):r)}}function ii(e,t){return e===Y?t:function(n){var r=e.apply(this,arguments);R(n,r);var i=this.onsuccess,a=this.onerror;return this.onsuccess=null,this.onerror=null,n=t.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?Te(i,this.onsuccess):i),a&&(this.onerror=this.onerror?Te(a,this.onerror):a),r===void 0?n===void 0?void 0:n:R(r,n)}}function ai(e,t){return e===Y?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function rn(e,t){return e===Y?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return n.then(function(){return t.apply(r,a)})}return t.apply(this,arguments)}}_t.ModifyError=wt,_t.DexieError=Xe,_t.BulkError=Ye;var ye=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Jn(e){ye=e}var at={},er=100,we=typeof Promise>"u"?[]:(function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,re(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,re(t),e]})(),ot=we[0],pe=we[1],we=we[2],pe=pe&&pe.then,Ce=ot&&ot.constructor,an=!!we,ut=function(e,t){st.push([e,t]),xt&&(queueMicrotask(ui),xt=!1)},on=!0,xt=!0,Re=[],kt=[],un=it,xe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Y,pgp:!1,env:{},finalize:Y},C=xe,st=[],Be=0,Et=[];function D(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=C;if(typeof e!="function"){if(e!==at)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&cn(this,this._value))}this._state=null,this._value=null,++t.ref,(function n(r,i){try{i(function(a){if(r._state===null){if(a===r)throw new TypeError("A promise cannot be resolved with itself.");var o=r._lib&&Ge();a&&typeof a.then=="function"?n(r,function(u,c){a instanceof D?a._then(u,c):a.then(u,c)}):(r._state=!0,r._value=a,nr(r)),o&&He()}},cn.bind(null,r))}catch(a){cn(r,a)}})(this,e)}var sn={get:function(){var e=C,t=Kt;function n(r,i){var a=this,o=!e.global&&(e!==C||t!==Kt),u=o&&!Ee(),c=new D(function(f,p){ln(a,new tr(ir(r,e,o,u),ir(i,e,o,u),f,p,e))});return this._consoleTask&&(c._consoleTask=this._consoleTask),c}return n.prototype=at,n},set:function(e){$(this,"then",e&&e.prototype===at?sn:{get:function(){return e},set:sn.set})}};function tr(e,t,n,r,i){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=r,this.psd=i}function cn(e,t){var n,r;kt.push(t),e._state===null&&(n=e._lib&&Ge(),t=un(t),e._state=!1,e._value=t,r=e,Re.some(function(i){return i._value===r._value})||Re.push(r),nr(e),n&&He())}function nr(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)ln(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),Be===0&&(++Be,ut(function(){--Be==0&&fn()},[]))}function ln(e,t){if(e._state!==null){var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Be,ut(oi,[n,e,t])}else e._listeners.push(t)}function oi(e,t,n){try{var r,i=t._value;!t._state&&kt.length&&(kt=[]),r=ye&&t._consoleTask?t._consoleTask.run(function(){return e(i)}):e(i),t._state||kt.indexOf(i)!==-1||(function(a){for(var o=Re.length;o;)if(Re[--o]._value===a._value)return Re.splice(o,1)})(t),n.resolve(r)}catch(a){n.reject(a)}finally{--Be==0&&fn(),--n.psd.ref||n.psd.finalize()}}function ui(){qe(xe,function(){Ge()&&He()})}function Ge(){var e=on;return xt=on=!1,e}function He(){var e,t,n;do for(;0<st.length;)for(e=st,st=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(0<st.length);xt=on=!0}function fn(){var e=Re;Re=[],e.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var t=Et.slice(0),n=t.length;n;)t[--n]()}function Pt(e){return new D(at,!1,e)}function H(e,t){var n=C;return function(){var r=Ge(),i=C;try{return Pe(n,!0),e.apply(this,arguments)}catch(a){t&&t(a)}finally{Pe(i,!1),r&&He()}}}ee(D.prototype,{then:sn,_then:function(e,t){ln(this,new tr(null,null,e,t,C))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,n=arguments[1];return typeof t=="function"?this.then(null,function(r){return(r instanceof t?n:Pt)(r)}):this.then(null,function(r){return(r&&r.name===t?n:Pt)(r)})},finally:function(e){return this.then(function(t){return D.resolve(e()).then(function(){return t})},function(t){return D.resolve(e()).then(function(){return Pt(t)})})},timeout:function(e,t){var n=this;return e<1/0?new D(function(r,i){var a=setTimeout(function(){return i(new q.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,a))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&$(D.prototype,Symbol.toStringTag,"Dexie.Promise"),xe.env=rr(),ee(D,{all:function(){var e=ge.apply(null,arguments).map(At);return new D(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach(function(i,a){return D.resolve(i).then(function(o){e[a]=o,--r||t(e)},n)})})},resolve:function(e){return e instanceof D?e:e&&typeof e.then=="function"?new D(function(t,n){e.then(t,n)}):new D(at,!0,e)},reject:Pt,race:function(){var e=ge.apply(null,arguments).map(At);return new D(function(t,n){e.map(function(r){return D.resolve(r).then(t,n)})})},PSD:{get:function(){return C},set:function(e){return C=e}},totalEchoes:{get:function(){return Kt}},newPSD:ke,usePSD:qe,scheduler:{get:function(){return ut},set:function(e){ut=e}},rejectionMapper:{get:function(){return un},set:function(e){un=e}},follow:function(e,t){return new D(function(n,r){return ke(function(i,a){var o=C;o.unhandleds=[],o.onunhandled=a,o.finalize=Te(function(){var u,c=this;u=function(){c.unhandleds.length===0?i():a(c.unhandleds[0])},Et.push(function f(){u(),Et.splice(Et.indexOf(f),1)}),++Be,ut(function(){--Be==0&&fn()},[])},o.finalize),e()},t,n,r)})}}),Ce&&(Ce.allSettled&&$(D,"allSettled",function(){var e=ge.apply(null,arguments).map(At);return new D(function(t){e.length===0&&t([]);var n=e.length,r=new Array(n);e.forEach(function(i,a){return D.resolve(i).then(function(o){return r[a]={status:"fulfilled",value:o}},function(o){return r[a]={status:"rejected",reason:o}}).then(function(){return--n||t(r)})})})}),Ce.any&&typeof AggregateError<"u"&&$(D,"any",function(){var e=ge.apply(null,arguments).map(At);return new D(function(t,n){e.length===0&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach(function(a,o){return D.resolve(a).then(function(u){return t(u)},function(u){i[o]=u,--r||n(new AggregateError(i))})})})}),Ce.withResolvers&&(D.withResolvers=Ce.withResolvers));var te={awaits:0,echoes:0,id:0},si=0,Ot=[],St=0,Kt=0,ci=0;function ke(e,t,n,r){var i=C,a=Object.create(i);return a.parent=i,a.ref=0,a.global=!1,a.id=++ci,xe.env,a.env=an?{Promise:D,PromiseProp:{value:D,configurable:!0,writable:!0},all:D.all,race:D.race,allSettled:D.allSettled,any:D.any,resolve:D.resolve,reject:D.reject}:{},t&&R(a,t),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()},r=qe(a,e,n,r),a.ref===0&&a.finalize(),r}function Qe(){return te.id||(te.id=++si),++te.awaits,te.echoes+=er,te.id}function Ee(){return!!te.awaits&&(--te.awaits==0&&(te.id=0),te.echoes=te.awaits*er,!0)}function At(e){return te.echoes&&e&&e.constructor===Ce?(Qe(),e.then(function(t){return Ee(),t},function(t){return Ee(),Q(t)})):e}function li(){var e=Ot[Ot.length-1];Ot.pop(),Pe(e,!1)}function Pe(e,t){var n,r=C;(t?!te.echoes||St++&&e===C:!St||--St&&e===C)||queueMicrotask(t?(function(i){++Kt,te.echoes&&--te.echoes!=0||(te.echoes=te.awaits=te.id=0),Ot.push(C),Pe(i,!0)}).bind(null,e):li),e!==C&&(C=e,r===xe&&(xe.env=rr()),an&&(n=xe.env.Promise,t=e.env,(r.global||e.global)&&(Object.defineProperty(T,"Promise",t.PromiseProp),n.all=t.all,n.race=t.race,n.resolve=t.resolve,n.reject=t.reject,t.allSettled&&(n.allSettled=t.allSettled),t.any&&(n.any=t.any))))}function rr(){var e=T.Promise;return an?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(T,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function qe(e,t,n,r,i){var a=C;try{return Pe(e,!0),t(n,r,i)}finally{Pe(a,!1)}}function ir(e,t,n,r){return typeof e!="function"?e:function(){var i=C;n&&Qe(),Pe(t,!0);try{return e.apply(this,arguments)}finally{Pe(i,!1),r&&queueMicrotask(Ee)}}}function hn(e){Promise===Ce&&te.echoes===0?St===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+pe).indexOf("[native code]")===-1&&(Qe=Ee=Y);var Q=D.reject,Ne="ï¿¿",be="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ar="String expected.",Ze=[],It="__dbnames",dn="readonly",pn="readwrite";function Me(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var or={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Dt(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=De(t))[e],t}}function ur(){throw q.Type()}function W(e,t){try{var n=sr(e),r=sr(t);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return(function(i,a){for(var o=i.length,u=a.length,c=o<u?o:u,f=0;f<c;++f)if(i[f]!==a[f])return i[f]<a[f]?-1:1;return o===u?0:o<u?-1:1})(cr(e),cr(t));case"Array":return(function(i,a){for(var o=i.length,u=a.length,c=o<u?o:u,f=0;f<c;++f){var p=W(i[f],a[f]);if(p!==0)return p}return o===u?0:o<u?-1:1})(e,t)}}catch{}return NaN}function sr(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=Jt(e),e==="ArrayBuffer"?"binary":e)}function cr(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var lr=(G.prototype._trans=function(e,t,n){var r=this._tx||C.trans,i=this.name,a=ye&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function o(f,p,s){if(!s.schema[i])throw new q.NotFound("Table "+i+" not part of transaction");return t(s.idbtrans,s)}var u=Ge();try{var c=r&&r.db._novip===this.db._novip?r===C.trans?r._promise(e,o,n):ke(function(){return r._promise(e,o,n)},{trans:r,transless:C.transless||C}):(function f(p,s,v,l){if(p.idbdb&&(p._state.openComplete||C.letThrough||p._vip)){var d=p._createTransaction(s,v,p._dbSchema);try{d.create(),p._state.PR1398_maxLoop=3}catch(y){return y.name===nn.InvalidState&&p.isOpen()&&0<--p._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),p.close({disableAutoOpen:!1}),p.open().then(function(){return f(p,s,v,l)})):Q(y)}return d._promise(s,function(y,h){return ke(function(){return C.trans=d,l(y,h,d)})}).then(function(y){if(s==="readwrite")try{d.idbtrans.commit()}catch{}return s==="readonly"?y:d._completion.then(function(){return y})})}if(p._state.openComplete)return Q(new q.DatabaseClosed(p._state.dbOpenError));if(!p._state.isBeingOpened){if(!p._state.autoOpen)return Q(new q.DatabaseClosed);p.open().catch(Y)}return p._state.dbReadyPromise.then(function(){return f(p,s,v,l)})})(this.db,e,[this.name],o);return a&&(c._consoleTask=a,c=c.catch(function(f){return console.trace(f),Q(f)})),c}finally{u&&He()}},G.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?Q(new q.Type("Invalid argument to Table.get()")):this._trans("readonly",function(r){return n.core.get({trans:r,key:e}).then(function(i){return n.hook.reading.fire(i)})}).then(t)},G.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(N(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=B(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(u){if(u.compound&&t.every(function(f){return 0<=u.keyPath.indexOf(f)})){for(var c=0;c<t.length;++c)if(t.indexOf(u.keyPath[c])===-1)return!1;return!0}return!1}).sort(function(u,c){return u.keyPath.length-c.keyPath.length})[0];if(n&&this.db._maxKey!==Ne){var a=n.keyPath.slice(0,t.length);return this.where(a).equals(a.map(function(c){return e[c]}))}!n&&ye&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var r=this.schema.idxByName;function i(u,c){return W(u,c)===0}var o=t.reduce(function(s,c){var f=s[0],p=s[1],s=r[c],v=e[c];return[f||s,f||!s?Me(p,s&&s.multi?function(l){return l=de(l,c),N(l)&&l.some(function(d){return i(v,d)})}:function(l){return i(v,de(l,c))}):p]},[null,null]),a=o[0],o=o[1];return a?this.where(a.name).equals(e[a.keyPath]).filter(o):n?this.filter(o):this.where(t).equals("")},G.prototype.filter=function(e){return this.toCollection().and(e)},G.prototype.count=function(e){return this.toCollection().count(e)},G.prototype.offset=function(e){return this.toCollection().offset(e)},G.prototype.limit=function(e){return this.toCollection().limit(e)},G.prototype.each=function(e){return this.toCollection().each(e)},G.prototype.toArray=function(e){return this.toCollection().toArray(e)},G.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},G.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,N(e)?"[".concat(e.join("+"),"]"):e))},G.prototype.reverse=function(){return this.toCollection().reverse()},G.prototype.mapToClass=function(e){var t,n=this.db,r=this.name;function i(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof ur&&((function(c,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function p(){this.constructor=c}A(c,f),c.prototype=f===null?Object.create(f):(p.prototype=f.prototype,new p)})(i,t=e),Object.defineProperty(i.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),i.prototype.table=function(){return r},e=i);for(var a=new Set,o=e.prototype;o;o=re(o))Object.getOwnPropertyNames(o).forEach(function(c){return a.add(c)});function u(c){if(!c)return c;var f,p=Object.create(e.prototype);for(f in c)if(!a.has(f))try{p[f]=c[f]}catch{}return p}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=u,this.hook("reading",u),e},G.prototype.defineClass=function(){return this.mapToClass(function(e){R(this,e)})},G.prototype.add=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,a=r.keyPath,o=e;return a&&i&&(o=Dt(a)(e)),this._trans("readwrite",function(u){return n.core.mutate({trans:u,type:"add",keys:t!=null?[t]:null,values:[o]})}).then(function(u){return u.numFailures?D.reject(u.failures[0]):u.lastResult}).then(function(u){if(a)try{ce(e,a,u)}catch{}return u})},G.prototype.update=function(e,t){return typeof e!="object"||N(e)?this.where(":id").equals(e).modify(t):(e=de(e,this.schema.primKey.keyPath),e===void 0?Q(new q.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},G.prototype.put=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,a=r.keyPath,o=e;return a&&i&&(o=Dt(a)(e)),this._trans("readwrite",function(u){return n.core.mutate({trans:u,type:"put",values:[o],keys:t!=null?[t]:null})}).then(function(u){return u.numFailures?D.reject(u.failures[0]):u.lastResult}).then(function(u){if(a)try{ce(e,a,u)}catch{}return u})},G.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]})}).then(function(n){return n.numFailures?D.reject(n.failures[0]):void 0})},G.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:or})}).then(function(t){return t.numFailures?D.reject(t.failures[0]):void 0})},G.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(r){return r.map(function(i){return t.hook.reading.fire(i)})})})},G.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,a=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(o){var f=r.schema.primKey,u=f.auto,f=f.keyPath;if(f&&i)throw new q.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new q.InvalidArgument("Arguments objects and keys must have the same length");var c=e.length,f=f&&u?e.map(Dt(f)):e;return r.core.mutate({trans:o,type:"add",keys:i,values:f,wantResults:a}).then(function(d){var s=d.numFailures,v=d.results,l=d.lastResult,d=d.failures;if(s===0)return a?v:l;throw new Ye("".concat(r.name,".bulkAdd(): ").concat(s," of ").concat(c," operations failed"),d)})})},G.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,a=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(o){var f=r.schema.primKey,u=f.auto,f=f.keyPath;if(f&&i)throw new q.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new q.InvalidArgument("Arguments objects and keys must have the same length");var c=e.length,f=f&&u?e.map(Dt(f)):e;return r.core.mutate({trans:o,type:"put",keys:i,values:f,wantResults:a}).then(function(d){var s=d.numFailures,v=d.results,l=d.lastResult,d=d.failures;if(s===0)return a?v:l;throw new Ye("".concat(r.name,".bulkPut(): ").concat(s," of ").concat(c," operations failed"),d)})})},G.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(o){return o.key}),i=e.map(function(o){return o.changes}),a=[];return this._trans("readwrite",function(o){return n.getMany({trans:o,keys:r,cache:"clone"}).then(function(u){var c=[],f=[];e.forEach(function(s,v){var l=s.key,d=s.changes,y=u[v];if(y){for(var h=0,m=Object.keys(d);h<m.length;h++){var g=m[h],b=d[g];if(g===t.schema.primKey.keyPath){if(W(b,l)!==0)throw new q.Constraint("Cannot update primary key in bulkUpdate()")}else ce(y,g,b)}a.push(v),c.push(l),f.push(y)}});var p=c.length;return n.mutate({trans:o,type:"put",keys:c,values:f,updates:{keys:r,changeSpecs:i}}).then(function(s){var v=s.numFailures,l=s.failures;if(v===0)return p;for(var d=0,y=Object.keys(l);d<y.length;d++){var h,m=y[d],g=a[Number(m)];g!=null&&(h=l[m],delete l[m],l[g]=h)}throw new Ye("".concat(t.name,".bulkUpdate(): ").concat(v," of ").concat(p," operations failed"),l)})})})},G.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:e})}).then(function(o){var i=o.numFailures,a=o.lastResult,o=o.failures;if(i===0)return a;throw new Ye("".concat(t.name,".bulkDelete(): ").concat(i," of ").concat(n," operations failed"),o)})},G);function G(){}function ct(e){function t(o,u){if(u){for(var c=arguments.length,f=new Array(c-1);--c;)f[c-1]=arguments[c];return n[o].subscribe.apply(null,f),e}if(typeof o=="string")return n[o]}var n={};t.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return t;function a(o,u,c){if(typeof o!="object"){var f;u=u||ai;var p={subscribers:[],fire:c=c||Y,subscribe:function(s){p.subscribers.indexOf(s)===-1&&(p.subscribers.push(s),p.fire=u(p.fire,s))},unsubscribe:function(s){p.subscribers=p.subscribers.filter(function(v){return v!==s}),p.fire=p.subscribers.reduce(u,c)}};return n[o]=t[o]=p}B(f=o).forEach(function(s){var v=f[s];if(N(v))a(s,f[s][0],f[s][1]);else{if(v!=="asap")throw new q.InvalidArgument("Invalid event config");var l=a(s,it,function(){for(var d=arguments.length,y=new Array(d);d--;)y[d]=arguments[d];l.subscribers.forEach(function(h){ze(function(){h.apply(null,y)})})})}})}}function lt(e,t){return ue(t).from({prototype:e}),t}function Je(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function yn(e,t){e.filter=Me(e.filter,t)}function vn(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Me(r(),t())}:t,e.justLimit=n&&!r}function jt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new q.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function fr(e,t,n){var r=jt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function Tt(e,t,n,r){var i=e.replayFilter?Me(e.filter,e.replayFilter()):e.filter;if(e.or){var a={},o=function(u,c,f){var p,s;i&&!i(c,f,function(v){return c.stop(v)},function(v){return c.fail(v)})||((s=""+(p=c.primaryKey))=="[object ArrayBuffer]"&&(s=""+new Uint8Array(p)),X(a,s)||(a[s]=!0,t(u,c,f)))};return Promise.all([e.or._iterate(o,n),hr(fr(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return hr(fr(e,r,n),Me(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function hr(e,t,n,r){var i=H(r?function(a,o,u){return n(r(a),o,u)}:n);return e.then(function(a){if(a)return a.start(function(){var o=function(){return a.continue()};t&&!t(a,function(u){return o=u},function(u){a.stop(u),o=Y},function(u){a.fail(u),o=Y})||i(a.value,a,function(u){return o=u}),o()})})}var we=Symbol(),ft=(dr.prototype.execute=function(e){if(this.add!==void 0){var t=this.add;if(N(t))return M(M([],N(e)?e:[],!0),t).sort();if(typeof t=="number")return(Number(e)||0)+t;if(typeof t=="bigint")try{return BigInt(e)+t}catch{return BigInt(0)+t}throw new TypeError("Invalid term ".concat(t))}if(this.remove!==void 0){var n=this.remove;if(N(n))return N(e)?e.filter(function(r){return!n.includes(r)}).sort():[];if(typeof n=="number")return Number(e)-n;if(typeof n=="bigint")try{return BigInt(e)-n}catch{return BigInt(0)-n}throw new TypeError("Invalid subtrahend ".concat(n))}return t=(t=this.replacePrefix)===null||t===void 0?void 0:t[0],t&&typeof e=="string"&&e.startsWith(t)?this.replacePrefix[1]+e.substring(t.length):e},dr);function dr(e){Object.assign(this,e)}var fi=(z.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,Q.bind(null,n.error)):n.table._trans("readonly",e).then(t)},z.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,Q.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},z.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Me(t.algorithm,e)},z.prototype._iterate=function(e,t){return Tt(this._ctx,e,t,this._ctx.table.core)},z.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&R(n,e),t._ctx=n,t},z.prototype.raw=function(){return this._ctx.valueMapper=null,this},z.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return Tt(t,e,n,t.table.core)})},z.prototype.count=function(e){var t=this;return this._read(function(n){var r=t._ctx,i=r.table.core;if(Je(r,!0))return i.count({trans:n,query:{index:jt(r,i.schema),range:r.range}}).then(function(o){return Math.min(o,r.limit)});var a=0;return Tt(r,function(){return++a,!1},n,i).then(function(){return a})}).then(e)},z.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function a(c,f){return f?a(c[n[f]],f-1):c[r]}var o=this._ctx.dir==="next"?1:-1;function u(c,f){return W(a(c,i),a(f,i))*o}return this.toArray(function(c){return c.sort(u)}).then(t)},z.prototype.toArray=function(e){var t=this;return this._read(function(n){var r=t._ctx;if(r.dir==="next"&&Je(r,!0)&&0<r.limit){var i=r.valueMapper,a=jt(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:a,range:r.range}}).then(function(u){return u=u.result,i?u.map(i):u})}var o=[];return Tt(r,function(u){return o.push(u)},n,r.table.core).then(function(){return o})},e)},z.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Je(t)?vn(t,function(){var n=e;return function(r,i){return n===0||(n===1?--n:i(function(){r.advance(n),n=0}),!1)}}):vn(t,function(){var n=e;return function(){return--n<0}})),this},z.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),vn(this._ctx,function(){var t=e;return function(n,r,i){return--t<=0&&r(i),0<=t}},!0),this},z.prototype.until=function(e,t){return yn(this._ctx,function(n,r,i){return!e(n.value)||(r(i),t)}),this},z.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},z.prototype.last=function(e){return this.reverse().first(e)},z.prototype.filter=function(e){var t;return yn(this._ctx,function(n){return e(n.value)}),(t=this._ctx).isMatch=Me(t.isMatch,e),this},z.prototype.and=function(e){return this.filter(e)},z.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},z.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},z.prototype.desc=function(){return this.reverse()},z.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,r){e(r.key,r)})},z.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},z.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,r){e(r.primaryKey,r)})},z.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(r,i){n.push(i.key)}).then(function(){return n}).then(e)},z.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&Je(t,!0)&&0<t.limit)return this._read(function(r){var i=jt(t,t.table.core.schema);return t.table.core.query({trans:r,values:!1,limit:t.limit,query:{index:i,range:t.range}})}).then(function(r){return r.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(r,i){n.push(i.primaryKey)}).then(function(){return n}).then(e)},z.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},z.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},z.prototype.lastKey=function(e){return this.reverse().firstKey(e)},z.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return yn(this._ctx,function(i){var r=i.primaryKey.toString(),i=X(t,r);return t[r]=!0,!i}),this},z.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){var i,a,o;o=typeof e=="function"?e:(i=B(e),a=i.length,function(h){for(var m=!1,g=0;g<a;++g){var b=i[g],_=e[b],x=de(h,b);_ instanceof ft?(ce(h,b,_.execute(x)),m=!0):x!==_&&(ce(h,b,_),m=!0)}return m});var u=n.table.core,s=u.schema.primaryKey,c=s.outbound,f=s.extractKey,p=200,s=t.db._options.modifyChunkSize;s&&(p=typeof s=="object"?s[u.name]||s["*"]||200:s);function v(h,b){var g=b.failures,b=b.numFailures;d+=h-b;for(var _=0,x=B(g);_<x.length;_++){var K=x[_];l.push(g[K])}}var l=[],d=0,y=[];return t.clone().primaryKeys().then(function(h){function m(b){var _=Math.min(p,h.length-b);return u.getMany({trans:r,keys:h.slice(b,b+_),cache:"immutable"}).then(function(x){for(var K=[],k=[],P=c?[]:null,I=[],S=0;S<_;++S){var j=x[S],L={value:De(j),primKey:h[b+S]};o.call(L,L.value,L)!==!1&&(L.value==null?I.push(h[b+S]):c||W(f(j),f(L.value))===0?(k.push(L.value),c&&P.push(h[b+S])):(I.push(h[b+S]),K.push(L.value)))}return Promise.resolve(0<K.length&&u.mutate({trans:r,type:"add",values:K}).then(function(U){for(var V in U.failures)I.splice(parseInt(V),1);v(K.length,U)})).then(function(){return(0<k.length||g&&typeof e=="object")&&u.mutate({trans:r,type:"put",keys:P,values:k,criteria:g,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<b}).then(function(U){return v(k.length,U)})}).then(function(){return(0<I.length||g&&e===mn)&&u.mutate({trans:r,type:"delete",keys:I,criteria:g,isAdditionalChunk:0<b}).then(function(U){return v(I.length,U)})}).then(function(){return h.length>b+_&&m(b+p)})})}var g=Je(n)&&n.limit===1/0&&(typeof e!="function"||e===mn)&&{index:n.index,range:n.range};return m(0).then(function(){if(0<l.length)throw new wt("Error modifying one or more objects",l,d,y);return h.length})})})},z.prototype.delete=function(){var e=this._ctx,t=e.range;return Je(e)&&(e.isPrimKey||t.type===3)?this._write(function(n){var r=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then(function(a){return e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then(function(o){var u=o.failures;if(o.lastResult,o.results,o=o.numFailures,o)throw new wt("Could not delete some values",Object.keys(u).map(function(c){return u[c]}),a-o);return a-o})})}):this.modify(mn)},z);function z(){}var mn=function(e,t){return t.value=null};function hi(e,t){return e<t?-1:e===t?0:1}function di(e,t){return t<e?-1:e===t?0:1}function le(e,t,n){return e=e instanceof yr?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(t),e}function et(e){return new e.Collection(e,function(){return pr("")}).limit(0)}function Ct(e,t,n,r){var i,a,o,u,c,f,p,s=n.length;if(!n.every(function(d){return typeof d=="string"}))return le(e,ar);function v(d){i=d==="next"?function(h){return h.toUpperCase()}:function(h){return h.toLowerCase()},a=d==="next"?function(h){return h.toLowerCase()}:function(h){return h.toUpperCase()},o=d==="next"?hi:di;var y=n.map(function(h){return{lower:a(h),upper:i(h)}}).sort(function(h,m){return o(h.lower,m.lower)});u=y.map(function(h){return h.upper}),c=y.map(function(h){return h.lower}),p=(f=d)==="next"?"":r}v("next"),e=new e.Collection(e,function(){return Oe(u[0],c[s-1]+r)}),e._ondirectionchange=function(d){v(d)};var l=0;return e._addAlgorithm(function(d,y,h){var m=d.key;if(typeof m!="string")return!1;var g=a(m);if(t(g,c,l))return!0;for(var b=null,_=l;_<s;++_){var x=(function(K,k,P,I,S,j){for(var L=Math.min(K.length,I.length),U=-1,V=0;V<L;++V){var fe=k[V];if(fe!==I[V])return S(K[V],P[V])<0?K.substr(0,V)+P[V]+P.substr(V+1):S(K[V],I[V])<0?K.substr(0,V)+I[V]+P.substr(V+1):0<=U?K.substr(0,U)+k[U]+P.substr(U+1):null;S(K[V],fe)<0&&(U=V)}return L<I.length&&j==="next"?K+P.substr(K.length):L<K.length&&j==="prev"?K.substr(0,P.length):U<0?null:K.substr(0,U)+I[U]+P.substr(U+1)})(m,g,u[_],c[_],o,f);x===null&&b===null?l=_+1:(b===null||0<o(b,x))&&(b=x)}return y(b!==null?function(){d.continue(b+p)}:h),!1}),e}function Oe(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function pr(e){return{type:1,lower:e,upper:e}}var yr=(Object.defineProperty(ne.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),ne.prototype.between=function(e,t,n,r){n=n!==!1,r=r===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(n||r)&&(!n||!r)?et(this):new this.Collection(this,function(){return Oe(e,t,!n,!r)})}catch{return le(this,be)}},ne.prototype.equals=function(e){return e==null?le(this,be):new this.Collection(this,function(){return pr(e)})},ne.prototype.above=function(e){return e==null?le(this,be):new this.Collection(this,function(){return Oe(e,void 0,!0)})},ne.prototype.aboveOrEqual=function(e){return e==null?le(this,be):new this.Collection(this,function(){return Oe(e,void 0,!1)})},ne.prototype.below=function(e){return e==null?le(this,be):new this.Collection(this,function(){return Oe(void 0,e,!1,!0)})},ne.prototype.belowOrEqual=function(e){return e==null?le(this,be):new this.Collection(this,function(){return Oe(void 0,e)})},ne.prototype.startsWith=function(e){return typeof e!="string"?le(this,ar):this.between(e,e+Ne,!0,!0)},ne.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):Ct(this,function(t,n){return t.indexOf(n[0])===0},[e],Ne)},ne.prototype.equalsIgnoreCase=function(e){return Ct(this,function(t,n){return t===n[0]},[e],"")},ne.prototype.anyOfIgnoreCase=function(){var e=ge.apply($e,arguments);return e.length===0?et(this):Ct(this,function(t,n){return n.indexOf(t)!==-1},e,"")},ne.prototype.startsWithAnyOfIgnoreCase=function(){var e=ge.apply($e,arguments);return e.length===0?et(this):Ct(this,function(t,n){return n.some(function(r){return t.indexOf(r)===0})},e,Ne)},ne.prototype.anyOf=function(){var e=this,t=ge.apply($e,arguments),n=this._cmp;try{t.sort(n)}catch{return le(this,be)}if(t.length===0)return et(this);var r=new this.Collection(this,function(){return Oe(t[0],t[t.length-1])});r._ondirectionchange=function(a){n=a==="next"?e._ascending:e._descending,t.sort(n)};var i=0;return r._addAlgorithm(function(a,o,u){for(var c=a.key;0<n(c,t[i]);)if(++i===t.length)return o(u),!1;return n(c,t[i])===0||(o(function(){a.continue(t[i])}),!1)}),r},ne.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},ne.prototype.noneOf=function(){var e=ge.apply($e,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return le(this,be)}var t=e.reduce(function(n,r){return n?n.concat([[n[n.length-1][1],r]]):[[-1/0,r]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},ne.prototype.inAnyRange=function(m,t){var n=this,r=this._cmp,i=this._ascending,a=this._descending,o=this._min,u=this._max;if(m.length===0)return et(this);if(!m.every(function(g){return g[0]!==void 0&&g[1]!==void 0&&i(g[0],g[1])<=0}))return le(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",q.InvalidArgument);var c=!t||t.includeLowers!==!1,f=t&&t.includeUppers===!0,p,s=i;function v(g,b){return s(g[0],b[0])}try{(p=m.reduce(function(g,b){for(var _=0,x=g.length;_<x;++_){var K=g[_];if(r(b[0],K[1])<0&&0<r(b[1],K[0])){K[0]=o(K[0],b[0]),K[1]=u(K[1],b[1]);break}}return _===x&&g.push(b),g},[])).sort(v)}catch{return le(this,be)}var l=0,d=f?function(g){return 0<i(g,p[l][1])}:function(g){return 0<=i(g,p[l][1])},y=c?function(g){return 0<a(g,p[l][0])}:function(g){return 0<=a(g,p[l][0])},h=d,m=new this.Collection(this,function(){return Oe(p[0][0],p[p.length-1][1],!c,!f)});return m._ondirectionchange=function(g){s=g==="next"?(h=d,i):(h=y,a),p.sort(v)},m._addAlgorithm(function(g,b,_){for(var x,K=g.key;h(K);)if(++l===p.length)return b(_),!1;return!d(x=K)&&!y(x)||(n._cmp(K,p[l][1])===0||n._cmp(K,p[l][0])===0||b(function(){s===i?g.continue(p[l][0]):g.continue(p[l][1])}),!1)}),m},ne.prototype.startsWithAnyOf=function(){var e=ge.apply($e,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?et(this):this.inAnyRange(e.map(function(t){return[t,t+Ne]})):le(this,"startsWithAnyOf() only works with strings")},ne);function ne(){}function ve(e){return H(function(t){return ht(t),e(t.target.error),!1})}function ht(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var dt="storagemutated",gn="x-storagemutated-1",Se=ct(null,dt),pi=(me.prototype._lock=function(){return Ie(!C.global),++this._reculock,this._reculock!==1||C.global||(C.lockOwnerFor=this),this},me.prototype._unlock=function(){if(Ie(!C.global),--this._reculock==0)for(C.global||(C.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{qe(e[1],e[0])}catch{}}return this},me.prototype._locked=function(){return this._reculock&&C.lockOwnerFor!==this},me.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(Ie(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new q.DatabaseClosed(r);case"MissingAPIError":throw new q.MissingAPI(r.message,r);default:throw new q.OpenFailed(r)}if(!this.active)throw new q.TransactionInactive;return Ie(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=H(function(i){ht(i),t._reject(e.error)}),e.onabort=H(function(i){ht(i),t.active&&t._reject(new q.Abort(e.error)),t.active=!1,t.on("abort").fire(i)}),e.oncomplete=H(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&Se.storagemutated.fire(e.mutatedParts)}),this},me.prototype._promise=function(e,t,n){var r=this;if(e==="readwrite"&&this.mode!=="readwrite")return Q(new q.ReadOnly("Transaction is readonly"));if(!this.active)return Q(new q.TransactionInactive);if(this._locked())return new D(function(a,o){r._blockedFuncs.push([function(){r._promise(e,t,n).then(a,o)},C])});if(n)return ke(function(){var a=new D(function(o,u){r._lock();var c=t(o,u,r);c&&c.then&&c.then(o,u)});return a.finally(function(){return r._unlock()}),a._lib=!0,a});var i=new D(function(a,o){var u=t(a,o,r);u&&u.then&&u.then(a,o)});return i._lib=!0,i},me.prototype._root=function(){return this.parent?this.parent._root():this},me.prototype.waitFor=function(e){var t,n=this._root(),r=D.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return r}):(n._waitingFor=r,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),(function a(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=a)})());var i=n._waitingFor;return new D(function(a,o){r.then(function(u){return n._waitingQueue.push(H(a.bind(null,u)))},function(u){return n._waitingQueue.push(H(o.bind(null,u)))}).finally(function(){n._waitingFor===i&&(n._waitingFor=null)})})},me.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new q.Abort))},me.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(X(t,e))return t[e];var n=this.schema[e];if(!n)throw new q.NotFound("Table "+e+" not part of transaction");return n=new this.db.Table(e,n,this),n.core=this.db.core.table(e),t[e]=n},me);function me(){}function bn(e,t,n,r,i,a,o){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:a,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+vr(t)}}function vr(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function wn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(r=function(i){return[i.name,i]},n.reduce(function(i,a,o){return o=r(a,o),o&&(i[o[0]]=o[1]),i},{}))};var r}var pt=function(e){try{return e.only([[]]),pt=function(){return[[]]},[[]]}catch{return pt=function(){return Ne},Ne}};function _n(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(n){return n[t]}:function(n){return de(n,t)}:function(n){return de(n,e)};var t}function mr(e){return[].slice.call(e)}var yi=0;function yt(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function vi(e,t,c){function r(h){if(h.type===3)return null;if(h.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var l=h.lower,d=h.upper,y=h.lowerOpen,h=h.upperOpen;return l===void 0?d===void 0?null:t.upperBound(d,!!h):d===void 0?t.lowerBound(l,!!y):t.bound(l,d,!!y,!!h)}function i(v){var l,d=v.name;return{name:d,schema:v,mutate:function(y){var h=y.trans,m=y.type,g=y.keys,b=y.values,_=y.range;return new Promise(function(x,K){x=H(x);var k=h.objectStore(d),P=k.keyPath==null,I=m==="put"||m==="add";if(!I&&m!=="delete"&&m!=="deleteRange")throw new Error("Invalid operation type: "+m);var S,j=(g||b||{length:1}).length;if(g&&b&&g.length!==b.length)throw new Error("Given keys array must have same length as given values array.");if(j===0)return x({numFailures:0,failures:{},results:[],lastResult:void 0});function L(se){++fe,ht(se)}var U=[],V=[],fe=0;if(m==="deleteRange"){if(_.type===4)return x({numFailures:fe,failures:V,results:[],lastResult:void 0});_.type===3?U.push(S=k.clear()):U.push(S=k.delete(r(_)))}else{var P=I?P?[b,g]:[b,null]:[g,null],F=P[0],ae=P[1];if(I)for(var oe=0;oe<j;++oe)U.push(S=ae&&ae[oe]!==void 0?k[m](F[oe],ae[oe]):k[m](F[oe])),S.onerror=L;else for(oe=0;oe<j;++oe)U.push(S=k[m](F[oe])),S.onerror=L}function Xt(se){se=se.target.result,U.forEach(function(Ue,Mn){return Ue.error!=null&&(V[Mn]=Ue.error)}),x({numFailures:fe,failures:V,results:m==="delete"?g:U.map(function(Ue){return Ue.result}),lastResult:se})}S.onerror=function(se){L(se),Xt(se)},S.onsuccess=Xt})},getMany:function(y){var h=y.trans,m=y.keys;return new Promise(function(g,b){g=H(g);for(var _,x=h.objectStore(d),K=m.length,k=new Array(K),P=0,I=0,S=function(U){U=U.target,k[U._pos]=U.result,++I===P&&g(k)},j=ve(b),L=0;L<K;++L)m[L]!=null&&((_=x.get(m[L]))._pos=L,_.onsuccess=S,_.onerror=j,++P);P===0&&g(k)})},get:function(y){var h=y.trans,m=y.key;return new Promise(function(g,b){g=H(g);var _=h.objectStore(d).get(m);_.onsuccess=function(x){return g(x.target.result)},_.onerror=ve(b)})},query:(l=f,function(y){return new Promise(function(h,m){h=H(h);var g,b,_,P=y.trans,x=y.values,K=y.limit,S=y.query,k=K===1/0?void 0:K,I=S.index,S=S.range,P=P.objectStore(d),I=I.isPrimaryKey?P:P.index(I.name),S=r(S);if(K===0)return h({result:[]});l?((k=x?I.getAll(S,k):I.getAllKeys(S,k)).onsuccess=function(j){return h({result:j.target.result})},k.onerror=ve(m)):(g=0,b=!x&&"openKeyCursor"in I?I.openKeyCursor(S):I.openCursor(S),_=[],b.onsuccess=function(j){var L=b.result;return L?(_.push(x?L.value:L.primaryKey),++g===K?h({result:_}):void L.continue()):h({result:_})},b.onerror=ve(m))})}),openCursor:function(y){var h=y.trans,m=y.values,g=y.query,b=y.reverse,_=y.unique;return new Promise(function(x,K){x=H(x);var I=g.index,k=g.range,P=h.objectStore(d),P=I.isPrimaryKey?P:P.index(I.name),I=b?_?"prevunique":"prev":_?"nextunique":"next",S=!m&&"openKeyCursor"in P?P.openKeyCursor(r(k),I):P.openCursor(r(k),I);S.onerror=ve(K),S.onsuccess=H(function(j){var L,U,V,fe,F=S.result;F?(F.___id=++yi,F.done=!1,L=F.continue.bind(F),U=(U=F.continuePrimaryKey)&&U.bind(F),V=F.advance.bind(F),fe=function(){throw new Error("Cursor not stopped")},F.trans=h,F.stop=F.continue=F.continuePrimaryKey=F.advance=function(){throw new Error("Cursor not started")},F.fail=H(K),F.next=function(){var ae=this,oe=1;return this.start(function(){return oe--?ae.continue():ae.stop()}).then(function(){return ae})},F.start=function(ae){function oe(){if(S.result)try{ae()}catch(se){F.fail(se)}else F.done=!0,F.start=function(){throw new Error("Cursor behind last entry")},F.stop()}var Xt=new Promise(function(se,Ue){se=H(se),S.onerror=ve(Ue),F.fail=Ue,F.stop=function(Mn){F.stop=F.continue=F.continuePrimaryKey=F.advance=fe,se(Mn)}});return S.onsuccess=H(function(se){S.onsuccess=oe,oe()}),F.continue=L,F.continuePrimaryKey=U,F.advance=V,oe(),Xt},x(F)):x(null)},K)})},count:function(y){var h=y.query,m=y.trans,g=h.index,b=h.range;return new Promise(function(_,x){var K=m.objectStore(d),k=g.isPrimaryKey?K:K.index(g.name),K=r(b),k=K?k.count(K):k.count();k.onsuccess=H(function(P){return _(P.target.result)}),k.onerror=ve(x)})}}}var a,o,u,p=(o=c,u=mr((a=e).objectStoreNames),{schema:{name:a.name,tables:u.map(function(v){return o.objectStore(v)}).map(function(v){var l=v.keyPath,h=v.autoIncrement,d=N(l),y={},h={name:v.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:l==null,compound:d,keyPath:l,autoIncrement:h,unique:!0,extractKey:_n(l)},indexes:mr(v.indexNames).map(function(m){return v.index(m)}).map(function(_){var g=_.name,b=_.unique,x=_.multiEntry,_=_.keyPath,x={name:g,compound:N(_),keyPath:_,unique:b,multiEntry:x,extractKey:_n(_)};return y[yt(_)]=x}),getIndexByKeyPath:function(m){return y[yt(m)]}};return y[":id"]=h.primaryKey,l!=null&&(y[yt(l)]=h.primaryKey),h})},hasGetAll:0<u.length&&"getAll"in o.objectStore(u[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),c=p.schema,f=p.hasGetAll,p=c.tables.map(i),s={};return p.forEach(function(v){return s[v.name]=v}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(v){if(!s[v])throw new Error("Table '".concat(v,"' not found"));return s[v]},MIN_KEY:-1/0,MAX_KEY:pt(t),schema:c}}function mi(e,t,n,r){var i=n.IDBKeyRange;return n.indexedDB,{dbcore:(r=vi(t,i,r),e.dbcore.reduce(function(a,o){return o=o.create,w(w({},a),o(a))},r))}}function Rt(e,r){var n=r.db,r=mi(e._middlewares,n,e._deps,r);e.core=r.dbcore,e.tables.forEach(function(i){var a=i.name;e.core.schema.tables.some(function(o){return o.name===a})&&(i.core=e.core.table(a),e[a]instanceof e.Table&&(e[a].core=i.core))})}function Bt(e,t,n,r){n.forEach(function(i){var a=r[i];t.forEach(function(o){var u=(function c(f,p){return gt(f,p)||(f=re(f))&&c(f,p)})(o,i);(!u||"value"in u&&u.value===void 0)&&(o===e.Transaction.prototype||o instanceof e.Transaction?$(o,i,{get:function(){return this.table(i)},set:function(c){he(this,i,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new e.Table(i,a))})})}function xn(e,t){t.forEach(function(n){for(var r in n)n[r]instanceof e.Table&&delete n[r]})}function gi(e,t){return e._cfg.version-t._cfg.version}function bi(e,t,n,r){var i=e._dbSchema;n.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=wn("$meta",br("")[0],[]),e._storeNames.push("$meta"));var a=e._createTransaction("readwrite",e._storeNames,i);a.create(n),a._completion.catch(r);var o=a._reject.bind(a),u=C.transless||C;ke(function(){return C.trans=a,C.transless=u,t!==0?(Rt(e,n),f=t,((c=a).storeNames.includes("$meta")?c.table("$meta").get("version").then(function(p){return p??f}):D.resolve(f)).then(function(p){return v=p,l=a,d=n,y=[],p=(s=e)._versions,h=s._dbSchema=Nt(0,s.idbdb,d),(p=p.filter(function(m){return m._cfg.version>=v})).length!==0?(p.forEach(function(m){y.push(function(){var g=h,b=m._cfg.dbschema;Mt(s,g,d),Mt(s,b,d),h=s._dbSchema=b;var _=kn(g,b);_.add.forEach(function(I){En(d,I[0],I[1].primKey,I[1].indexes)}),_.change.forEach(function(I){if(I.recreate)throw new q.Upgrade("Not yet support for changing primary key");var S=d.objectStore(I.name);I.add.forEach(function(j){return qt(S,j)}),I.change.forEach(function(j){S.deleteIndex(j.name),qt(S,j)}),I.del.forEach(function(j){return S.deleteIndex(j)})});var x=m._cfg.contentUpgrade;if(x&&m._cfg.version>v){Rt(s,d),l._memoizedTables={};var K=Yn(b);_.del.forEach(function(I){K[I]=g[I]}),xn(s,[s.Transaction.prototype]),Bt(s,[s.Transaction.prototype],B(K),K),l.schema=K;var k,P=tn(x);return P&&Qe(),_=D.follow(function(){var I;(k=x(l))&&P&&(I=Ee.bind(null,null),k.then(I,I))}),k&&typeof k.then=="function"?D.resolve(k):_.then(function(){return k})}}),y.push(function(g){var b,_,x=m._cfg.dbschema;b=x,_=g,[].slice.call(_.db.objectStoreNames).forEach(function(K){return b[K]==null&&_.db.deleteObjectStore(K)}),xn(s,[s.Transaction.prototype]),Bt(s,[s.Transaction.prototype],s._storeNames,s._dbSchema),l.schema=s._dbSchema}),y.push(function(g){s.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(s.idbdb.version/10)===m._cfg.version?(s.idbdb.deleteObjectStore("$meta"),delete s._dbSchema.$meta,s._storeNames=s._storeNames.filter(function(b){return b!=="$meta"})):g.objectStore("$meta").put(m._cfg.version,"version"))})}),(function m(){return y.length?D.resolve(y.shift()(l.idbtrans)).then(m):D.resolve()})().then(function(){gr(h,d)})):D.resolve();var s,v,l,d,y,h}).catch(o)):(B(i).forEach(function(p){En(n,p,i[p].primKey,i[p].indexes)}),Rt(e,n),void D.follow(function(){return e.on.populate.fire(a)}).catch(o));var c,f})}function wi(e,t){gr(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=Nt(0,e.idbdb,t);Mt(e,e._dbSchema,t);for(var r=0,i=kn(n,e._dbSchema).change;r<i.length;r++){var a=(function(o){if(o.change.length||o.recreate)return console.warn("Unable to patch indexes of table ".concat(o.name," because it has changes on the type of index or primary key.")),{value:void 0};var u=t.objectStore(o.name);o.add.forEach(function(c){ye&&console.debug("Dexie upgrade patch: Creating missing index ".concat(o.name,".").concat(c.src)),qt(u,c)})})(i[r]);if(typeof a=="object")return a.value}}function kn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],a=t[n];if(i){var o={name:n,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto)o.recreate=!0,r.change.push(o);else{var u=i.idxByName,c=a.idxByName,f=void 0;for(f in u)c[f]||o.del.push(f);for(f in c){var p=u[f],s=c[f];p?p.src!==s.src&&o.change.push(s):o.add.push(s)}(0<o.del.length||0<o.add.length||0<o.change.length)&&r.change.push(o)}}else r.add.push([n,a])}return r}function En(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(a){return qt(i,a)}),i}function gr(e,t){B(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(ye&&console.debug("Dexie: Creating missing table",n),En(t,n,e[n].primKey,e[n].indexes))})}function qt(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Nt(e,t,n){var r={};return We(t.objectStoreNames,0).forEach(function(i){for(var a=n.objectStore(i),o=bn(vr(f=a.keyPath),f||"",!0,!1,!!a.autoIncrement,f&&typeof f!="string",!0),u=[],c=0;c<a.indexNames.length;++c){var p=a.index(a.indexNames[c]),f=p.keyPath,p=bn(p.name,f,!!p.unique,!!p.multiEntry,!1,f&&typeof f!="string",!1);u.push(p)}r[i]=wn(i,o,u)}),r}function Mt(e,t,n){for(var r=n.db.objectStoreNames,i=0;i<r.length;++i){var a=r[i],o=n.objectStore(a);e._hasGetAll="getAll"in o;for(var u=0;u<o.indexNames.length;++u){var c=o.indexNames[u],f=o.index(c).keyPath,p=typeof f=="string"?f:"["+We(f).join("+")+"]";!t[a]||(f=t[a].idxByName[p])&&(f.name=c,delete t[a].idxByName[p],t[a].idxByName[c]=f)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&T.WorkerGlobalScope&&T instanceof T.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function br(e){return e.split(",").map(function(t,n){var r=(t=t.trim()).replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return bn(r,i||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),N(i),n===0)})}var _i=(Ft.prototype._parseStoresSpec=function(e,t){B(e).forEach(function(n){if(e[n]!==null){var r=br(e[n]),i=r.shift();if(i.unique=!0,i.multi)throw new q.Schema("Primary key cannot be multi-valued");r.forEach(function(a){if(a.auto)throw new q.Schema("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new q.Schema("Index must have a name and cannot be an empty string")}),t[n]=wn(n,i,r)}})},Ft.prototype.stores=function(n){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?R(this._cfg.storesSource,n):n;var n=t._versions,r={},i={};return n.forEach(function(a){R(r,a._cfg.storesSource),i=a._cfg.dbschema={},a._parseStoresSpec(r,i)}),t._dbSchema=i,xn(t,[t._allTables,t,t.Transaction.prototype]),Bt(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],B(i),i),t._storeNames=B(i),this},Ft.prototype.upgrade=function(e){return this._cfg.contentUpgrade=rn(this._cfg.contentUpgrade||Y,e),this},Ft);function Ft(){}function Pn(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new _e(It,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function On(e){return e&&typeof e.databases=="function"}function Sn(e){return ke(function(){return C.letThrough=!0,e()})}function Kn(e){return!("from"in e)}var ie=function(e,t){if(!this){var n=new ie;return e&&"d"in e&&R(n,e),n}R(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function vt(e,t,n){var r=W(t,n);if(!isNaN(r)){if(0<r)throw RangeError();if(Kn(e))return R(e,{from:t,to:n,d:1});var i=e.l,r=e.r;if(W(n,e.from)<0)return i?vt(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},_r(e);if(0<W(t,e.to))return r?vt(r,t,n):e.r={from:t,to:n,d:1,l:null,r:null},_r(e);W(t,e.from)<0&&(e.from=t,e.l=null,e.d=r?r.d+1:1),0<W(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,i&&!e.l&&mt(e,i),r&&n&&mt(e,r)}}function mt(e,t){Kn(t)||(function n(r,c){var a=c.from,o=c.to,u=c.l,c=c.r;vt(r,a,o),u&&n(r,u),c&&n(r,c)})(e,t)}function wr(e,t){var n=Lt(t),r=n.next();if(r.done)return!1;for(var i=r.value,a=Lt(e),o=a.next(i.from),u=o.value;!r.done&&!o.done;){if(W(u.from,i.to)<=0&&0<=W(u.to,i.from))return!0;W(i.from,u.from)<0?i=(r=n.next(u.from)).value:u=(o=a.next(i.from)).value}return!1}function Lt(e){var t=Kn(e)?null:{s:0,n:e};return{next:function(n){for(var r=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&W(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||W(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function _r(e){var t,n,r=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),i=1<r?"r":r<-1?"l":"";i&&(t=i=="r"?"l":"r",n=w({},e),r=e[i],e.from=r.from,e.to=r.to,e[i]=r[i],n[i]=r[t],(e[t]=n).d=xr(n)),e.d=xr(e)}function xr(n){var t=n.r,n=n.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function Ut(e,t){return B(t).forEach(function(n){e[n]?mt(e[n],t[n]):e[n]=(function r(i){var a,o,u={};for(a in i)X(i,a)&&(o=i[a],u[a]=!o||typeof o!="object"||Hn.has(o.constructor)?o:r(o));return u})(t[n])}),e}function An(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&wr(t[n],e[n])})}ee(ie.prototype,((pe={add:function(e){return mt(this,e),this},addKey:function(e){return vt(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return vt(t,n,n)}),this},hasKey:function(e){var t=Lt(this).next(e).value;return t&&W(t.from,e)<=0&&0<=W(t.to,e)}})[en]=function(){return Lt(this)},pe));var Fe={},In={},Dn=!1;function Vt(e){Ut(In,e),Dn||(Dn=!0,setTimeout(function(){Dn=!1,jn(In,!(In={}))},0))}function jn(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var r=0,i=Object.values(Fe);r<i.length;r++)kr(o=i[r],e,n,t);else for(var a in e){var o,u=/^idb\:\/\/(.*)\/(.*)\//.exec(a);u&&(a=u[1],u=u[2],(o=Fe["idb://".concat(a,"/").concat(u)])&&kr(o,e,n,t))}n.forEach(function(c){return c()})}function kr(e,t,n,r){for(var i=[],a=0,o=Object.entries(e.queries.query);a<o.length;a++){for(var u=o[a],c=u[0],f=[],p=0,s=u[1];p<s.length;p++){var v=s[p];An(t,v.obsSet)?v.subscribers.forEach(function(h){return n.add(h)}):r&&f.push(v)}r&&i.push([c,f])}if(r)for(var l=0,d=i;l<d.length;l++){var y=d[l],c=y[0],f=y[1];e.queries.query[c]=f}}function xi(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?Q(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,i=Math.round(10*e.verno),a=!1;function o(){if(t.openCanceller!==r)throw new q.DatabaseClosed("db.open() was cancelled")}function u(){return new D(function(v,l){if(o(),!n)throw new q.MissingAPI;var d=e.name,y=t.autoSchema||!i?n.open(d):n.open(d,i);if(!y)throw new q.MissingAPI;y.onerror=ve(l),y.onblocked=H(e._fireOnBlocked),y.onupgradeneeded=H(function(h){var m;p=y.transaction,t.autoSchema&&!e._options.allowEmptyDB?(y.onerror=ht,p.abort(),y.result.close(),(m=n.deleteDatabase(d)).onsuccess=m.onerror=H(function(){l(new q.NoSuchDatabase("Database ".concat(d," doesnt exist")))})):(p.onerror=ve(l),h=h.oldVersion>Math.pow(2,62)?0:h.oldVersion,s=h<1,e.idbdb=y.result,a&&wi(e,p),bi(e,h/10,p,l))},l),y.onsuccess=H(function(){p=null;var h,m,g,b,_,x=e.idbdb=y.result,K=We(x.objectStoreNames);if(0<K.length)try{var k=x.transaction((b=K).length===1?b[0]:b,"readonly");if(t.autoSchema)m=x,g=k,(h=e).verno=m.version/10,g=h._dbSchema=Nt(0,m,g),h._storeNames=We(m.objectStoreNames,0),Bt(h,[h._allTables],B(g),g);else if(Mt(e,e._dbSchema,k),((_=kn(Nt(0,(_=e).idbdb,k),_._dbSchema)).add.length||_.change.some(function(P){return P.add.length||P.change.length}))&&!a)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),x.close(),i=x.version+1,a=!0,v(u());Rt(e,k)}catch{}Ze.push(e),x.onversionchange=H(function(P){t.vcFired=!0,e.on("versionchange").fire(P)}),x.onclose=H(function(P){e.on("close").fire(P)}),s&&(_=e._deps,k=d,x=_.indexedDB,_=_.IDBKeyRange,On(x)||k===It||Pn(x,_).put({name:k}).catch(Y)),v()},l)}).catch(function(v){switch(v?.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),u();break;case"VersionError":if(0<i)return i=0,u()}return D.reject(v)})}var c,f=t.dbReadyResolve,p=null,s=!1;return D.race([r,(typeof navigator>"u"?D.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(v){function l(){return indexedDB.databases().finally(v)}c=setInterval(l,100),l()}).finally(function(){return clearInterval(c)}):Promise.resolve()).then(u)]).then(function(){return o(),t.onReadyBeingFired=[],D.resolve(Sn(function(){return e.on.ready.fire(e.vip)})).then(function v(){if(0<t.onReadyBeingFired.length){var l=t.onReadyBeingFired.reduce(rn,Y);return t.onReadyBeingFired=[],D.resolve(Sn(function(){return l(e.vip)})).then(v)}})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(v){t.dbOpenError=v;try{p&&p.abort()}catch{}return r===t.openCanceller&&e._close(),Q(v)}).finally(function(){t.openComplete=!0,f()}).then(function(){var v;return s&&(v={},e.tables.forEach(function(l){l.schema.indexes.forEach(function(d){d.name&&(v["idb://".concat(e.name,"/").concat(l.name,"/").concat(d.name)]=new ie(-1/0,[[[]]]))}),v["idb://".concat(e.name,"/").concat(l.name,"/")]=v["idb://".concat(e.name,"/").concat(l.name,"/:dels")]=new ie(-1/0,[[[]]])}),Se(dt).fire(v),jn(v,!0)),e})}function Tn(e){function t(a){return e.next(a)}var n=i(t),r=i(function(a){return e.throw(a)});function i(a){return function(c){var u=a(c),c=u.value;return u.done?c:c&&typeof c.then=="function"?c.then(n,r):N(c)?Promise.all(c).then(n,r):n(c)}}return i(t)()}function Wt(e,t,n){for(var r=N(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}var ki={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return w(w({},e),{table:function(t){var n=e.table(t),r=n.schema,i={},a=[];function o(s,v,l){var d=yt(s),y=i[d]=i[d]||[],h=s==null?0:typeof s=="string"?1:s.length,m=0<v,m=w(w({},l),{name:m?"".concat(d,"(virtual-from:").concat(l.name,")"):l.name,lowLevelIndex:l,isVirtual:m,keyTail:v,keyLength:h,extractKey:_n(s),unique:!m&&l.unique});return y.push(m),m.isPrimaryKey||a.push(m),1<h&&o(h===2?s[0]:s.slice(0,h-1),v+1,l),y.sort(function(g,b){return g.keyTail-b.keyTail}),m}t=o(r.primaryKey.keyPath,0,r.primaryKey),i[":id"]=[t];for(var u=0,c=r.indexes;u<c.length;u++){var f=c[u];o(f.keyPath,0,f)}function p(s){var v,l=s.query.index;return l.isVirtual?w(w({},s),{query:{index:l.lowLevelIndex,range:(v=s.query.range,l=l.keyTail,{type:v.type===1?2:v.type,lower:Wt(v.lower,v.lowerOpen?e.MAX_KEY:e.MIN_KEY,l),lowerOpen:!0,upper:Wt(v.upper,v.upperOpen?e.MIN_KEY:e.MAX_KEY,l),upperOpen:!0})}}):s}return w(w({},n),{schema:w(w({},r),{primaryKey:t,indexes:a,getIndexByKeyPath:function(s){return(s=i[yt(s)])&&s[0]}}),count:function(s){return n.count(p(s))},query:function(s){return n.query(p(s))},openCursor:function(s){var v=s.query.index,l=v.keyTail,d=v.isVirtual,y=v.keyLength;return d?n.openCursor(p(s)).then(function(m){return m&&h(m)}):n.openCursor(s);function h(m){return Object.create(m,{continue:{value:function(g){g!=null?m.continue(Wt(g,s.reverse?e.MAX_KEY:e.MIN_KEY,l)):s.unique?m.continue(m.key.slice(0,y).concat(s.reverse?e.MIN_KEY:e.MAX_KEY,l)):m.continue()}},continuePrimaryKey:{value:function(g,b){m.continuePrimaryKey(Wt(g,e.MAX_KEY,l),b)}},primaryKey:{get:function(){return m.primaryKey}},key:{get:function(){var g=m.key;return y===1?g[0]:g.slice(0,y)}},value:{get:function(){return m.value}}})}}})}})}};function Cn(e,t,n,r){return n=n||{},r=r||"",B(e).forEach(function(i){var a,o,u;X(t,i)?(a=e[i],o=t[i],typeof a=="object"&&typeof o=="object"&&a&&o?(u=Jt(a))!==Jt(o)?n[r+i]=t[i]:u==="Object"?Cn(a,o,n,r+i+"."):a!==o&&(n[r+i]=t[i]):a!==o&&(n[r+i]=t[i])):n[r+i]=void 0}),B(t).forEach(function(i){X(e,i)||(n[r+i]=t[i])}),n}function Rn(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var Ei={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return w(w({},e),{table:function(t){var n=e.table(t),r=n.schema.primaryKey;return w(w({},n),{mutate:function(i){var a=C.trans,o=a.table(t).hook,u=o.deleting,c=o.creating,f=o.updating;switch(i.type){case"add":if(c.fire===Y)break;return a._promise("readwrite",function(){return p(i)},!0);case"put":if(c.fire===Y&&f.fire===Y)break;return a._promise("readwrite",function(){return p(i)},!0);case"delete":if(u.fire===Y)break;return a._promise("readwrite",function(){return p(i)},!0);case"deleteRange":if(u.fire===Y)break;return a._promise("readwrite",function(){return(function s(v,l,d){return n.query({trans:v,values:!1,query:{index:r,range:l},limit:d}).then(function(y){var h=y.result;return p({type:"delete",keys:h,trans:v}).then(function(m){return 0<m.numFailures?Promise.reject(m.failures[0]):h.length<d?{failures:[],numFailures:0,lastResult:void 0}:s(v,w(w({},l),{lower:h[h.length-1],lowerOpen:!0}),d)})})})(i.trans,i.range,1e4)},!0)}return n.mutate(i);function p(s){var v,l,d,y=C.trans,h=s.keys||Rn(r,s);if(!h)throw new Error("Keys missing");return(s=s.type==="add"||s.type==="put"?w(w({},s),{keys:h}):w({},s)).type!=="delete"&&(s.values=M([],s.values)),s.keys&&(s.keys=M([],s.keys)),v=n,d=h,((l=s).type==="add"?Promise.resolve([]):v.getMany({trans:l.trans,keys:d,cache:"immutable"})).then(function(m){var g=h.map(function(b,_){var x,K,k,P=m[_],I={onerror:null,onsuccess:null};return s.type==="delete"?u.fire.call(I,b,P,y):s.type==="add"||P===void 0?(x=c.fire.call(I,b,s.values[_],y),b==null&&x!=null&&(s.keys[_]=b=x,r.outbound||ce(s.values[_],r.keyPath,b))):(x=Cn(P,s.values[_]),(K=f.fire.call(I,x,b,P,y))&&(k=s.values[_],Object.keys(K).forEach(function(S){X(k,S)?k[S]=K[S]:ce(k,S,K[S])}))),I});return n.mutate(s).then(function(b){for(var _=b.failures,x=b.results,K=b.numFailures,b=b.lastResult,k=0;k<h.length;++k){var P=(x||h)[k],I=g[k];P==null?I.onerror&&I.onerror(_[k]):I.onsuccess&&I.onsuccess(s.type==="put"&&m[k]?s.values[k]:P)}return{failures:_,results:x,numFailures:K,lastResult:b}}).catch(function(b){return g.forEach(function(_){return _.onerror&&_.onerror(b)}),Promise.reject(b)})})}}})}})}};function Er(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var r=[],i=0,a=0;i<t.keys.length&&a<e.length;++i)W(t.keys[i],e[a])===0&&(r.push(n?De(t.values[i]):t.values[i]),++a);return r.length===e.length?r:null}catch{return null}}var Pi={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return w(w({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=Er(r.keys,r.trans._cache,r.cache==="clone");return i?D.resolve(i):n.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?De(a):a},a})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}};function Pr(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function Or(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Oi={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new ie(e.MIN_KEY,e.MAX_KEY);return w(w({},e),{transaction:function(r,i,a){if(C.subscr&&i!=="readonly")throw new q.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(C.querier));return e.transaction(r,i,a)},table:function(r){var i=e.table(r),a=i.schema,o=a.primaryKey,s=a.indexes,u=o.extractKey,c=o.outbound,f=o.autoIncrement&&s.filter(function(l){return l.compound&&l.keyPath.includes(o.keyPath)}),p=w(w({},i),{mutate:function(l){function d(S){return S="idb://".concat(t,"/").concat(r,"/").concat(S),b[S]||(b[S]=new ie)}var y,h,m,g=l.trans,b=l.mutatedParts||(l.mutatedParts={}),_=d(""),x=d(":dels"),K=l.type,I=l.type==="deleteRange"?[l.range]:l.type==="delete"?[l.keys]:l.values.length<50?[Rn(o,l).filter(function(S){return S}),l.values]:[],k=I[0],P=I[1],I=l.trans._cache;return N(k)?(_.addKeys(k),(I=K==="delete"||k.length===P.length?Er(k,I):null)||x.addKeys(k),(I||P)&&(y=d,h=I,m=P,a.indexes.forEach(function(S){var j=y(S.name||"");function L(V){return V!=null?S.extractKey(V):null}function U(V){return S.multiEntry&&N(V)?V.forEach(function(fe){return j.addKey(fe)}):j.addKey(V)}(h||m).forEach(function(V,ae){var F=h&&L(h[ae]),ae=m&&L(m[ae]);W(F,ae)!==0&&(F!=null&&U(F),ae!=null&&U(ae))})}))):k?(P={from:(P=k.lower)!==null&&P!==void 0?P:e.MIN_KEY,to:(P=k.upper)!==null&&P!==void 0?P:e.MAX_KEY},x.add(P),_.add(P)):(_.add(n),x.add(n),a.indexes.forEach(function(S){return d(S.name).add(n)})),i.mutate(l).then(function(S){return!k||l.type!=="add"&&l.type!=="put"||(_.addKeys(S.results),f&&f.forEach(function(j){for(var L=l.values.map(function(F){return j.extractKey(F)}),U=j.keyPath.findIndex(function(F){return F===o.keyPath}),V=0,fe=S.results.length;V<fe;++V)L[V][U]=S.results[V];d(j.name).addKeys(L)})),g.mutatedParts=Ut(g.mutatedParts||{},b),S})}}),s=function(d){var y=d.query,d=y.index,y=y.range;return[d,new ie((d=y.lower)!==null&&d!==void 0?d:e.MIN_KEY,(y=y.upper)!==null&&y!==void 0?y:e.MAX_KEY)]},v={get:function(l){return[o,new ie(l.key)]},getMany:function(l){return[o,new ie().addKeys(l.keys)]},count:s,query:s,openCursor:s};return B(v).forEach(function(l){p[l]=function(d){var y=C.subscr,h=!!y,m=Pr(C,i)&&Or(l,d)?d.obsSet={}:y;if(h){var g=function(P){return P="idb://".concat(t,"/").concat(r,"/").concat(P),m[P]||(m[P]=new ie)},b=g(""),_=g(":dels"),y=v[l](d),h=y[0],y=y[1];if((l==="query"&&h.isPrimaryKey&&!d.values?_:g(h.name||"")).add(y),!h.isPrimaryKey){if(l!=="count"){var x=l==="query"&&c&&d.values&&i.query(w(w({},d),{values:!1}));return i[l].apply(this,arguments).then(function(P){if(l==="query"){if(c&&d.values)return x.then(function(L){return L=L.result,b.addKeys(L),P});var I=d.values?P.result.map(u):P.result;(d.values?b:_).addKeys(I)}else if(l==="openCursor"){var S=P,j=d.values;return S&&Object.create(S,{key:{get:function(){return _.addKey(S.primaryKey),S.key}},primaryKey:{get:function(){var L=S.primaryKey;return _.addKey(L),L}},value:{get:function(){return j&&b.addKey(S.primaryKey),S.value}}})}return P})}_.add(n)}}return i[l].apply(this,arguments)}}),p}})}};function Sr(e,t,n){if(n.numFailures===0)return t;if(t.type==="deleteRange")return null;var r=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return n.numFailures===r?null:(t=w({},t),N(t.keys)&&(t.keys=t.keys.filter(function(i,a){return!(a in n.failures)})),"values"in t&&N(t.values)&&(t.values=t.values.filter(function(i,a){return!(a in n.failures)})),t)}function Bn(e,t){return n=e,((r=t).lower===void 0||(r.lowerOpen?0<W(n,r.lower):0<=W(n,r.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?W(e,t.upper)<0:W(e,t.upper)<=0));var n,r}function Kr(e,t,v,r,i,a){if(!v||v.length===0)return e;var o=t.query.index,u=o.multiEntry,c=t.query.range,f=r.schema.primaryKey.extractKey,p=o.extractKey,s=(o.lowLevelIndex||o).extractKey,v=v.reduce(function(l,d){var y=l,h=[];if(d.type==="add"||d.type==="put")for(var m=new ie,g=d.values.length-1;0<=g;--g){var b,_=d.values[g],x=f(_);m.hasKey(x)||(b=p(_),(u&&N(b)?b.some(function(S){return Bn(S,c)}):Bn(b,c))&&(m.addKey(x),h.push(_)))}switch(d.type){case"add":var K=new ie().addKeys(t.values?l.map(function(j){return f(j)}):l),y=l.concat(t.values?h.filter(function(j){return j=f(j),!K.hasKey(j)&&(K.addKey(j),!0)}):h.map(function(j){return f(j)}).filter(function(j){return!K.hasKey(j)&&(K.addKey(j),!0)}));break;case"put":var k=new ie().addKeys(d.values.map(function(j){return f(j)}));y=l.filter(function(j){return!k.hasKey(t.values?f(j):j)}).concat(t.values?h:h.map(function(j){return f(j)}));break;case"delete":var P=new ie().addKeys(d.keys);y=l.filter(function(j){return!P.hasKey(t.values?f(j):j)});break;case"deleteRange":var I=d.range;y=l.filter(function(j){return!Bn(f(j),I)})}return y},e);return v===e?e:(v.sort(function(l,d){return W(s(l),s(d))||W(f(l),f(d))}),t.limit&&t.limit<1/0&&(v.length>t.limit?v.length=t.limit:e.length===t.limit&&v.length<t.limit&&(i.dirty=!0)),a?Object.freeze(v):v)}function Ar(e,t){return W(e.lower,t.lower)===0&&W(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Si(e,t){return(function(n,r,i,a){if(n===void 0)return r!==void 0?-1:0;if(r===void 0)return 1;if((r=W(n,r))===0){if(i&&a)return 0;if(i)return 1;if(a)return-1}return r})(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=(function(n,r,i,a){if(n===void 0)return r!==void 0?1:0;if(r===void 0)return-1;if((r=W(n,r))===0){if(i&&a)return 0;if(i)return-1;if(a)return 1}return r})(e.upper,t.upper,e.upperOpen,t.upperOpen)}function Ki(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",function(){var i,a;e.subscribers.delete(n),e.subscribers.size===0&&(i=e,a=t,setTimeout(function(){i.subscribers.size===0&&je(a,i)},3e3))})}var Ai={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return w(w({},e),{transaction:function(n,r,i){var a,o,u=e.transaction(n,r,i);return r==="readwrite"&&(o=(a=new AbortController).signal,i=function(c){return function(){if(a.abort(),r==="readwrite"){for(var f=new Set,p=0,s=n;p<s.length;p++){var v=s[p],l=Fe["idb://".concat(t,"/").concat(v)];if(l){var d=e.table(v),y=l.optimisticOps.filter(function(j){return j.trans===u});if(u._explicit&&c&&u.mutatedParts)for(var h=0,m=Object.values(l.queries.query);h<m.length;h++)for(var g=0,b=(K=m[h]).slice();g<b.length;g++)An((k=b[g]).obsSet,u.mutatedParts)&&(je(K,k),k.subscribers.forEach(function(j){return f.add(j)}));else if(0<y.length){l.optimisticOps=l.optimisticOps.filter(function(j){return j.trans!==u});for(var _=0,x=Object.values(l.queries.query);_<x.length;_++)for(var K,k,P,I=0,S=(K=x[_]).slice();I<S.length;I++)(k=S[I]).res!=null&&u.mutatedParts&&(c&&!k.dirty?(P=Object.isFrozen(k.res),P=Kr(k.res,k.req,y,d,k,P),k.dirty?(je(K,k),k.subscribers.forEach(function(j){return f.add(j)})):P!==k.res&&(k.res=P,k.promise=D.resolve({result:P}))):(k.dirty&&je(K,k),k.subscribers.forEach(function(j){return f.add(j)})))}}}f.forEach(function(j){return j()})}}},u.addEventListener("abort",i(!1),{signal:o}),u.addEventListener("error",i(!1),{signal:o}),u.addEventListener("complete",i(!0),{signal:o})),u},table:function(n){var r=e.table(n),i=r.schema.primaryKey;return w(w({},r),{mutate:function(a){var o=C.trans;if(i.outbound||o.db._options.cache==="disabled"||o.explicit||o.idbtrans.mode!=="readwrite")return r.mutate(a);var u=Fe["idb://".concat(t,"/").concat(n)];return u?(o=r.mutate(a),a.type!=="add"&&a.type!=="put"||!(50<=a.values.length||Rn(i,a).some(function(c){return c==null}))?(u.optimisticOps.push(a),a.mutatedParts&&Vt(a.mutatedParts),o.then(function(c){0<c.numFailures&&(je(u.optimisticOps,a),(c=Sr(0,a,c))&&u.optimisticOps.push(c),a.mutatedParts&&Vt(a.mutatedParts))}),o.catch(function(){je(u.optimisticOps,a),a.mutatedParts&&Vt(a.mutatedParts)})):o.then(function(c){var f=Sr(0,w(w({},a),{values:a.values.map(function(p,s){var v;return c.failures[s]?p:(p=(v=i.keyPath)!==null&&v!==void 0&&v.includes(".")?De(p):w({},p),ce(p,i.keyPath,c.results[s]),p)})}),c);u.optimisticOps.push(f),queueMicrotask(function(){return a.mutatedParts&&Vt(a.mutatedParts)})}),o):r.mutate(a)},query:function(a){if(!Pr(C,r)||!Or("query",a))return r.query(a);var o=((f=C.trans)===null||f===void 0?void 0:f.db._options.cache)==="immutable",s=C,u=s.requery,c=s.signal,f=(function(d,y,h,m){var g=Fe["idb://".concat(d,"/").concat(y)];if(!g)return[];if(!(y=g.queries[h]))return[null,!1,g,null];var b=y[(m.query?m.query.index.name:null)||""];if(!b)return[null,!1,g,null];switch(h){case"query":var _=b.find(function(x){return x.req.limit===m.limit&&x.req.values===m.values&&Ar(x.req.query.range,m.query.range)});return _?[_,!0,g,b]:[b.find(function(x){return("limit"in x.req?x.req.limit:1/0)>=m.limit&&(!m.values||x.req.values)&&Si(x.req.query.range,m.query.range)}),!1,g,b];case"count":return _=b.find(function(x){return Ar(x.req.query.range,m.query.range)}),[_,!!_,g,b]}})(t,n,"query",a),p=f[0],s=f[1],v=f[2],l=f[3];return p&&s?p.obsSet=a.obsSet:(s=r.query(a).then(function(d){var y=d.result;if(p&&(p.res=y),o){for(var h=0,m=y.length;h<m;++h)Object.freeze(y[h]);Object.freeze(y)}else d.result=De(y);return d}).catch(function(d){return l&&p&&je(l,p),Promise.reject(d)}),p={obsSet:a.obsSet,promise:s,subscribers:new Set,type:"query",req:a,dirty:!1},l?l.push(p):(l=[p],(v=v||(Fe["idb://".concat(t,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[a.query.index.name||""]=l)),Ki(p,l,u,c),p.promise.then(function(d){return{result:Kr(d.result,a,v?.optimisticOps,r,p,o)}})}})}})}};function zt(e,t){return new Proxy(e,{get:function(n,r,i){return r==="db"?t:Reflect.get(n,r,i)}})}var _e=(Z.prototype.version=function(e){if(isNaN(e)||e<.1)throw new q.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new q.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(r){return r._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(gi),n.stores({}),this._state.autoSchema=!1,n)},Z.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||C.letThrough||this._vip)?e():new D(function(n,r){if(t._state.openComplete)return r(new q.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void r(new q.DatabaseClosed);t.open().catch(Y)}t._state.dbReadyPromise.then(n,r)}).then(e)},Z.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;return i&&this.unuse({stack:t,name:i}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:n,level:r??10,name:i}),e.sort(function(a,o){return a.level-o.level}),this},Z.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(i){return r?i.create!==r:!!n&&i.name!==n})),this},Z.prototype.open=function(){var e=this;return qe(xe,function(){return xi(e)})},Z.prototype._close=function(){var e=this._state,t=Ze.indexOf(this);if(0<=t&&Ze.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new D(function(n){e.dbReadyResolve=n}),e.openCanceller=new D(function(n,r){e.cancelOpen=r}))},Z.prototype.close=function(n){var t=(n===void 0?{disableAutoOpen:!0}:n).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new q.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new q.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},Z.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var n=0<arguments.length&&typeof arguments[0]!="object",r=this._state;return new D(function(i,a){function o(){t.close(e);var u=t._deps.indexedDB.deleteDatabase(t.name);u.onsuccess=H(function(){var c,f,p;c=t._deps,f=t.name,p=c.indexedDB,c=c.IDBKeyRange,On(p)||f===It||Pn(p,c).delete(f).catch(Y),i()}),u.onerror=ve(a),u.onblocked=t._fireOnBlocked}if(n)throw new q.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})},Z.prototype.backendDB=function(){return this.idbdb},Z.prototype.isOpen=function(){return this.idbdb!==null},Z.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},Z.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Z.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Z.prototype,"tables",{get:function(){var e=this;return B(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),Z.prototype.transaction=function(){var e=(function(t,n,r){var i=arguments.length;if(i<2)throw new q.InvalidArgument("Too few arguments");for(var a=new Array(i-1);--i;)a[i-1]=arguments[i];return r=a.pop(),[t,Gn(a),r]}).apply(this,arguments);return this._transaction.apply(this,e)},Z.prototype._transaction=function(e,t,n){var r=this,i=C.trans;i&&i.db===this&&e.indexOf("!")===-1||(i=null);var a,o,u=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(o=t.map(function(f){if(f=f instanceof r.Table?f.name:f,typeof f!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return f}),e=="r"||e===dn)a=dn;else{if(e!="rw"&&e!=pn)throw new q.InvalidArgument("Invalid transaction mode: "+e);a=pn}if(i){if(i.mode===dn&&a===pn){if(!u)throw new q.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&o.forEach(function(f){if(i&&i.storeNames.indexOf(f)===-1){if(!u)throw new q.SubTransaction("Table "+f+" not included in parent transaction.");i=null}}),u&&i&&!i.active&&(i=null)}}catch(f){return i?i._promise(null,function(p,s){s(f)}):Q(f)}var c=(function f(p,s,v,l,d){return D.resolve().then(function(){var y=C.transless||C,h=p._createTransaction(s,v,p._dbSchema,l);if(h.explicit=!0,y={trans:h,transless:y},l)h.idbtrans=l.idbtrans;else try{h.create(),h.idbtrans._explicit=!0,p._state.PR1398_maxLoop=3}catch(b){return b.name===nn.InvalidState&&p.isOpen()&&0<--p._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),p.close({disableAutoOpen:!1}),p.open().then(function(){return f(p,s,v,null,d)})):Q(b)}var m,g=tn(d);return g&&Qe(),y=D.follow(function(){var b;(m=d.call(h,h))&&(g?(b=Ee.bind(null,null),m.then(b,b)):typeof m.next=="function"&&typeof m.throw=="function"&&(m=Tn(m)))},y),(m&&typeof m.then=="function"?D.resolve(m).then(function(b){return h.active?b:Q(new q.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):y.then(function(){return m})).then(function(b){return l&&h._resolve(),h._completion.then(function(){return b})}).catch(function(b){return h._reject(b),Q(b)})})}).bind(null,this,a,o,i,n);return i?i._promise(a,c,"lock"):C.trans?qe(C.transless,function(){return r._whenReady(c)}):this._whenReady(c)},Z.prototype.table=function(e){if(!X(this._allTables,e))throw new q.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},Z);function Z(e,t){var n=this;this._middlewares={},this.verno=0;var r=Z.dependencies;this._options=t=w({addons:Z.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},r=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var i,a,o,u,c,f={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Y,dbReadyPromise:null,cancelOpen:Y,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};f.dbReadyPromise=new D(function(s){f.dbReadyResolve=s}),f.openCanceller=new D(function(s,v){f.cancelOpen=v}),this._state=f,this.name=e,this.on=ct(this,"populate","blocked","versionchange","close",{ready:[rn,Y]}),this.on.ready.subscribe=Ae(this.on.ready.subscribe,function(s){return function(v,l){Z.vip(function(){var d,y=n._state;y.openComplete?(y.dbOpenError||D.resolve().then(v),l&&s(v)):y.onReadyBeingFired?(y.onReadyBeingFired.push(v),l&&s(v)):(s(v),d=n,l||s(function h(){d.on.ready.unsubscribe(v),d.on.ready.unsubscribe(h)}))})}}),this.Collection=(i=this,lt(fi.prototype,function(m,h){this.db=i;var l=or,d=null;if(h)try{l=h()}catch(g){d=g}var y=m._ctx,h=y.table,m=h.hook.reading.fire;this._ctx={table:h,index:y.index,isPrimKey:!y.index||h.schema.primKey.keyPath&&y.index===h.schema.primKey.name,range:l,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:d,or:y.or,valueMapper:m!==it?m:null}})),this.Table=(a=this,lt(lr.prototype,function(s,v,l){this.db=a,this._tx=l,this.name=s,this.schema=v,this.hook=a._allTables[s]?a._allTables[s].hook:ct(null,{creating:[ni,Y],reading:[ti,it],updating:[ii,Y],deleting:[ri,Y]})})),this.Transaction=(o=this,lt(pi.prototype,function(s,v,l,d,y){var h=this;this.db=o,this.mode=s,this.storeNames=v,this.schema=l,this.chromeTransactionDurability=d,this.idbtrans=null,this.on=ct(this,"complete","error","abort"),this.parent=y||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new D(function(m,g){h._resolve=m,h._reject=g}),this._completion.then(function(){h.active=!1,h.on.complete.fire()},function(m){var g=h.active;return h.active=!1,h.on.error.fire(m),h.parent?h.parent._reject(m):g&&h.idbtrans&&h.idbtrans.abort(),Q(m)})})),this.Version=(u=this,lt(_i.prototype,function(s){this.db=u,this._cfg={version:s,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(c=this,lt(yr.prototype,function(s,v,l){if(this.db=c,this._ctx={table:s,index:v===":id"?null:v,or:l},this._cmp=this._ascending=W,this._descending=function(d,y){return W(y,d)},this._max=function(d,y){return 0<W(d,y)?d:y},this._min=function(d,y){return W(d,y)<0?d:y},this._IDBKeyRange=c._deps.IDBKeyRange,!this._IDBKeyRange)throw new q.MissingAPI})),this.on("versionchange",function(s){0<s.newVersion?console.warn("Another connection wants to upgrade database '".concat(n.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(n.name,"'. Closing db now to resume the delete request.")),n.close({disableAutoOpen:!1})}),this.on("blocked",function(s){!s.newVersion||s.newVersion<s.oldVersion?console.warn("Dexie.delete('".concat(n.name,"') was blocked")):console.warn("Upgrade '".concat(n.name,"' blocked by other connection holding version ").concat(s.oldVersion/10))}),this._maxKey=pt(t.IDBKeyRange),this._createTransaction=function(s,v,l,d){return new n.Transaction(s,v,l,n._options.chromeTransactionDurability,d)},this._fireOnBlocked=function(s){n.on("blocked").fire(s),Ze.filter(function(v){return v.name===n.name&&v!==n&&!v._state.vcFired}).map(function(v){return v.on("versionchange").fire(s)})},this.use(Pi),this.use(Ai),this.use(Oi),this.use(ki),this.use(Ei);var p=new Proxy(this,{get:function(s,v,l){if(v==="_vip")return!0;if(v==="table")return function(y){return zt(n.table(y),p)};var d=Reflect.get(s,v,l);return d instanceof lr?zt(d,p):v==="tables"?d.map(function(y){return zt(y,p)}):v==="_createTransaction"?function(){return zt(d.apply(this,arguments),p)}:d}});this.vip=p,r.forEach(function(s){return s(n)})}var $t,pe=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Ii=(qn.prototype.subscribe=function(e,t,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:n})},qn.prototype[pe]=function(){return this},qn);function qn(e){this._subscribe=e}try{$t={indexedDB:T.indexedDB||T.mozIndexedDB||T.webkitIndexedDB||T.msIndexedDB,IDBKeyRange:T.IDBKeyRange||T.webkitIDBKeyRange}}catch{$t={indexedDB:null,IDBKeyRange:null}}function Ir(e){var t,n=!1,r=new Ii(function(i){var a=tn(e),o,u=!1,c={},f={},p={get closed(){return u},unsubscribe:function(){u||(u=!0,o&&o.abort(),s&&Se.storagemutated.unsubscribe(l))}};i.start&&i.start(p);var s=!1,v=function(){return hn(d)},l=function(y){Ut(c,y),An(f,c)&&v()},d=function(){var y,h,m;!u&&$t.indexedDB&&(c={},y={},o&&o.abort(),o=new AbortController,m=(function(g){var b=Ge();try{a&&Qe();var _=ke(e,g);return _=a?_.finally(Ee):_}finally{b&&He()}})(h={subscr:y,signal:o.signal,requery:v,querier:e,trans:null}),Promise.resolve(m).then(function(g){n=!0,t=g,u||h.signal.aborted||(c={},(function(b){for(var _ in b)if(X(b,_))return;return 1})(f=y)||s||(Se(dt,l),s=!0),hn(function(){return!u&&i.next&&i.next(g)}))},function(g){n=!1,["DatabaseClosedError","AbortError"].includes(g?.name)||u||hn(function(){u||i.error&&i.error(g)})}))};return setTimeout(v,0),p});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var Le=_e;function Nn(e){var t=Ke;try{Ke=!0,Se.storagemutated.fire(e),jn(e,!0)}finally{Ke=t}}ee(Le,w(w({},_t),{delete:function(e){return new Le(e,{addons:[]}).delete()},exists:function(e){return new Le(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=Le.dependencies,n=t.indexedDB,t=t.IDBKeyRange,(On(n)?Promise.resolve(n.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==It})}):Pn(n,t).toCollection().primaryKeys()).then(e)}catch{return Q(new q.MissingAPI)}var t,n},defineClass:function(){return function(e){R(this,e)}},ignoreTransaction:function(e){return C.trans?qe(C.transless,e):e()},vip:Sn,async:function(e){return function(){try{var t=Tn(e.apply(this,arguments));return t&&typeof t.then=="function"?t:D.resolve(t)}catch(n){return Q(n)}}},spawn:function(e,t,n){try{var r=Tn(e.apply(n,t||[]));return r&&typeof r.then=="function"?r:D.resolve(r)}catch(i){return Q(i)}},currentTransaction:{get:function(){return C.trans||null}},waitFor:function(e,t){return t=D.resolve(typeof e=="function"?Le.ignoreTransaction(e):e).timeout(t||6e4),C.trans?C.trans.waitFor(t):t},Promise:D,debug:{get:function(){return ye},set:function(e){Jn(e)}},derive:ue,extend:R,props:ee,override:Ae,Events:ct,on:Se,liveQuery:Ir,extendObservabilitySet:Ut,getByKeyPath:de,setByKeyPath:ce,delByKeyPath:function(e,t){typeof t=="string"?ce(e,t,void 0):"length"in t&&[].map.call(t,function(n){ce(e,n,void 0)})},shallowClone:Yn,deepClone:De,getObjectDiff:Cn,cmp:W,asap:ze,minKey:-1/0,addons:[],connections:Ze,errnames:nn,dependencies:$t,cache:Fe,semVer:"4.0.10",version:"4.0.10".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),Le.maxKey=pt(Le.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Se(dt,function(e){Ke||(e=new CustomEvent(gn,{detail:e}),Ke=!0,dispatchEvent(e),Ke=!1)}),addEventListener(gn,function(e){e=e.detail,Ke||Nn(e)}));var tt,Ke=!1,Dr=function(){};return typeof BroadcastChannel<"u"&&((Dr=function(){(tt=new BroadcastChannel(gn)).onmessage=function(e){return e.data&&Nn(e.data)}})(),typeof tt.unref=="function"&&tt.unref(),Se(dt,function(e){Ke||tt.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!_e.disableBfCache&&e.persisted){ye&&console.debug("Dexie: handling persisted pagehide"),tt?.close();for(var t=0,n=Ze;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!_e.disableBfCache&&e.persisted&&(ye&&console.debug("Dexie: handling persisted pageshow"),Dr(),Nn({all:new ie(-1/0,[[]])}))})),D.rejectionMapper=function(e,t){return!e||e instanceof Xe||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Zn[e.name]?e:(t=new Zn[e.name](t||e.message,e),"stack"in e&&$(t,"stack",{get:function(){return this.inner.stack}}),t)},Jn(ye),w(_e,Object.freeze({__proto__:null,Dexie:_e,liveQuery:Ir,Entity:ur,cmp:W,PropModSymbol:we,PropModification:ft,replacePrefix:function(e,t){return new ft({replacePrefix:[e,t]})},add:function(e){return new ft({add:e})},remove:function(e){return new ft({remove:e})},default:_e,RangeSet:ie,mergeRanges:mt,rangesOverlap:wr}),{default:_e}),_e})})(Gt)),Gt.exports}var Hi=Gi();const Vn=ji(Hi),Rr=Symbol.for("Dexie"),Qt=globalThis[Rr]||(globalThis[Rr]=Vn);if(Vn.semVer!==Qt.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Vn.semVer} and ${Qt.semVer}`);const{liveQuery:da,mergeRanges:pa,rangesOverlap:ya,RangeSet:va,cmp:ma,Entity:ga,PropModSymbol:ba,PropModification:wa,replacePrefix:_a,add:xa,remove:ka}=Qt;var Zt="docs",Qi="changes",Br="attachments",$r="dexie",qr=new Map,Ht=new Map;function Zi(O,E,A,w){var M="rxdb-dexie-"+O+"--"+w.version+"--"+E,T=Fi(qr,M,()=>{var B=(async()=>{var N=Xn(A);N.autoOpen=!1;var R=new Qt(M,N),re={[Zt]:ta(w),[Qi]:"++sequence, id",[Br]:"id"};return R.version(1).stores(re),await R.open(),{dexieDb:R,dexieTable:R[Zt],dexieAttachmentsTable:R[Br],booleanIndexes:na(w)}})();return qr.set(M,T),Ht.set(T,0),B});return T}async function Ji(O){var E=await O,A=Ht.get(O),w=A-1;w===0?(E.dexieDb.close(),Ht.delete(O)):Ht.set(O,w)}var Wn="__";function nt(O){var E=O.split(".");if(E.length>1)return E.map(w=>nt(w)).join(".");if(O.startsWith("|")){var A=O.substring(1);return Wn+A}else return O}function Xr(O){var E=O.split(".");if(E.length>1)return E.map(w=>Xr(w)).join(".");if(O.startsWith(Wn)){var A=O.substring(Wn.length);return"|"+A}else return O}function ea(O,E){if(!E)return E;var A=Xn(E);return A=zn(A),O.forEach(w=>{var M=Ur(E,w),T=M?"1":"0",B=nt(w);Vr(A,B,T)}),A}function Yr(O,E){return E&&(E=Xn(E),E=$n(E),O.forEach(A=>{var w=Ur(E,A),M=w==="1";Vr(E,A,M)}),E)}function zn(O){if(!O||typeof O=="string"||typeof O=="number"||typeof O=="boolean")return O;if(Array.isArray(O))return O.map(A=>zn(A));if(typeof O=="object"){var E={};return Object.entries(O).forEach(([A,w])=>{typeof w=="object"&&(w=zn(w)),E[nt(A)]=w}),E}}function $n(O){if(!O||typeof O=="string"||typeof O=="number"||typeof O=="boolean")return O;if(Array.isArray(O))return O.map(A=>$n(A));if(typeof O=="object"){var E={};return Object.entries(O).forEach(([A,w])=>{(typeof w=="object"||Array.isArray(O))&&(w=$n(w)),E[Xr(A)]=w}),E}}function ta(O){var E=[],A=zr(O.primaryKey);E.push([A]),E.push(["_deleted",A]),O.indexes&&O.indexes.forEach(T=>{var B=Wr(T);E.push(B)}),E.push(["_meta.lwt",A]),E.push(["_meta.lwt"]),E=E.map(T=>T.map(B=>nt(B)));var w=E.map(T=>T.length===1?T[0]:"["+T.join("+")+"]");w=w.filter((T,B,N)=>N.indexOf(T)===B);var M=w.join(", ");return M}async function Nr(O,E){var A=await O,w=await A.dexieTable.bulkGet(E);return w.map(M=>Yr(A.booleanIndexes,M))}function Yt(O,E){return O+"||"+E}function na(O){var E=new Set,A=[];return O.indexes?(O.indexes.forEach(w=>{var M=Wr(w);M.forEach(T=>{if(!E.has(T)){E.add(T);var B=Ti(O,T);B.type==="boolean"&&A.push(T)}})}),A.push("_deleted"),Ci(A)):A}function Mr(O){return O===qi?-1/0:O}function Fr(O,E,A){if(O.includes(E)){var w=A===Ni||A===!0?"1":"0";return w}else return A}function Gr(O,E,A){if(!A){if(typeof window>"u")throw new Error("IDBKeyRange missing");A=window.IDBKeyRange}var w=E.startKeys.map((B,N)=>{var R=E.index[N];return Fr(O,R,B)}).map(Mr),M=E.endKeys.map((B,N)=>{var R=E.index[N];return Fr(O,R,B)}).map(Mr),T=A.bound(w,M,!E.inclusiveStart,!E.inclusiveEnd);return T}async function Lr(O,E){var A=await O.internals,w=E.query,M=w.skip?w.skip:0,T=w.limit?w.limit:1/0,B=M+T,N=E.queryPlan,R=!1;N.selectorSatisfiedByIndex||(R=Ri(O.schema,E.query));var re=Gr(A.booleanIndexes,N,A.dexieDb._options.IDBKeyRange),J=N.index,X=[];if(await A.dexieDb.transaction("r",A.dexieTable,async he=>{var $=he.idbtrans,ue=$.objectStore(Zt),gt,bt;bt="["+J.map(Ae=>nt(Ae)).join("+")+"]",gt=ue.index(bt);var We=gt.openCursor(re);await new Promise(Ae=>{We.onsuccess=function(Ie){var ze=Ie.target.result;if(ze){var de=Yr(A.booleanIndexes,ze.value);(!R||R(de))&&X.push(de),N.sortSatisfiedByIndex&&X.length===B?Ae():ze.continue()}else Ae()}})}),!N.sortSatisfiedByIndex){var ee=Bi(O.schema,E.query);X=X.sort(ee)}return X=X.slice(M,B),{documents:X}}async function ra(O,E){var A=await O.internals,w=E.queryPlan,M=w.index,T=Gr(A.booleanIndexes,w,A.dexieDb._options.IDBKeyRange),B=-1;return await A.dexieDb.transaction("r",A.dexieTable,async N=>{var R=N.idbtrans,re=R.objectStore(Zt),J,X;X="["+M.map(he=>nt(he)).join("+")+"]",J=re.index(X);var ee=J.count(T);B=await new Promise((he,$)=>{ee.onsuccess=function(){he(ee.result)},ee.onerror=ue=>$(ue)})}),B}var ia=Un(),Ln=!1,aa=(function(){function O(A,w,M,T,B,N,R,re){this.changes$=new Tr,this.instanceId=ia++,this.storage=A,this.databaseName=w,this.collectionName=M,this.schema=T,this.internals=B,this.options=N,this.settings=R,this.devMode=re,this.primaryPath=zr(this.schema.primaryKey)}var E=O.prototype;return E.bulkWrite=async function(w,M){Ve(this),!Ln&&(!Fn.premium||typeof Fn.premium!="string"||await Li(Fn.premium)!==$i)&&console.warn(["-------------- RxDB Open Core RxStorage -------------------------------","You are using the free Dexie.js based RxStorage implementation from RxDB https://rxdb.info/rx-storage-dexie.html?console=dexie ","While this is a great option, we want to let you know that there are faster storage solutions available in our premium plugins.","For professional users and production environments, we highly recommend considering these premium options to enhance performance and reliability."," https://rxdb.info/premium?console=dexie ","If you already purchased premium access you can disable this log by calling the setPremiumFlag() function from rxdb-premium/plugins/shared.","---------------------------------------------------------------------"].join(`
`)),Ln=!0,w.forEach(J=>{if(!J.document._rev||J.previous&&!J.previous._rev)throw Mi("SNH",{args:{row:J}})});var T=await this.internals,B={error:[]};this.devMode&&(w=w.map(J=>{var X=Ui(J.document);return{previous:J.previous,document:X}}));var N=w.map(J=>J.document[this.primaryPath]),R;if(await T.dexieDb.transaction("rw",T.dexieTable,T.dexieAttachmentsTable,async()=>{var J=new Map,X=await Nr(this.internals,N);X.forEach($=>{var ue=$;return ue&&J.set(ue[this.primaryPath],ue),ue}),R=Vi(this,this.primaryPath,J,w,M),B.error=R.errors;var ee=[];R.bulkInsertDocs.forEach($=>{ee.push($.document)}),R.bulkUpdateDocs.forEach($=>{ee.push($.document)}),ee=ee.map($=>ea(T.booleanIndexes,$)),ee.length>0&&await T.dexieTable.bulkPut(ee);var he=[];R.attachmentsAdd.forEach($=>{he.push({id:Yt($.documentId,$.attachmentId),data:$.attachmentData.data})}),R.attachmentsUpdate.forEach($=>{he.push({id:Yt($.documentId,$.attachmentId),data:$.attachmentData.data})}),await T.dexieAttachmentsTable.bulkPut(he),await T.dexieAttachmentsTable.bulkDelete(R.attachmentsRemove.map($=>Yt($.documentId,$.attachmentId)))}),R=jr(R),R.eventBulk.events.length>0){var re=jr(R.newestRow).document;R.eventBulk.checkpoint={id:re[this.primaryPath],lwt:re._meta.lwt},R.eventBulk.endTime=Un(),this.changes$.next(R.eventBulk)}return B},E.findDocumentsById=async function(w,M){Ve(this);var T=await this.internals,B=[];return await T.dexieDb.transaction("r",T.dexieTable,async()=>{var N=await Nr(this.internals,w);N.forEach(R=>{R&&(!R._deleted||M)&&B.push(R)})}),B},E.query=function(w){return Ve(this),Lr(this,w)},E.count=async function(w){if(w.queryPlan.selectorSatisfiedByIndex){var M=await ra(this,w);return{count:M,mode:"fast"}}else{var T=await Lr(this,w);return{count:T.documents.length,mode:"slow"}}},E.changeStream=function(){return Ve(this),this.changes$.asObservable()},E.cleanup=async function(w){Ve(this);var M=await this.internals;return await M.dexieDb.transaction("rw",M.dexieTable,async()=>{var T=Un()-w,B=await M.dexieTable.where("_meta.lwt").below(T).toArray(),N=[];B.forEach(R=>{R._deleted==="1"&&N.push(R[this.primaryPath])}),await M.dexieTable.bulkDelete(N)}),!0},E.getAttachmentData=async function(w,M,T){Ve(this);var B=await this.internals,N=Yt(w,M);return await B.dexieDb.transaction("r",B.dexieAttachmentsTable,async()=>{var R=await B.dexieAttachmentsTable.get(N);if(R)return R.data;throw new Error("attachment missing documentId: "+w+" attachmentId: "+M)})},E.remove=async function(){Ve(this);var w=await this.internals;return await w.dexieTable.clear(),this.close()},E.close=function(){return this.closed?this.closed:(this.closed=(async()=>{this.changes$.complete(),await Ji(this.internals)})(),this.closed)},E.conflictResultionTasks=function(){return new Tr},E.resolveConflictResultionTask=async function(w){},O})();async function oa(O,E,A){var w=Zi(E.databaseName,E.collectionName,A,E.schema),M=new aa(O,E.databaseName,E.collectionName,E.schema,w,E.options,A,E.devMode);return await Xi($r,E,M),Promise.resolve(M)}function Ve(O){if(O.closed)throw new Error("RxStorageInstanceDexie is closed "+O.databaseName+"-"+O.collectionName)}var ua=(function(){function O(A){this.name=$r,this.rxdbVersion=zi,this.settings=A}var E=O.prototype;return E.createStorageInstance=function(w){return Wi(w),oa(this,w,this.settings)},O})();function Ea(O={}){var E=new ua(O);return E}export{Br as DEXIE_ATTACHMENTS_TABLE_NAME,Qi as DEXIE_CHANGES_TABLE_NAME,Zt as DEXIE_DOCS_TABLE_NAME,Wn as DEXIE_PIPE_SUBSTITUTE,$r as RX_STORAGE_NAME_DEXIE,ua as RxStorageDexie,aa as RxStorageInstanceDexie,Yt as attachmentObjectId,Ji as closeDexieDb,oa as createDexieStorageInstance,ra as dexieCount,Lr as dexieQuery,nt as dexieReplaceIfStartsWithPipe,Xr as dexieReplaceIfStartsWithPipeRevert,Yr as fromDexieToStorage,$n as fromDexieToStorageField,ea as fromStorageToDexie,zn as fromStorageToDexieField,na as getBooleanIndexes,Zi as getDexieDbWithTables,ta as getDexieStoreSchema,Nr as getDocsInDb,Gr as getKeyRangeByQueryPlan,Ea as getRxStorageDexie,Mr as mapKeyForKeyRange};
