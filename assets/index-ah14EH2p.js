import{s as Uo,_ as Zo,a as Fo,b as Vo,c as Ho,$ as W,d as Ko,e as Jo,f as Wo,g as Bo,h as Go,j as zn,i as Qo,k as Yo,l as Xo,m as ei,n as ti,o as ri,p as ni,q as ai,r as si,t as oi,u as ii,v as ci,w as li,x as ui,y as Be,z as di,A as fi,B as pi,C as mi,D as hi,E as gi,F as yi,G as vi,H as _i,I as wi,J as Ln,K as bi,L as $i,M as Si,N as Ti,O as Ct,P as Pi,Q as Ei,R as Os,S as ki,T as Is,U as Ri,V as Oi,W as Ii,X as Ci,Y as Ni,Z as Ai,a0 as qi,a1 as Mi,a2 as ji,a3 as Di,a4 as xi,a5 as zi,a6 as Li,a7 as Ui,a8 as Zi,a9 as Fi,aa as Vi,ab as Hi,ac as Ki,ad as Ji,ae as Wi,af as Bi,ag as Gi,ah as Qi,ai as Yi,aj as Xi,ak as ec,al as tc,am as rc,an as nc,ao as ac,ap as sc,aq as oc,ar as ic,as as Un,at as cc,au as lc,av as uc,aw as Cs,ax as dc,ay as fc,az as pc,aA as mc,aB as Zn,aC as hc,aD as gc,aE as yc,aF as vc,aG as _c,aH as wc,aI as bc,aJ as $c,aK as Sc,aL as Tc,aM as Pc,aN as Ec,aO as kc,aP as Rc,aQ as Oc,aR as Ic,aS as Cc,aT as Nc,aU as Ac,aV as Fn,aW as zr,aX as Vn,aY as Lr,aZ as Hn,a_ as qc,a$ as Mc,b0 as jc,b1 as Dc,b2 as xc,b3 as zc,b4 as Lc,b5 as Uc,b6 as wr,b7 as Ns,b8 as As,b9 as Zc,ba as Fc,bb as Vc,bc as Hc,bd as Kc,be as Jc,bf as Wc,bg as Bc,bh as Gc,bi as Qc,bj as Yc,bk as Xc,bl as el,bm as tl,bn as rl,bo as nl,bp as al,bq as sl,br as ol,bs as il,bt as cl,bu as ll,bv as ul,bw as dl,bx as fl,by as pl,bz as ml,bA as hl,bB as gl,bC as yl,bD as vl,bE as _l,bF as wl,bG as bl,bH as $l,bI as Sl,bJ as Tl,bK as Pl,bL as El,bM as B,bN as rt,bO as dn,bP as kl,bQ as tt,bR as Nt,bS as Kn,bT as gt,bU as Rl,bV as Jn,bW as Ol,bX as sn,bY as Il,bZ as Cl,b_ as Nl,b$ as Al,c0 as ql}from"./types-HWclk0JI.js";import{X as qs}from"./main-DA3mdgRZ.js";function Rr(e){return!!e._zod}function Tt(e,t){return Rr(e)?Uo(e,t):e.safeParse(t)}function Ms(e){if(!e)return;let t;if(Rr(e)?t=e._zod?.def?.shape:t=e.shape,!!t){if(typeof t=="function")try{return t()}catch{return}return t}}function Ml(e){if(Rr(e)){const s=e._zod?.def;if(s){if(s.value!==void 0)return s.value;if(Array.isArray(s.values)&&s.values.length>0)return s.values[0]}}const r=e._def;if(r){if(r.value!==void 0)return r.value;if(Array.isArray(r.values)&&r.values.length>0)return r.values[0]}const n=e.value;if(n!==void 0)return n}const jl=W("ZodISODateTime",(e,t)=>{Ko.init(e,t),ge.init(e,t)});function js(e){return Zo(jl,e)}const Dl=W("ZodISODate",(e,t)=>{Jo.init(e,t),ge.init(e,t)});function xl(e){return Fo(Dl,e)}const zl=W("ZodISOTime",(e,t)=>{Wo.init(e,t),ge.init(e,t)});function Ll(e){return Vo(zl,e)}const Ul=W("ZodISODuration",(e,t)=>{Bo.init(e,t),ge.init(e,t)});function Zl(e){return Ho(Ul,e)}const Fl=(e,t)=>{Go.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>Yo(e,r)},flatten:{value:r=>Qo(e,r)},addIssue:{value:r=>{e.issues.push(r),e.message=JSON.stringify(e.issues,zn,2)}},addIssues:{value:r=>{e.issues.push(...r),e.message=JSON.stringify(e.issues,zn,2)}},isEmpty:{get(){return e.issues.length===0}}})},Le=W("ZodError",Fl,{Parent:Error}),Vl=Xo(Le),Hl=ti(Le),Kl=ei(Le),Jl=ri(Le),Wl=ni(Le),Bl=ai(Le),Gl=si(Le),Ql=oi(Le),Yl=ii(Le),Xl=ci(Le),eu=li(Le),tu=ui(Le),pe=W("ZodType",(e,t)=>(wi.init(e,t),Object.assign(e["~standard"],{jsonSchema:{input:Ln(e,"input"),output:Ln(e,"output")}}),e.toJSONSchema=bi(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone($i(t,{checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),{parent:!0}),e.with=e.check,e.clone=(r,n)=>Si(e,r,n),e.brand=()=>e,e.register=((r,n)=>(r.add(e,n),e)),e.parse=(r,n)=>Vl(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>Kl(e,r,n),e.parseAsync=async(r,n)=>Hl(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>Jl(e,r,n),e.spa=e.safeParseAsync,e.encode=(r,n)=>Wl(e,r,n),e.decode=(r,n)=>Bl(e,r,n),e.encodeAsync=async(r,n)=>Gl(e,r,n),e.decodeAsync=async(r,n)=>Ql(e,r,n),e.safeEncode=(r,n)=>Yl(e,r,n),e.safeDecode=(r,n)=>Xl(e,r,n),e.safeEncodeAsync=async(r,n)=>eu(e,r,n),e.safeDecodeAsync=async(r,n)=>tu(e,r,n),e.refine=(r,n)=>e.check(Ku(r,n)),e.superRefine=r=>e.check(Ju(r)),e.overwrite=r=>e.check(Ti(r)),e.optional=()=>ve(e),e.exactOptional=()=>Au(e),e.nullable=()=>Gn(e),e.nullish=()=>ve(Gn(e)),e.nonoptional=r=>zu(e,r),e.array=()=>re(e),e.or=r=>fe([e,r]),e.and=r=>fn(e,r),e.transform=r=>cn(e,Fs(r)),e.default=r=>ju(e,r),e.prefault=r=>xu(e,r),e.catch=r=>Uu(e,r),e.pipe=r=>cn(e,r),e.readonly=()=>Vu(e),e.describe=r=>{const n=e.clone();return Ct.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){return Ct.get(e)?.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return Ct.get(e);const n=e.clone();return Ct.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e.apply=r=>r(e),e)),Ds=W("_ZodString",(e,t)=>{Cs.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(n,a,s)=>Hc(e,n,a);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...n)=>e.check(Kc(...n)),e.includes=(...n)=>e.check(Jc(...n)),e.startsWith=(...n)=>e.check(Wc(...n)),e.endsWith=(...n)=>e.check(Bc(...n)),e.min=(...n)=>e.check(wr(...n)),e.max=(...n)=>e.check(Ns(...n)),e.length=(...n)=>e.check(As(...n)),e.nonempty=(...n)=>e.check(wr(1,...n)),e.lowercase=n=>e.check(Gc(n)),e.uppercase=n=>e.check(Qc(n)),e.trim=()=>e.check(Yc()),e.normalize=(...n)=>e.check(Xc(...n)),e.toLowerCase=()=>e.check(el()),e.toUpperCase=()=>e.check(tl()),e.slugify=()=>e.check(rl())}),ru=W("ZodString",(e,t)=>{Cs.init(e,t),Ds.init(e,t),e.email=r=>e.check(dc(nu,r)),e.url=r=>e.check(fc(au,r)),e.jwt=r=>e.check(pc(_u,r)),e.emoji=r=>e.check(mc(su,r)),e.guid=r=>e.check(Zn(Wn,r)),e.uuid=r=>e.check(hc(At,r)),e.uuidv4=r=>e.check(gc(At,r)),e.uuidv6=r=>e.check(yc(At,r)),e.uuidv7=r=>e.check(vc(At,r)),e.nanoid=r=>e.check(_c(ou,r)),e.guid=r=>e.check(Zn(Wn,r)),e.cuid=r=>e.check(wc(iu,r)),e.cuid2=r=>e.check(bc(cu,r)),e.ulid=r=>e.check($c(lu,r)),e.base64=r=>e.check(Sc(gu,r)),e.base64url=r=>e.check(Tc(yu,r)),e.xid=r=>e.check(Pc(uu,r)),e.ksuid=r=>e.check(Ec(du,r)),e.ipv4=r=>e.check(kc(fu,r)),e.ipv6=r=>e.check(Rc(pu,r)),e.cidrv4=r=>e.check(Oc(mu,r)),e.cidrv6=r=>e.check(Ic(hu,r)),e.e164=r=>e.check(Cc(vu,r)),e.datetime=r=>e.check(js(r)),e.date=r=>e.check(xl(r)),e.time=r=>e.check(Ll(r)),e.duration=r=>e.check(Zl(r))});function I(e){return di(ru,e)}const ge=W("ZodStringFormat",(e,t)=>{ol.init(e,t),Ds.init(e,t)}),nu=W("ZodEmail",(e,t)=>{il.init(e,t),ge.init(e,t)}),Wn=W("ZodGUID",(e,t)=>{cl.init(e,t),ge.init(e,t)}),At=W("ZodUUID",(e,t)=>{ll.init(e,t),ge.init(e,t)}),au=W("ZodURL",(e,t)=>{ul.init(e,t),ge.init(e,t)}),su=W("ZodEmoji",(e,t)=>{dl.init(e,t),ge.init(e,t)}),ou=W("ZodNanoID",(e,t)=>{fl.init(e,t),ge.init(e,t)}),iu=W("ZodCUID",(e,t)=>{pl.init(e,t),ge.init(e,t)}),cu=W("ZodCUID2",(e,t)=>{ml.init(e,t),ge.init(e,t)}),lu=W("ZodULID",(e,t)=>{hl.init(e,t),ge.init(e,t)}),uu=W("ZodXID",(e,t)=>{gl.init(e,t),ge.init(e,t)}),du=W("ZodKSUID",(e,t)=>{yl.init(e,t),ge.init(e,t)}),fu=W("ZodIPv4",(e,t)=>{vl.init(e,t),ge.init(e,t)}),pu=W("ZodIPv6",(e,t)=>{_l.init(e,t),ge.init(e,t)}),mu=W("ZodCIDRv4",(e,t)=>{wl.init(e,t),ge.init(e,t)}),hu=W("ZodCIDRv6",(e,t)=>{bl.init(e,t),ge.init(e,t)}),gu=W("ZodBase64",(e,t)=>{$l.init(e,t),ge.init(e,t)}),yu=W("ZodBase64URL",(e,t)=>{Sl.init(e,t),ge.init(e,t)}),vu=W("ZodE164",(e,t)=>{Tl.init(e,t),ge.init(e,t)}),_u=W("ZodJWT",(e,t)=>{Pl.init(e,t),ge.init(e,t)}),xs=W("ZodNumber",(e,t)=>{Nc.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(n,a,s)=>Ac(e,n,a),e.gt=(n,a)=>e.check(Fn(n,a)),e.gte=(n,a)=>e.check(zr(n,a)),e.min=(n,a)=>e.check(zr(n,a)),e.lt=(n,a)=>e.check(Vn(n,a)),e.lte=(n,a)=>e.check(Lr(n,a)),e.max=(n,a)=>e.check(Lr(n,a)),e.int=n=>e.check(Bn(n)),e.safe=n=>e.check(Bn(n)),e.positive=n=>e.check(Fn(0,n)),e.nonnegative=n=>e.check(zr(0,n)),e.negative=n=>e.check(Vn(0,n)),e.nonpositive=n=>e.check(Lr(0,n)),e.multipleOf=(n,a)=>e.check(Hn(n,a)),e.step=(n,a)=>e.check(Hn(n,a)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function de(e){return mi(xs,e)}const wu=W("ZodNumberFormat",(e,t)=>{El.init(e,t),xs.init(e,t)});function Bn(e){return nl(wu,e)}const bu=W("ZodBoolean",(e,t)=>{qc.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Mc(e,r,n)});function Te(e){return gi(bu,e)}const $u=W("ZodNull",(e,t)=>{jc.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Dc(e,r,n)});function zs(e){return hi($u,e)}const Su=W("ZodUnknown",(e,t)=>{xc.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>zc()});function me(){return pi(Su)}const Tu=W("ZodNever",(e,t)=>{al.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>sl(e,r,n)});function Pu(e){return Zc(Tu,e)}const Eu=W("ZodArray",(e,t)=>{Lc.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Uc(e,r,n,a),e.element=t.element,e.min=(r,n)=>e.check(wr(r,n)),e.nonempty=r=>e.check(wr(1,r)),e.max=(r,n)=>e.check(Ns(r,n)),e.length=(r,n)=>e.check(As(r,n)),e.unwrap=()=>e.element});function re(e,t){return fi(Eu,e,t)}const Ls=W("ZodObject",(e,t)=>{Li.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Ui(e,r,n,a),Zi(e,"shape",()=>t.shape),e.keyof=()=>De(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:me()}),e.loose=()=>e.clone({...e._zod.def,catchall:me()}),e.strict=()=>e.clone({...e._zod.def,catchall:Pu()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>Fi(e,r),e.safeExtend=r=>Vi(e,r),e.merge=r=>Hi(e,r),e.pick=r=>Ki(e,r),e.omit=r=>Ji(e,r),e.partial=(...r)=>Wi(Vs,e,r[0]),e.required=(...r)=>Bi(Hs,e,r[0])});function U(e,t){const r={type:"object",shape:e??{},...Be(t)};return new Ls(r)}function qe(e,t){return new Ls({type:"object",shape:e,catchall:me(),...Be(t)})}const Us=W("ZodUnion",(e,t)=>{Gi.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Qi(e,r,n,a),e.options=t.options});function fe(e,t){return new Us({type:"union",options:e,...Be(t)})}const ku=W("ZodDiscriminatedUnion",(e,t)=>{Us.init(e,t),Yi.init(e,t)});function Zs(e,t,r){return new ku({type:"union",options:t,discriminator:e,...Be(r)})}const Ru=W("ZodIntersection",(e,t)=>{vi.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>_i(e,r,n,a)});function fn(e,t){return new Ru({type:"intersection",left:e,right:t})}const Ou=W("ZodRecord",(e,t)=>{Xi.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>ec(e,r,n,a),e.keyType=t.keyType,e.valueType=t.valueType});function he(e,t,r){return new Ou({type:"record",keyType:e,valueType:t,...Be(r)})}const on=W("ZodEnum",(e,t)=>{tc.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(n,a,s)=>rc(e,n,a),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,a)=>{const s={};for(const o of n)if(r.has(o))s[o]=t.entries[o];else throw new Error(`Key ${o} not found in enum`);return new on({...t,checks:[],...Be(a),entries:s})},e.exclude=(n,a)=>{const s={...t.entries};for(const o of n)if(r.has(o))delete s[o];else throw new Error(`Key ${o} not found in enum`);return new on({...t,checks:[],...Be(a),entries:s})}});function De(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new on({type:"enum",entries:r,...Be(t)})}const Iu=W("ZodLiteral",(e,t)=>{nc.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>ac(e,r,n),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function K(e,t){return new Iu({type:"literal",values:Array.isArray(e)?e:[e],...Be(t)})}const Cu=W("ZodTransform",(e,t)=>{sc.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>oc(e,r),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new ic(e.constructor.name);r.addIssue=s=>{if(typeof s=="string")r.issues.push(Un(s,r.value,t));else{const o=s;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),r.issues.push(Un(o))}};const a=t.transform(r.value,r);return a instanceof Promise?a.then(s=>(r.value=s,r)):(r.value=a,r)}});function Fs(e){return new Cu({type:"transform",transform:e})}const Vs=W("ZodOptional",(e,t)=>{cc.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Is(e,r,n,a),e.unwrap=()=>e._zod.def.innerType});function ve(e){return new Vs({type:"optional",innerType:e})}const Nu=W("ZodExactOptional",(e,t)=>{ki.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Is(e,r,n,a),e.unwrap=()=>e._zod.def.innerType});function Au(e){return new Nu({type:"optional",innerType:e})}const qu=W("ZodNullable",(e,t)=>{Ri.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Oi(e,r,n,a),e.unwrap=()=>e._zod.def.innerType});function Gn(e){return new qu({type:"nullable",innerType:e})}const Mu=W("ZodDefault",(e,t)=>{Ni.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Ai(e,r,n,a),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function ju(e,t){return new Mu({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():Os(t)}})}const Du=W("ZodPrefault",(e,t)=>{qi.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Mi(e,r,n,a),e.unwrap=()=>e._zod.def.innerType});function xu(e,t){return new Du({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():Os(t)}})}const Hs=W("ZodNonOptional",(e,t)=>{Ii.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Ci(e,r,n,a),e.unwrap=()=>e._zod.def.innerType});function zu(e,t){return new Hs({type:"nonoptional",innerType:e,...Be(t)})}const Lu=W("ZodCatch",(e,t)=>{ji.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Di(e,r,n,a),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Uu(e,t){return new Lu({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const Zu=W("ZodPipe",(e,t)=>{lc.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>uc(e,r,n,a),e.in=t.in,e.out=t.out});function cn(e,t){return new Zu({type:"pipe",in:e,out:t})}const Fu=W("ZodReadonly",(e,t)=>{xi.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>zi(e,r,n,a),e.unwrap=()=>e._zod.def.innerType});function Vu(e){return new Fu({type:"readonly",innerType:e})}const Ks=W("ZodCustom",(e,t)=>{Fc.init(e,t),pe.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Vc(e,r)});function Hu(e,t){return yi(Ks,e??(()=>!0),t)}function Ku(e,t={}){return Pi(Ks,e,t)}function Ju(e){return Ei(e)}function Js(e,t){return cn(Fs(e),t)}const Ws="2025-11-25",Wu=[Ws,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],ct="io.modelcontextprotocol/related-task",Or="2.0",Pe=Hu(e=>e!==null&&(typeof e=="object"||typeof e=="function")),Bs=fe([I(),de().int()]),Gs=I();qe({ttl:fe([de(),zs()]).optional(),pollInterval:de().optional()});const Bu=U({ttl:de().optional()}),Gu=U({taskId:I()}),pn=qe({progressToken:Bs.optional(),[ct]:Gu.optional()}),xe=U({_meta:pn.optional()}),Pt=xe.extend({task:Bu.optional()}),Qu=e=>Pt.safeParse(e).success,Ee=U({method:I(),params:xe.loose().optional()}),Ue=U({_meta:pn.optional()}),Ze=U({method:I(),params:Ue.loose().optional()}),ke=qe({_meta:pn.optional()}),Ir=fe([I(),de().int()]),Qs=U({jsonrpc:K(Or),id:Ir,...Ee.shape}).strict(),Qn=e=>Qs.safeParse(e).success,Ys=U({jsonrpc:K(Or),...Ze.shape}).strict(),Yu=e=>Ys.safeParse(e).success,mn=U({jsonrpc:K(Or),id:Ir,result:ke}).strict(),qt=e=>mn.safeParse(e).success;var ne;(function(e){e[e.ConnectionClosed=-32e3]="ConnectionClosed",e[e.RequestTimeout=-32001]="RequestTimeout",e[e.ParseError=-32700]="ParseError",e[e.InvalidRequest=-32600]="InvalidRequest",e[e.MethodNotFound=-32601]="MethodNotFound",e[e.InvalidParams=-32602]="InvalidParams",e[e.InternalError=-32603]="InternalError",e[e.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(ne||(ne={}));const hn=U({jsonrpc:K(Or),id:Ir.optional(),error:U({code:de().int(),message:I(),data:me().optional()})}).strict(),Xu=e=>hn.safeParse(e).success,Xs=fe([Qs,Ys,mn,hn]);fe([mn,hn]);const gn=ke.strict(),ed=Ue.extend({requestId:Ir.optional(),reason:I().optional()}),yn=Ze.extend({method:K("notifications/cancelled"),params:ed}),td=U({src:I(),mimeType:I().optional(),sizes:re(I()).optional(),theme:De(["light","dark"]).optional()}),Et=U({icons:re(td).optional()}),yt=U({name:I(),title:I().optional()}),eo=yt.extend({...yt.shape,...Et.shape,version:I(),websiteUrl:I().optional(),description:I().optional()}),rd=fn(U({applyDefaults:Te().optional()}),he(I(),me())),nd=Js(e=>e&&typeof e=="object"&&!Array.isArray(e)&&Object.keys(e).length===0?{form:{}}:e,fn(U({form:rd.optional(),url:Pe.optional()}),he(I(),me()).optional())),ad=qe({list:Pe.optional(),cancel:Pe.optional(),requests:qe({sampling:qe({createMessage:Pe.optional()}).optional(),elicitation:qe({create:Pe.optional()}).optional()}).optional()}),sd=qe({list:Pe.optional(),cancel:Pe.optional(),requests:qe({tools:qe({call:Pe.optional()}).optional()}).optional()}),od=U({experimental:he(I(),Pe).optional(),sampling:U({context:Pe.optional(),tools:Pe.optional()}).optional(),elicitation:nd.optional(),roots:U({listChanged:Te().optional()}).optional(),tasks:ad.optional()}),id=xe.extend({protocolVersion:I(),capabilities:od,clientInfo:eo}),to=Ee.extend({method:K("initialize"),params:id}),cd=U({experimental:he(I(),Pe).optional(),logging:Pe.optional(),completions:Pe.optional(),prompts:U({listChanged:Te().optional()}).optional(),resources:U({subscribe:Te().optional(),listChanged:Te().optional()}).optional(),tools:U({listChanged:Te().optional()}).optional(),tasks:sd.optional()}),ld=ke.extend({protocolVersion:I(),capabilities:cd,serverInfo:eo,instructions:I().optional()}),ro=Ze.extend({method:K("notifications/initialized"),params:Ue.optional()}),vn=Ee.extend({method:K("ping"),params:xe.optional()}),ud=U({progress:de(),total:ve(de()),message:ve(I())}),dd=U({...Ue.shape,...ud.shape,progressToken:Bs}),_n=Ze.extend({method:K("notifications/progress"),params:dd}),fd=xe.extend({cursor:Gs.optional()}),kt=Ee.extend({params:fd.optional()}),Rt=ke.extend({nextCursor:Gs.optional()}),pd=De(["working","input_required","completed","failed","cancelled"]),Ot=U({taskId:I(),status:pd,ttl:fe([de(),zs()]),createdAt:I(),lastUpdatedAt:I(),pollInterval:ve(de()),statusMessage:ve(I())}),Cr=ke.extend({task:Ot}),md=Ue.merge(Ot),br=Ze.extend({method:K("notifications/tasks/status"),params:md}),wn=Ee.extend({method:K("tasks/get"),params:xe.extend({taskId:I()})}),bn=ke.merge(Ot),$n=Ee.extend({method:K("tasks/result"),params:xe.extend({taskId:I()})});ke.loose();const Sn=kt.extend({method:K("tasks/list")}),Tn=Rt.extend({tasks:re(Ot)}),Pn=Ee.extend({method:K("tasks/cancel"),params:xe.extend({taskId:I()})}),hd=ke.merge(Ot),no=U({uri:I(),mimeType:ve(I()),_meta:he(I(),me()).optional()}),ao=no.extend({text:I()}),En=I().refine(e=>{try{return atob(e),!0}catch{return!1}},{message:"Invalid Base64 string"}),so=no.extend({blob:En}),It=De(["user","assistant"]),vt=U({audience:re(It).optional(),priority:de().min(0).max(1).optional(),lastModified:js({offset:!0}).optional()}),oo=U({...yt.shape,...Et.shape,uri:I(),description:ve(I()),mimeType:ve(I()),annotations:vt.optional(),_meta:ve(qe({}))}),gd=U({...yt.shape,...Et.shape,uriTemplate:I(),description:ve(I()),mimeType:ve(I()),annotations:vt.optional(),_meta:ve(qe({}))}),io=kt.extend({method:K("resources/list")}),yd=Rt.extend({resources:re(oo)}),vd=kt.extend({method:K("resources/templates/list")}),_d=Rt.extend({resourceTemplates:re(gd)}),kn=xe.extend({uri:I()}),wd=kn,co=Ee.extend({method:K("resources/read"),params:wd}),bd=ke.extend({contents:re(fe([ao,so]))}),$d=Ze.extend({method:K("notifications/resources/list_changed"),params:Ue.optional()}),Sd=kn,Td=Ee.extend({method:K("resources/subscribe"),params:Sd}),Pd=kn,Ed=Ee.extend({method:K("resources/unsubscribe"),params:Pd}),kd=Ue.extend({uri:I()}),Rd=Ze.extend({method:K("notifications/resources/updated"),params:kd}),Od=U({name:I(),description:ve(I()),required:ve(Te())}),Id=U({...yt.shape,...Et.shape,description:ve(I()),arguments:ve(re(Od)),_meta:ve(qe({}))}),lo=kt.extend({method:K("prompts/list")}),Cd=Rt.extend({prompts:re(Id)}),Nd=xe.extend({name:I(),arguments:he(I(),I()).optional()}),uo=Ee.extend({method:K("prompts/get"),params:Nd}),Rn=U({type:K("text"),text:I(),annotations:vt.optional(),_meta:he(I(),me()).optional()}),On=U({type:K("image"),data:En,mimeType:I(),annotations:vt.optional(),_meta:he(I(),me()).optional()}),In=U({type:K("audio"),data:En,mimeType:I(),annotations:vt.optional(),_meta:he(I(),me()).optional()}),Ad=U({type:K("tool_use"),name:I(),id:I(),input:he(I(),me()),_meta:he(I(),me()).optional()}),qd=U({type:K("resource"),resource:fe([ao,so]),annotations:vt.optional(),_meta:he(I(),me()).optional()}),Md=oo.extend({type:K("resource_link")}),Cn=fe([Rn,On,In,Md,qd]),jd=U({role:It,content:Cn}),Dd=ke.extend({description:I().optional(),messages:re(jd)}),xd=Ze.extend({method:K("notifications/prompts/list_changed"),params:Ue.optional()}),zd=U({title:I().optional(),readOnlyHint:Te().optional(),destructiveHint:Te().optional(),idempotentHint:Te().optional(),openWorldHint:Te().optional()}),Ld=U({taskSupport:De(["required","optional","forbidden"]).optional()}),fo=U({...yt.shape,...Et.shape,description:I().optional(),inputSchema:U({type:K("object"),properties:he(I(),Pe).optional(),required:re(I()).optional()}).catchall(me()),outputSchema:U({type:K("object"),properties:he(I(),Pe).optional(),required:re(I()).optional()}).catchall(me()).optional(),annotations:zd.optional(),execution:Ld.optional(),_meta:he(I(),me()).optional()}),po=kt.extend({method:K("tools/list")}),Ud=Rt.extend({tools:re(fo)}),Nn=ke.extend({content:re(Cn).default([]),structuredContent:he(I(),me()).optional(),isError:Te().optional()});Nn.or(ke.extend({toolResult:me()}));const Zd=Pt.extend({name:I(),arguments:he(I(),me()).optional()}),An=Ee.extend({method:K("tools/call"),params:Zd}),Fd=Ze.extend({method:K("notifications/tools/list_changed"),params:Ue.optional()});U({autoRefresh:Te().default(!0),debounceMs:de().int().nonnegative().default(300)});const $r=De(["debug","info","notice","warning","error","critical","alert","emergency"]),Vd=xe.extend({level:$r}),mo=Ee.extend({method:K("logging/setLevel"),params:Vd}),Hd=Ue.extend({level:$r,logger:I().optional(),data:me()}),Kd=Ze.extend({method:K("notifications/message"),params:Hd}),Jd=U({name:I().optional()}),Wd=U({hints:re(Jd).optional(),costPriority:de().min(0).max(1).optional(),speedPriority:de().min(0).max(1).optional(),intelligencePriority:de().min(0).max(1).optional()}),Bd=U({mode:De(["auto","required","none"]).optional()}),Gd=U({type:K("tool_result"),toolUseId:I().describe("The unique identifier for the corresponding tool call."),content:re(Cn).default([]),structuredContent:U({}).loose().optional(),isError:Te().optional(),_meta:he(I(),me()).optional()}),Qd=Zs("type",[Rn,On,In]),Sr=Zs("type",[Rn,On,In,Ad,Gd]),Yd=U({role:It,content:fe([Sr,re(Sr)]),_meta:he(I(),me()).optional()}),Xd=Pt.extend({messages:re(Yd),modelPreferences:Wd.optional(),systemPrompt:I().optional(),includeContext:De(["none","thisServer","allServers"]).optional(),temperature:de().optional(),maxTokens:de().int(),stopSequences:re(I()).optional(),metadata:Pe.optional(),tools:re(fo).optional(),toolChoice:Bd.optional()}),ef=Ee.extend({method:K("sampling/createMessage"),params:Xd}),ho=ke.extend({model:I(),stopReason:ve(De(["endTurn","stopSequence","maxTokens"]).or(I())),role:It,content:Qd}),go=ke.extend({model:I(),stopReason:ve(De(["endTurn","stopSequence","maxTokens","toolUse"]).or(I())),role:It,content:fe([Sr,re(Sr)])}),tf=U({type:K("boolean"),title:I().optional(),description:I().optional(),default:Te().optional()}),rf=U({type:K("string"),title:I().optional(),description:I().optional(),minLength:de().optional(),maxLength:de().optional(),format:De(["email","uri","date","date-time"]).optional(),default:I().optional()}),nf=U({type:De(["number","integer"]),title:I().optional(),description:I().optional(),minimum:de().optional(),maximum:de().optional(),default:de().optional()}),af=U({type:K("string"),title:I().optional(),description:I().optional(),enum:re(I()),default:I().optional()}),sf=U({type:K("string"),title:I().optional(),description:I().optional(),oneOf:re(U({const:I(),title:I()})),default:I().optional()}),of=U({type:K("string"),title:I().optional(),description:I().optional(),enum:re(I()),enumNames:re(I()).optional(),default:I().optional()}),cf=fe([af,sf]),lf=U({type:K("array"),title:I().optional(),description:I().optional(),minItems:de().optional(),maxItems:de().optional(),items:U({type:K("string"),enum:re(I())}),default:re(I()).optional()}),uf=U({type:K("array"),title:I().optional(),description:I().optional(),minItems:de().optional(),maxItems:de().optional(),items:U({anyOf:re(U({const:I(),title:I()}))}),default:re(I()).optional()}),df=fe([lf,uf]),ff=fe([of,cf,df]),pf=fe([ff,tf,rf,nf]),mf=Pt.extend({mode:K("form").optional(),message:I(),requestedSchema:U({type:K("object"),properties:he(I(),pf),required:re(I()).optional()})}),hf=Pt.extend({mode:K("url"),message:I(),elicitationId:I(),url:I().url()}),gf=fe([mf,hf]),yf=Ee.extend({method:K("elicitation/create"),params:gf}),vf=Ue.extend({elicitationId:I()}),_f=Ze.extend({method:K("notifications/elicitation/complete"),params:vf}),ln=ke.extend({action:De(["accept","decline","cancel"]),content:Js(e=>e===null?void 0:e,he(I(),fe([I(),de(),Te(),re(I())])).optional())}),wf=U({type:K("ref/resource"),uri:I()}),bf=U({type:K("ref/prompt"),name:I()}),$f=xe.extend({ref:fe([bf,wf]),argument:U({name:I(),value:I()}),context:U({arguments:he(I(),I()).optional()}).optional()}),Sf=Ee.extend({method:K("completion/complete"),params:$f}),Tf=ke.extend({completion:qe({values:re(I()).max(100),total:ve(de().int()),hasMore:ve(Te())})}),Pf=U({uri:I().startsWith("file://"),name:I().optional(),_meta:he(I(),me()).optional()}),Ef=Ee.extend({method:K("roots/list"),params:xe.optional()}),yo=ke.extend({roots:re(Pf)}),kf=Ze.extend({method:K("notifications/roots/list_changed"),params:Ue.optional()});fe([vn,to,Sf,mo,uo,lo,io,vd,co,Td,Ed,An,po,wn,$n,Sn,Pn]);fe([yn,_n,ro,kf,br]);fe([gn,ho,go,ln,yo,bn,Tn,Cr]);fe([vn,ef,yf,Ef,wn,$n,Sn,Pn]);fe([yn,_n,Kd,Rd,$d,Fd,xd,br,_f]);fe([gn,ld,Tf,Dd,Cd,yd,_d,bd,Nn,Ud,bn,Tn,Cr]);class ee extends Error{constructor(t,r,n){super(`MCP error ${t}: ${r}`),this.code=t,this.data=n,this.name="McpError"}static fromError(t,r,n){if(t===ne.UrlElicitationRequired&&n){const a=n;if(a.elicitations)return new Rf(a.elicitations,r)}return new ee(t,r,n)}}class Rf extends ee{constructor(t,r=`URL elicitation${t.length>1?"s":""} required`){super(ne.UrlElicitationRequired,r,{elicitations:t})}get elicitations(){return this.data?.elicitations??[]}}function at(e){return e==="completed"||e==="failed"||e==="cancelled"}const Of=Symbol("Let zodToJsonSchema decide on which parser to use"),Yn={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},If=e=>typeof e=="string"?{...Yn,name:e}:{...Yn,...e},Cf=e=>{const t=If(e),r=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([n,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,n],jsonSchema:void 0}]))}};function vo(e,t,r,n){n?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function le(e,t,r,n,a){e[t]=r,vo(e,t,n,a)}const _o=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};function Me(e){if(e.target!=="openAi")return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:e.$refStrategy==="relative"?_o(t,e.currentPath):t.join("/")}}function Nf(e,t){const r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==B.ZodAny&&(r.items=oe(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&le(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&le(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(le(r,"minItems",e.exactLength.value,e.exactLength.message,t),le(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}function Af(e,t){const r={type:"integer",format:"int64"};if(!e.checks)return r;for(const n of e.checks)switch(n.kind){case"min":t.target==="jsonSchema7"?n.inclusive?le(r,"minimum",n.value,n.message,t):le(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=!0),le(r,"minimum",n.value,n.message,t));break;case"max":t.target==="jsonSchema7"?n.inclusive?le(r,"maximum",n.value,n.message,t):le(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=!0),le(r,"maximum",n.value,n.message,t));break;case"multipleOf":le(r,"multipleOf",n.value,n.message,t);break}return r}function qf(){return{type:"boolean"}}function wo(e,t){return oe(e.type._def,t)}const Mf=(e,t)=>oe(e.innerType._def,t);function bo(e,t,r){const n=r??t.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,s)=>bo(e,t,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return jf(e,t)}}const jf=(e,t)=>{const r={type:"integer",format:"unix-time"};if(t.target==="openApi3")return r;for(const n of e.checks)switch(n.kind){case"min":le(r,"minimum",n.value,n.message,t);break;case"max":le(r,"maximum",n.value,n.message,t);break}return r};function Df(e,t){return{...oe(e.innerType._def,t),default:e.defaultValue()}}function xf(e,t){return t.effectStrategy==="input"?oe(e.schema._def,t):Me(t)}function zf(e){return{type:"string",enum:Array.from(e.values)}}const Lf=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function Uf(e,t){const r=[oe(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),oe(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(s=>!!s);let n=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return r.forEach(s=>{if(Lf(s))a.push(...s.allOf),s.unevaluatedProperties===void 0&&(n=void 0);else{let o=s;if("additionalProperties"in s&&s.additionalProperties===!1){const{additionalProperties:i,...l}=s;o=l}else n=void 0;a.push(o)}}),a.length?{allOf:a,...n}:void 0}function Zf(e,t){const r=typeof e.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[e.value]}:{type:r==="bigint"?"integer":r,const:e.value}}let Ur;const He={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ur===void 0&&(Ur=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ur),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function $o(e,t){const r={type:"string"};if(e.checks)for(const n of e.checks)switch(n.kind){case"min":le(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,t);break;case"max":le(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,t);break;case"email":switch(t.emailStrategy){case"format:email":Ke(r,"email",n.message,t);break;case"format:idn-email":Ke(r,"idn-email",n.message,t);break;case"pattern:zod":Ie(r,He.email,n.message,t);break}break;case"url":Ke(r,"uri",n.message,t);break;case"uuid":Ke(r,"uuid",n.message,t);break;case"regex":Ie(r,n.regex,n.message,t);break;case"cuid":Ie(r,He.cuid,n.message,t);break;case"cuid2":Ie(r,He.cuid2,n.message,t);break;case"startsWith":Ie(r,RegExp(`^${Zr(n.value,t)}`),n.message,t);break;case"endsWith":Ie(r,RegExp(`${Zr(n.value,t)}$`),n.message,t);break;case"datetime":Ke(r,"date-time",n.message,t);break;case"date":Ke(r,"date",n.message,t);break;case"time":Ke(r,"time",n.message,t);break;case"duration":Ke(r,"duration",n.message,t);break;case"length":le(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,t),le(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,t);break;case"includes":{Ie(r,RegExp(Zr(n.value,t)),n.message,t);break}case"ip":{n.version!=="v6"&&Ke(r,"ipv4",n.message,t),n.version!=="v4"&&Ke(r,"ipv6",n.message,t);break}case"base64url":Ie(r,He.base64url,n.message,t);break;case"jwt":Ie(r,He.jwt,n.message,t);break;case"cidr":{n.version!=="v6"&&Ie(r,He.ipv4Cidr,n.message,t),n.version!=="v4"&&Ie(r,He.ipv6Cidr,n.message,t);break}case"emoji":Ie(r,He.emoji(),n.message,t);break;case"ulid":{Ie(r,He.ulid,n.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{Ke(r,"binary",n.message,t);break}case"contentEncoding:base64":{le(r,"contentEncoding","base64",n.message,t);break}case"pattern:zod":{Ie(r,He.base64,n.message,t);break}}break}case"nanoid":Ie(r,He.nanoid,n.message,t)}return r}function Zr(e,t){return t.patternStrategy==="escape"?Vf(e):e}const Ff=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Vf(e){let t="";for(let r=0;r<e.length;r++)Ff.has(e[r])||(t+="\\"),t+=e[r];return t}function Ke(e,t,r,n){e.format||e.anyOf?.some(a=>a.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&n.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&n.errorMessages&&{errorMessage:{format:r}}})):le(e,"format",t,r,n)}function Ie(e,t,r,n){e.pattern||e.allOf?.some(a=>a.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&n.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:Xn(t,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):le(e,"pattern",Xn(t,n),r,n)}function Xn(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;const r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},n=r.i?e.source.toLowerCase():e.source;let a="",s=!1,o=!1,i=!1;for(let l=0;l<n.length;l++){if(s){a+=n[l],s=!1;continue}if(r.i){if(o){if(n[l].match(/[a-z]/)){i?(a+=n[l],a+=`${n[l-2]}-${n[l]}`.toUpperCase(),i=!1):n[l+1]==="-"&&n[l+2]?.match(/[a-z]/)?(a+=n[l],i=!0):a+=`${n[l]}${n[l].toUpperCase()}`;continue}}else if(n[l].match(/[a-z]/)){a+=`[${n[l]}${n[l].toUpperCase()}]`;continue}}if(r.m){if(n[l]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(n[l]==="$"){a+=`($|(?=[\r
]))`;continue}}if(r.s&&n[l]==="."){a+=o?`${n[l]}\r
`:`[${n[l]}\r
]`;continue}a+=n[l],n[l]==="\\"?s=!0:o&&n[l]==="]"?o=!1:!o&&n[l]==="["&&(o=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function So(e,t){if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&e.keyType?._def.typeName===B.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((n,a)=>({...n,[a]:oe(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??Me(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const r={type:"object",additionalProperties:oe(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if(t.target==="openApi3")return r;if(e.keyType?._def.typeName===B.ZodString&&e.keyType._def.checks?.length){const{type:n,...a}=$o(e.keyType._def,t);return{...r,propertyNames:a}}else{if(e.keyType?._def.typeName===B.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===B.ZodBranded&&e.keyType._def.type._def.typeName===B.ZodString&&e.keyType._def.type._def.checks?.length){const{type:n,...a}=wo(e.keyType._def,t);return{...r,propertyNames:a}}}return r}function Hf(e,t){if(t.mapStrategy==="record")return So(e,t);const r=oe(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||Me(t),n=oe(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||Me(t);return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function Kf(e){const t=e.values,n=Object.keys(e.values).filter(s=>typeof t[t[s]]!="number").map(s=>t[s]),a=Array.from(new Set(n.map(s=>typeof s)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:n}}function Jf(e){return e.target==="openAi"?void 0:{not:Me({...e,currentPath:[...e.currentPath,"not"]})}}function Wf(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Tr={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Bf(e,t){if(t.target==="openApi3")return ea(e,t);const r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(n=>n._def.typeName in Tr&&(!n._def.checks||!n._def.checks.length))){const n=r.reduce((a,s)=>{const o=Tr[s._def.typeName];return o&&!a.includes(o)?[...a,o]:a},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=r.reduce((a,s)=>{const o=typeof s._def.value;switch(o){case"string":case"number":case"boolean":return[...a,o];case"bigint":return[...a,"integer"];case"object":if(s._def.value===null)return[...a,"null"];default:return a}},[]);if(n.length===r.length){const a=n.filter((s,o,i)=>i.indexOf(s)===o);return{type:a.length>1?a:a[0],enum:r.reduce((s,o)=>s.includes(o._def.value)?s:[...s,o._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,a)=>[...n,...a._def.values.filter(s=>!n.includes(s))],[])};return ea(e,t)}const ea=(e,t)=>{const r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((n,a)=>oe(n._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(n=>!!n&&(!t.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function Gf(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:Tr[e.innerType._def.typeName],nullable:!0}:{type:[Tr[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const n=oe(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const r=oe(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function Qf(e,t){const r={type:"number"};if(!e.checks)return r;for(const n of e.checks)switch(n.kind){case"int":r.type="integer",vo(r,"type",n.message,t);break;case"min":t.target==="jsonSchema7"?n.inclusive?le(r,"minimum",n.value,n.message,t):le(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=!0),le(r,"minimum",n.value,n.message,t));break;case"max":t.target==="jsonSchema7"?n.inclusive?le(r,"maximum",n.value,n.message,t):le(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=!0),le(r,"maximum",n.value,n.message,t));break;case"multipleOf":le(r,"multipleOf",n.value,n.message,t);break}return r}function Yf(e,t){const r=t.target==="openAi",n={type:"object",properties:{}},a=[],s=e.shape();for(const i in s){let l=s[i];if(l===void 0||l._def===void 0)continue;let m=ep(l);m&&r&&(l._def.typeName==="ZodOptional"&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),m=!1);const f=oe(l._def,{...t,currentPath:[...t.currentPath,"properties",i],propertyPath:[...t.currentPath,"properties",i]});f!==void 0&&(n.properties[i]=f,m||a.push(i))}a.length&&(n.required=a);const o=Xf(e,t);return o!==void 0&&(n.additionalProperties=o),n}function Xf(e,t){if(e.catchall._def.typeName!=="ZodNever")return oe(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function ep(e){try{return e.isOptional()}catch{return!0}}const tp=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return oe(e.innerType._def,t);const r=oe(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:Me(t)},r]}:Me(t)},rp=(e,t)=>{if(t.pipeStrategy==="input")return oe(e.in._def,t);if(t.pipeStrategy==="output")return oe(e.out._def,t);const r=oe(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),n=oe(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(a=>a!==void 0)}};function np(e,t){return oe(e.type._def,t)}function ap(e,t){const n={type:"array",uniqueItems:!0,items:oe(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&le(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&le(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}function sp(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((r,n)=>oe(r._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:oe(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((r,n)=>oe(r._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function op(e){return{not:Me(e)}}function ip(e){return Me(e)}const cp=(e,t)=>oe(e.innerType._def,t),lp=(e,t,r)=>{switch(t){case B.ZodString:return $o(e,r);case B.ZodNumber:return Qf(e,r);case B.ZodObject:return Yf(e,r);case B.ZodBigInt:return Af(e,r);case B.ZodBoolean:return qf();case B.ZodDate:return bo(e,r);case B.ZodUndefined:return op(r);case B.ZodNull:return Wf(r);case B.ZodArray:return Nf(e,r);case B.ZodUnion:case B.ZodDiscriminatedUnion:return Bf(e,r);case B.ZodIntersection:return Uf(e,r);case B.ZodTuple:return sp(e,r);case B.ZodRecord:return So(e,r);case B.ZodLiteral:return Zf(e,r);case B.ZodEnum:return zf(e);case B.ZodNativeEnum:return Kf(e);case B.ZodNullable:return Gf(e,r);case B.ZodOptional:return tp(e,r);case B.ZodMap:return Hf(e,r);case B.ZodSet:return ap(e,r);case B.ZodLazy:return()=>e.getter()._def;case B.ZodPromise:return np(e,r);case B.ZodNaN:case B.ZodNever:return Jf(r);case B.ZodEffects:return xf(e,r);case B.ZodAny:return Me(r);case B.ZodUnknown:return ip(r);case B.ZodDefault:return Df(e,r);case B.ZodBranded:return wo(e,r);case B.ZodReadonly:return cp(e,r);case B.ZodCatch:return Mf(e,r);case B.ZodPipeline:return rp(e,r);case B.ZodFunction:case B.ZodVoid:case B.ZodSymbol:return;default:return(n=>{})()}};function oe(e,t,r=!1){const n=t.seen.get(e);if(t.override){const i=t.override?.(e,t,n,r);if(i!==Of)return i}if(n&&!r){const i=up(n,t);if(i!==void 0)return i}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const s=lp(e,e.typeName,t),o=typeof s=="function"?oe(s(),t):s;if(o&&dp(e,t,o),t.postProcess){const i=t.postProcess(o,e,t);return a.jsonSchema=o,i}return a.jsonSchema=o,o}const up=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:_o(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((r,n)=>t.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),Me(t)):t.$refStrategy==="seen"?Me(t):void 0}},dp=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),fp=(e,t)=>{const r=Cf(t);let n=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((l,[m,f])=>({...l,[m]:oe(f._def,{...r,currentPath:[...r.basePath,r.definitionPath,m]},!0)??Me(r)}),{}):void 0;const a=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,s=oe(e._def,a===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,a]},!1)??Me(r),o=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;o!==void 0&&(s.title=o),r.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[r.openAiAnyTypeName]||(n[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));const i=a===void 0?n?{...s,[r.definitionPath]:n}:s:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,a].join("/"),[r.definitionPath]:{...n,[a]:s}};return r.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};function ta(e){const r=Ms(e)?.method;if(!r)throw new Error("Schema is missing a method literal");const n=Ml(r);if(typeof n!="string")throw new Error("Schema method literal must be a string");return n}function ra(e,t){const r=Tt(e,t);if(!r.success)throw r.error;return r.data}const pp=6e4;class mp{constructor(t){this._options=t,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(yn,r=>{this._oncancel(r)}),this.setNotificationHandler(_n,r=>{this._onprogress(r)}),this.setRequestHandler(vn,r=>({})),this._taskStore=t?.taskStore,this._taskMessageQueue=t?.taskMessageQueue,this._taskStore&&(this.setRequestHandler(wn,async(r,n)=>{const a=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!a)throw new ee(ne.InvalidParams,"Failed to retrieve task: Task not found");return{...a}}),this.setRequestHandler($n,async(r,n)=>{const a=async()=>{const s=r.params.taskId;if(this._taskMessageQueue){let i;for(;i=await this._taskMessageQueue.dequeue(s,n.sessionId);){if(i.type==="response"||i.type==="error"){const l=i.message,m=l.id,f=this._requestResolvers.get(m);if(f)if(this._requestResolvers.delete(m),i.type==="response")f(l);else{const $=l,y=new ee($.error.code,$.error.message,$.error.data);f(y)}else{const $=i.type==="response"?"Response":"Error";this._onerror(new Error(`${$} handler missing for request ${m}`))}continue}await this._transport?.send(i.message,{relatedRequestId:n.requestId})}}const o=await this._taskStore.getTask(s,n.sessionId);if(!o)throw new ee(ne.InvalidParams,`Task not found: ${s}`);if(!at(o.status))return await this._waitForTaskUpdate(s,n.signal),await a();if(at(o.status)){const i=await this._taskStore.getTaskResult(s,n.sessionId);return this._clearTaskQueue(s),{...i,_meta:{...i._meta,[ct]:{taskId:s}}}}return await a()};return await a()}),this.setRequestHandler(Sn,async(r,n)=>{try{const{tasks:a,nextCursor:s}=await this._taskStore.listTasks(r.params?.cursor,n.sessionId);return{tasks:a,nextCursor:s,_meta:{}}}catch(a){throw new ee(ne.InvalidParams,`Failed to list tasks: ${a instanceof Error?a.message:String(a)}`)}}),this.setRequestHandler(Pn,async(r,n)=>{try{const a=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!a)throw new ee(ne.InvalidParams,`Task not found: ${r.params.taskId}`);if(at(a.status))throw new ee(ne.InvalidParams,`Cannot cancel task in terminal status: ${a.status}`);await this._taskStore.updateTaskStatus(r.params.taskId,"cancelled","Client cancelled task execution.",n.sessionId),this._clearTaskQueue(r.params.taskId);const s=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!s)throw new ee(ne.InvalidParams,`Task not found after cancellation: ${r.params.taskId}`);return{_meta:{},...s}}catch(a){throw a instanceof ee?a:new ee(ne.InvalidRequest,`Failed to cancel task: ${a instanceof Error?a.message:String(a)}`)}}))}async _oncancel(t){if(!t.params.requestId)return;this._requestHandlerAbortControllers.get(t.params.requestId)?.abort(t.params.reason)}_setupTimeout(t,r,n,a,s=!1){this._timeoutInfo.set(t,{timeoutId:setTimeout(a,r),startTime:Date.now(),timeout:r,maxTotalTimeout:n,resetTimeoutOnProgress:s,onTimeout:a})}_resetTimeout(t){const r=this._timeoutInfo.get(t);if(!r)return!1;const n=Date.now()-r.startTime;if(r.maxTotalTimeout&&n>=r.maxTotalTimeout)throw this._timeoutInfo.delete(t),ee.fromError(ne.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:n});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(t){const r=this._timeoutInfo.get(t);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(t))}async connect(t){this._transport=t;const r=this.transport?.onclose;this._transport.onclose=()=>{r?.(),this._onclose()};const n=this.transport?.onerror;this._transport.onerror=s=>{n?.(s),this._onerror(s)};const a=this._transport?.onmessage;this._transport.onmessage=(s,o)=>{a?.(s,o),qt(s)||Xu(s)?this._onresponse(s):Qn(s)?this._onrequest(s,o):Yu(s)?this._onnotification(s):this._onerror(new Error(`Unknown message type: ${JSON.stringify(s)}`))},await this._transport.start()}_onclose(){const t=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();const r=ee.fromError(ne.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(const n of t.values())n(r)}_onerror(t){this.onerror?.(t)}_onnotification(t){const r=this._notificationHandlers.get(t.method)??this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(t)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(t,r){const n=this._requestHandlers.get(t.method)??this.fallbackRequestHandler,a=this._transport,s=t.params?._meta?.[ct]?.taskId;if(n===void 0){const f={jsonrpc:"2.0",id:t.id,error:{code:ne.MethodNotFound,message:"Method not found"}};s&&this._taskMessageQueue?this._enqueueTaskMessage(s,{type:"error",message:f,timestamp:Date.now()},a?.sessionId).catch($=>this._onerror(new Error(`Failed to enqueue error response: ${$}`))):a?.send(f).catch($=>this._onerror(new Error(`Failed to send an error response: ${$}`)));return}const o=new AbortController;this._requestHandlerAbortControllers.set(t.id,o);const i=Qu(t.params)?t.params.task:void 0,l=this._taskStore?this.requestTaskStore(t,a?.sessionId):void 0,m={signal:o.signal,sessionId:a?.sessionId,_meta:t.params?._meta,sendNotification:async f=>{const $={relatedRequestId:t.id};s&&($.relatedTask={taskId:s}),await this.notification(f,$)},sendRequest:async(f,$,y)=>{const v={...y,relatedRequestId:t.id};s&&!v.relatedTask&&(v.relatedTask={taskId:s});const w=v.relatedTask?.taskId??s;return w&&l&&await l.updateTaskStatus(w,"input_required"),await this.request(f,$,v)},authInfo:r?.authInfo,requestId:t.id,requestInfo:r?.requestInfo,taskId:s,taskStore:l,taskRequestedTtl:i?.ttl,closeSSEStream:r?.closeSSEStream,closeStandaloneSSEStream:r?.closeStandaloneSSEStream};Promise.resolve().then(()=>{i&&this.assertTaskHandlerCapability(t.method)}).then(()=>n(t,m)).then(async f=>{if(o.signal.aborted)return;const $={result:f,jsonrpc:"2.0",id:t.id};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"response",message:$,timestamp:Date.now()},a?.sessionId):await a?.send($)},async f=>{if(o.signal.aborted)return;const $={jsonrpc:"2.0",id:t.id,error:{code:Number.isSafeInteger(f.code)?f.code:ne.InternalError,message:f.message??"Internal error",...f.data!==void 0&&{data:f.data}}};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"error",message:$,timestamp:Date.now()},a?.sessionId):await a?.send($)}).catch(f=>this._onerror(new Error(`Failed to send response: ${f}`))).finally(()=>{this._requestHandlerAbortControllers.delete(t.id)})}_onprogress(t){const{progressToken:r,...n}=t.params,a=Number(r),s=this._progressHandlers.get(a);if(!s){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(t)}`));return}const o=this._responseHandlers.get(a),i=this._timeoutInfo.get(a);if(i&&o&&i.resetTimeoutOnProgress)try{this._resetTimeout(a)}catch(l){this._responseHandlers.delete(a),this._progressHandlers.delete(a),this._cleanupTimeout(a),o(l);return}s(n)}_onresponse(t){const r=Number(t.id),n=this._requestResolvers.get(r);if(n){if(this._requestResolvers.delete(r),qt(t))n(t);else{const o=new ee(t.error.code,t.error.message,t.error.data);n(o)}return}const a=this._responseHandlers.get(r);if(a===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(t)}`));return}this._responseHandlers.delete(r),this._cleanupTimeout(r);let s=!1;if(qt(t)&&t.result&&typeof t.result=="object"){const o=t.result;if(o.task&&typeof o.task=="object"){const i=o.task;typeof i.taskId=="string"&&(s=!0,this._taskProgressTokens.set(i.taskId,r))}}if(s||this._progressHandlers.delete(r),qt(t))a(t);else{const o=ee.fromError(t.error.code,t.error.message,t.error.data);a(o)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(t,r,n){const{task:a}=n??{};if(!a){try{yield{type:"result",result:await this.request(t,r,n)}}catch(o){yield{type:"error",error:o instanceof ee?o:new ee(ne.InternalError,String(o))}}return}let s;try{const o=await this.request(t,Cr,n);if(o.task)s=o.task.taskId,yield{type:"taskCreated",task:o.task};else throw new ee(ne.InternalError,"Task creation did not return a task");for(;;){const i=await this.getTask({taskId:s},n);if(yield{type:"taskStatus",task:i},at(i.status)){i.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)}:i.status==="failed"?yield{type:"error",error:new ee(ne.InternalError,`Task ${s} failed`)}:i.status==="cancelled"&&(yield{type:"error",error:new ee(ne.InternalError,`Task ${s} was cancelled`)});return}if(i.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)};return}const l=i.pollInterval??this._options?.defaultTaskPollInterval??1e3;await new Promise(m=>setTimeout(m,l)),n?.signal?.throwIfAborted()}}catch(o){yield{type:"error",error:o instanceof ee?o:new ee(ne.InternalError,String(o))}}}request(t,r,n){const{relatedRequestId:a,resumptionToken:s,onresumptiontoken:o,task:i,relatedTask:l}=n??{};return new Promise((m,f)=>{const $=c=>{f(c)};if(!this._transport){$(new Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{this.assertCapabilityForMethod(t.method),i&&this.assertTaskCapability(t.method)}catch(c){$(c);return}n?.signal?.throwIfAborted();const y=this._requestMessageId++,v={...t,jsonrpc:"2.0",id:y};n?.onprogress&&(this._progressHandlers.set(y,n.onprogress),v.params={...t.params,_meta:{...t.params?._meta||{},progressToken:y}}),i&&(v.params={...v.params,task:i}),l&&(v.params={...v.params,_meta:{...v.params?._meta||{},[ct]:l}});const w=c=>{this._responseHandlers.delete(y),this._progressHandlers.delete(y),this._cleanupTimeout(y),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:y,reason:String(c)}},{relatedRequestId:a,resumptionToken:s,onresumptiontoken:o}).catch(b=>this._onerror(new Error(`Failed to send cancellation: ${b}`)));const d=c instanceof ee?c:new ee(ne.RequestTimeout,String(c));f(d)};this._responseHandlers.set(y,c=>{if(!n?.signal?.aborted){if(c instanceof Error)return f(c);try{const d=Tt(r,c.result);d.success?m(d.data):f(d.error)}catch(d){f(d)}}}),n?.signal?.addEventListener("abort",()=>{w(n?.signal?.reason)});const S=n?.timeout??pp,p=()=>w(ee.fromError(ne.RequestTimeout,"Request timed out",{timeout:S}));this._setupTimeout(y,S,n?.maxTotalTimeout,p,n?.resetTimeoutOnProgress??!1);const h=l?.taskId;if(h){const c=d=>{const b=this._responseHandlers.get(y);b?b(d):this._onerror(new Error(`Response handler missing for side-channeled request ${y}`))};this._requestResolvers.set(y,c),this._enqueueTaskMessage(h,{type:"request",message:v,timestamp:Date.now()}).catch(d=>{this._cleanupTimeout(y),f(d)})}else this._transport.send(v,{relatedRequestId:a,resumptionToken:s,onresumptiontoken:o}).catch(c=>{this._cleanupTimeout(y),f(c)})})}async getTask(t,r){return this.request({method:"tasks/get",params:t},bn,r)}async getTaskResult(t,r,n){return this.request({method:"tasks/result",params:t},r,n)}async listTasks(t,r){return this.request({method:"tasks/list",params:t},Tn,r)}async cancelTask(t,r){return this.request({method:"tasks/cancel",params:t},hd,r)}async notification(t,r){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(t.method);const n=r?.relatedTask?.taskId;if(n){const i={...t,jsonrpc:"2.0",params:{...t.params,_meta:{...t.params?._meta||{},[ct]:r.relatedTask}}};await this._enqueueTaskMessage(n,{type:"notification",message:i,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(t.method)&&!t.params&&!r?.relatedRequestId&&!r?.relatedTask){if(this._pendingDebouncedNotifications.has(t.method))return;this._pendingDebouncedNotifications.add(t.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(t.method),!this._transport)return;let i={...t,jsonrpc:"2.0"};r?.relatedTask&&(i={...i,params:{...i.params,_meta:{...i.params?._meta||{},[ct]:r.relatedTask}}}),this._transport?.send(i,r).catch(l=>this._onerror(l))});return}let o={...t,jsonrpc:"2.0"};r?.relatedTask&&(o={...o,params:{...o.params,_meta:{...o.params?._meta||{},[ct]:r.relatedTask}}}),await this._transport.send(o,r)}setRequestHandler(t,r){const n=ta(t);this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(a,s)=>{const o=ra(t,a);return Promise.resolve(r(o,s))})}removeRequestHandler(t){this._requestHandlers.delete(t)}assertCanSetRequestHandler(t){if(this._requestHandlers.has(t))throw new Error(`A request handler for ${t} already exists, which would be overridden`)}setNotificationHandler(t,r){const n=ta(t);this._notificationHandlers.set(n,a=>{const s=ra(t,a);return Promise.resolve(r(s))})}removeNotificationHandler(t){this._notificationHandlers.delete(t)}_cleanupTaskProgressHandler(t){const r=this._taskProgressTokens.get(t);r!==void 0&&(this._progressHandlers.delete(r),this._taskProgressTokens.delete(t))}async _enqueueTaskMessage(t,r,n){if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");const a=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(t,r,n,a)}async _clearTaskQueue(t,r){if(this._taskMessageQueue){const n=await this._taskMessageQueue.dequeueAll(t,r);for(const a of n)if(a.type==="request"&&Qn(a.message)){const s=a.message.id,o=this._requestResolvers.get(s);o?(o(new ee(ne.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(s)):this._onerror(new Error(`Resolver missing for request ${s} during task ${t} cleanup`))}}}async _waitForTaskUpdate(t,r){let n=this._options?.defaultTaskPollInterval??1e3;try{const a=await this._taskStore?.getTask(t);a?.pollInterval&&(n=a.pollInterval)}catch{}return new Promise((a,s)=>{if(r.aborted){s(new ee(ne.InvalidRequest,"Request cancelled"));return}const o=setTimeout(a,n);r.addEventListener("abort",()=>{clearTimeout(o),s(new ee(ne.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(t,r){const n=this._taskStore;if(!n)throw new Error("No task store configured");return{createTask:async a=>{if(!t)throw new Error("No request provided");return await n.createTask(a,t.id,{method:t.method,params:t.params},r)},getTask:async a=>{const s=await n.getTask(a,r);if(!s)throw new ee(ne.InvalidParams,"Failed to retrieve task: Task not found");return s},storeTaskResult:async(a,s,o)=>{await n.storeTaskResult(a,s,o,r);const i=await n.getTask(a,r);if(i){const l=br.parse({method:"notifications/tasks/status",params:i});await this.notification(l),at(i.status)&&this._cleanupTaskProgressHandler(a)}},getTaskResult:a=>n.getTaskResult(a,r),updateTaskStatus:async(a,s,o)=>{const i=await n.getTask(a,r);if(!i)throw new ee(ne.InvalidParams,`Task "${a}" not found - it may have been cleaned up`);if(at(i.status))throw new ee(ne.InvalidParams,`Cannot update task "${a}" from terminal status "${i.status}" to "${s}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await n.updateTaskStatus(a,s,o,r);const l=await n.getTask(a,r);if(l){const m=br.parse({method:"notifications/tasks/status",params:l});await this.notification(m),at(l.status)&&this._cleanupTaskProgressHandler(a)}},listTasks:a=>n.listTasks(a,r)}}}function na(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function hp(e,t){const r={...e};for(const n in t){const a=n,s=t[a];if(s===void 0)continue;const o=r[a];na(o)&&na(s)?r[a]={...o,...s}:r[a]=s}return r}var Mt={exports:{}},Fr={},Ge={},st={},Vr={},Hr={},Kr={},aa;function Pr(){return aa||(aa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.regexpCode=e.getEsmExportName=e.getProperty=e.safeStringify=e.stringify=e.strConcat=e.addCodeArg=e.str=e._=e.nil=e._Code=e.Name=e.IDENTIFIER=e._CodeOrName=void 0;class t{}e._CodeOrName=t,e.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class r extends t{constructor(c){if(super(),!e.IDENTIFIER.test(c))throw new Error("CodeGen: name must be a valid identifier");this.str=c}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}e.Name=r;class n extends t{constructor(c){super(),this._items=typeof c=="string"?[c]:c}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const c=this._items[0];return c===""||c==='""'}get str(){var c;return(c=this._str)!==null&&c!==void 0?c:this._str=this._items.reduce((d,b)=>`${d}${b}`,"")}get names(){var c;return(c=this._names)!==null&&c!==void 0?c:this._names=this._items.reduce((d,b)=>(b instanceof r&&(d[b.str]=(d[b.str]||0)+1),d),{})}}e._Code=n,e.nil=new n("");function a(h,...c){const d=[h[0]];let b=0;for(;b<c.length;)i(d,c[b]),d.push(h[++b]);return new n(d)}e._=a;const s=new n("+");function o(h,...c){const d=[v(h[0])];let b=0;for(;b<c.length;)d.push(s),i(d,c[b]),d.push(s,v(h[++b]));return l(d),new n(d)}e.str=o;function i(h,c){c instanceof n?h.push(...c._items):c instanceof r?h.push(c):h.push($(c))}e.addCodeArg=i;function l(h){let c=1;for(;c<h.length-1;){if(h[c]===s){const d=m(h[c-1],h[c+1]);if(d!==void 0){h.splice(c-1,3,d);continue}h[c++]="+"}c++}}function m(h,c){if(c==='""')return h;if(h==='""')return c;if(typeof h=="string")return c instanceof r||h[h.length-1]!=='"'?void 0:typeof c!="string"?`${h.slice(0,-1)}${c}"`:c[0]==='"'?h.slice(0,-1)+c.slice(1):void 0;if(typeof c=="string"&&c[0]==='"'&&!(h instanceof r))return`"${h}${c.slice(1)}`}function f(h,c){return c.emptyStr()?h:h.emptyStr()?c:o`${h}${c}`}e.strConcat=f;function $(h){return typeof h=="number"||typeof h=="boolean"||h===null?h:v(Array.isArray(h)?h.join(","):h)}function y(h){return new n(v(h))}e.stringify=y;function v(h){return JSON.stringify(h).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}e.safeStringify=v;function w(h){return typeof h=="string"&&e.IDENTIFIER.test(h)?new n(`.${h}`):a`[${h}]`}e.getProperty=w;function S(h){if(typeof h=="string"&&e.IDENTIFIER.test(h))return new n(`${h}`);throw new Error(`CodeGen: invalid export name: ${h}, use explicit $id name mapping`)}e.getEsmExportName=S;function p(h){return new n(h.toString())}e.regexpCode=p})(Kr)),Kr}var Jr={},sa;function oa(){return sa||(sa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ValueScope=e.ValueScopeName=e.Scope=e.varKinds=e.UsedValueState=void 0;const t=Pr();class r extends Error{constructor(m){super(`CodeGen: "code" for ${m} not defined`),this.value=m.value}}var n;(function(l){l[l.Started=0]="Started",l[l.Completed=1]="Completed"})(n||(e.UsedValueState=n={})),e.varKinds={const:new t.Name("const"),let:new t.Name("let"),var:new t.Name("var")};class a{constructor({prefixes:m,parent:f}={}){this._names={},this._prefixes=m,this._parent=f}toName(m){return m instanceof t.Name?m:this.name(m)}name(m){return new t.Name(this._newName(m))}_newName(m){const f=this._names[m]||this._nameGroup(m);return`${m}${f.index++}`}_nameGroup(m){var f,$;if(!(($=(f=this._parent)===null||f===void 0?void 0:f._prefixes)===null||$===void 0)&&$.has(m)||this._prefixes&&!this._prefixes.has(m))throw new Error(`CodeGen: prefix "${m}" is not allowed in this scope`);return this._names[m]={prefix:m,index:0}}}e.Scope=a;class s extends t.Name{constructor(m,f){super(f),this.prefix=m}setValue(m,{property:f,itemIndex:$}){this.value=m,this.scopePath=(0,t._)`.${new t.Name(f)}[${$}]`}}e.ValueScopeName=s;const o=(0,t._)`\n`;class i extends a{constructor(m){super(m),this._values={},this._scope=m.scope,this.opts={...m,_n:m.lines?o:t.nil}}get(){return this._scope}name(m){return new s(m,this._newName(m))}value(m,f){var $;if(f.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const y=this.toName(m),{prefix:v}=y,w=($=f.key)!==null&&$!==void 0?$:f.ref;let S=this._values[v];if(S){const c=S.get(w);if(c)return c}else S=this._values[v]=new Map;S.set(w,y);const p=this._scope[v]||(this._scope[v]=[]),h=p.length;return p[h]=f.ref,y.setValue(f,{property:v,itemIndex:h}),y}getValue(m,f){const $=this._values[m];if($)return $.get(f)}scopeRefs(m,f=this._values){return this._reduceValues(f,$=>{if($.scopePath===void 0)throw new Error(`CodeGen: name "${$}" has no value`);return(0,t._)`${m}${$.scopePath}`})}scopeCode(m=this._values,f,$){return this._reduceValues(m,y=>{if(y.value===void 0)throw new Error(`CodeGen: name "${y}" has no value`);return y.value.code},f,$)}_reduceValues(m,f,$={},y){let v=t.nil;for(const w in m){const S=m[w];if(!S)continue;const p=$[w]=$[w]||new Map;S.forEach(h=>{if(p.has(h))return;p.set(h,n.Started);let c=f(h);if(c){const d=this.opts.es5?e.varKinds.var:e.varKinds.const;v=(0,t._)`${v}${d} ${h} = ${c};${this.opts._n}`}else if(c=y?.(h))v=(0,t._)`${v}${c}${this.opts._n}`;else throw new r(h);p.set(h,n.Completed)})}return v}}e.ValueScope=i})(Jr)),Jr}var ia;function Y(){return ia||(ia=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.or=e.and=e.not=e.CodeGen=e.operators=e.varKinds=e.ValueScopeName=e.ValueScope=e.Scope=e.Name=e.regexpCode=e.stringify=e.getProperty=e.nil=e.strConcat=e.str=e._=void 0;const t=Pr(),r=oa();var n=Pr();Object.defineProperty(e,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(e,"strConcat",{enumerable:!0,get:function(){return n.strConcat}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(e,"getProperty",{enumerable:!0,get:function(){return n.getProperty}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(e,"regexpCode",{enumerable:!0,get:function(){return n.regexpCode}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return n.Name}});var a=oa();Object.defineProperty(e,"Scope",{enumerable:!0,get:function(){return a.Scope}}),Object.defineProperty(e,"ValueScope",{enumerable:!0,get:function(){return a.ValueScope}}),Object.defineProperty(e,"ValueScopeName",{enumerable:!0,get:function(){return a.ValueScopeName}}),Object.defineProperty(e,"varKinds",{enumerable:!0,get:function(){return a.varKinds}}),e.operators={GT:new t._Code(">"),GTE:new t._Code(">="),LT:new t._Code("<"),LTE:new t._Code("<="),EQ:new t._Code("==="),NEQ:new t._Code("!=="),NOT:new t._Code("!"),OR:new t._Code("||"),AND:new t._Code("&&"),ADD:new t._Code("+")};class s{optimizeNodes(){return this}optimizeNames(g,P){return this}}class o extends s{constructor(g,P,N){super(),this.varKind=g,this.name=P,this.rhs=N}render({es5:g,_n:P}){const N=g?r.varKinds.var:this.varKind,V=this.rhs===void 0?"":` = ${this.rhs}`;return`${N} ${this.name}${V};`+P}optimizeNames(g,P){if(g[this.name.str])return this.rhs&&(this.rhs=F(this.rhs,g,P)),this}get names(){return this.rhs instanceof t._CodeOrName?this.rhs.names:{}}}class i extends s{constructor(g,P,N){super(),this.lhs=g,this.rhs=P,this.sideEffects=N}render({_n:g}){return`${this.lhs} = ${this.rhs};`+g}optimizeNames(g,P){if(!(this.lhs instanceof t.Name&&!g[this.lhs.str]&&!this.sideEffects))return this.rhs=F(this.rhs,g,P),this}get names(){const g=this.lhs instanceof t.Name?{}:{...this.lhs.names};return Z(g,this.rhs)}}class l extends i{constructor(g,P,N,V){super(g,N,V),this.op=P}render({_n:g}){return`${this.lhs} ${this.op}= ${this.rhs};`+g}}class m extends s{constructor(g){super(),this.label=g,this.names={}}render({_n:g}){return`${this.label}:`+g}}class f extends s{constructor(g){super(),this.label=g,this.names={}}render({_n:g}){return`break${this.label?` ${this.label}`:""};`+g}}class $ extends s{constructor(g){super(),this.error=g}render({_n:g}){return`throw ${this.error};`+g}get names(){return this.error.names}}class y extends s{constructor(g){super(),this.code=g}render({_n:g}){return`${this.code};`+g}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(g,P){return this.code=F(this.code,g,P),this}get names(){return this.code instanceof t._CodeOrName?this.code.names:{}}}class v extends s{constructor(g=[]){super(),this.nodes=g}render(g){return this.nodes.reduce((P,N)=>P+N.render(g),"")}optimizeNodes(){const{nodes:g}=this;let P=g.length;for(;P--;){const N=g[P].optimizeNodes();Array.isArray(N)?g.splice(P,1,...N):N?g[P]=N:g.splice(P,1)}return g.length>0?this:void 0}optimizeNames(g,P){const{nodes:N}=this;let V=N.length;for(;V--;){const J=N[V];J.optimizeNames(g,P)||(ie(g,J.names),N.splice(V,1))}return N.length>0?this:void 0}get names(){return this.nodes.reduce((g,P)=>z(g,P.names),{})}}class w extends v{render(g){return"{"+g._n+super.render(g)+"}"+g._n}}class S extends v{}class p extends w{}p.kind="else";class h extends w{constructor(g,P){super(P),this.condition=g}render(g){let P=`if(${this.condition})`+super.render(g);return this.else&&(P+="else "+this.else.render(g)),P}optimizeNodes(){super.optimizeNodes();const g=this.condition;if(g===!0)return this.nodes;let P=this.else;if(P){const N=P.optimizeNodes();P=this.else=Array.isArray(N)?new p(N):N}if(P)return g===!1?P instanceof h?P:P.nodes:this.nodes.length?this:new h(Re(g),P instanceof h?[P]:P.nodes);if(!(g===!1||!this.nodes.length))return this}optimizeNames(g,P){var N;if(this.else=(N=this.else)===null||N===void 0?void 0:N.optimizeNames(g,P),!!(super.optimizeNames(g,P)||this.else))return this.condition=F(this.condition,g,P),this}get names(){const g=super.names;return Z(g,this.condition),this.else&&z(g,this.else.names),g}}h.kind="if";class c extends w{}c.kind="for";class d extends c{constructor(g){super(),this.iteration=g}render(g){return`for(${this.iteration})`+super.render(g)}optimizeNames(g,P){if(super.optimizeNames(g,P))return this.iteration=F(this.iteration,g,P),this}get names(){return z(super.names,this.iteration.names)}}class b extends c{constructor(g,P,N,V){super(),this.varKind=g,this.name=P,this.from=N,this.to=V}render(g){const P=g.es5?r.varKinds.var:this.varKind,{name:N,from:V,to:J}=this;return`for(${P} ${N}=${V}; ${N}<${J}; ${N}++)`+super.render(g)}get names(){const g=Z(super.names,this.from);return Z(g,this.to)}}class u extends c{constructor(g,P,N,V){super(),this.loop=g,this.varKind=P,this.name=N,this.iterable=V}render(g){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(g)}optimizeNames(g,P){if(super.optimizeNames(g,P))return this.iterable=F(this.iterable,g,P),this}get names(){return z(super.names,this.iterable.names)}}class _ extends w{constructor(g,P,N){super(),this.name=g,this.args=P,this.async=N}render(g){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(g)}}_.kind="func";class T extends v{render(g){return"return "+super.render(g)}}T.kind="return";class C extends w{render(g){let P="try"+super.render(g);return this.catch&&(P+=this.catch.render(g)),this.finally&&(P+=this.finally.render(g)),P}optimizeNodes(){var g,P;return super.optimizeNodes(),(g=this.catch)===null||g===void 0||g.optimizeNodes(),(P=this.finally)===null||P===void 0||P.optimizeNodes(),this}optimizeNames(g,P){var N,V;return super.optimizeNames(g,P),(N=this.catch)===null||N===void 0||N.optimizeNames(g,P),(V=this.finally)===null||V===void 0||V.optimizeNames(g,P),this}get names(){const g=super.names;return this.catch&&z(g,this.catch.names),this.finally&&z(g,this.finally.names),g}}class j extends w{constructor(g){super(),this.error=g}render(g){return`catch(${this.error})`+super.render(g)}}j.kind="catch";class L extends w{render(g){return"finally"+super.render(g)}}L.kind="finally";class A{constructor(g,P={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...P,_n:P.lines?`
`:""},this._extScope=g,this._scope=new r.Scope({parent:g}),this._nodes=[new S]}toString(){return this._root.render(this.opts)}name(g){return this._scope.name(g)}scopeName(g){return this._extScope.name(g)}scopeValue(g,P){const N=this._extScope.value(g,P);return(this._values[N.prefix]||(this._values[N.prefix]=new Set)).add(N),N}getScopeValue(g,P){return this._extScope.getValue(g,P)}scopeRefs(g){return this._extScope.scopeRefs(g,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(g,P,N,V){const J=this._scope.toName(P);return N!==void 0&&V&&(this._constants[J.str]=N),this._leafNode(new o(g,J,N)),J}const(g,P,N){return this._def(r.varKinds.const,g,P,N)}let(g,P,N){return this._def(r.varKinds.let,g,P,N)}var(g,P,N){return this._def(r.varKinds.var,g,P,N)}assign(g,P,N){return this._leafNode(new i(g,P,N))}add(g,P){return this._leafNode(new l(g,e.operators.ADD,P))}code(g){return typeof g=="function"?g():g!==t.nil&&this._leafNode(new y(g)),this}object(...g){const P=["{"];for(const[N,V]of g)P.length>1&&P.push(","),P.push(N),(N!==V||this.opts.es5)&&(P.push(":"),(0,t.addCodeArg)(P,V));return P.push("}"),new t._Code(P)}if(g,P,N){if(this._blockNode(new h(g)),P&&N)this.code(P).else().code(N).endIf();else if(P)this.code(P).endIf();else if(N)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(g){return this._elseNode(new h(g))}else(){return this._elseNode(new p)}endIf(){return this._endBlockNode(h,p)}_for(g,P){return this._blockNode(g),P&&this.code(P).endFor(),this}for(g,P){return this._for(new d(g),P)}forRange(g,P,N,V,J=this.opts.es5?r.varKinds.var:r.varKinds.let){const se=this._scope.toName(g);return this._for(new b(J,se,P,N),()=>V(se))}forOf(g,P,N,V=r.varKinds.const){const J=this._scope.toName(g);if(this.opts.es5){const se=P instanceof t.Name?P:this.var("_arr",P);return this.forRange("_i",0,(0,t._)`${se}.length`,te=>{this.var(J,(0,t._)`${se}[${te}]`),N(J)})}return this._for(new u("of",V,J,P),()=>N(J))}forIn(g,P,N,V=this.opts.es5?r.varKinds.var:r.varKinds.const){if(this.opts.ownProperties)return this.forOf(g,(0,t._)`Object.keys(${P})`,N);const J=this._scope.toName(g);return this._for(new u("in",V,J,P),()=>N(J))}endFor(){return this._endBlockNode(c)}label(g){return this._leafNode(new m(g))}break(g){return this._leafNode(new f(g))}return(g){const P=new T;if(this._blockNode(P),this.code(g),P.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(T)}try(g,P,N){if(!P&&!N)throw new Error('CodeGen: "try" without "catch" and "finally"');const V=new C;if(this._blockNode(V),this.code(g),P){const J=this.name("e");this._currNode=V.catch=new j(J),P(J)}return N&&(this._currNode=V.finally=new L,this.code(N)),this._endBlockNode(j,L)}throw(g){return this._leafNode(new $(g))}block(g,P){return this._blockStarts.push(this._nodes.length),g&&this.code(g).endBlock(P),this}endBlock(g){const P=this._blockStarts.pop();if(P===void 0)throw new Error("CodeGen: not in self-balancing block");const N=this._nodes.length-P;if(N<0||g!==void 0&&N!==g)throw new Error(`CodeGen: wrong number of nodes: ${N} vs ${g} expected`);return this._nodes.length=P,this}func(g,P=t.nil,N,V){return this._blockNode(new _(g,P,N)),V&&this.code(V).endFunc(),this}endFunc(){return this._endBlockNode(_)}optimize(g=1){for(;g-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(g){return this._currNode.nodes.push(g),this}_blockNode(g){this._currNode.nodes.push(g),this._nodes.push(g)}_endBlockNode(g,P){const N=this._currNode;if(N instanceof g||P&&N instanceof P)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${P?`${g.kind}/${P.kind}`:g.kind}"`)}_elseNode(g){const P=this._currNode;if(!(P instanceof h))throw new Error('CodeGen: "else" without "if"');return this._currNode=P.else=g,this}get _root(){return this._nodes[0]}get _currNode(){const g=this._nodes;return g[g.length-1]}set _currNode(g){const P=this._nodes;P[P.length-1]=g}}e.CodeGen=A;function z(O,g){for(const P in g)O[P]=(O[P]||0)+(g[P]||0);return O}function Z(O,g){return g instanceof t._CodeOrName?z(O,g.names):O}function F(O,g,P){if(O instanceof t.Name)return N(O);if(!V(O))return O;return new t._Code(O._items.reduce((J,se)=>(se instanceof t.Name&&(se=N(se)),se instanceof t._Code?J.push(...se._items):J.push(se),J),[]));function N(J){const se=P[J.str];return se===void 0||g[J.str]!==1?J:(delete g[J.str],se)}function V(J){return J instanceof t._Code&&J._items.some(se=>se instanceof t.Name&&g[se.str]===1&&P[se.str]!==void 0)}}function ie(O,g){for(const P in g)O[P]=(O[P]||0)-(g[P]||0)}function Re(O){return typeof O=="boolean"||typeof O=="number"||O===null?!O:(0,t._)`!${M(O)}`}e.not=Re;const Oe=k(e.operators.AND);function ue(...O){return O.reduce(Oe)}e.and=ue;const Fe=k(e.operators.OR);function D(...O){return O.reduce(Fe)}e.or=D;function k(O){return(g,P)=>g===t.nil?P:P===t.nil?g:(0,t._)`${M(g)} ${O} ${M(P)}`}function M(O){return O instanceof t.Name?O:(0,t._)`(${O})`}})(Hr)),Hr}var Q={},ca;function ae(){if(ca)return Q;ca=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.checkStrictMode=Q.getErrorPath=Q.Type=Q.useFunc=Q.setEvaluated=Q.evaluatedPropsToName=Q.mergeEvaluated=Q.eachItem=Q.unescapeJsonPointer=Q.escapeJsonPointer=Q.escapeFragment=Q.unescapeFragment=Q.schemaRefOrVal=Q.schemaHasRulesButRef=Q.schemaHasRules=Q.checkUnknownRules=Q.alwaysValidSchema=Q.toHash=void 0;const e=Y(),t=Pr();function r(u){const _={};for(const T of u)_[T]=!0;return _}Q.toHash=r;function n(u,_){return typeof _=="boolean"?_:Object.keys(_).length===0?!0:(a(u,_),!s(_,u.self.RULES.all))}Q.alwaysValidSchema=n;function a(u,_=u.schema){const{opts:T,self:C}=u;if(!T.strictSchema||typeof _=="boolean")return;const j=C.RULES.keywords;for(const L in _)j[L]||b(u,`unknown keyword: "${L}"`)}Q.checkUnknownRules=a;function s(u,_){if(typeof u=="boolean")return!u;for(const T in u)if(_[T])return!0;return!1}Q.schemaHasRules=s;function o(u,_){if(typeof u=="boolean")return!u;for(const T in u)if(T!=="$ref"&&_.all[T])return!0;return!1}Q.schemaHasRulesButRef=o;function i({topSchemaRef:u,schemaPath:_},T,C,j){if(!j){if(typeof T=="number"||typeof T=="boolean")return T;if(typeof T=="string")return(0,e._)`${T}`}return(0,e._)`${u}${_}${(0,e.getProperty)(C)}`}Q.schemaRefOrVal=i;function l(u){return $(decodeURIComponent(u))}Q.unescapeFragment=l;function m(u){return encodeURIComponent(f(u))}Q.escapeFragment=m;function f(u){return typeof u=="number"?`${u}`:u.replace(/~/g,"~0").replace(/\//g,"~1")}Q.escapeJsonPointer=f;function $(u){return u.replace(/~1/g,"/").replace(/~0/g,"~")}Q.unescapeJsonPointer=$;function y(u,_){if(Array.isArray(u))for(const T of u)_(T);else _(u)}Q.eachItem=y;function v({mergeNames:u,mergeToName:_,mergeValues:T,resultToName:C}){return(j,L,A,z)=>{const Z=A===void 0?L:A instanceof e.Name?(L instanceof e.Name?u(j,L,A):_(j,L,A),A):L instanceof e.Name?(_(j,A,L),L):T(L,A);return z===e.Name&&!(Z instanceof e.Name)?C(j,Z):Z}}Q.mergeEvaluated={props:v({mergeNames:(u,_,T)=>u.if((0,e._)`${T} !== true && ${_} !== undefined`,()=>{u.if((0,e._)`${_} === true`,()=>u.assign(T,!0),()=>u.assign(T,(0,e._)`${T} || {}`).code((0,e._)`Object.assign(${T}, ${_})`))}),mergeToName:(u,_,T)=>u.if((0,e._)`${T} !== true`,()=>{_===!0?u.assign(T,!0):(u.assign(T,(0,e._)`${T} || {}`),S(u,T,_))}),mergeValues:(u,_)=>u===!0?!0:{...u,..._},resultToName:w}),items:v({mergeNames:(u,_,T)=>u.if((0,e._)`${T} !== true && ${_} !== undefined`,()=>u.assign(T,(0,e._)`${_} === true ? true : ${T} > ${_} ? ${T} : ${_}`)),mergeToName:(u,_,T)=>u.if((0,e._)`${T} !== true`,()=>u.assign(T,_===!0?!0:(0,e._)`${T} > ${_} ? ${T} : ${_}`)),mergeValues:(u,_)=>u===!0?!0:Math.max(u,_),resultToName:(u,_)=>u.var("items",_)})};function w(u,_){if(_===!0)return u.var("props",!0);const T=u.var("props",(0,e._)`{}`);return _!==void 0&&S(u,T,_),T}Q.evaluatedPropsToName=w;function S(u,_,T){Object.keys(T).forEach(C=>u.assign((0,e._)`${_}${(0,e.getProperty)(C)}`,!0))}Q.setEvaluated=S;const p={};function h(u,_){return u.scopeValue("func",{ref:_,code:p[_.code]||(p[_.code]=new t._Code(_.code))})}Q.useFunc=h;var c;(function(u){u[u.Num=0]="Num",u[u.Str=1]="Str"})(c||(Q.Type=c={}));function d(u,_,T){if(u instanceof e.Name){const C=_===c.Num;return T?C?(0,e._)`"[" + ${u} + "]"`:(0,e._)`"['" + ${u} + "']"`:C?(0,e._)`"/" + ${u}`:(0,e._)`"/" + ${u}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return T?(0,e.getProperty)(u).toString():"/"+f(u)}Q.getErrorPath=d;function b(u,_,T=u.opts.strictSchema){if(T){if(_=`strict mode: ${_}`,T===!0)throw new Error(_);u.self.logger.warn(_)}}return Q.checkStrictMode=b,Q}var jt={},la;function nt(){if(la)return jt;la=1,Object.defineProperty(jt,"__esModule",{value:!0});const e=Y(),t={data:new e.Name("data"),valCxt:new e.Name("valCxt"),instancePath:new e.Name("instancePath"),parentData:new e.Name("parentData"),parentDataProperty:new e.Name("parentDataProperty"),rootData:new e.Name("rootData"),dynamicAnchors:new e.Name("dynamicAnchors"),vErrors:new e.Name("vErrors"),errors:new e.Name("errors"),this:new e.Name("this"),self:new e.Name("self"),scope:new e.Name("scope"),json:new e.Name("json"),jsonPos:new e.Name("jsonPos"),jsonLen:new e.Name("jsonLen"),jsonPart:new e.Name("jsonPart")};return jt.default=t,jt}var ua;function Nr(){return ua||(ua=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.extendErrors=e.resetErrorsCount=e.reportExtraError=e.reportError=e.keyword$DataError=e.keywordError=void 0;const t=Y(),r=ae(),n=nt();e.keywordError={message:({keyword:p})=>(0,t.str)`must pass "${p}" keyword validation`},e.keyword$DataError={message:({keyword:p,schemaType:h})=>h?(0,t.str)`"${p}" keyword must be ${h} ($data)`:(0,t.str)`"${p}" keyword is invalid ($data)`};function a(p,h=e.keywordError,c,d){const{it:b}=p,{gen:u,compositeRule:_,allErrors:T}=b,C=$(p,h,c);d??(_||T)?l(u,C):m(b,(0,t._)`[${C}]`)}e.reportError=a;function s(p,h=e.keywordError,c){const{it:d}=p,{gen:b,compositeRule:u,allErrors:_}=d,T=$(p,h,c);l(b,T),u||_||m(d,n.default.vErrors)}e.reportExtraError=s;function o(p,h){p.assign(n.default.errors,h),p.if((0,t._)`${n.default.vErrors} !== null`,()=>p.if(h,()=>p.assign((0,t._)`${n.default.vErrors}.length`,h),()=>p.assign(n.default.vErrors,null)))}e.resetErrorsCount=o;function i({gen:p,keyword:h,schemaValue:c,data:d,errsCount:b,it:u}){if(b===void 0)throw new Error("ajv implementation error");const _=p.name("err");p.forRange("i",b,n.default.errors,T=>{p.const(_,(0,t._)`${n.default.vErrors}[${T}]`),p.if((0,t._)`${_}.instancePath === undefined`,()=>p.assign((0,t._)`${_}.instancePath`,(0,t.strConcat)(n.default.instancePath,u.errorPath))),p.assign((0,t._)`${_}.schemaPath`,(0,t.str)`${u.errSchemaPath}/${h}`),u.opts.verbose&&(p.assign((0,t._)`${_}.schema`,c),p.assign((0,t._)`${_}.data`,d))})}e.extendErrors=i;function l(p,h){const c=p.const("err",h);p.if((0,t._)`${n.default.vErrors} === null`,()=>p.assign(n.default.vErrors,(0,t._)`[${c}]`),(0,t._)`${n.default.vErrors}.push(${c})`),p.code((0,t._)`${n.default.errors}++`)}function m(p,h){const{gen:c,validateName:d,schemaEnv:b}=p;b.$async?c.throw((0,t._)`new ${p.ValidationError}(${h})`):(c.assign((0,t._)`${d}.errors`,h),c.return(!1))}const f={keyword:new t.Name("keyword"),schemaPath:new t.Name("schemaPath"),params:new t.Name("params"),propertyName:new t.Name("propertyName"),message:new t.Name("message"),schema:new t.Name("schema"),parentSchema:new t.Name("parentSchema")};function $(p,h,c){const{createErrors:d}=p.it;return d===!1?(0,t._)`{}`:y(p,h,c)}function y(p,h,c={}){const{gen:d,it:b}=p,u=[v(b,c),w(p,c)];return S(p,h,u),d.object(...u)}function v({errorPath:p},{instancePath:h}){const c=h?(0,t.str)`${p}${(0,r.getErrorPath)(h,r.Type.Str)}`:p;return[n.default.instancePath,(0,t.strConcat)(n.default.instancePath,c)]}function w({keyword:p,it:{errSchemaPath:h}},{schemaPath:c,parentSchema:d}){let b=d?h:(0,t.str)`${h}/${p}`;return c&&(b=(0,t.str)`${b}${(0,r.getErrorPath)(c,r.Type.Str)}`),[f.schemaPath,b]}function S(p,{params:h,message:c},d){const{keyword:b,data:u,schemaValue:_,it:T}=p,{opts:C,propertyName:j,topSchemaRef:L,schemaPath:A}=T;d.push([f.keyword,b],[f.params,typeof h=="function"?h(p):h||(0,t._)`{}`]),C.messages&&d.push([f.message,typeof c=="function"?c(p):c]),C.verbose&&d.push([f.schema,_],[f.parentSchema,(0,t._)`${L}${A}`],[n.default.data,u]),j&&d.push([f.propertyName,j])}})(Vr)),Vr}var da;function gp(){if(da)return st;da=1,Object.defineProperty(st,"__esModule",{value:!0}),st.boolOrEmptySchema=st.topBoolOrEmptySchema=void 0;const e=Nr(),t=Y(),r=nt(),n={message:"boolean schema is false"};function a(i){const{gen:l,schema:m,validateName:f}=i;m===!1?o(i,!1):typeof m=="object"&&m.$async===!0?l.return(r.default.data):(l.assign((0,t._)`${f}.errors`,null),l.return(!0))}st.topBoolOrEmptySchema=a;function s(i,l){const{gen:m,schema:f}=i;f===!1?(m.var(l,!1),o(i)):m.var(l,!0)}st.boolOrEmptySchema=s;function o(i,l){const{gen:m,data:f}=i,$={gen:m,keyword:"false schema",data:f,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:i};(0,e.reportError)($,n,void 0,l)}return st}var Se={},ot={},fa;function To(){if(fa)return ot;fa=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.getRules=ot.isJSONType=void 0;const e=["string","number","integer","boolean","null","object","array"],t=new Set(e);function r(a){return typeof a=="string"&&t.has(a)}ot.isJSONType=r;function n(){const a={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...a,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},a.number,a.string,a.array,a.object],post:{rules:[]},all:{},keywords:{}}}return ot.getRules=n,ot}var Qe={},pa;function Po(){if(pa)return Qe;pa=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.shouldUseRule=Qe.shouldUseGroup=Qe.schemaHasRulesForType=void 0;function e({schema:n,self:a},s){const o=a.RULES.types[s];return o&&o!==!0&&t(n,o)}Qe.schemaHasRulesForType=e;function t(n,a){return a.rules.some(s=>r(n,s))}Qe.shouldUseGroup=t;function r(n,a){var s;return n[a.keyword]!==void 0||((s=a.definition.implements)===null||s===void 0?void 0:s.some(o=>n[o]!==void 0))}return Qe.shouldUseRule=r,Qe}var ma;function Er(){if(ma)return Se;ma=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.reportTypeError=Se.checkDataTypes=Se.checkDataType=Se.coerceAndCheckDataType=Se.getJSONTypes=Se.getSchemaTypes=Se.DataType=void 0;const e=To(),t=Po(),r=Nr(),n=Y(),a=ae();var s;(function(c){c[c.Correct=0]="Correct",c[c.Wrong=1]="Wrong"})(s||(Se.DataType=s={}));function o(c){const d=i(c.type);if(d.includes("null")){if(c.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!d.length&&c.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');c.nullable===!0&&d.push("null")}return d}Se.getSchemaTypes=o;function i(c){const d=Array.isArray(c)?c:c?[c]:[];if(d.every(e.isJSONType))return d;throw new Error("type must be JSONType or JSONType[]: "+d.join(","))}Se.getJSONTypes=i;function l(c,d){const{gen:b,data:u,opts:_}=c,T=f(d,_.coerceTypes),C=d.length>0&&!(T.length===0&&d.length===1&&(0,t.schemaHasRulesForType)(c,d[0]));if(C){const j=w(d,u,_.strictNumbers,s.Wrong);b.if(j,()=>{T.length?$(c,d,T):p(c)})}return C}Se.coerceAndCheckDataType=l;const m=new Set(["string","number","integer","boolean","null"]);function f(c,d){return d?c.filter(b=>m.has(b)||d==="array"&&b==="array"):[]}function $(c,d,b){const{gen:u,data:_,opts:T}=c,C=u.let("dataType",(0,n._)`typeof ${_}`),j=u.let("coerced",(0,n._)`undefined`);T.coerceTypes==="array"&&u.if((0,n._)`${C} == 'object' && Array.isArray(${_}) && ${_}.length == 1`,()=>u.assign(_,(0,n._)`${_}[0]`).assign(C,(0,n._)`typeof ${_}`).if(w(d,_,T.strictNumbers),()=>u.assign(j,_))),u.if((0,n._)`${j} !== undefined`);for(const A of b)(m.has(A)||A==="array"&&T.coerceTypes==="array")&&L(A);u.else(),p(c),u.endIf(),u.if((0,n._)`${j} !== undefined`,()=>{u.assign(_,j),y(c,j)});function L(A){switch(A){case"string":u.elseIf((0,n._)`${C} == "number" || ${C} == "boolean"`).assign(j,(0,n._)`"" + ${_}`).elseIf((0,n._)`${_} === null`).assign(j,(0,n._)`""`);return;case"number":u.elseIf((0,n._)`${C} == "boolean" || ${_} === null
              || (${C} == "string" && ${_} && ${_} == +${_})`).assign(j,(0,n._)`+${_}`);return;case"integer":u.elseIf((0,n._)`${C} === "boolean" || ${_} === null
              || (${C} === "string" && ${_} && ${_} == +${_} && !(${_} % 1))`).assign(j,(0,n._)`+${_}`);return;case"boolean":u.elseIf((0,n._)`${_} === "false" || ${_} === 0 || ${_} === null`).assign(j,!1).elseIf((0,n._)`${_} === "true" || ${_} === 1`).assign(j,!0);return;case"null":u.elseIf((0,n._)`${_} === "" || ${_} === 0 || ${_} === false`),u.assign(j,null);return;case"array":u.elseIf((0,n._)`${C} === "string" || ${C} === "number"
              || ${C} === "boolean" || ${_} === null`).assign(j,(0,n._)`[${_}]`)}}}function y({gen:c,parentData:d,parentDataProperty:b},u){c.if((0,n._)`${d} !== undefined`,()=>c.assign((0,n._)`${d}[${b}]`,u))}function v(c,d,b,u=s.Correct){const _=u===s.Correct?n.operators.EQ:n.operators.NEQ;let T;switch(c){case"null":return(0,n._)`${d} ${_} null`;case"array":T=(0,n._)`Array.isArray(${d})`;break;case"object":T=(0,n._)`${d} && typeof ${d} == "object" && !Array.isArray(${d})`;break;case"integer":T=C((0,n._)`!(${d} % 1) && !isNaN(${d})`);break;case"number":T=C();break;default:return(0,n._)`typeof ${d} ${_} ${c}`}return u===s.Correct?T:(0,n.not)(T);function C(j=n.nil){return(0,n.and)((0,n._)`typeof ${d} == "number"`,j,b?(0,n._)`isFinite(${d})`:n.nil)}}Se.checkDataType=v;function w(c,d,b,u){if(c.length===1)return v(c[0],d,b,u);let _;const T=(0,a.toHash)(c);if(T.array&&T.object){const C=(0,n._)`typeof ${d} != "object"`;_=T.null?C:(0,n._)`!${d} || ${C}`,delete T.null,delete T.array,delete T.object}else _=n.nil;T.number&&delete T.integer;for(const C in T)_=(0,n.and)(_,v(C,d,b,u));return _}Se.checkDataTypes=w;const S={message:({schema:c})=>`must be ${c}`,params:({schema:c,schemaValue:d})=>typeof c=="string"?(0,n._)`{type: ${c}}`:(0,n._)`{type: ${d}}`};function p(c){const d=h(c);(0,r.reportError)(d,S)}Se.reportTypeError=p;function h(c){const{gen:d,data:b,schema:u}=c,_=(0,a.schemaRefOrVal)(c,u,"type");return{gen:d,keyword:"type",data:b,schema:u.type,schemaCode:_,schemaValue:_,parentSchema:u,params:{},it:c}}return Se}var wt={},ha;function yp(){if(ha)return wt;ha=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.assignDefaults=void 0;const e=Y(),t=ae();function r(a,s){const{properties:o,items:i}=a.schema;if(s==="object"&&o)for(const l in o)n(a,l,o[l].default);else s==="array"&&Array.isArray(i)&&i.forEach((l,m)=>n(a,m,l.default))}wt.assignDefaults=r;function n(a,s,o){const{gen:i,compositeRule:l,data:m,opts:f}=a;if(o===void 0)return;const $=(0,e._)`${m}${(0,e.getProperty)(s)}`;if(l){(0,t.checkStrictMode)(a,`default is ignored for: ${$}`);return}let y=(0,e._)`${$} === undefined`;f.useDefaults==="empty"&&(y=(0,e._)`${y} || ${$} === null || ${$} === ""`),i.if(y,(0,e._)`${$} = ${(0,e.stringify)(o)}`)}return wt}var Je={},ce={},ga;function We(){if(ga)return ce;ga=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.validateUnion=ce.validateArray=ce.usePattern=ce.callValidateCode=ce.schemaProperties=ce.allSchemaProperties=ce.noPropertyInData=ce.propertyInData=ce.isOwnProperty=ce.hasPropFunc=ce.reportMissingProp=ce.checkMissingProp=ce.checkReportMissingProp=void 0;const e=Y(),t=ae(),r=nt(),n=ae();function a(c,d){const{gen:b,data:u,it:_}=c;b.if(f(b,u,d,_.opts.ownProperties),()=>{c.setParams({missingProperty:(0,e._)`${d}`},!0),c.error()})}ce.checkReportMissingProp=a;function s({gen:c,data:d,it:{opts:b}},u,_){return(0,e.or)(...u.map(T=>(0,e.and)(f(c,d,T,b.ownProperties),(0,e._)`${_} = ${T}`)))}ce.checkMissingProp=s;function o(c,d){c.setParams({missingProperty:d},!0),c.error()}ce.reportMissingProp=o;function i(c){return c.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,e._)`Object.prototype.hasOwnProperty`})}ce.hasPropFunc=i;function l(c,d,b){return(0,e._)`${i(c)}.call(${d}, ${b})`}ce.isOwnProperty=l;function m(c,d,b,u){const _=(0,e._)`${d}${(0,e.getProperty)(b)} !== undefined`;return u?(0,e._)`${_} && ${l(c,d,b)}`:_}ce.propertyInData=m;function f(c,d,b,u){const _=(0,e._)`${d}${(0,e.getProperty)(b)} === undefined`;return u?(0,e.or)(_,(0,e.not)(l(c,d,b))):_}ce.noPropertyInData=f;function $(c){return c?Object.keys(c).filter(d=>d!=="__proto__"):[]}ce.allSchemaProperties=$;function y(c,d){return $(d).filter(b=>!(0,t.alwaysValidSchema)(c,d[b]))}ce.schemaProperties=y;function v({schemaCode:c,data:d,it:{gen:b,topSchemaRef:u,schemaPath:_,errorPath:T},it:C},j,L,A){const z=A?(0,e._)`${c}, ${d}, ${u}${_}`:d,Z=[[r.default.instancePath,(0,e.strConcat)(r.default.instancePath,T)],[r.default.parentData,C.parentData],[r.default.parentDataProperty,C.parentDataProperty],[r.default.rootData,r.default.rootData]];C.opts.dynamicRef&&Z.push([r.default.dynamicAnchors,r.default.dynamicAnchors]);const F=(0,e._)`${z}, ${b.object(...Z)}`;return L!==e.nil?(0,e._)`${j}.call(${L}, ${F})`:(0,e._)`${j}(${F})`}ce.callValidateCode=v;const w=(0,e._)`new RegExp`;function S({gen:c,it:{opts:d}},b){const u=d.unicodeRegExp?"u":"",{regExp:_}=d.code,T=_(b,u);return c.scopeValue("pattern",{key:T.toString(),ref:T,code:(0,e._)`${_.code==="new RegExp"?w:(0,n.useFunc)(c,_)}(${b}, ${u})`})}ce.usePattern=S;function p(c){const{gen:d,data:b,keyword:u,it:_}=c,T=d.name("valid");if(_.allErrors){const j=d.let("valid",!0);return C(()=>d.assign(j,!1)),j}return d.var(T,!0),C(()=>d.break()),T;function C(j){const L=d.const("len",(0,e._)`${b}.length`);d.forRange("i",0,L,A=>{c.subschema({keyword:u,dataProp:A,dataPropType:t.Type.Num},T),d.if((0,e.not)(T),j)})}}ce.validateArray=p;function h(c){const{gen:d,schema:b,keyword:u,it:_}=c;if(!Array.isArray(b))throw new Error("ajv implementation error");if(b.some(L=>(0,t.alwaysValidSchema)(_,L))&&!_.opts.unevaluated)return;const C=d.let("valid",!1),j=d.name("_valid");d.block(()=>b.forEach((L,A)=>{const z=c.subschema({keyword:u,schemaProp:A,compositeRule:!0},j);d.assign(C,(0,e._)`${C} || ${j}`),c.mergeValidEvaluated(z,j)||d.if((0,e.not)(C))})),c.result(C,()=>c.reset(),()=>c.error(!0))}return ce.validateUnion=h,ce}var ya;function vp(){if(ya)return Je;ya=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.validateKeywordUsage=Je.validSchemaType=Je.funcKeywordCode=Je.macroKeywordCode=void 0;const e=Y(),t=nt(),r=We(),n=Nr();function a(y,v){const{gen:w,keyword:S,schema:p,parentSchema:h,it:c}=y,d=v.macro.call(c.self,p,h,c),b=m(w,S,d);c.opts.validateSchema!==!1&&c.self.validateSchema(d,!0);const u=w.name("valid");y.subschema({schema:d,schemaPath:e.nil,errSchemaPath:`${c.errSchemaPath}/${S}`,topSchemaRef:b,compositeRule:!0},u),y.pass(u,()=>y.error(!0))}Je.macroKeywordCode=a;function s(y,v){var w;const{gen:S,keyword:p,schema:h,parentSchema:c,$data:d,it:b}=y;l(b,v);const u=!d&&v.compile?v.compile.call(b.self,h,c,b):v.validate,_=m(S,p,u),T=S.let("valid");y.block$data(T,C),y.ok((w=v.valid)!==null&&w!==void 0?w:T);function C(){if(v.errors===!1)A(),v.modifying&&o(y),z(()=>y.error());else{const Z=v.async?j():L();v.modifying&&o(y),z(()=>i(y,Z))}}function j(){const Z=S.let("ruleErrs",null);return S.try(()=>A((0,e._)`await `),F=>S.assign(T,!1).if((0,e._)`${F} instanceof ${b.ValidationError}`,()=>S.assign(Z,(0,e._)`${F}.errors`),()=>S.throw(F))),Z}function L(){const Z=(0,e._)`${_}.errors`;return S.assign(Z,null),A(e.nil),Z}function A(Z=v.async?(0,e._)`await `:e.nil){const F=b.opts.passContext?t.default.this:t.default.self,ie=!("compile"in v&&!d||v.schema===!1);S.assign(T,(0,e._)`${Z}${(0,r.callValidateCode)(y,_,F,ie)}`,v.modifying)}function z(Z){var F;S.if((0,e.not)((F=v.valid)!==null&&F!==void 0?F:T),Z)}}Je.funcKeywordCode=s;function o(y){const{gen:v,data:w,it:S}=y;v.if(S.parentData,()=>v.assign(w,(0,e._)`${S.parentData}[${S.parentDataProperty}]`))}function i(y,v){const{gen:w}=y;w.if((0,e._)`Array.isArray(${v})`,()=>{w.assign(t.default.vErrors,(0,e._)`${t.default.vErrors} === null ? ${v} : ${t.default.vErrors}.concat(${v})`).assign(t.default.errors,(0,e._)`${t.default.vErrors}.length`),(0,n.extendErrors)(y)},()=>y.error())}function l({schemaEnv:y},v){if(v.async&&!y.$async)throw new Error("async keyword in sync schema")}function m(y,v,w){if(w===void 0)throw new Error(`keyword "${v}" failed to compile`);return y.scopeValue("keyword",typeof w=="function"?{ref:w}:{ref:w,code:(0,e.stringify)(w)})}function f(y,v,w=!1){return!v.length||v.some(S=>S==="array"?Array.isArray(y):S==="object"?y&&typeof y=="object"&&!Array.isArray(y):typeof y==S||w&&typeof y>"u")}Je.validSchemaType=f;function $({schema:y,opts:v,self:w,errSchemaPath:S},p,h){if(Array.isArray(p.keyword)?!p.keyword.includes(h):p.keyword!==h)throw new Error("ajv implementation error");const c=p.dependencies;if(c?.some(d=>!Object.prototype.hasOwnProperty.call(y,d)))throw new Error(`parent schema must have dependencies of ${h}: ${c.join(",")}`);if(p.validateSchema&&!p.validateSchema(y[h])){const b=`keyword "${h}" value is invalid at path "${S}": `+w.errorsText(p.validateSchema.errors);if(v.validateSchema==="log")w.logger.error(b);else throw new Error(b)}}return Je.validateKeywordUsage=$,Je}var Ye={},va;function _p(){if(va)return Ye;va=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.extendSubschemaMode=Ye.extendSubschemaData=Ye.getSubschema=void 0;const e=Y(),t=ae();function r(s,{keyword:o,schemaProp:i,schema:l,schemaPath:m,errSchemaPath:f,topSchemaRef:$}){if(o!==void 0&&l!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(o!==void 0){const y=s.schema[o];return i===void 0?{schema:y,schemaPath:(0,e._)`${s.schemaPath}${(0,e.getProperty)(o)}`,errSchemaPath:`${s.errSchemaPath}/${o}`}:{schema:y[i],schemaPath:(0,e._)`${s.schemaPath}${(0,e.getProperty)(o)}${(0,e.getProperty)(i)}`,errSchemaPath:`${s.errSchemaPath}/${o}/${(0,t.escapeFragment)(i)}`}}if(l!==void 0){if(m===void 0||f===void 0||$===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:l,schemaPath:m,topSchemaRef:$,errSchemaPath:f}}throw new Error('either "keyword" or "schema" must be passed')}Ye.getSubschema=r;function n(s,o,{dataProp:i,dataPropType:l,data:m,dataTypes:f,propertyName:$}){if(m!==void 0&&i!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:y}=o;if(i!==void 0){const{errorPath:w,dataPathArr:S,opts:p}=o,h=y.let("data",(0,e._)`${o.data}${(0,e.getProperty)(i)}`,!0);v(h),s.errorPath=(0,e.str)`${w}${(0,t.getErrorPath)(i,l,p.jsPropertySyntax)}`,s.parentDataProperty=(0,e._)`${i}`,s.dataPathArr=[...S,s.parentDataProperty]}if(m!==void 0){const w=m instanceof e.Name?m:y.let("data",m,!0);v(w),$!==void 0&&(s.propertyName=$)}f&&(s.dataTypes=f);function v(w){s.data=w,s.dataLevel=o.dataLevel+1,s.dataTypes=[],o.definedProperties=new Set,s.parentData=o.data,s.dataNames=[...o.dataNames,w]}}Ye.extendSubschemaData=n;function a(s,{jtdDiscriminator:o,jtdMetadata:i,compositeRule:l,createErrors:m,allErrors:f}){l!==void 0&&(s.compositeRule=l),m!==void 0&&(s.createErrors=m),f!==void 0&&(s.allErrors=f),s.jtdDiscriminator=o,s.jtdMetadata=i}return Ye.extendSubschemaMode=a,Ye}var Ce={},Wr,_a;function Eo(){return _a||(_a=1,Wr=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,a,s;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(a=n;a--!==0;)if(!e(t[a],r[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(s=Object.keys(t),n=s.length,n!==Object.keys(r).length)return!1;for(a=n;a--!==0;)if(!Object.prototype.hasOwnProperty.call(r,s[a]))return!1;for(a=n;a--!==0;){var o=s[a];if(!e(t[o],r[o]))return!1}return!0}return t!==t&&r!==r}),Wr}var Br={exports:{}},wa;function wp(){if(wa)return Br.exports;wa=1;var e=Br.exports=function(n,a,s){typeof a=="function"&&(s=a,a={}),s=a.cb||s;var o=typeof s=="function"?s:s.pre||function(){},i=s.post||function(){};t(a,o,i,n,"",n)};e.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},e.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},e.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},e.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function t(n,a,s,o,i,l,m,f,$,y){if(o&&typeof o=="object"&&!Array.isArray(o)){a(o,i,l,m,f,$,y);for(var v in o){var w=o[v];if(Array.isArray(w)){if(v in e.arrayKeywords)for(var S=0;S<w.length;S++)t(n,a,s,w[S],i+"/"+v+"/"+S,l,i,v,o,S)}else if(v in e.propsKeywords){if(w&&typeof w=="object")for(var p in w)t(n,a,s,w[p],i+"/"+v+"/"+r(p),l,i,v,o,p)}else(v in e.keywords||n.allKeys&&!(v in e.skipKeywords))&&t(n,a,s,w,i+"/"+v,l,i,v,o)}s(o,i,l,m,f,$,y)}}function r(n){return n.replace(/~/g,"~0").replace(/\//g,"~1")}return Br.exports}var ba;function Ar(){if(ba)return Ce;ba=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.getSchemaRefs=Ce.resolveUrl=Ce.normalizeId=Ce._getFullPath=Ce.getFullPath=Ce.inlineRef=void 0;const e=ae(),t=Eo(),r=wp(),n=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function a(S,p=!0){return typeof S=="boolean"?!0:p===!0?!o(S):p?i(S)<=p:!1}Ce.inlineRef=a;const s=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function o(S){for(const p in S){if(s.has(p))return!0;const h=S[p];if(Array.isArray(h)&&h.some(o)||typeof h=="object"&&o(h))return!0}return!1}function i(S){let p=0;for(const h in S){if(h==="$ref")return 1/0;if(p++,!n.has(h)&&(typeof S[h]=="object"&&(0,e.eachItem)(S[h],c=>p+=i(c)),p===1/0))return 1/0}return p}function l(S,p="",h){h!==!1&&(p=$(p));const c=S.parse(p);return m(S,c)}Ce.getFullPath=l;function m(S,p){return S.serialize(p).split("#")[0]+"#"}Ce._getFullPath=m;const f=/#\/?$/;function $(S){return S?S.replace(f,""):""}Ce.normalizeId=$;function y(S,p,h){return h=$(h),S.resolve(p,h)}Ce.resolveUrl=y;const v=/^[a-z_][-a-z0-9._]*$/i;function w(S,p){if(typeof S=="boolean")return{};const{schemaId:h,uriResolver:c}=this.opts,d=$(S[h]||p),b={"":d},u=l(c,d,!1),_={},T=new Set;return r(S,{allKeys:!0},(L,A,z,Z)=>{if(Z===void 0)return;const F=u+A;let ie=b[Z];typeof L[h]=="string"&&(ie=Re.call(this,L[h])),Oe.call(this,L.$anchor),Oe.call(this,L.$dynamicAnchor),b[A]=ie;function Re(ue){const Fe=this.opts.uriResolver.resolve;if(ue=$(ie?Fe(ie,ue):ue),T.has(ue))throw j(ue);T.add(ue);let D=this.refs[ue];return typeof D=="string"&&(D=this.refs[D]),typeof D=="object"?C(L,D.schema,ue):ue!==$(F)&&(ue[0]==="#"?(C(L,_[ue],ue),_[ue]=L):this.refs[ue]=F),ue}function Oe(ue){if(typeof ue=="string"){if(!v.test(ue))throw new Error(`invalid anchor "${ue}"`);Re.call(this,`#${ue}`)}}}),_;function C(L,A,z){if(A!==void 0&&!t(L,A))throw j(z)}function j(L){return new Error(`reference "${L}" resolves to more than one schema`)}}return Ce.getSchemaRefs=w,Ce}var $a;function qr(){if($a)return Ge;$a=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.getData=Ge.KeywordCxt=Ge.validateFunctionCode=void 0;const e=gp(),t=Er(),r=Po(),n=Er(),a=yp(),s=vp(),o=_p(),i=Y(),l=nt(),m=Ar(),f=ae(),$=Nr();function y(E){if(u(E)&&(T(E),b(E))){p(E);return}v(E,()=>(0,e.topBoolOrEmptySchema)(E))}Ge.validateFunctionCode=y;function v({gen:E,validateName:R,schema:q,schemaEnv:x,opts:H},X){H.code.es5?E.func(R,(0,i._)`${l.default.data}, ${l.default.valCxt}`,x.$async,()=>{E.code((0,i._)`"use strict"; ${c(q,H)}`),S(E,H),E.code(X)}):E.func(R,(0,i._)`${l.default.data}, ${w(H)}`,x.$async,()=>E.code(c(q,H)).code(X))}function w(E){return(0,i._)`{${l.default.instancePath}="", ${l.default.parentData}, ${l.default.parentDataProperty}, ${l.default.rootData}=${l.default.data}${E.dynamicRef?(0,i._)`, ${l.default.dynamicAnchors}={}`:i.nil}}={}`}function S(E,R){E.if(l.default.valCxt,()=>{E.var(l.default.instancePath,(0,i._)`${l.default.valCxt}.${l.default.instancePath}`),E.var(l.default.parentData,(0,i._)`${l.default.valCxt}.${l.default.parentData}`),E.var(l.default.parentDataProperty,(0,i._)`${l.default.valCxt}.${l.default.parentDataProperty}`),E.var(l.default.rootData,(0,i._)`${l.default.valCxt}.${l.default.rootData}`),R.dynamicRef&&E.var(l.default.dynamicAnchors,(0,i._)`${l.default.valCxt}.${l.default.dynamicAnchors}`)},()=>{E.var(l.default.instancePath,(0,i._)`""`),E.var(l.default.parentData,(0,i._)`undefined`),E.var(l.default.parentDataProperty,(0,i._)`undefined`),E.var(l.default.rootData,l.default.data),R.dynamicRef&&E.var(l.default.dynamicAnchors,(0,i._)`{}`)})}function p(E){const{schema:R,opts:q,gen:x}=E;v(E,()=>{q.$comment&&R.$comment&&Z(E),L(E),x.let(l.default.vErrors,null),x.let(l.default.errors,0),q.unevaluated&&h(E),C(E),F(E)})}function h(E){const{gen:R,validateName:q}=E;E.evaluated=R.const("evaluated",(0,i._)`${q}.evaluated`),R.if((0,i._)`${E.evaluated}.dynamicProps`,()=>R.assign((0,i._)`${E.evaluated}.props`,(0,i._)`undefined`)),R.if((0,i._)`${E.evaluated}.dynamicItems`,()=>R.assign((0,i._)`${E.evaluated}.items`,(0,i._)`undefined`))}function c(E,R){const q=typeof E=="object"&&E[R.schemaId];return q&&(R.code.source||R.code.process)?(0,i._)`/*# sourceURL=${q} */`:i.nil}function d(E,R){if(u(E)&&(T(E),b(E))){_(E,R);return}(0,e.boolOrEmptySchema)(E,R)}function b({schema:E,self:R}){if(typeof E=="boolean")return!E;for(const q in E)if(R.RULES.all[q])return!0;return!1}function u(E){return typeof E.schema!="boolean"}function _(E,R){const{schema:q,gen:x,opts:H}=E;H.$comment&&q.$comment&&Z(E),A(E),z(E);const X=x.const("_errs",l.default.errors);C(E,X),x.var(R,(0,i._)`${X} === ${l.default.errors}`)}function T(E){(0,f.checkUnknownRules)(E),j(E)}function C(E,R){if(E.opts.jtd)return Re(E,[],!1,R);const q=(0,t.getSchemaTypes)(E.schema),x=(0,t.coerceAndCheckDataType)(E,q);Re(E,q,!x,R)}function j(E){const{schema:R,errSchemaPath:q,opts:x,self:H}=E;R.$ref&&x.ignoreKeywordsWithRef&&(0,f.schemaHasRulesButRef)(R,H.RULES)&&H.logger.warn(`$ref: keywords ignored in schema at path "${q}"`)}function L(E){const{schema:R,opts:q}=E;R.default!==void 0&&q.useDefaults&&q.strictSchema&&(0,f.checkStrictMode)(E,"default is ignored in the schema root")}function A(E){const R=E.schema[E.opts.schemaId];R&&(E.baseId=(0,m.resolveUrl)(E.opts.uriResolver,E.baseId,R))}function z(E){if(E.schema.$async&&!E.schemaEnv.$async)throw new Error("async schema in sync schema")}function Z({gen:E,schemaEnv:R,schema:q,errSchemaPath:x,opts:H}){const X=q.$comment;if(H.$comment===!0)E.code((0,i._)`${l.default.self}.logger.log(${X})`);else if(typeof H.$comment=="function"){const be=(0,i.str)`${x}/$comment`,Ve=E.scopeValue("root",{ref:R.root});E.code((0,i._)`${l.default.self}.opts.$comment(${X}, ${be}, ${Ve}.schema)`)}}function F(E){const{gen:R,schemaEnv:q,validateName:x,ValidationError:H,opts:X}=E;q.$async?R.if((0,i._)`${l.default.errors} === 0`,()=>R.return(l.default.data),()=>R.throw((0,i._)`new ${H}(${l.default.vErrors})`)):(R.assign((0,i._)`${x}.errors`,l.default.vErrors),X.unevaluated&&ie(E),R.return((0,i._)`${l.default.errors} === 0`))}function ie({gen:E,evaluated:R,props:q,items:x}){q instanceof i.Name&&E.assign((0,i._)`${R}.props`,q),x instanceof i.Name&&E.assign((0,i._)`${R}.items`,x)}function Re(E,R,q,x){const{gen:H,schema:X,data:be,allErrors:Ve,opts:Ne,self:Ae}=E,{RULES:$e}=Ae;if(X.$ref&&(Ne.ignoreKeywordsWithRef||!(0,f.schemaHasRulesButRef)(X,$e))){H.block(()=>V(E,"$ref",$e.all.$ref.definition));return}Ne.jtd||ue(E,R),H.block(()=>{for(const ze of $e.rules)ft(ze);ft($e.post)});function ft(ze){(0,r.shouldUseGroup)(X,ze)&&(ze.type?(H.if((0,n.checkDataType)(ze.type,be,Ne.strictNumbers)),Oe(E,ze),R.length===1&&R[0]===ze.type&&q&&(H.else(),(0,n.reportTypeError)(E)),H.endIf()):Oe(E,ze),Ve||H.if((0,i._)`${l.default.errors} === ${x||0}`))}}function Oe(E,R){const{gen:q,schema:x,opts:{useDefaults:H}}=E;H&&(0,a.assignDefaults)(E,R.type),q.block(()=>{for(const X of R.rules)(0,r.shouldUseRule)(x,X)&&V(E,X.keyword,X.definition,R.type)})}function ue(E,R){E.schemaEnv.meta||!E.opts.strictTypes||(Fe(E,R),E.opts.allowUnionTypes||D(E,R),k(E,E.dataTypes))}function Fe(E,R){if(R.length){if(!E.dataTypes.length){E.dataTypes=R;return}R.forEach(q=>{O(E.dataTypes,q)||P(E,`type "${q}" not allowed by context "${E.dataTypes.join(",")}"`)}),g(E,R)}}function D(E,R){R.length>1&&!(R.length===2&&R.includes("null"))&&P(E,"use allowUnionTypes to allow union type keyword")}function k(E,R){const q=E.self.RULES.all;for(const x in q){const H=q[x];if(typeof H=="object"&&(0,r.shouldUseRule)(E.schema,H)){const{type:X}=H.definition;X.length&&!X.some(be=>M(R,be))&&P(E,`missing type "${X.join(",")}" for keyword "${x}"`)}}}function M(E,R){return E.includes(R)||R==="number"&&E.includes("integer")}function O(E,R){return E.includes(R)||R==="integer"&&E.includes("number")}function g(E,R){const q=[];for(const x of E.dataTypes)O(R,x)?q.push(x):R.includes("integer")&&x==="number"&&q.push("integer");E.dataTypes=q}function P(E,R){const q=E.schemaEnv.baseId+E.errSchemaPath;R+=` at "${q}" (strictTypes)`,(0,f.checkStrictMode)(E,R,E.opts.strictTypes)}class N{constructor(R,q,x){if((0,s.validateKeywordUsage)(R,q,x),this.gen=R.gen,this.allErrors=R.allErrors,this.keyword=x,this.data=R.data,this.schema=R.schema[x],this.$data=q.$data&&R.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,f.schemaRefOrVal)(R,this.schema,x,this.$data),this.schemaType=q.schemaType,this.parentSchema=R.schema,this.params={},this.it=R,this.def=q,this.$data)this.schemaCode=R.gen.const("vSchema",te(this.$data,R));else if(this.schemaCode=this.schemaValue,!(0,s.validSchemaType)(this.schema,q.schemaType,q.allowUndefined))throw new Error(`${x} value must be ${JSON.stringify(q.schemaType)}`);("code"in q?q.trackErrors:q.errors!==!1)&&(this.errsCount=R.gen.const("_errs",l.default.errors))}result(R,q,x){this.failResult((0,i.not)(R),q,x)}failResult(R,q,x){this.gen.if(R),x?x():this.error(),q?(this.gen.else(),q(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(R,q){this.failResult((0,i.not)(R),void 0,q)}fail(R){if(R===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(R),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(R){if(!this.$data)return this.fail(R);const{schemaCode:q}=this;this.fail((0,i._)`${q} !== undefined && (${(0,i.or)(this.invalid$data(),R)})`)}error(R,q,x){if(q){this.setParams(q),this._error(R,x),this.setParams({});return}this._error(R,x)}_error(R,q){(R?$.reportExtraError:$.reportError)(this,this.def.error,q)}$dataError(){(0,$.reportError)(this,this.def.$dataError||$.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,$.resetErrorsCount)(this.gen,this.errsCount)}ok(R){this.allErrors||this.gen.if(R)}setParams(R,q){q?Object.assign(this.params,R):this.params=R}block$data(R,q,x=i.nil){this.gen.block(()=>{this.check$data(R,x),q()})}check$data(R=i.nil,q=i.nil){if(!this.$data)return;const{gen:x,schemaCode:H,schemaType:X,def:be}=this;x.if((0,i.or)((0,i._)`${H} === undefined`,q)),R!==i.nil&&x.assign(R,!0),(X.length||be.validateSchema)&&(x.elseIf(this.invalid$data()),this.$dataError(),R!==i.nil&&x.assign(R,!1)),x.else()}invalid$data(){const{gen:R,schemaCode:q,schemaType:x,def:H,it:X}=this;return(0,i.or)(be(),Ve());function be(){if(x.length){if(!(q instanceof i.Name))throw new Error("ajv implementation error");const Ne=Array.isArray(x)?x:[x];return(0,i._)`${(0,n.checkDataTypes)(Ne,q,X.opts.strictNumbers,n.DataType.Wrong)}`}return i.nil}function Ve(){if(H.validateSchema){const Ne=R.scopeValue("validate$data",{ref:H.validateSchema});return(0,i._)`!${Ne}(${q})`}return i.nil}}subschema(R,q){const x=(0,o.getSubschema)(this.it,R);(0,o.extendSubschemaData)(x,this.it,R),(0,o.extendSubschemaMode)(x,R);const H={...this.it,...x,items:void 0,props:void 0};return d(H,q),H}mergeEvaluated(R,q){const{it:x,gen:H}=this;x.opts.unevaluated&&(x.props!==!0&&R.props!==void 0&&(x.props=f.mergeEvaluated.props(H,R.props,x.props,q)),x.items!==!0&&R.items!==void 0&&(x.items=f.mergeEvaluated.items(H,R.items,x.items,q)))}mergeValidEvaluated(R,q){const{it:x,gen:H}=this;if(x.opts.unevaluated&&(x.props!==!0||x.items!==!0))return H.if(q,()=>this.mergeEvaluated(R,i.Name)),!0}}Ge.KeywordCxt=N;function V(E,R,q,x){const H=new N(E,q,R);"code"in q?q.code(H,x):H.$data&&q.validate?(0,s.funcKeywordCode)(H,q):"macro"in q?(0,s.macroKeywordCode)(H,q):(q.compile||q.validate)&&(0,s.funcKeywordCode)(H,q)}const J=/^\/(?:[^~]|~0|~1)*$/,se=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function te(E,{dataLevel:R,dataNames:q,dataPathArr:x}){let H,X;if(E==="")return l.default.rootData;if(E[0]==="/"){if(!J.test(E))throw new Error(`Invalid JSON-pointer: ${E}`);H=E,X=l.default.rootData}else{const Ae=se.exec(E);if(!Ae)throw new Error(`Invalid JSON-pointer: ${E}`);const $e=+Ae[1];if(H=Ae[2],H==="#"){if($e>=R)throw new Error(Ne("property/index",$e));return x[R-$e]}if($e>R)throw new Error(Ne("data",$e));if(X=q[R-$e],!H)return X}let be=X;const Ve=H.split("/");for(const Ae of Ve)Ae&&(X=(0,i._)`${X}${(0,i.getProperty)((0,f.unescapeJsonPointer)(Ae))}`,be=(0,i._)`${be} && ${X}`);return be;function Ne(Ae,$e){return`Cannot access ${Ae} ${$e} levels up, current level is ${R}`}}return Ge.getData=te,Ge}var Dt={},Sa;function qn(){if(Sa)return Dt;Sa=1,Object.defineProperty(Dt,"__esModule",{value:!0});class e extends Error{constructor(r){super("validation failed"),this.errors=r,this.ajv=this.validation=!0}}return Dt.default=e,Dt}var xt={},Ta;function Mr(){if(Ta)return xt;Ta=1,Object.defineProperty(xt,"__esModule",{value:!0});const e=Ar();class t extends Error{constructor(n,a,s,o){super(o||`can't resolve reference ${s} from id ${a}`),this.missingRef=(0,e.resolveUrl)(n,a,s),this.missingSchema=(0,e.normalizeId)((0,e.getFullPath)(n,this.missingRef))}}return xt.default=t,xt}var je={},Pa;function Mn(){if(Pa)return je;Pa=1,Object.defineProperty(je,"__esModule",{value:!0}),je.resolveSchema=je.getCompilingSchema=je.resolveRef=je.compileSchema=je.SchemaEnv=void 0;const e=Y(),t=qn(),r=nt(),n=Ar(),a=ae(),s=qr();class o{constructor(h){var c;this.refs={},this.dynamicAnchors={};let d;typeof h.schema=="object"&&(d=h.schema),this.schema=h.schema,this.schemaId=h.schemaId,this.root=h.root||this,this.baseId=(c=h.baseId)!==null&&c!==void 0?c:(0,n.normalizeId)(d?.[h.schemaId||"$id"]),this.schemaPath=h.schemaPath,this.localRefs=h.localRefs,this.meta=h.meta,this.$async=d?.$async,this.refs={}}}je.SchemaEnv=o;function i(p){const h=f.call(this,p);if(h)return h;const c=(0,n.getFullPath)(this.opts.uriResolver,p.root.baseId),{es5:d,lines:b}=this.opts.code,{ownProperties:u}=this.opts,_=new e.CodeGen(this.scope,{es5:d,lines:b,ownProperties:u});let T;p.$async&&(T=_.scopeValue("Error",{ref:t.default,code:(0,e._)`require("ajv/dist/runtime/validation_error").default`}));const C=_.scopeName("validate");p.validateName=C;const j={gen:_,allErrors:this.opts.allErrors,data:r.default.data,parentData:r.default.parentData,parentDataProperty:r.default.parentDataProperty,dataNames:[r.default.data],dataPathArr:[e.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:_.scopeValue("schema",this.opts.code.source===!0?{ref:p.schema,code:(0,e.stringify)(p.schema)}:{ref:p.schema}),validateName:C,ValidationError:T,schema:p.schema,schemaEnv:p,rootId:c,baseId:p.baseId||c,schemaPath:e.nil,errSchemaPath:p.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,e._)`""`,opts:this.opts,self:this};let L;try{this._compilations.add(p),(0,s.validateFunctionCode)(j),_.optimize(this.opts.code.optimize);const A=_.toString();L=`${_.scopeRefs(r.default.scope)}return ${A}`,this.opts.code.process&&(L=this.opts.code.process(L,p));const Z=new Function(`${r.default.self}`,`${r.default.scope}`,L)(this,this.scope.get());if(this.scope.value(C,{ref:Z}),Z.errors=null,Z.schema=p.schema,Z.schemaEnv=p,p.$async&&(Z.$async=!0),this.opts.code.source===!0&&(Z.source={validateName:C,validateCode:A,scopeValues:_._values}),this.opts.unevaluated){const{props:F,items:ie}=j;Z.evaluated={props:F instanceof e.Name?void 0:F,items:ie instanceof e.Name?void 0:ie,dynamicProps:F instanceof e.Name,dynamicItems:ie instanceof e.Name},Z.source&&(Z.source.evaluated=(0,e.stringify)(Z.evaluated))}return p.validate=Z,p}catch(A){throw delete p.validate,delete p.validateName,L&&this.logger.error("Error compiling schema, function code:",L),A}finally{this._compilations.delete(p)}}je.compileSchema=i;function l(p,h,c){var d;c=(0,n.resolveUrl)(this.opts.uriResolver,h,c);const b=p.refs[c];if(b)return b;let u=y.call(this,p,c);if(u===void 0){const _=(d=p.localRefs)===null||d===void 0?void 0:d[c],{schemaId:T}=this.opts;_&&(u=new o({schema:_,schemaId:T,root:p,baseId:h}))}if(u!==void 0)return p.refs[c]=m.call(this,u)}je.resolveRef=l;function m(p){return(0,n.inlineRef)(p.schema,this.opts.inlineRefs)?p.schema:p.validate?p:i.call(this,p)}function f(p){for(const h of this._compilations)if($(h,p))return h}je.getCompilingSchema=f;function $(p,h){return p.schema===h.schema&&p.root===h.root&&p.baseId===h.baseId}function y(p,h){let c;for(;typeof(c=this.refs[h])=="string";)h=c;return c||this.schemas[h]||v.call(this,p,h)}function v(p,h){const c=this.opts.uriResolver.parse(h),d=(0,n._getFullPath)(this.opts.uriResolver,c);let b=(0,n.getFullPath)(this.opts.uriResolver,p.baseId,void 0);if(Object.keys(p.schema).length>0&&d===b)return S.call(this,c,p);const u=(0,n.normalizeId)(d),_=this.refs[u]||this.schemas[u];if(typeof _=="string"){const T=v.call(this,p,_);return typeof T?.schema!="object"?void 0:S.call(this,c,T)}if(typeof _?.schema=="object"){if(_.validate||i.call(this,_),u===(0,n.normalizeId)(h)){const{schema:T}=_,{schemaId:C}=this.opts,j=T[C];return j&&(b=(0,n.resolveUrl)(this.opts.uriResolver,b,j)),new o({schema:T,schemaId:C,root:p,baseId:b})}return S.call(this,c,_)}}je.resolveSchema=v;const w=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function S(p,{baseId:h,schema:c,root:d}){var b;if(((b=p.fragment)===null||b===void 0?void 0:b[0])!=="/")return;for(const T of p.fragment.slice(1).split("/")){if(typeof c=="boolean")return;const C=c[(0,a.unescapeFragment)(T)];if(C===void 0)return;c=C;const j=typeof c=="object"&&c[this.opts.schemaId];!w.has(T)&&j&&(h=(0,n.resolveUrl)(this.opts.uriResolver,h,j))}let u;if(typeof c!="boolean"&&c.$ref&&!(0,a.schemaHasRulesButRef)(c,this.RULES)){const T=(0,n.resolveUrl)(this.opts.uriResolver,h,c.$ref);u=v.call(this,d,T)}const{schemaId:_}=this.opts;if(u=u||new o({schema:c,schemaId:_,root:d,baseId:h}),u.schema!==u.root.schema)return u}return je}const bp="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",$p="Meta-schema for $data reference (JSON AnySchema extension proposal)",Sp="object",Tp=["$data"],Pp={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},Ep=!1,kp={$id:bp,description:$p,type:Sp,required:Tp,properties:Pp,additionalProperties:Ep};var zt={},bt={exports:{}},Gr,Ea;function ko(){if(Ea)return Gr;Ea=1;const e=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),t=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function r(y){let v="",w=0,S=0;for(S=0;S<y.length;S++)if(w=y[S].charCodeAt(0),w!==48){if(!(w>=48&&w<=57||w>=65&&w<=70||w>=97&&w<=102))return"";v+=y[S];break}for(S+=1;S<y.length;S++){if(w=y[S].charCodeAt(0),!(w>=48&&w<=57||w>=65&&w<=70||w>=97&&w<=102))return"";v+=y[S]}return v}const n=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function a(y){return y.length=0,!0}function s(y,v,w){if(y.length){const S=r(y);if(S!=="")v.push(S);else return w.error=!0,!1;y.length=0}return!0}function o(y){let v=0;const w={error:!1,address:"",zone:""},S=[],p=[];let h=!1,c=!1,d=s;for(let b=0;b<y.length;b++){const u=y[b];if(!(u==="["||u==="]"))if(u===":"){if(h===!0&&(c=!0),!d(p,S,w))break;if(++v>7){w.error=!0;break}b>0&&y[b-1]===":"&&(h=!0),S.push(":");continue}else if(u==="%"){if(!d(p,S,w))break;d=a}else{p.push(u);continue}}return p.length&&(d===a?w.zone=p.join(""):c?S.push(p.join("")):S.push(r(p))),w.address=S.join(""),w}function i(y){if(l(y,":")<2)return{host:y,isIPV6:!1};const v=o(y);if(v.error)return{host:y,isIPV6:!1};{let w=v.address,S=v.address;return v.zone&&(w+="%"+v.zone,S+="%25"+v.zone),{host:w,isIPV6:!0,escapedHost:S}}}function l(y,v){let w=0;for(let S=0;S<y.length;S++)y[S]===v&&w++;return w}function m(y){let v=y;const w=[];let S=-1,p=0;for(;p=v.length;){if(p===1){if(v===".")break;if(v==="/"){w.push("/");break}else{w.push(v);break}}else if(p===2){if(v[0]==="."){if(v[1]===".")break;if(v[1]==="/"){v=v.slice(2);continue}}else if(v[0]==="/"&&(v[1]==="."||v[1]==="/")){w.push("/");break}}else if(p===3&&v==="/.."){w.length!==0&&w.pop(),w.push("/");break}if(v[0]==="."){if(v[1]==="."){if(v[2]==="/"){v=v.slice(3);continue}}else if(v[1]==="/"){v=v.slice(2);continue}}else if(v[0]==="/"&&v[1]==="."){if(v[2]==="/"){v=v.slice(2);continue}else if(v[2]==="."&&v[3]==="/"){v=v.slice(3),w.length!==0&&w.pop();continue}}if((S=v.indexOf("/",1))===-1){w.push(v);break}else w.push(v.slice(0,S)),v=v.slice(S)}return w.join("")}function f(y,v){const w=v!==!0?escape:unescape;return y.scheme!==void 0&&(y.scheme=w(y.scheme)),y.userinfo!==void 0&&(y.userinfo=w(y.userinfo)),y.host!==void 0&&(y.host=w(y.host)),y.path!==void 0&&(y.path=w(y.path)),y.query!==void 0&&(y.query=w(y.query)),y.fragment!==void 0&&(y.fragment=w(y.fragment)),y}function $(y){const v=[];if(y.userinfo!==void 0&&(v.push(y.userinfo),v.push("@")),y.host!==void 0){let w=unescape(y.host);if(!t(w)){const S=i(w);S.isIPV6===!0?w=`[${S.escapedHost}]`:w=y.host}v.push(w)}return(typeof y.port=="number"||typeof y.port=="string")&&(v.push(":"),v.push(String(y.port))),v.length?v.join(""):void 0}return Gr={nonSimpleDomain:n,recomposeAuthority:$,normalizeComponentEncoding:f,removeDotSegments:m,isIPv4:t,isUUID:e,normalizeIPv6:i,stringArrayToHexStripped:r},Gr}var Qr,ka;function Rp(){if(ka)return Qr;ka=1;const{isUUID:e}=ko(),t=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,r=["http","https","ws","wss","urn","urn:uuid"];function n(u){return r.indexOf(u)!==-1}function a(u){return u.secure===!0?!0:u.secure===!1?!1:u.scheme?u.scheme.length===3&&(u.scheme[0]==="w"||u.scheme[0]==="W")&&(u.scheme[1]==="s"||u.scheme[1]==="S")&&(u.scheme[2]==="s"||u.scheme[2]==="S"):!1}function s(u){return u.host||(u.error=u.error||"HTTP URIs must have a host."),u}function o(u){const _=String(u.scheme).toLowerCase()==="https";return(u.port===(_?443:80)||u.port==="")&&(u.port=void 0),u.path||(u.path="/"),u}function i(u){return u.secure=a(u),u.resourceName=(u.path||"/")+(u.query?"?"+u.query:""),u.path=void 0,u.query=void 0,u}function l(u){if((u.port===(a(u)?443:80)||u.port==="")&&(u.port=void 0),typeof u.secure=="boolean"&&(u.scheme=u.secure?"wss":"ws",u.secure=void 0),u.resourceName){const[_,T]=u.resourceName.split("?");u.path=_&&_!=="/"?_:void 0,u.query=T,u.resourceName=void 0}return u.fragment=void 0,u}function m(u,_){if(!u.path)return u.error="URN can not be parsed",u;const T=u.path.match(t);if(T){const C=_.scheme||u.scheme||"urn";u.nid=T[1].toLowerCase(),u.nss=T[2];const j=`${C}:${_.nid||u.nid}`,L=b(j);u.path=void 0,L&&(u=L.parse(u,_))}else u.error=u.error||"URN can not be parsed.";return u}function f(u,_){if(u.nid===void 0)throw new Error("URN without nid cannot be serialized");const T=_.scheme||u.scheme||"urn",C=u.nid.toLowerCase(),j=`${T}:${_.nid||C}`,L=b(j);L&&(u=L.serialize(u,_));const A=u,z=u.nss;return A.path=`${C||_.nid}:${z}`,_.skipEscape=!0,A}function $(u,_){const T=u;return T.uuid=T.nss,T.nss=void 0,!_.tolerant&&(!T.uuid||!e(T.uuid))&&(T.error=T.error||"UUID is not valid."),T}function y(u){const _=u;return _.nss=(u.uuid||"").toLowerCase(),_}const v={scheme:"http",domainHost:!0,parse:s,serialize:o},w={scheme:"https",domainHost:v.domainHost,parse:s,serialize:o},S={scheme:"ws",domainHost:!0,parse:i,serialize:l},p={scheme:"wss",domainHost:S.domainHost,parse:S.parse,serialize:S.serialize},d={http:v,https:w,ws:S,wss:p,urn:{scheme:"urn",parse:m,serialize:f,skipNormalize:!0},"urn:uuid":{scheme:"urn:uuid",parse:$,serialize:y,skipNormalize:!0}};Object.setPrototypeOf(d,null);function b(u){return u&&(d[u]||d[u.toLowerCase()])||void 0}return Qr={wsIsSecure:a,SCHEMES:d,isValidSchemeName:n,getSchemeHandler:b},Qr}var Ra;function Op(){if(Ra)return bt.exports;Ra=1;const{normalizeIPv6:e,removeDotSegments:t,recomposeAuthority:r,normalizeComponentEncoding:n,isIPv4:a,nonSimpleDomain:s}=ko(),{SCHEMES:o,getSchemeHandler:i}=Rp();function l(p,h){return typeof p=="string"?p=y(w(p,h),h):typeof p=="object"&&(p=w(y(p,h),h)),p}function m(p,h,c){const d=c?Object.assign({scheme:"null"},c):{scheme:"null"},b=f(w(p,d),w(h,d),d,!0);return d.skipEscape=!0,y(b,d)}function f(p,h,c,d){const b={};return d||(p=w(y(p,c),c),h=w(y(h,c),c)),c=c||{},!c.tolerant&&h.scheme?(b.scheme=h.scheme,b.userinfo=h.userinfo,b.host=h.host,b.port=h.port,b.path=t(h.path||""),b.query=h.query):(h.userinfo!==void 0||h.host!==void 0||h.port!==void 0?(b.userinfo=h.userinfo,b.host=h.host,b.port=h.port,b.path=t(h.path||""),b.query=h.query):(h.path?(h.path[0]==="/"?b.path=t(h.path):((p.userinfo!==void 0||p.host!==void 0||p.port!==void 0)&&!p.path?b.path="/"+h.path:p.path?b.path=p.path.slice(0,p.path.lastIndexOf("/")+1)+h.path:b.path=h.path,b.path=t(b.path)),b.query=h.query):(b.path=p.path,h.query!==void 0?b.query=h.query:b.query=p.query),b.userinfo=p.userinfo,b.host=p.host,b.port=p.port),b.scheme=p.scheme),b.fragment=h.fragment,b}function $(p,h,c){return typeof p=="string"?(p=unescape(p),p=y(n(w(p,c),!0),{...c,skipEscape:!0})):typeof p=="object"&&(p=y(n(p,!0),{...c,skipEscape:!0})),typeof h=="string"?(h=unescape(h),h=y(n(w(h,c),!0),{...c,skipEscape:!0})):typeof h=="object"&&(h=y(n(h,!0),{...c,skipEscape:!0})),p.toLowerCase()===h.toLowerCase()}function y(p,h){const c={host:p.host,scheme:p.scheme,userinfo:p.userinfo,port:p.port,path:p.path,query:p.query,nid:p.nid,nss:p.nss,uuid:p.uuid,fragment:p.fragment,reference:p.reference,resourceName:p.resourceName,secure:p.secure,error:""},d=Object.assign({},h),b=[],u=i(d.scheme||c.scheme);u&&u.serialize&&u.serialize(c,d),c.path!==void 0&&(d.skipEscape?c.path=unescape(c.path):(c.path=escape(c.path),c.scheme!==void 0&&(c.path=c.path.split("%3A").join(":")))),d.reference!=="suffix"&&c.scheme&&b.push(c.scheme,":");const _=r(c);if(_!==void 0&&(d.reference!=="suffix"&&b.push("//"),b.push(_),c.path&&c.path[0]!=="/"&&b.push("/")),c.path!==void 0){let T=c.path;!d.absolutePath&&(!u||!u.absolutePath)&&(T=t(T)),_===void 0&&T[0]==="/"&&T[1]==="/"&&(T="/%2F"+T.slice(2)),b.push(T)}return c.query!==void 0&&b.push("?",c.query),c.fragment!==void 0&&b.push("#",c.fragment),b.join("")}const v=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function w(p,h){const c=Object.assign({},h),d={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0};let b=!1;c.reference==="suffix"&&(c.scheme?p=c.scheme+":"+p:p="//"+p);const u=p.match(v);if(u){if(d.scheme=u[1],d.userinfo=u[3],d.host=u[4],d.port=parseInt(u[5],10),d.path=u[6]||"",d.query=u[7],d.fragment=u[8],isNaN(d.port)&&(d.port=u[5]),d.host)if(a(d.host)===!1){const C=e(d.host);d.host=C.host.toLowerCase(),b=C.isIPV6}else b=!0;d.scheme===void 0&&d.userinfo===void 0&&d.host===void 0&&d.port===void 0&&d.query===void 0&&!d.path?d.reference="same-document":d.scheme===void 0?d.reference="relative":d.fragment===void 0?d.reference="absolute":d.reference="uri",c.reference&&c.reference!=="suffix"&&c.reference!==d.reference&&(d.error=d.error||"URI is not a "+c.reference+" reference.");const _=i(c.scheme||d.scheme);if(!c.unicodeSupport&&(!_||!_.unicodeSupport)&&d.host&&(c.domainHost||_&&_.domainHost)&&b===!1&&s(d.host))try{d.host=URL.domainToASCII(d.host.toLowerCase())}catch(T){d.error=d.error||"Host's domain name can not be converted to ASCII: "+T}(!_||_&&!_.skipNormalize)&&(p.indexOf("%")!==-1&&(d.scheme!==void 0&&(d.scheme=unescape(d.scheme)),d.host!==void 0&&(d.host=unescape(d.host))),d.path&&(d.path=escape(unescape(d.path))),d.fragment&&(d.fragment=encodeURI(decodeURIComponent(d.fragment)))),_&&_.parse&&_.parse(d,c)}else d.error=d.error||"URI can not be parsed.";return d}const S={SCHEMES:o,normalize:l,resolve:m,resolveComponent:f,equal:$,serialize:y,parse:w};return bt.exports=S,bt.exports.default=S,bt.exports.fastUri=S,bt.exports}var Oa;function Ip(){if(Oa)return zt;Oa=1,Object.defineProperty(zt,"__esModule",{value:!0});const e=Op();return e.code='require("ajv/dist/runtime/uri").default',zt.default=e,zt}var Ia;function Cp(){return Ia||(Ia=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;var t=qr();Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return t.KeywordCxt}});var r=Y();Object.defineProperty(e,"_",{enumerable:!0,get:function(){return r._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return r.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return r.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return r.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return r.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return r.CodeGen}});const n=qn(),a=Mr(),s=To(),o=Mn(),i=Y(),l=Ar(),m=Er(),f=ae(),$=kp,y=Ip(),v=(D,k)=>new RegExp(D,k);v.code="new RegExp";const w=["removeAdditional","useDefaults","coerceTypes"],S=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),p={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},h={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},c=200;function d(D){var k,M,O,g,P,N,V,J,se,te,E,R,q,x,H,X,be,Ve,Ne,Ae,$e,ft,ze,jr,Dr;const _t=D.strict,xr=(k=D.code)===null||k===void 0?void 0:k.optimize,Dn=xr===!0||xr===void 0?1:xr||0,xn=(O=(M=D.code)===null||M===void 0?void 0:M.regExp)!==null&&O!==void 0?O:v,Lo=(g=D.uriResolver)!==null&&g!==void 0?g:y.default;return{strictSchema:(N=(P=D.strictSchema)!==null&&P!==void 0?P:_t)!==null&&N!==void 0?N:!0,strictNumbers:(J=(V=D.strictNumbers)!==null&&V!==void 0?V:_t)!==null&&J!==void 0?J:!0,strictTypes:(te=(se=D.strictTypes)!==null&&se!==void 0?se:_t)!==null&&te!==void 0?te:"log",strictTuples:(R=(E=D.strictTuples)!==null&&E!==void 0?E:_t)!==null&&R!==void 0?R:"log",strictRequired:(x=(q=D.strictRequired)!==null&&q!==void 0?q:_t)!==null&&x!==void 0?x:!1,code:D.code?{...D.code,optimize:Dn,regExp:xn}:{optimize:Dn,regExp:xn},loopRequired:(H=D.loopRequired)!==null&&H!==void 0?H:c,loopEnum:(X=D.loopEnum)!==null&&X!==void 0?X:c,meta:(be=D.meta)!==null&&be!==void 0?be:!0,messages:(Ve=D.messages)!==null&&Ve!==void 0?Ve:!0,inlineRefs:(Ne=D.inlineRefs)!==null&&Ne!==void 0?Ne:!0,schemaId:(Ae=D.schemaId)!==null&&Ae!==void 0?Ae:"$id",addUsedSchema:($e=D.addUsedSchema)!==null&&$e!==void 0?$e:!0,validateSchema:(ft=D.validateSchema)!==null&&ft!==void 0?ft:!0,validateFormats:(ze=D.validateFormats)!==null&&ze!==void 0?ze:!0,unicodeRegExp:(jr=D.unicodeRegExp)!==null&&jr!==void 0?jr:!0,int32range:(Dr=D.int32range)!==null&&Dr!==void 0?Dr:!0,uriResolver:Lo}}class b{constructor(k={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,k=this.opts={...k,...d(k)};const{es5:M,lines:O}=this.opts.code;this.scope=new i.ValueScope({scope:{},prefixes:S,es5:M,lines:O}),this.logger=z(k.logger);const g=k.validateFormats;k.validateFormats=!1,this.RULES=(0,s.getRules)(),u.call(this,p,k,"NOT SUPPORTED"),u.call(this,h,k,"DEPRECATED","warn"),this._metaOpts=L.call(this),k.formats&&C.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),k.keywords&&j.call(this,k.keywords),typeof k.meta=="object"&&this.addMetaSchema(k.meta),T.call(this),k.validateFormats=g}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:k,meta:M,schemaId:O}=this.opts;let g=$;O==="id"&&(g={...$},g.id=g.$id,delete g.$id),M&&k&&this.addMetaSchema(g,g[O],!1)}defaultMeta(){const{meta:k,schemaId:M}=this.opts;return this.opts.defaultMeta=typeof k=="object"?k[M]||k:void 0}validate(k,M){let O;if(typeof k=="string"){if(O=this.getSchema(k),!O)throw new Error(`no schema with key or ref "${k}"`)}else O=this.compile(k);const g=O(M);return"$async"in O||(this.errors=O.errors),g}compile(k,M){const O=this._addSchema(k,M);return O.validate||this._compileSchemaEnv(O)}compileAsync(k,M){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:O}=this.opts;return g.call(this,k,M);async function g(te,E){await P.call(this,te.$schema);const R=this._addSchema(te,E);return R.validate||N.call(this,R)}async function P(te){te&&!this.getSchema(te)&&await g.call(this,{$ref:te},!0)}async function N(te){try{return this._compileSchemaEnv(te)}catch(E){if(!(E instanceof a.default))throw E;return V.call(this,E),await J.call(this,E.missingSchema),N.call(this,te)}}function V({missingSchema:te,missingRef:E}){if(this.refs[te])throw new Error(`AnySchema ${te} is loaded but ${E} cannot be resolved`)}async function J(te){const E=await se.call(this,te);this.refs[te]||await P.call(this,E.$schema),this.refs[te]||this.addSchema(E,te,M)}async function se(te){const E=this._loading[te];if(E)return E;try{return await(this._loading[te]=O(te))}finally{delete this._loading[te]}}}addSchema(k,M,O,g=this.opts.validateSchema){if(Array.isArray(k)){for(const N of k)this.addSchema(N,void 0,O,g);return this}let P;if(typeof k=="object"){const{schemaId:N}=this.opts;if(P=k[N],P!==void 0&&typeof P!="string")throw new Error(`schema ${N} must be string`)}return M=(0,l.normalizeId)(M||P),this._checkUnique(M),this.schemas[M]=this._addSchema(k,O,M,g,!0),this}addMetaSchema(k,M,O=this.opts.validateSchema){return this.addSchema(k,M,!0,O),this}validateSchema(k,M){if(typeof k=="boolean")return!0;let O;if(O=k.$schema,O!==void 0&&typeof O!="string")throw new Error("$schema must be a string");if(O=O||this.opts.defaultMeta||this.defaultMeta(),!O)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const g=this.validate(O,k);if(!g&&M){const P="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(P);else throw new Error(P)}return g}getSchema(k){let M;for(;typeof(M=_.call(this,k))=="string";)k=M;if(M===void 0){const{schemaId:O}=this.opts,g=new o.SchemaEnv({schema:{},schemaId:O});if(M=o.resolveSchema.call(this,g,k),!M)return;this.refs[k]=M}return M.validate||this._compileSchemaEnv(M)}removeSchema(k){if(k instanceof RegExp)return this._removeAllSchemas(this.schemas,k),this._removeAllSchemas(this.refs,k),this;switch(typeof k){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const M=_.call(this,k);return typeof M=="object"&&this._cache.delete(M.schema),delete this.schemas[k],delete this.refs[k],this}case"object":{const M=k;this._cache.delete(M);let O=k[this.opts.schemaId];return O&&(O=(0,l.normalizeId)(O),delete this.schemas[O],delete this.refs[O]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(k){for(const M of k)this.addKeyword(M);return this}addKeyword(k,M){let O;if(typeof k=="string")O=k,typeof M=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),M.keyword=O);else if(typeof k=="object"&&M===void 0){if(M=k,O=M.keyword,Array.isArray(O)&&!O.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(F.call(this,O,M),!M)return(0,f.eachItem)(O,P=>ie.call(this,P)),this;Oe.call(this,M);const g={...M,type:(0,m.getJSONTypes)(M.type),schemaType:(0,m.getJSONTypes)(M.schemaType)};return(0,f.eachItem)(O,g.type.length===0?P=>ie.call(this,P,g):P=>g.type.forEach(N=>ie.call(this,P,g,N))),this}getKeyword(k){const M=this.RULES.all[k];return typeof M=="object"?M.definition:!!M}removeKeyword(k){const{RULES:M}=this;delete M.keywords[k],delete M.all[k];for(const O of M.rules){const g=O.rules.findIndex(P=>P.keyword===k);g>=0&&O.rules.splice(g,1)}return this}addFormat(k,M){return typeof M=="string"&&(M=new RegExp(M)),this.formats[k]=M,this}errorsText(k=this.errors,{separator:M=", ",dataVar:O="data"}={}){return!k||k.length===0?"No errors":k.map(g=>`${O}${g.instancePath} ${g.message}`).reduce((g,P)=>g+M+P)}$dataMetaSchema(k,M){const O=this.RULES.all;k=JSON.parse(JSON.stringify(k));for(const g of M){const P=g.split("/").slice(1);let N=k;for(const V of P)N=N[V];for(const V in O){const J=O[V];if(typeof J!="object")continue;const{$data:se}=J.definition,te=N[V];se&&te&&(N[V]=Fe(te))}}return k}_removeAllSchemas(k,M){for(const O in k){const g=k[O];(!M||M.test(O))&&(typeof g=="string"?delete k[O]:g&&!g.meta&&(this._cache.delete(g.schema),delete k[O]))}}_addSchema(k,M,O,g=this.opts.validateSchema,P=this.opts.addUsedSchema){let N;const{schemaId:V}=this.opts;if(typeof k=="object")N=k[V];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof k!="boolean")throw new Error("schema must be object or boolean")}let J=this._cache.get(k);if(J!==void 0)return J;O=(0,l.normalizeId)(N||O);const se=l.getSchemaRefs.call(this,k,O);return J=new o.SchemaEnv({schema:k,schemaId:V,meta:M,baseId:O,localRefs:se}),this._cache.set(J.schema,J),P&&!O.startsWith("#")&&(O&&this._checkUnique(O),this.refs[O]=J),g&&this.validateSchema(k,!0),J}_checkUnique(k){if(this.schemas[k]||this.refs[k])throw new Error(`schema with key or id "${k}" already exists`)}_compileSchemaEnv(k){if(k.meta?this._compileMetaSchema(k):o.compileSchema.call(this,k),!k.validate)throw new Error("ajv implementation error");return k.validate}_compileMetaSchema(k){const M=this.opts;this.opts=this._metaOpts;try{o.compileSchema.call(this,k)}finally{this.opts=M}}}b.ValidationError=n.default,b.MissingRefError=a.default,e.default=b;function u(D,k,M,O="error"){for(const g in D){const P=g;P in k&&this.logger[O](`${M}: option ${g}. ${D[P]}`)}}function _(D){return D=(0,l.normalizeId)(D),this.schemas[D]||this.refs[D]}function T(){const D=this.opts.schemas;if(D)if(Array.isArray(D))this.addSchema(D);else for(const k in D)this.addSchema(D[k],k)}function C(){for(const D in this.opts.formats){const k=this.opts.formats[D];k&&this.addFormat(D,k)}}function j(D){if(Array.isArray(D)){this.addVocabulary(D);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const k in D){const M=D[k];M.keyword||(M.keyword=k),this.addKeyword(M)}}function L(){const D={...this.opts};for(const k of w)delete D[k];return D}const A={log(){},warn(){},error(){}};function z(D){if(D===!1)return A;if(D===void 0)return console;if(D.log&&D.warn&&D.error)return D;throw new Error("logger must implement log, warn and error methods")}const Z=/^[a-z_$][a-z0-9_$:-]*$/i;function F(D,k){const{RULES:M}=this;if((0,f.eachItem)(D,O=>{if(M.keywords[O])throw new Error(`Keyword ${O} is already defined`);if(!Z.test(O))throw new Error(`Keyword ${O} has invalid name`)}),!!k&&k.$data&&!("code"in k||"validate"in k))throw new Error('$data keyword must have "code" or "validate" function')}function ie(D,k,M){var O;const g=k?.post;if(M&&g)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:P}=this;let N=g?P.post:P.rules.find(({type:J})=>J===M);if(N||(N={type:M,rules:[]},P.rules.push(N)),P.keywords[D]=!0,!k)return;const V={keyword:D,definition:{...k,type:(0,m.getJSONTypes)(k.type),schemaType:(0,m.getJSONTypes)(k.schemaType)}};k.before?Re.call(this,N,V,k.before):N.rules.push(V),P.all[D]=V,(O=k.implements)===null||O===void 0||O.forEach(J=>this.addKeyword(J))}function Re(D,k,M){const O=D.rules.findIndex(g=>g.keyword===M);O>=0?D.rules.splice(O,0,k):(D.rules.push(k),this.logger.warn(`rule ${M} is not defined`))}function Oe(D){let{metaSchema:k}=D;k!==void 0&&(D.$data&&this.opts.$data&&(k=Fe(k)),D.validateSchema=this.compile(k,!0))}const ue={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function Fe(D){return{anyOf:[D,ue]}}})(Fr)),Fr}var Lt={},Ut={},Zt={},Ca;function Np(){if(Ca)return Zt;Ca=1,Object.defineProperty(Zt,"__esModule",{value:!0});const e={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};return Zt.default=e,Zt}var et={},Na;function Ap(){if(Na)return et;Na=1,Object.defineProperty(et,"__esModule",{value:!0}),et.callRef=et.getValidate=void 0;const e=Mr(),t=We(),r=Y(),n=nt(),a=Mn(),s=ae(),o={keyword:"$ref",schemaType:"string",code(m){const{gen:f,schema:$,it:y}=m,{baseId:v,schemaEnv:w,validateName:S,opts:p,self:h}=y,{root:c}=w;if(($==="#"||$==="#/")&&v===c.baseId)return b();const d=a.resolveRef.call(h,c,v,$);if(d===void 0)throw new e.default(y.opts.uriResolver,v,$);if(d instanceof a.SchemaEnv)return u(d);return _(d);function b(){if(w===c)return l(m,S,w,w.$async);const T=f.scopeValue("root",{ref:c});return l(m,(0,r._)`${T}.validate`,c,c.$async)}function u(T){const C=i(m,T);l(m,C,T,T.$async)}function _(T){const C=f.scopeValue("schema",p.code.source===!0?{ref:T,code:(0,r.stringify)(T)}:{ref:T}),j=f.name("valid"),L=m.subschema({schema:T,dataTypes:[],schemaPath:r.nil,topSchemaRef:C,errSchemaPath:$},j);m.mergeEvaluated(L),m.ok(j)}}};function i(m,f){const{gen:$}=m;return f.validate?$.scopeValue("validate",{ref:f.validate}):(0,r._)`${$.scopeValue("wrapper",{ref:f})}.validate`}et.getValidate=i;function l(m,f,$,y){const{gen:v,it:w}=m,{allErrors:S,schemaEnv:p,opts:h}=w,c=h.passContext?n.default.this:r.nil;y?d():b();function d(){if(!p.$async)throw new Error("async schema referenced by sync schema");const T=v.let("valid");v.try(()=>{v.code((0,r._)`await ${(0,t.callValidateCode)(m,f,c)}`),_(f),S||v.assign(T,!0)},C=>{v.if((0,r._)`!(${C} instanceof ${w.ValidationError})`,()=>v.throw(C)),u(C),S||v.assign(T,!1)}),m.ok(T)}function b(){m.result((0,t.callValidateCode)(m,f,c),()=>_(f),()=>u(f))}function u(T){const C=(0,r._)`${T}.errors`;v.assign(n.default.vErrors,(0,r._)`${n.default.vErrors} === null ? ${C} : ${n.default.vErrors}.concat(${C})`),v.assign(n.default.errors,(0,r._)`${n.default.vErrors}.length`)}function _(T){var C;if(!w.opts.unevaluated)return;const j=(C=$?.validate)===null||C===void 0?void 0:C.evaluated;if(w.props!==!0)if(j&&!j.dynamicProps)j.props!==void 0&&(w.props=s.mergeEvaluated.props(v,j.props,w.props));else{const L=v.var("props",(0,r._)`${T}.evaluated.props`);w.props=s.mergeEvaluated.props(v,L,w.props,r.Name)}if(w.items!==!0)if(j&&!j.dynamicItems)j.items!==void 0&&(w.items=s.mergeEvaluated.items(v,j.items,w.items));else{const L=v.var("items",(0,r._)`${T}.evaluated.items`);w.items=s.mergeEvaluated.items(v,L,w.items,r.Name)}}}return et.callRef=l,et.default=o,et}var Aa;function qp(){if(Aa)return Ut;Aa=1,Object.defineProperty(Ut,"__esModule",{value:!0});const e=Np(),t=Ap(),r=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",e.default,t.default];return Ut.default=r,Ut}var Ft={},Vt={},qa;function Mp(){if(qa)return Vt;qa=1,Object.defineProperty(Vt,"__esModule",{value:!0});const e=Y(),t=e.operators,r={maximum:{okStr:"<=",ok:t.LTE,fail:t.GT},minimum:{okStr:">=",ok:t.GTE,fail:t.LT},exclusiveMaximum:{okStr:"<",ok:t.LT,fail:t.GTE},exclusiveMinimum:{okStr:">",ok:t.GT,fail:t.LTE}},n={message:({keyword:s,schemaCode:o})=>(0,e.str)`must be ${r[s].okStr} ${o}`,params:({keyword:s,schemaCode:o})=>(0,e._)`{comparison: ${r[s].okStr}, limit: ${o}}`},a={keyword:Object.keys(r),type:"number",schemaType:"number",$data:!0,error:n,code(s){const{keyword:o,data:i,schemaCode:l}=s;s.fail$data((0,e._)`${i} ${r[o].fail} ${l} || isNaN(${i})`)}};return Vt.default=a,Vt}var Ht={},Ma;function jp(){if(Ma)return Ht;Ma=1,Object.defineProperty(Ht,"__esModule",{value:!0});const e=Y(),r={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:{message:({schemaCode:n})=>(0,e.str)`must be multiple of ${n}`,params:({schemaCode:n})=>(0,e._)`{multipleOf: ${n}}`},code(n){const{gen:a,data:s,schemaCode:o,it:i}=n,l=i.opts.multipleOfPrecision,m=a.let("res"),f=l?(0,e._)`Math.abs(Math.round(${m}) - ${m}) > 1e-${l}`:(0,e._)`${m} !== parseInt(${m})`;n.fail$data((0,e._)`(${o} === 0 || (${m} = ${s}/${o}, ${f}))`)}};return Ht.default=r,Ht}var Kt={},Jt={},ja;function Dp(){if(ja)return Jt;ja=1,Object.defineProperty(Jt,"__esModule",{value:!0});function e(t){const r=t.length;let n=0,a=0,s;for(;a<r;)n++,s=t.charCodeAt(a++),s>=55296&&s<=56319&&a<r&&(s=t.charCodeAt(a),(s&64512)===56320&&a++);return n}return Jt.default=e,e.code='require("ajv/dist/runtime/ucs2length").default',Jt}var Da;function xp(){if(Da)return Kt;Da=1,Object.defineProperty(Kt,"__esModule",{value:!0});const e=Y(),t=ae(),r=Dp(),a={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:{message({keyword:s,schemaCode:o}){const i=s==="maxLength"?"more":"fewer";return(0,e.str)`must NOT have ${i} than ${o} characters`},params:({schemaCode:s})=>(0,e._)`{limit: ${s}}`},code(s){const{keyword:o,data:i,schemaCode:l,it:m}=s,f=o==="maxLength"?e.operators.GT:e.operators.LT,$=m.opts.unicode===!1?(0,e._)`${i}.length`:(0,e._)`${(0,t.useFunc)(s.gen,r.default)}(${i})`;s.fail$data((0,e._)`${$} ${f} ${l}`)}};return Kt.default=a,Kt}var Wt={},xa;function zp(){if(xa)return Wt;xa=1,Object.defineProperty(Wt,"__esModule",{value:!0});const e=We(),t=Y(),n={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:{message:({schemaCode:a})=>(0,t.str)`must match pattern "${a}"`,params:({schemaCode:a})=>(0,t._)`{pattern: ${a}}`},code(a){const{data:s,$data:o,schema:i,schemaCode:l,it:m}=a,f=m.opts.unicodeRegExp?"u":"",$=o?(0,t._)`(new RegExp(${l}, ${f}))`:(0,e.usePattern)(a,i);a.fail$data((0,t._)`!${$}.test(${s})`)}};return Wt.default=n,Wt}var Bt={},za;function Lp(){if(za)return Bt;za=1,Object.defineProperty(Bt,"__esModule",{value:!0});const e=Y(),r={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:{message({keyword:n,schemaCode:a}){const s=n==="maxProperties"?"more":"fewer";return(0,e.str)`must NOT have ${s} than ${a} properties`},params:({schemaCode:n})=>(0,e._)`{limit: ${n}}`},code(n){const{keyword:a,data:s,schemaCode:o}=n,i=a==="maxProperties"?e.operators.GT:e.operators.LT;n.fail$data((0,e._)`Object.keys(${s}).length ${i} ${o}`)}};return Bt.default=r,Bt}var Gt={},La;function Up(){if(La)return Gt;La=1,Object.defineProperty(Gt,"__esModule",{value:!0});const e=We(),t=Y(),r=ae(),a={keyword:"required",type:"object",schemaType:"array",$data:!0,error:{message:({params:{missingProperty:s}})=>(0,t.str)`must have required property '${s}'`,params:({params:{missingProperty:s}})=>(0,t._)`{missingProperty: ${s}}`},code(s){const{gen:o,schema:i,schemaCode:l,data:m,$data:f,it:$}=s,{opts:y}=$;if(!f&&i.length===0)return;const v=i.length>=y.loopRequired;if($.allErrors?w():S(),y.strictRequired){const c=s.parentSchema.properties,{definedProperties:d}=s.it;for(const b of i)if(c?.[b]===void 0&&!d.has(b)){const u=$.schemaEnv.baseId+$.errSchemaPath,_=`required property "${b}" is not defined at "${u}" (strictRequired)`;(0,r.checkStrictMode)($,_,$.opts.strictRequired)}}function w(){if(v||f)s.block$data(t.nil,p);else for(const c of i)(0,e.checkReportMissingProp)(s,c)}function S(){const c=o.let("missing");if(v||f){const d=o.let("valid",!0);s.block$data(d,()=>h(c,d)),s.ok(d)}else o.if((0,e.checkMissingProp)(s,i,c)),(0,e.reportMissingProp)(s,c),o.else()}function p(){o.forOf("prop",l,c=>{s.setParams({missingProperty:c}),o.if((0,e.noPropertyInData)(o,m,c,y.ownProperties),()=>s.error())})}function h(c,d){s.setParams({missingProperty:c}),o.forOf(c,l,()=>{o.assign(d,(0,e.propertyInData)(o,m,c,y.ownProperties)),o.if((0,t.not)(d),()=>{s.error(),o.break()})},t.nil)}}};return Gt.default=a,Gt}var Qt={},Ua;function Zp(){if(Ua)return Qt;Ua=1,Object.defineProperty(Qt,"__esModule",{value:!0});const e=Y(),r={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:{message({keyword:n,schemaCode:a}){const s=n==="maxItems"?"more":"fewer";return(0,e.str)`must NOT have ${s} than ${a} items`},params:({schemaCode:n})=>(0,e._)`{limit: ${n}}`},code(n){const{keyword:a,data:s,schemaCode:o}=n,i=a==="maxItems"?e.operators.GT:e.operators.LT;n.fail$data((0,e._)`${s}.length ${i} ${o}`)}};return Qt.default=r,Qt}var Yt={},Xt={},Za;function jn(){if(Za)return Xt;Za=1,Object.defineProperty(Xt,"__esModule",{value:!0});const e=Eo();return e.code='require("ajv/dist/runtime/equal").default',Xt.default=e,Xt}var Fa;function Fp(){if(Fa)return Yt;Fa=1,Object.defineProperty(Yt,"__esModule",{value:!0});const e=Er(),t=Y(),r=ae(),n=jn(),s={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:{message:({params:{i:o,j:i}})=>(0,t.str)`must NOT have duplicate items (items ## ${i} and ${o} are identical)`,params:({params:{i:o,j:i}})=>(0,t._)`{i: ${o}, j: ${i}}`},code(o){const{gen:i,data:l,$data:m,schema:f,parentSchema:$,schemaCode:y,it:v}=o;if(!m&&!f)return;const w=i.let("valid"),S=$.items?(0,e.getSchemaTypes)($.items):[];o.block$data(w,p,(0,t._)`${y} === false`),o.ok(w);function p(){const b=i.let("i",(0,t._)`${l}.length`),u=i.let("j");o.setParams({i:b,j:u}),i.assign(w,!0),i.if((0,t._)`${b} > 1`,()=>(h()?c:d)(b,u))}function h(){return S.length>0&&!S.some(b=>b==="object"||b==="array")}function c(b,u){const _=i.name("item"),T=(0,e.checkDataTypes)(S,_,v.opts.strictNumbers,e.DataType.Wrong),C=i.const("indices",(0,t._)`{}`);i.for((0,t._)`;${b}--;`,()=>{i.let(_,(0,t._)`${l}[${b}]`),i.if(T,(0,t._)`continue`),S.length>1&&i.if((0,t._)`typeof ${_} == "string"`,(0,t._)`${_} += "_"`),i.if((0,t._)`typeof ${C}[${_}] == "number"`,()=>{i.assign(u,(0,t._)`${C}[${_}]`),o.error(),i.assign(w,!1).break()}).code((0,t._)`${C}[${_}] = ${b}`)})}function d(b,u){const _=(0,r.useFunc)(i,n.default),T=i.name("outer");i.label(T).for((0,t._)`;${b}--;`,()=>i.for((0,t._)`${u} = ${b}; ${u}--;`,()=>i.if((0,t._)`${_}(${l}[${b}], ${l}[${u}])`,()=>{o.error(),i.assign(w,!1).break(T)})))}}};return Yt.default=s,Yt}var er={},Va;function Vp(){if(Va)return er;Va=1,Object.defineProperty(er,"__esModule",{value:!0});const e=Y(),t=ae(),r=jn(),a={keyword:"const",$data:!0,error:{message:"must be equal to constant",params:({schemaCode:s})=>(0,e._)`{allowedValue: ${s}}`},code(s){const{gen:o,data:i,$data:l,schemaCode:m,schema:f}=s;l||f&&typeof f=="object"?s.fail$data((0,e._)`!${(0,t.useFunc)(o,r.default)}(${i}, ${m})`):s.fail((0,e._)`${f} !== ${i}`)}};return er.default=a,er}var tr={},Ha;function Hp(){if(Ha)return tr;Ha=1,Object.defineProperty(tr,"__esModule",{value:!0});const e=Y(),t=ae(),r=jn(),a={keyword:"enum",schemaType:"array",$data:!0,error:{message:"must be equal to one of the allowed values",params:({schemaCode:s})=>(0,e._)`{allowedValues: ${s}}`},code(s){const{gen:o,data:i,$data:l,schema:m,schemaCode:f,it:$}=s;if(!l&&m.length===0)throw new Error("enum must have non-empty array");const y=m.length>=$.opts.loopEnum;let v;const w=()=>v??(v=(0,t.useFunc)(o,r.default));let S;if(y||l)S=o.let("valid"),s.block$data(S,p);else{if(!Array.isArray(m))throw new Error("ajv implementation error");const c=o.const("vSchema",f);S=(0,e.or)(...m.map((d,b)=>h(c,b)))}s.pass(S);function p(){o.assign(S,!1),o.forOf("v",f,c=>o.if((0,e._)`${w()}(${i}, ${c})`,()=>o.assign(S,!0).break()))}function h(c,d){const b=m[d];return typeof b=="object"&&b!==null?(0,e._)`${w()}(${i}, ${c}[${d}])`:(0,e._)`${i} === ${b}`}}};return tr.default=a,tr}var Ka;function Kp(){if(Ka)return Ft;Ka=1,Object.defineProperty(Ft,"__esModule",{value:!0});const e=Mp(),t=jp(),r=xp(),n=zp(),a=Lp(),s=Up(),o=Zp(),i=Fp(),l=Vp(),m=Hp(),f=[e.default,t.default,r.default,n.default,a.default,s.default,o.default,i.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},l.default,m.default];return Ft.default=f,Ft}var rr={},pt={},Ja;function Ro(){if(Ja)return pt;Ja=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.validateAdditionalItems=void 0;const e=Y(),t=ae(),n={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:{message:({params:{len:s}})=>(0,e.str)`must NOT have more than ${s} items`,params:({params:{len:s}})=>(0,e._)`{limit: ${s}}`},code(s){const{parentSchema:o,it:i}=s,{items:l}=o;if(!Array.isArray(l)){(0,t.checkStrictMode)(i,'"additionalItems" is ignored when "items" is not an array of schemas');return}a(s,l)}};function a(s,o){const{gen:i,schema:l,data:m,keyword:f,it:$}=s;$.items=!0;const y=i.const("len",(0,e._)`${m}.length`);if(l===!1)s.setParams({len:o.length}),s.pass((0,e._)`${y} <= ${o.length}`);else if(typeof l=="object"&&!(0,t.alwaysValidSchema)($,l)){const w=i.var("valid",(0,e._)`${y} <= ${o.length}`);i.if((0,e.not)(w),()=>v(w)),s.ok(w)}function v(w){i.forRange("i",o.length,y,S=>{s.subschema({keyword:f,dataProp:S,dataPropType:t.Type.Num},w),$.allErrors||i.if((0,e.not)(w),()=>i.break())})}}return pt.validateAdditionalItems=a,pt.default=n,pt}var nr={},mt={},Wa;function Oo(){if(Wa)return mt;Wa=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.validateTuple=void 0;const e=Y(),t=ae(),r=We(),n={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(s){const{schema:o,it:i}=s;if(Array.isArray(o))return a(s,"additionalItems",o);i.items=!0,!(0,t.alwaysValidSchema)(i,o)&&s.ok((0,r.validateArray)(s))}};function a(s,o,i=s.schema){const{gen:l,parentSchema:m,data:f,keyword:$,it:y}=s;S(m),y.opts.unevaluated&&i.length&&y.items!==!0&&(y.items=t.mergeEvaluated.items(l,i.length,y.items));const v=l.name("valid"),w=l.const("len",(0,e._)`${f}.length`);i.forEach((p,h)=>{(0,t.alwaysValidSchema)(y,p)||(l.if((0,e._)`${w} > ${h}`,()=>s.subschema({keyword:$,schemaProp:h,dataProp:h},v)),s.ok(v))});function S(p){const{opts:h,errSchemaPath:c}=y,d=i.length,b=d===p.minItems&&(d===p.maxItems||p[o]===!1);if(h.strictTuples&&!b){const u=`"${$}" is ${d}-tuple, but minItems or maxItems/${o} are not specified or different at path "${c}"`;(0,t.checkStrictMode)(y,u,h.strictTuples)}}}return mt.validateTuple=a,mt.default=n,mt}var Ba;function Jp(){if(Ba)return nr;Ba=1,Object.defineProperty(nr,"__esModule",{value:!0});const e=Oo(),t={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:r=>(0,e.validateTuple)(r,"items")};return nr.default=t,nr}var ar={},Ga;function Wp(){if(Ga)return ar;Ga=1,Object.defineProperty(ar,"__esModule",{value:!0});const e=Y(),t=ae(),r=We(),n=Ro(),s={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:{message:({params:{len:o}})=>(0,e.str)`must NOT have more than ${o} items`,params:({params:{len:o}})=>(0,e._)`{limit: ${o}}`},code(o){const{schema:i,parentSchema:l,it:m}=o,{prefixItems:f}=l;m.items=!0,!(0,t.alwaysValidSchema)(m,i)&&(f?(0,n.validateAdditionalItems)(o,f):o.ok((0,r.validateArray)(o)))}};return ar.default=s,ar}var sr={},Qa;function Bp(){if(Qa)return sr;Qa=1,Object.defineProperty(sr,"__esModule",{value:!0});const e=Y(),t=ae(),n={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:{message:({params:{min:a,max:s}})=>s===void 0?(0,e.str)`must contain at least ${a} valid item(s)`:(0,e.str)`must contain at least ${a} and no more than ${s} valid item(s)`,params:({params:{min:a,max:s}})=>s===void 0?(0,e._)`{minContains: ${a}}`:(0,e._)`{minContains: ${a}, maxContains: ${s}}`},code(a){const{gen:s,schema:o,parentSchema:i,data:l,it:m}=a;let f,$;const{minContains:y,maxContains:v}=i;m.opts.next?(f=y===void 0?1:y,$=v):f=1;const w=s.const("len",(0,e._)`${l}.length`);if(a.setParams({min:f,max:$}),$===void 0&&f===0){(0,t.checkStrictMode)(m,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if($!==void 0&&f>$){(0,t.checkStrictMode)(m,'"minContains" > "maxContains" is always invalid'),a.fail();return}if((0,t.alwaysValidSchema)(m,o)){let d=(0,e._)`${w} >= ${f}`;$!==void 0&&(d=(0,e._)`${d} && ${w} <= ${$}`),a.pass(d);return}m.items=!0;const S=s.name("valid");$===void 0&&f===1?h(S,()=>s.if(S,()=>s.break())):f===0?(s.let(S,!0),$!==void 0&&s.if((0,e._)`${l}.length > 0`,p)):(s.let(S,!1),p()),a.result(S,()=>a.reset());function p(){const d=s.name("_valid"),b=s.let("count",0);h(d,()=>s.if(d,()=>c(b)))}function h(d,b){s.forRange("i",0,w,u=>{a.subschema({keyword:"contains",dataProp:u,dataPropType:t.Type.Num,compositeRule:!0},d),b()})}function c(d){s.code((0,e._)`${d}++`),$===void 0?s.if((0,e._)`${d} >= ${f}`,()=>s.assign(S,!0).break()):(s.if((0,e._)`${d} > ${$}`,()=>s.assign(S,!1).break()),f===1?s.assign(S,!0):s.if((0,e._)`${d} >= ${f}`,()=>s.assign(S,!0)))}}};return sr.default=n,sr}var Yr={},Ya;function Gp(){return Ya||(Ya=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateSchemaDeps=e.validatePropertyDeps=e.error=void 0;const t=Y(),r=ae(),n=We();e.error={message:({params:{property:l,depsCount:m,deps:f}})=>{const $=m===1?"property":"properties";return(0,t.str)`must have ${$} ${f} when property ${l} is present`},params:({params:{property:l,depsCount:m,deps:f,missingProperty:$}})=>(0,t._)`{property: ${l},
    missingProperty: ${$},
    depsCount: ${m},
    deps: ${f}}`};const a={keyword:"dependencies",type:"object",schemaType:"object",error:e.error,code(l){const[m,f]=s(l);o(l,m),i(l,f)}};function s({schema:l}){const m={},f={};for(const $ in l){if($==="__proto__")continue;const y=Array.isArray(l[$])?m:f;y[$]=l[$]}return[m,f]}function o(l,m=l.schema){const{gen:f,data:$,it:y}=l;if(Object.keys(m).length===0)return;const v=f.let("missing");for(const w in m){const S=m[w];if(S.length===0)continue;const p=(0,n.propertyInData)(f,$,w,y.opts.ownProperties);l.setParams({property:w,depsCount:S.length,deps:S.join(", ")}),y.allErrors?f.if(p,()=>{for(const h of S)(0,n.checkReportMissingProp)(l,h)}):(f.if((0,t._)`${p} && (${(0,n.checkMissingProp)(l,S,v)})`),(0,n.reportMissingProp)(l,v),f.else())}}e.validatePropertyDeps=o;function i(l,m=l.schema){const{gen:f,data:$,keyword:y,it:v}=l,w=f.name("valid");for(const S in m)(0,r.alwaysValidSchema)(v,m[S])||(f.if((0,n.propertyInData)(f,$,S,v.opts.ownProperties),()=>{const p=l.subschema({keyword:y,schemaProp:S},w);l.mergeValidEvaluated(p,w)},()=>f.var(w,!0)),l.ok(w))}e.validateSchemaDeps=i,e.default=a})(Yr)),Yr}var or={},Xa;function Qp(){if(Xa)return or;Xa=1,Object.defineProperty(or,"__esModule",{value:!0});const e=Y(),t=ae(),n={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:{message:"property name must be valid",params:({params:a})=>(0,e._)`{propertyName: ${a.propertyName}}`},code(a){const{gen:s,schema:o,data:i,it:l}=a;if((0,t.alwaysValidSchema)(l,o))return;const m=s.name("valid");s.forIn("key",i,f=>{a.setParams({propertyName:f}),a.subschema({keyword:"propertyNames",data:f,dataTypes:["string"],propertyName:f,compositeRule:!0},m),s.if((0,e.not)(m),()=>{a.error(!0),l.allErrors||s.break()})}),a.ok(m)}};return or.default=n,or}var ir={},es;function Io(){if(es)return ir;es=1,Object.defineProperty(ir,"__esModule",{value:!0});const e=We(),t=Y(),r=nt(),n=ae(),s={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:{message:"must NOT have additional properties",params:({params:o})=>(0,t._)`{additionalProperty: ${o.additionalProperty}}`},code(o){const{gen:i,schema:l,parentSchema:m,data:f,errsCount:$,it:y}=o;if(!$)throw new Error("ajv implementation error");const{allErrors:v,opts:w}=y;if(y.props=!0,w.removeAdditional!=="all"&&(0,n.alwaysValidSchema)(y,l))return;const S=(0,e.allSchemaProperties)(m.properties),p=(0,e.allSchemaProperties)(m.patternProperties);h(),o.ok((0,t._)`${$} === ${r.default.errors}`);function h(){i.forIn("key",f,_=>{!S.length&&!p.length?b(_):i.if(c(_),()=>b(_))})}function c(_){let T;if(S.length>8){const C=(0,n.schemaRefOrVal)(y,m.properties,"properties");T=(0,e.isOwnProperty)(i,C,_)}else S.length?T=(0,t.or)(...S.map(C=>(0,t._)`${_} === ${C}`)):T=t.nil;return p.length&&(T=(0,t.or)(T,...p.map(C=>(0,t._)`${(0,e.usePattern)(o,C)}.test(${_})`))),(0,t.not)(T)}function d(_){i.code((0,t._)`delete ${f}[${_}]`)}function b(_){if(w.removeAdditional==="all"||w.removeAdditional&&l===!1){d(_);return}if(l===!1){o.setParams({additionalProperty:_}),o.error(),v||i.break();return}if(typeof l=="object"&&!(0,n.alwaysValidSchema)(y,l)){const T=i.name("valid");w.removeAdditional==="failing"?(u(_,T,!1),i.if((0,t.not)(T),()=>{o.reset(),d(_)})):(u(_,T),v||i.if((0,t.not)(T),()=>i.break()))}}function u(_,T,C){const j={keyword:"additionalProperties",dataProp:_,dataPropType:n.Type.Str};C===!1&&Object.assign(j,{compositeRule:!0,createErrors:!1,allErrors:!1}),o.subschema(j,T)}}};return ir.default=s,ir}var cr={},ts;function Yp(){if(ts)return cr;ts=1,Object.defineProperty(cr,"__esModule",{value:!0});const e=qr(),t=We(),r=ae(),n=Io(),a={keyword:"properties",type:"object",schemaType:"object",code(s){const{gen:o,schema:i,parentSchema:l,data:m,it:f}=s;f.opts.removeAdditional==="all"&&l.additionalProperties===void 0&&n.default.code(new e.KeywordCxt(f,n.default,"additionalProperties"));const $=(0,t.allSchemaProperties)(i);for(const p of $)f.definedProperties.add(p);f.opts.unevaluated&&$.length&&f.props!==!0&&(f.props=r.mergeEvaluated.props(o,(0,r.toHash)($),f.props));const y=$.filter(p=>!(0,r.alwaysValidSchema)(f,i[p]));if(y.length===0)return;const v=o.name("valid");for(const p of y)w(p)?S(p):(o.if((0,t.propertyInData)(o,m,p,f.opts.ownProperties)),S(p),f.allErrors||o.else().var(v,!0),o.endIf()),s.it.definedProperties.add(p),s.ok(v);function w(p){return f.opts.useDefaults&&!f.compositeRule&&i[p].default!==void 0}function S(p){s.subschema({keyword:"properties",schemaProp:p,dataProp:p},v)}}};return cr.default=a,cr}var lr={},rs;function Xp(){if(rs)return lr;rs=1,Object.defineProperty(lr,"__esModule",{value:!0});const e=We(),t=Y(),r=ae(),n=ae(),a={keyword:"patternProperties",type:"object",schemaType:"object",code(s){const{gen:o,schema:i,data:l,parentSchema:m,it:f}=s,{opts:$}=f,y=(0,e.allSchemaProperties)(i),v=y.filter(b=>(0,r.alwaysValidSchema)(f,i[b]));if(y.length===0||v.length===y.length&&(!f.opts.unevaluated||f.props===!0))return;const w=$.strictSchema&&!$.allowMatchingProperties&&m.properties,S=o.name("valid");f.props!==!0&&!(f.props instanceof t.Name)&&(f.props=(0,n.evaluatedPropsToName)(o,f.props));const{props:p}=f;h();function h(){for(const b of y)w&&c(b),f.allErrors?d(b):(o.var(S,!0),d(b),o.if(S))}function c(b){for(const u in w)new RegExp(b).test(u)&&(0,r.checkStrictMode)(f,`property ${u} matches pattern ${b} (use allowMatchingProperties)`)}function d(b){o.forIn("key",l,u=>{o.if((0,t._)`${(0,e.usePattern)(s,b)}.test(${u})`,()=>{const _=v.includes(b);_||s.subschema({keyword:"patternProperties",schemaProp:b,dataProp:u,dataPropType:n.Type.Str},S),f.opts.unevaluated&&p!==!0?o.assign((0,t._)`${p}[${u}]`,!0):!_&&!f.allErrors&&o.if((0,t.not)(S),()=>o.break())})})}}};return lr.default=a,lr}var ur={},ns;function em(){if(ns)return ur;ns=1,Object.defineProperty(ur,"__esModule",{value:!0});const e=ae(),t={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(r){const{gen:n,schema:a,it:s}=r;if((0,e.alwaysValidSchema)(s,a)){r.fail();return}const o=n.name("valid");r.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),r.failResult(o,()=>r.reset(),()=>r.error())},error:{message:"must NOT be valid"}};return ur.default=t,ur}var dr={},as;function tm(){if(as)return dr;as=1,Object.defineProperty(dr,"__esModule",{value:!0});const t={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:We().validateUnion,error:{message:"must match a schema in anyOf"}};return dr.default=t,dr}var fr={},ss;function rm(){if(ss)return fr;ss=1,Object.defineProperty(fr,"__esModule",{value:!0});const e=Y(),t=ae(),n={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:{message:"must match exactly one schema in oneOf",params:({params:a})=>(0,e._)`{passingSchemas: ${a.passing}}`},code(a){const{gen:s,schema:o,parentSchema:i,it:l}=a;if(!Array.isArray(o))throw new Error("ajv implementation error");if(l.opts.discriminator&&i.discriminator)return;const m=o,f=s.let("valid",!1),$=s.let("passing",null),y=s.name("_valid");a.setParams({passing:$}),s.block(v),a.result(f,()=>a.reset(),()=>a.error(!0));function v(){m.forEach((w,S)=>{let p;(0,t.alwaysValidSchema)(l,w)?s.var(y,!0):p=a.subschema({keyword:"oneOf",schemaProp:S,compositeRule:!0},y),S>0&&s.if((0,e._)`${y} && ${f}`).assign(f,!1).assign($,(0,e._)`[${$}, ${S}]`).else(),s.if(y,()=>{s.assign(f,!0),s.assign($,S),p&&a.mergeEvaluated(p,e.Name)})})}}};return fr.default=n,fr}var pr={},os;function nm(){if(os)return pr;os=1,Object.defineProperty(pr,"__esModule",{value:!0});const e=ae(),t={keyword:"allOf",schemaType:"array",code(r){const{gen:n,schema:a,it:s}=r;if(!Array.isArray(a))throw new Error("ajv implementation error");const o=n.name("valid");a.forEach((i,l)=>{if((0,e.alwaysValidSchema)(s,i))return;const m=r.subschema({keyword:"allOf",schemaProp:l},o);r.ok(o),r.mergeEvaluated(m)})}};return pr.default=t,pr}var mr={},is;function am(){if(is)return mr;is=1,Object.defineProperty(mr,"__esModule",{value:!0});const e=Y(),t=ae(),n={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:{message:({params:s})=>(0,e.str)`must match "${s.ifClause}" schema`,params:({params:s})=>(0,e._)`{failingKeyword: ${s.ifClause}}`},code(s){const{gen:o,parentSchema:i,it:l}=s;i.then===void 0&&i.else===void 0&&(0,t.checkStrictMode)(l,'"if" without "then" and "else" is ignored');const m=a(l,"then"),f=a(l,"else");if(!m&&!f)return;const $=o.let("valid",!0),y=o.name("_valid");if(v(),s.reset(),m&&f){const S=o.let("ifClause");s.setParams({ifClause:S}),o.if(y,w("then",S),w("else",S))}else m?o.if(y,w("then")):o.if((0,e.not)(y),w("else"));s.pass($,()=>s.error(!0));function v(){const S=s.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},y);s.mergeEvaluated(S)}function w(S,p){return()=>{const h=s.subschema({keyword:S},y);o.assign($,y),s.mergeValidEvaluated(h,$),p?o.assign(p,(0,e._)`${S}`):s.setParams({ifClause:S})}}}};function a(s,o){const i=s.schema[o];return i!==void 0&&!(0,t.alwaysValidSchema)(s,i)}return mr.default=n,mr}var hr={},cs;function sm(){if(cs)return hr;cs=1,Object.defineProperty(hr,"__esModule",{value:!0});const e=ae(),t={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:r,parentSchema:n,it:a}){n.if===void 0&&(0,e.checkStrictMode)(a,`"${r}" without "if" is ignored`)}};return hr.default=t,hr}var ls;function om(){if(ls)return rr;ls=1,Object.defineProperty(rr,"__esModule",{value:!0});const e=Ro(),t=Jp(),r=Oo(),n=Wp(),a=Bp(),s=Gp(),o=Qp(),i=Io(),l=Yp(),m=Xp(),f=em(),$=tm(),y=rm(),v=nm(),w=am(),S=sm();function p(h=!1){const c=[f.default,$.default,y.default,v.default,w.default,S.default,o.default,i.default,s.default,l.default,m.default];return h?c.push(t.default,n.default):c.push(e.default,r.default),c.push(a.default),c}return rr.default=p,rr}var gr={},yr={},us;function im(){if(us)return yr;us=1,Object.defineProperty(yr,"__esModule",{value:!0});const e=Y(),r={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:{message:({schemaCode:n})=>(0,e.str)`must match format "${n}"`,params:({schemaCode:n})=>(0,e._)`{format: ${n}}`},code(n,a){const{gen:s,data:o,$data:i,schema:l,schemaCode:m,it:f}=n,{opts:$,errSchemaPath:y,schemaEnv:v,self:w}=f;if(!$.validateFormats)return;i?S():p();function S(){const h=s.scopeValue("formats",{ref:w.formats,code:$.code.formats}),c=s.const("fDef",(0,e._)`${h}[${m}]`),d=s.let("fType"),b=s.let("format");s.if((0,e._)`typeof ${c} == "object" && !(${c} instanceof RegExp)`,()=>s.assign(d,(0,e._)`${c}.type || "string"`).assign(b,(0,e._)`${c}.validate`),()=>s.assign(d,(0,e._)`"string"`).assign(b,c)),n.fail$data((0,e.or)(u(),_()));function u(){return $.strictSchema===!1?e.nil:(0,e._)`${m} && !${b}`}function _(){const T=v.$async?(0,e._)`(${c}.async ? await ${b}(${o}) : ${b}(${o}))`:(0,e._)`${b}(${o})`,C=(0,e._)`(typeof ${b} == "function" ? ${T} : ${b}.test(${o}))`;return(0,e._)`${b} && ${b} !== true && ${d} === ${a} && !${C}`}}function p(){const h=w.formats[l];if(!h){u();return}if(h===!0)return;const[c,d,b]=_(h);c===a&&n.pass(T());function u(){if($.strictSchema===!1){w.logger.warn(C());return}throw new Error(C());function C(){return`unknown format "${l}" ignored in schema at path "${y}"`}}function _(C){const j=C instanceof RegExp?(0,e.regexpCode)(C):$.code.formats?(0,e._)`${$.code.formats}${(0,e.getProperty)(l)}`:void 0,L=s.scopeValue("formats",{key:l,ref:C,code:j});return typeof C=="object"&&!(C instanceof RegExp)?[C.type||"string",C.validate,(0,e._)`${L}.validate`]:["string",C,L]}function T(){if(typeof h=="object"&&!(h instanceof RegExp)&&h.async){if(!v.$async)throw new Error("async format in sync schema");return(0,e._)`await ${b}(${o})`}return typeof d=="function"?(0,e._)`${b}(${o})`:(0,e._)`${b}.test(${o})`}}}};return yr.default=r,yr}var ds;function cm(){if(ds)return gr;ds=1,Object.defineProperty(gr,"__esModule",{value:!0});const t=[im().default];return gr.default=t,gr}var it={},fs;function lm(){return fs||(fs=1,Object.defineProperty(it,"__esModule",{value:!0}),it.contentVocabulary=it.metadataVocabulary=void 0,it.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"],it.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]),it}var ps;function um(){if(ps)return Lt;ps=1,Object.defineProperty(Lt,"__esModule",{value:!0});const e=qp(),t=Kp(),r=om(),n=cm(),a=lm(),s=[e.default,t.default,(0,r.default)(),n.default,a.metadataVocabulary,a.contentVocabulary];return Lt.default=s,Lt}var vr={},$t={},ms;function dm(){if(ms)return $t;ms=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.DiscrError=void 0;var e;return(function(t){t.Tag="tag",t.Mapping="mapping"})(e||($t.DiscrError=e={})),$t}var hs;function fm(){if(hs)return vr;hs=1,Object.defineProperty(vr,"__esModule",{value:!0});const e=Y(),t=dm(),r=Mn(),n=Mr(),a=ae(),o={keyword:"discriminator",type:"object",schemaType:"object",error:{message:({params:{discrError:i,tagName:l}})=>i===t.DiscrError.Tag?`tag "${l}" must be string`:`value of tag "${l}" must be in oneOf`,params:({params:{discrError:i,tag:l,tagName:m}})=>(0,e._)`{error: ${i}, tag: ${m}, tagValue: ${l}}`},code(i){const{gen:l,data:m,schema:f,parentSchema:$,it:y}=i,{oneOf:v}=$;if(!y.opts.discriminator)throw new Error("discriminator: requires discriminator option");const w=f.propertyName;if(typeof w!="string")throw new Error("discriminator: requires propertyName");if(f.mapping)throw new Error("discriminator: mapping is not supported");if(!v)throw new Error("discriminator: requires oneOf keyword");const S=l.let("valid",!1),p=l.const("tag",(0,e._)`${m}${(0,e.getProperty)(w)}`);l.if((0,e._)`typeof ${p} == "string"`,()=>h(),()=>i.error(!1,{discrError:t.DiscrError.Tag,tag:p,tagName:w})),i.ok(S);function h(){const b=d();l.if(!1);for(const u in b)l.elseIf((0,e._)`${p} === ${u}`),l.assign(S,c(b[u]));l.else(),i.error(!1,{discrError:t.DiscrError.Mapping,tag:p,tagName:w}),l.endIf()}function c(b){const u=l.name("valid"),_=i.subschema({keyword:"oneOf",schemaProp:b},u);return i.mergeEvaluated(_,e.Name),u}function d(){var b;const u={},_=C($);let T=!0;for(let A=0;A<v.length;A++){let z=v[A];if(z?.$ref&&!(0,a.schemaHasRulesButRef)(z,y.self.RULES)){const F=z.$ref;if(z=r.resolveRef.call(y.self,y.schemaEnv.root,y.baseId,F),z instanceof r.SchemaEnv&&(z=z.schema),z===void 0)throw new n.default(y.opts.uriResolver,y.baseId,F)}const Z=(b=z?.properties)===null||b===void 0?void 0:b[w];if(typeof Z!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${w}"`);T=T&&(_||C(z)),j(Z,A)}if(!T)throw new Error(`discriminator: "${w}" must be required`);return u;function C({required:A}){return Array.isArray(A)&&A.includes(w)}function j(A,z){if(A.const)L(A.const,z);else if(A.enum)for(const Z of A.enum)L(Z,z);else throw new Error(`discriminator: "properties/${w}" must have "const" or "enum"`)}function L(A,z){if(typeof A!="string"||A in u)throw new Error(`discriminator: "${w}" values must be unique strings`);u[A]=z}}}};return vr.default=o,vr}const pm="http://json-schema.org/draft-07/schema#",mm="http://json-schema.org/draft-07/schema#",hm="Core schema meta-schema",gm={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},ym=["object","boolean"],vm={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},_m={$schema:pm,$id:mm,title:hm,definitions:gm,type:ym,properties:vm,default:!0};var gs;function Co(){return gs||(gs=1,(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRefError=t.ValidationError=t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=t.Ajv=void 0;const r=Cp(),n=um(),a=fm(),s=_m,o=["/properties"],i="http://json-schema.org/draft-07/schema";class l extends r.default{_addVocabularies(){super._addVocabularies(),n.default.forEach(w=>this.addVocabulary(w)),this.opts.discriminator&&this.addKeyword(a.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const w=this.opts.$data?this.$dataMetaSchema(s,o):s;this.addMetaSchema(w,i,!1),this.refs["http://json-schema.org/schema"]=i}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(i)?i:void 0)}}t.Ajv=l,e.exports=t=l,e.exports.Ajv=l,Object.defineProperty(t,"__esModule",{value:!0}),t.default=l;var m=qr();Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return m.KeywordCxt}});var f=Y();Object.defineProperty(t,"_",{enumerable:!0,get:function(){return f._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return f.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return f.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return f.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return f.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return f.CodeGen}});var $=qn();Object.defineProperty(t,"ValidationError",{enumerable:!0,get:function(){return $.default}});var y=Mr();Object.defineProperty(t,"MissingRefError",{enumerable:!0,get:function(){return y.default}})})(Mt,Mt.exports)),Mt.exports}var wm=Co();const bm=qs(wm);var _r={exports:{}},Xr={},ys;function $m(){return ys||(ys=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.formatNames=e.fastFormats=e.fullFormats=void 0;function t(A,z){return{validate:A,compare:z}}e.fullFormats={date:t(s,o),time:t(l(!0),m),"date-time":t(y(!0),v),"iso-time":t(l(),f),"iso-date-time":t(y(),w),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:h,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:L,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:d,int32:{type:"number",validate:_},int64:{type:"number",validate:T},float:{type:"number",validate:C},double:{type:"number",validate:C},password:!0,binary:!0},e.fastFormats={...e.fullFormats,date:t(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,o),time:t(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,m),"date-time":t(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,v),"iso-time":t(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,f),"iso-date-time":t(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,w),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i},e.formatNames=Object.keys(e.fullFormats);function r(A){return A%4===0&&(A%100!==0||A%400===0)}const n=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,a=[0,31,28,31,30,31,30,31,31,30,31,30,31];function s(A){const z=n.exec(A);if(!z)return!1;const Z=+z[1],F=+z[2],ie=+z[3];return F>=1&&F<=12&&ie>=1&&ie<=(F===2&&r(Z)?29:a[F])}function o(A,z){if(A&&z)return A>z?1:A<z?-1:0}const i=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function l(A){return function(Z){const F=i.exec(Z);if(!F)return!1;const ie=+F[1],Re=+F[2],Oe=+F[3],ue=F[4],Fe=F[5]==="-"?-1:1,D=+(F[6]||0),k=+(F[7]||0);if(D>23||k>59||A&&!ue)return!1;if(ie<=23&&Re<=59&&Oe<60)return!0;const M=Re-k*Fe,O=ie-D*Fe-(M<0?1:0);return(O===23||O===-1)&&(M===59||M===-1)&&Oe<61}}function m(A,z){if(!(A&&z))return;const Z=new Date("2020-01-01T"+A).valueOf(),F=new Date("2020-01-01T"+z).valueOf();if(Z&&F)return Z-F}function f(A,z){if(!(A&&z))return;const Z=i.exec(A),F=i.exec(z);if(Z&&F)return A=Z[1]+Z[2]+Z[3],z=F[1]+F[2]+F[3],A>z?1:A<z?-1:0}const $=/t|\s/i;function y(A){const z=l(A);return function(F){const ie=F.split($);return ie.length===2&&s(ie[0])&&z(ie[1])}}function v(A,z){if(!(A&&z))return;const Z=new Date(A).valueOf(),F=new Date(z).valueOf();if(Z&&F)return Z-F}function w(A,z){if(!(A&&z))return;const[Z,F]=A.split($),[ie,Re]=z.split($),Oe=o(Z,ie);if(Oe!==void 0)return Oe||m(F,Re)}const S=/\/|:/,p=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function h(A){return S.test(A)&&p.test(A)}const c=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function d(A){return c.lastIndex=0,c.test(A)}const b=-2147483648,u=2**31-1;function _(A){return Number.isInteger(A)&&A<=u&&A>=b}function T(A){return Number.isInteger(A)}function C(){return!0}const j=/[^\\]\\Z/;function L(A){if(j.test(A))return!1;try{return new RegExp(A),!0}catch{return!1}}})(Xr)),Xr}var en={},vs;function Sm(){return vs||(vs=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.formatLimitDefinition=void 0;const t=Co(),r=Y(),n=r.operators,a={formatMaximum:{okStr:"<=",ok:n.LTE,fail:n.GT},formatMinimum:{okStr:">=",ok:n.GTE,fail:n.LT},formatExclusiveMaximum:{okStr:"<",ok:n.LT,fail:n.GTE},formatExclusiveMinimum:{okStr:">",ok:n.GT,fail:n.LTE}},s={message:({keyword:i,schemaCode:l})=>(0,r.str)`should be ${a[i].okStr} ${l}`,params:({keyword:i,schemaCode:l})=>(0,r._)`{comparison: ${a[i].okStr}, limit: ${l}}`};e.formatLimitDefinition={keyword:Object.keys(a),type:"string",schemaType:"string",$data:!0,error:s,code(i){const{gen:l,data:m,schemaCode:f,keyword:$,it:y}=i,{opts:v,self:w}=y;if(!v.validateFormats)return;const S=new t.KeywordCxt(y,w.RULES.all.format.definition,"format");S.$data?p():h();function p(){const d=l.scopeValue("formats",{ref:w.formats,code:v.code.formats}),b=l.const("fmt",(0,r._)`${d}[${S.schemaCode}]`);i.fail$data((0,r.or)((0,r._)`typeof ${b} != "object"`,(0,r._)`${b} instanceof RegExp`,(0,r._)`typeof ${b}.compare != "function"`,c(b)))}function h(){const d=S.schema,b=w.formats[d];if(!b||b===!0)return;if(typeof b!="object"||b instanceof RegExp||typeof b.compare!="function")throw new Error(`"${$}": format "${d}" does not define "compare" function`);const u=l.scopeValue("formats",{key:d,ref:b,code:v.code.formats?(0,r._)`${v.code.formats}${(0,r.getProperty)(d)}`:void 0});i.fail$data(c(u))}function c(d){return(0,r._)`${d}.compare(${m}, ${f}) ${a[$].fail} 0`}},dependencies:["format"]};const o=i=>(i.addKeyword(e.formatLimitDefinition),i);e.default=o})(en)),en}var _s;function Tm(){return _s||(_s=1,(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const r=$m(),n=Sm(),a=Y(),s=new a.Name("fullFormats"),o=new a.Name("fastFormats"),i=(m,f={keywords:!0})=>{if(Array.isArray(f))return l(m,f,r.fullFormats,s),m;const[$,y]=f.mode==="fast"?[r.fastFormats,o]:[r.fullFormats,s],v=f.formats||r.formatNames;return l(m,v,$,y),f.keywords&&(0,n.default)(m),m};i.get=(m,f="full")=>{const y=(f==="fast"?r.fastFormats:r.fullFormats)[m];if(!y)throw new Error(`Unknown format "${m}"`);return y};function l(m,f,$,y){var v,w;(v=(w=m.opts.code).formats)!==null&&v!==void 0||(w.formats=(0,a._)`require("ajv-formats/dist/formats").${y}`);for(const S of f)m.addFormat(S,$[S])}e.exports=t=i,Object.defineProperty(t,"__esModule",{value:!0}),t.default=i})(_r,_r.exports)),_r.exports}var Pm=Tm();const Em=qs(Pm);function km(){const e=new bm({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return Em(e),e}class Rm{constructor(t){this._ajv=t??km()}getValidator(t){const r="$id"in t&&typeof t.$id=="string"?this._ajv.getSchema(t.$id)??this._ajv.compile(t):this._ajv.compile(t);return n=>r(n)?{valid:!0,data:n,errorMessage:void 0}:{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(r.errors)}}}function Om(e,t,r){if(!e)throw new Error(`${r} does not support task creation (required for ${t})`);switch(t){case"tools/call":if(!e.tools?.call)throw new Error(`${r} does not support task creation for tools/call (required for ${t})`);break}}function Im(e,t,r){if(!e)throw new Error(`${r} does not support task creation (required for ${t})`);switch(t){case"sampling/createMessage":if(!e.sampling?.createMessage)throw new Error(`${r} does not support task creation for sampling/createMessage (required for ${t})`);break;case"elicitation/create":if(!e.elicitation?.create)throw new Error(`${r} does not support task creation for elicitation/create (required for ${t})`);break}}class Cm{constructor(t){this._server=t}requestStream(t,r,n){return this._server.requestStream(t,r,n)}async getTask(t,r){return this._server.getTask({taskId:t},r)}async getTaskResult(t,r,n){return this._server.getTaskResult({taskId:t},r,n)}async listTasks(t,r){return this._server.listTasks(t?{cursor:t}:void 0,r)}async cancelTask(t,r){return this._server.cancelTask({taskId:t},r)}}class tn extends mp{constructor(t,r){super(r),this._serverInfo=t,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map($r.options.map((n,a)=>[n,a])),this.isMessageIgnored=(n,a)=>{const s=this._loggingLevels.get(a);return s?this.LOG_LEVEL_SEVERITY.get(n)<this.LOG_LEVEL_SEVERITY.get(s):!1},this._capabilities=r?.capabilities??{},this._instructions=r?.instructions,this._jsonSchemaValidator=r?.jsonSchemaValidator??new Rm,this.setRequestHandler(to,n=>this._oninitialize(n)),this.setNotificationHandler(ro,()=>this.oninitialized?.()),this._capabilities.logging&&this.setRequestHandler(mo,async(n,a)=>{const s=a.sessionId||a.requestInfo?.headers["mcp-session-id"]||void 0,{level:o}=n.params,i=$r.safeParse(o);return i.success&&this._loggingLevels.set(s,i.data),{}})}get experimental(){return this._experimental||(this._experimental={tasks:new Cm(this)}),this._experimental}registerCapabilities(t){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=hp(this._capabilities,t)}setRequestHandler(t,r){const a=Ms(t)?.method;if(!a)throw new Error("Schema is missing a method literal");let s;if(Rr(a)){const i=a;s=i._zod?.def?.value??i.value}else{const i=a;s=i._def?.value??i.value}if(typeof s!="string")throw new Error("Schema method literal must be a string");if(s==="tools/call"){const i=async(l,m)=>{const f=Tt(An,l);if(!f.success){const w=f.error instanceof Error?f.error.message:String(f.error);throw new ee(ne.InvalidParams,`Invalid tools/call request: ${w}`)}const{params:$}=f.data,y=await Promise.resolve(r(l,m));if($.task){const w=Tt(Cr,y);if(!w.success){const S=w.error instanceof Error?w.error.message:String(w.error);throw new ee(ne.InvalidParams,`Invalid task creation result: ${S}`)}return w.data}const v=Tt(Nn,y);if(!v.success){const w=v.error instanceof Error?v.error.message:String(v.error);throw new ee(ne.InvalidParams,`Invalid tools/call result: ${w}`)}return v.data};return super.setRequestHandler(t,i)}return super.setRequestHandler(t,r)}assertCapabilityForMethod(t){switch(t){case"sampling/createMessage":if(!this._clientCapabilities?.sampling)throw new Error(`Client does not support sampling (required for ${t})`);break;case"elicitation/create":if(!this._clientCapabilities?.elicitation)throw new Error(`Client does not support elicitation (required for ${t})`);break;case"roots/list":if(!this._clientCapabilities?.roots)throw new Error(`Client does not support listing roots (required for ${t})`);break}}assertNotificationCapability(t){switch(t){case"notifications/message":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${t})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw new Error(`Server does not support notifying about resources (required for ${t})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw new Error(`Server does not support notifying of tool list changes (required for ${t})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw new Error(`Server does not support notifying of prompt list changes (required for ${t})`);break;case"notifications/elicitation/complete":if(!this._clientCapabilities?.elicitation?.url)throw new Error(`Client does not support URL elicitation (required for ${t})`);break}}assertRequestHandlerCapability(t){if(this._capabilities)switch(t){case"completion/complete":if(!this._capabilities.completions)throw new Error(`Server does not support completions (required for ${t})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${t})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw new Error(`Server does not support prompts (required for ${t})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw new Error(`Server does not support resources (required for ${t})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw new Error(`Server does not support tools (required for ${t})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Server does not support tasks capability (required for ${t})`);break}}assertTaskCapability(t){Im(this._clientCapabilities?.tasks?.requests,t,"Client")}assertTaskHandlerCapability(t){this._capabilities&&Om(this._capabilities.tasks?.requests,t,"Server")}async _oninitialize(t){const r=t.params.protocolVersion;return this._clientCapabilities=t.params.capabilities,this._clientVersion=t.params.clientInfo,{protocolVersion:Wu.includes(r)?r:Ws,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},gn)}async createMessage(t,r){if((t.tools||t.toolChoice)&&!this._clientCapabilities?.sampling?.tools)throw new Error("Client does not support sampling tools capability.");if(t.messages.length>0){const n=t.messages[t.messages.length-1],a=Array.isArray(n.content)?n.content:[n.content],s=a.some(m=>m.type==="tool_result"),o=t.messages.length>1?t.messages[t.messages.length-2]:void 0,i=o?Array.isArray(o.content)?o.content:[o.content]:[],l=i.some(m=>m.type==="tool_use");if(s){if(a.some(m=>m.type!=="tool_result"))throw new Error("The last message must contain only tool_result content if any is present");if(!l)throw new Error("tool_result blocks are not matching any tool_use from the previous message")}if(l){const m=new Set(i.filter($=>$.type==="tool_use").map($=>$.id)),f=new Set(a.filter($=>$.type==="tool_result").map($=>$.toolUseId));if(m.size!==f.size||![...m].every($=>f.has($)))throw new Error("ids of tool_result blocks and tool_use blocks from previous message do not match")}}return t.tools?this.request({method:"sampling/createMessage",params:t},go,r):this.request({method:"sampling/createMessage",params:t},ho,r)}async elicitInput(t,r){switch(t.mode??"form"){case"url":{if(!this._clientCapabilities?.elicitation?.url)throw new Error("Client does not support url elicitation.");const a=t;return this.request({method:"elicitation/create",params:a},ln,r)}case"form":{if(!this._clientCapabilities?.elicitation?.form)throw new Error("Client does not support form elicitation.");const a=t.mode==="form"?t:{...t,mode:"form"},s=await this.request({method:"elicitation/create",params:a},ln,r);if(s.action==="accept"&&s.content&&a.requestedSchema)try{const i=this._jsonSchemaValidator.getValidator(a.requestedSchema)(s.content);if(!i.valid)throw new ee(ne.InvalidParams,`Elicitation response content does not match requested schema: ${i.errorMessage}`)}catch(o){throw o instanceof ee?o:new ee(ne.InternalError,`Error validating elicitation response: ${o instanceof Error?o.message:String(o)}`)}return s}}}createElicitationCompletionNotifier(t,r){if(!this._clientCapabilities?.elicitation?.url)throw new Error("Client does not support URL elicitation (required for notifications/elicitation/complete)");return()=>this.notification({method:"notifications/elicitation/complete",params:{elicitationId:t}},r)}async listRoots(t,r){return this.request({method:"roots/list",params:t},yo,r)}async sendLoggingMessage(t,r){if(this._capabilities.logging&&!this.isMessageIgnored(t.level,r))return this.notification({method:"notifications/message",params:t})}async sendResourceUpdated(t){return this.notification({method:"notifications/resources/updated",params:t})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}}var ws;(function(e){e.Completable="McpCompletable"})(ws||(ws={}));(function(e){return e.START="start",e.STARTED="started",e.STOP="stop",e.STOPPED="stopped",e.PING="ping",e.PONG="pong",e.ERROR="error",e.LIST_TOOLS="list_tools",e.CALL_TOOL="call_tool",e.TOOL_LIST_UPDATED="tool_list_updated",e.TOOL_LIST_UPDATED_ACK="tool_list_updated_ack",e.PROCESS_DATA="process_data",e.SERVER_STARTED="server_started",e.SERVER_STOPPED="server_stopped",e.ERROR_FROM_NATIVE_HOST="error_from_native_host",e.CONNECT_NATIVE="connectNative",e.PING_NATIVE="ping_native",e.DISCONNECT_NATIVE="disconnect_native",e})({});var Nm=class{_started=!1;_allowedOrigins;_channelId;_messageHandler;_clientOrigin;_serverReadyTimeout;_serverReadyRetryMs;onclose;onerror;onmessage;constructor(e){if(!e.allowedOrigins||e.allowedOrigins.length===0)throw Error("At least one allowed origin must be specified");this._allowedOrigins=e.allowedOrigins,this._channelId=e.channelId||"mcp-iframe",this._serverReadyRetryMs=e.serverReadyRetryMs??250}async start(){if(this._started)throw Error("Transport already started");this._messageHandler=e=>{if(!this._allowedOrigins.includes(e.origin)&&!this._allowedOrigins.includes("*")||e.data?.channel!==this._channelId||e.data?.type!=="mcp"||e.data?.direction!=="client-to-server")return;this._clientOrigin=e.origin;let t=e.data.payload;if(typeof t=="string"&&t==="mcp-check-ready"){this.broadcastServerReady();return}try{let r=Xs.parse(t);this.onmessage?.(r)}catch(r){this.onerror?.(Error(`Invalid message: ${r instanceof Error?r.message:String(r)}`))}},window.addEventListener("message",this._messageHandler),this._started=!0,this.broadcastServerReady()}broadcastServerReady(){window.parent&&window.parent!==window?(window.parent.postMessage({channel:this._channelId,type:"mcp",direction:"server-to-client",payload:"mcp-server-ready"},"*"),this.clearServerReadyRetry()):this.scheduleServerReadyRetry()}scheduleServerReadyRetry(){this._serverReadyTimeout||=setTimeout(()=>{this._serverReadyTimeout=void 0,this._started&&this.broadcastServerReady()},this._serverReadyRetryMs)}clearServerReadyRetry(){this._serverReadyTimeout&&=(clearTimeout(this._serverReadyTimeout),void 0)}async send(e){if(!this._started)throw Error("Transport not started");if(!this._clientOrigin){console.warn("[IframeChildTransport] No client connected, message not sent");return}window.parent&&window.parent!==window?window.parent.postMessage({channel:this._channelId,type:"mcp",direction:"server-to-client",payload:e},this._clientOrigin):console.warn("[IframeChildTransport] Not running in an iframe, message not sent")}async close(){this._messageHandler&&window.removeEventListener("message",this._messageHandler),this._started=!1,this._clientOrigin&&window.parent&&window.parent!==window&&window.parent.postMessage({channel:this._channelId,type:"mcp",direction:"server-to-client",payload:"mcp-server-stopped"},"*"),this.clearServerReadyRetry(),this.onclose?.()}},Am=class{_started=!1;_allowedOrigins;_channelId;_messageHandler;_clientOrigin;_beforeUnloadHandler;_cleanupInterval;_pendingRequests=new Map;REQUEST_TIMEOUT_MS=3e5;onclose;onerror;onmessage;constructor(e){if(!e.allowedOrigins||e.allowedOrigins.length===0)throw Error("At least one allowed origin must be specified");this._allowedOrigins=e.allowedOrigins,this._channelId=e.channelId||"mcp-default"}async start(){if(this._started)throw Error("Transport already started");this._messageHandler=e=>{if(!this._allowedOrigins.includes(e.origin)&&!this._allowedOrigins.includes("*")||e.data?.channel!==this._channelId||e.data?.type!=="mcp"||e.data?.direction!=="client-to-server")return;this._clientOrigin=e.origin;let t=e.data.payload;if(typeof t=="string"&&t==="mcp-check-ready"){window.postMessage({channel:this._channelId,type:"mcp",direction:"server-to-client",payload:"mcp-server-ready"},this._clientOrigin);return}try{let r=Xs.parse(t);"method"in r&&"id"in r&&r.id!==void 0&&this._pendingRequests.set(r.id,{request:r,receivedAt:Date.now(),interruptedSent:!1}),this.onmessage?.(r)}catch(r){this.onerror?.(Error(`Invalid message: ${r instanceof Error?r.message:String(r)}`))}},window.addEventListener("message",this._messageHandler),this._started=!0,this._beforeUnloadHandler=()=>{this._handleBeforeUnload()},window.addEventListener("beforeunload",this._beforeUnloadHandler),this._cleanupInterval=setInterval(()=>{this._cleanupStaleRequests()},6e4),window.postMessage({channel:this._channelId,type:"mcp",direction:"server-to-client",payload:"mcp-server-ready"},"*")}async send(e){if(!this._started)throw Error("Transport not started");if(("result"in e||"error"in e)&&e.id!==void 0){if(this._pendingRequests.get(e.id)?.interruptedSent){console.debug(`[TabServerTransport] Suppressing response for ${e.id} - interrupted response already sent`),this._pendingRequests.delete(e.id);return}this._pendingRequests.delete(e.id)}let t=this._clientOrigin||"*";this._clientOrigin||console.debug("[TabServerTransport] Sending to unknown client origin (backwards compatibility mode)"),window.postMessage({channel:this._channelId,type:"mcp",direction:"server-to-client",payload:e},t)}_handleBeforeUnload(){let e=Array.from(this._pendingRequests.entries()).reverse();for(let[t,r]of e){r.interruptedSent=!0;let n={jsonrpc:"2.0",id:t,result:{content:[{type:"text",text:"Tool execution interrupted by page navigation"}],metadata:{navigationInterrupted:!0,originalMethod:"method"in r.request?r.request.method:"unknown",timestamp:Date.now()}}};try{window.postMessage({channel:this._channelId,type:"mcp",direction:"server-to-client",payload:n},this._clientOrigin||"*")}catch(a){console.error("[TabServerTransport] Failed to send beforeunload response:",a)}}this._pendingRequests.clear()}_cleanupStaleRequests(){let e=Date.now(),t=[];for(let[r,n]of this._pendingRequests)e-n.receivedAt>this.REQUEST_TIMEOUT_MS&&t.push(r);if(t.length>0){console.warn(`[TabServerTransport] Cleaning up ${t.length} stale requests`);for(let r of t)this._pendingRequests.delete(r)}}async close(){this._messageHandler&&window.removeEventListener("message",this._messageHandler),this._beforeUnloadHandler&&window.removeEventListener("beforeunload",this._beforeUnloadHandler),this._cleanupInterval!==void 0&&clearInterval(this._cleanupInterval),this._pendingRequests.clear(),this._started=!1,window.postMessage({channel:this._channelId,type:"mcp",direction:"server-to-client",payload:"mcp-server-stopped"},"*"),this.onclose?.()}};const qm=e=>[e.slice(0,e.length/2),e.slice(e.length/2)],St=Symbol("Original index"),Mm=e=>{const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(typeof n=="boolean")t.push(n?{[St]:r}:{[St]:r,not:{}});else{if(St in n)return e;t.push({...n,[St]:r})}}return t};function kr(e,t){if(e.allOf.length===0)return dn();if(e.allOf.length===1){const a=e.allOf[0];return we(a,{...t,path:[...t.path,"allOf",a[St]]})}const[r,n]=qm(Mm(e.allOf));return Ol(kr({allOf:r},t),kr({allOf:n},t))}const No=(e,t)=>e.anyOf.length?e.anyOf.length===1?we(e.anyOf[0],{...t,path:[...t.path,"anyOf",0]}):tt(e.anyOf.map((r,n)=>we(r,{...t,path:[...t.path,"anyOf",n]}))):rt();function ye(e,t,r,n){const a=t[r];if(a!==void 0){const s=t.errorMessage?.[r];return n(e,a,s)}return e}const _e={an:{object:e=>e.type==="object"||!e.type&&(e.properties!==void 0||e.additionalProperties!==void 0||e.patternProperties!==void 0),array:e=>e.type==="array",anyOf:e=>e.anyOf!==void 0,allOf:e=>e.allOf!==void 0,enum:e=>e.enum!==void 0},a:{nullable:e=>e.nullable===!0,multipleType:e=>Array.isArray(e.type),not:e=>e.not!==void 0,const:e=>e.const!==void 0,primitive:(e,t)=>e.type===t,conditional:e=>!!("if"in e&&e.if&&"then"in e&&"else"in e&&e.then&&e.else),oneOf:e=>e.oneOf!==void 0}},jm=(e,t)=>{if(_e.an.anyOf(e)){const n=new Set,a=[];e.anyOf.forEach(i=>{if(typeof i=="object"&&i.type&&n.add(typeof i.type=="string"?i.type:i.type[0]),typeof i=="object"&&i.items){const l=i.items;!Array.isArray(l)&&typeof l=="object"&&a.push(l)}});let s;a.length===1?s=a[0]:a.length>1&&(s={anyOf:a});const o={...n.size>0?{type:Array.from(n)}:{type:"array"},...s&&{items:s}};return["default","description","examples","title"].forEach(i=>{const l=e[i];l!==void 0&&(o[i]=l)}),we(o,t)}if(Array.isArray(e.items))return Rl(e.items.map((n,a)=>we(n,{...t,path:[...t.path,"items",a]})));let r=e.items?Jn(we(e.items,{...t,path:[...t.path,"items"]})):Jn(rt());return r=ye(r,e,"minItems",(n,a,s)=>n.min(a,s)),r=ye(r,e,"maxItems",(n,a,s)=>n.max(a,s)),typeof e.min=="number"&&typeof e.minItems!="number"&&(r=ye(r,{...e,minItems:e.min},"minItems",(n,a,s)=>n.min(a,s))),typeof e.max=="number"&&typeof e.maxItems!="number"&&(r=ye(r,{...e,maxItems:e.max},"maxItems",(n,a,s)=>n.max(a,s))),r},Dm=e=>Al(),xm=e=>sn(e.const),zm=e=>rt(),Lm=e=>e.enum.length===0?dn():e.enum.length===1?sn(e.enum[0]):e.enum.every(t=>typeof t=="string")?Il(e.enum):tt(e.enum.map(t=>sn(t))),Um=(e,t)=>{const r=we(e.if,{...t,path:[...t.path,"if"]}),n=we(e.then,{...t,path:[...t.path,"then"]}),a=we(e.else,{...t,path:[...t.path,"else"]});return tt([n,a]).superRefine((s,o)=>{const i=r.safeParse(s).success?n.safeParse(s):a.safeParse(s);i.success||i.error.errors.forEach(l=>o.addIssue(l))})},Zm=(e,t)=>tt(e.type.map(r=>we({...e,type:r},t))),Fm=(e,t)=>rt().refine(r=>!we(e.not,{...t,path:[...t.path,"not"]}).safeParse(r).success,"Invalid input: Should NOT be valid against schema"),Vm=e=>ql(),rn=(e,...t)=>Object.keys(e).reduce((r,n)=>(t.includes(n)||(r[n]=e[n]),r),{}),Hm=(e,t)=>{const r=e.default===null,n=we(r?rn(rn(e,"nullable"),"default"):rn(e,"nullable"),t,!0).nullable();return r?n.default(null):n},Km=e=>{let t=Nl(),r=!1;return e.type==="integer"?(r=!0,t=ye(t,e,"type",(n,a,s)=>n.int(s))):e.format==="int64"&&(r=!0,t=ye(t,e,"format",(n,a,s)=>n.int(s))),t=ye(t,e,"multipleOf",(n,a,s)=>a===1?r?n:n.int(s):n.multipleOf(a,s)),typeof e.minimum=="number"?e.exclusiveMinimum===!0?t=ye(t,e,"minimum",(n,a,s)=>n.gt(a,s)):t=ye(t,e,"minimum",(n,a,s)=>n.gte(a,s)):typeof e.exclusiveMinimum=="number"&&(t=ye(t,e,"exclusiveMinimum",(n,a,s)=>n.gt(a,s))),typeof e.maximum=="number"?e.exclusiveMaximum===!0?t=ye(t,e,"maximum",(n,a,s)=>n.lt(a,s)):t=ye(t,e,"maximum",(n,a,s)=>n.lte(a,s)):typeof e.exclusiveMaximum=="number"&&(t=ye(t,e,"exclusiveMaximum",(n,a,s)=>n.lt(a,s))),typeof e.min=="number"&&typeof e.minimum!="number"&&(t=ye(t,{...e,minimum:e.min},"minimum",(n,a,s)=>n.gte(a,s))),typeof e.max=="number"&&typeof e.maximum!="number"&&(t=ye(t,{...e,maximum:e.max},"maximum",(n,a,s)=>n.lte(a,s))),t},Ao=(e,t)=>e.oneOf.length?e.oneOf.length===1?we(e.oneOf[0],{...t,path:[...t.path,"oneOf",0]}):rt().superRefine((r,n)=>{const a=e.oneOf.map((o,i)=>we(o,{...t,path:[...t.path,"oneOf",i]})),s=a.reduce((o,i)=>(l=>l.error?[...o,l.error]:o)(i.safeParse(r)),[]);a.length-s.length!==1&&n.addIssue({path:n.path,code:"invalid_union",unionErrors:s,message:"Invalid input: Should pass single schema"})}):rt();function Jm(e,t){if(!e.properties)return gt({});const r=Object.keys(e.properties);if(r.length===0)return gt({});const n={};for(const a of r){const s=e.properties[a],o=we(s,{...t,path:[...t.path,"properties",a]}),i=Array.isArray(e.required)?e.required.includes(a):!1;if(!i&&s&&typeof s=="object"&&"default"in s)if(s.default===null){const l=s.anyOf&&Array.isArray(s.anyOf)&&s.anyOf.some($=>typeof $=="object"&&$!==null&&$.type==="null"),m=s.oneOf&&Array.isArray(s.oneOf)&&s.oneOf.some($=>typeof $=="object"&&$!==null&&$.type==="null"),f="nullable"in s&&s.nullable===!0;l||m||f?n[a]=o.optional().default(null):n[a]=o.nullable().optional().default(null)}else n[a]=o.optional().default(s.default);else n[a]=i?o:o.optional()}return gt(n)}function Wm(e,t){const r=Object.keys(e.patternProperties??{}).length>0,n=e.type==="object"?e:{...e},a=Jm(n,t);let s=a;const o=n.additionalProperties!==void 0?we(n.additionalProperties,{...t,path:[...t.path,"additionalProperties"]}):void 0,i=n.additionalProperties===!0;if(n.patternProperties){const m=Object.fromEntries(Object.entries(n.patternProperties).map(([y,v])=>[y,we(v,{...t,path:[...t.path,"patternProperties",y]})])),f=Object.values(m);a?o?s=a.catchall(tt([...f,o])):Object.keys(m).length>1?s=a.catchall(tt(f)):s=a.catchall(f[0]):o?s=Nt(tt([...f,o])):f.length>1?s=Nt(tt(f)):s=Nt(f[0]);const $=new Set(Object.keys(n.properties??{}));s=s.superRefine((y,v)=>{for(const w in y){let S=$.has(w);for(const p in n.patternProperties){const h=new RegExp(p);if(w.match(h)){S=!0;const c=m[p].safeParse(y[w]);c.success||v.addIssue({path:[...v.path,w],code:"custom",message:`Invalid input: Key matching regex /${w}/ must match schema`,params:{issues:c.error.issues}})}}if(!S&&o){const p=o.safeParse(y[w]);p.success||v.addIssue({path:[...v.path,w],code:"custom",message:"Invalid input: must match catchall schema",params:{issues:p.error.issues}})}}})}let l;return a?r?l=s:o?o instanceof Kn?l=a.strict():i?l=a.passthrough():l=a.catchall(o):l=a.strict():r?l=s:o?o instanceof Kn?l=gt({}).strict():i?l=gt({}).passthrough():l=Nt(o):l=gt({}).passthrough(),_e.an.anyOf(e)&&(l=l.and(No({...e,anyOf:e.anyOf.map(m=>typeof m=="object"&&!m.type&&(m.properties??m.additionalProperties??m.patternProperties)?{...m,type:"object"}:m)},t))),_e.a.oneOf(e)&&(l=l.and(Ao({...e,oneOf:e.oneOf.map(m=>typeof m=="object"&&!m.type&&(m.properties??m.additionalProperties??m.patternProperties)?{...m,type:"object"}:m)},t))),_e.an.allOf(e)&&(l=l.and(kr({...e,allOf:e.allOf.map(m=>typeof m=="object"&&!m.type&&(m.properties??m.additionalProperties??m.patternProperties)?{...m,type:"object"}:m)},t))),l}const Bm=e=>{let t=Cl();return t=ye(t,e,"format",(r,n,a)=>{switch(n){case"email":return r.email(a);case"ip":return r.ip(a);case"ipv4":return r.ip({version:"v4",message:a});case"ipv6":return r.ip({version:"v6",message:a});case"uri":return r.url(a);case"uuid":return r.uuid(a);case"date-time":return r.datetime({offset:!0,message:a});case"time":return r.time(a);case"date":return r.date(a);case"binary":return r.base64(a);case"duration":return r.duration(a);default:return r}}),t=ye(t,e,"contentEncoding",(r,n,a)=>r.base64(a)),t=ye(t,e,"pattern",(r,n,a)=>r.regex(new RegExp(n),a)),t=ye(t,e,"minLength",(r,n,a)=>r.min(n,a)),t=ye(t,e,"maxLength",(r,n,a)=>r.max(n,a)),typeof e.min=="number"&&typeof e.minLength!="number"&&(t=ye(t,{...e,minLength:e.min},"minLength",(r,n,a)=>r.min(n,a))),typeof e.max=="number"&&typeof e.maxLength!="number"&&(t=ye(t,{...e,maxLength:e.max},"maxLength",(r,n,a)=>r.max(n,a))),t},Gm=(e,t)=>{let r="";if(e.description?r=e.description:e.title&&(r=e.title),e.example!==void 0){const n=`Example: ${JSON.stringify(e.example)}`;r=r?`${r}
${n}`:n}else if(e.examples!==void 0&&Array.isArray(e.examples)){const n=e.examples;if(n&&n.length&&n.length>0){const a=n.length===1?`Example: ${JSON.stringify(n[0])}`:`Examples:
${n.map(s=>`  ${JSON.stringify(s)}`).join(`
`)}`;r=r?`${r}
${a}`:a}}return r&&(t=t.describe(r)),t},Qm=(e,t,r)=>{if(e.default!==void 0){if(e.default===null&&r?.path.some(n=>n==="anyOf"||n==="oneOf")&&e.type&&e.type!=="null"&&!e.nullable)return t;t=t.default(e.default)}return t},Ym=(e,t)=>(e.readOnly&&(t=t.readonly()),t),Xm=(e,t)=>_e.a.nullable(e)?Hm(e,t):_e.an.object(e)?Wm(e,t):_e.an.array(e)?jm(e,t):_e.an.anyOf(e)?No(e,t):_e.an.allOf(e)?kr(e,t):_e.a.oneOf(e)?Ao(e,t):_e.a.not(e)?Fm(e,t):_e.an.enum(e)?Lm(e):_e.a.const(e)?xm(e):_e.a.multipleType(e)?Zm(e,t):_e.a.primitive(e,"string")?Bm(e):_e.a.primitive(e,"number")||_e.a.primitive(e,"integer")?Km(e):_e.a.primitive(e,"boolean")?Dm():_e.a.primitive(e,"null")?Vm():_e.a.conditional(e)?Um(e,t):zm(),we=(e,t={seen:new Map,path:[]},r)=>{if(typeof e!="object")return e?rt():dn();if(t.parserOverride){const s=t.parserOverride(e,t);if(s instanceof kl)return s}let n=t.seen.get(e);if(n){if(n.r!==void 0)return n.r;if(t.depth===void 0||n.n>=t.depth)return rt();n.n+=1}else n={r:void 0,n:0},t.seen.set(e,n);let a=Xm(e,t);return r||(t.withoutDescribes||(a=Gm(e,a)),t.withoutDefaults||(a=Qm(e,a,t)),a=Ym(e,a)),n.r=a,a},eh=(e,t={})=>we(e,{path:[],seen:new Map,...t});const th="WEBMCP_DEBUG";function rh(e){if(typeof window>"u"||!window.localStorage)return!1;try{const t=localStorage.getItem(th);return t?t==="*"?!0:t.split(",").map(r=>r.trim()).some(r=>e===r||e.startsWith(`${r}:`)):!1}catch(t){if(typeof console<"u"&&console.warn){const r=t instanceof Error?t.message:String(t);console.warn(`[WebMCP] localStorage access failed, debug logging disabled: ${r}`)}return!1}}const bs=()=>{};function dt(e){const t=`[${e}]`,r=rh(e),n=console.warn.bind(console,t),a=console.error.bind(console,t),s=console.log.bind(console,t);return{warn:n,error:a,debug:r?s:bs,info:r?s:bs}}function qo(e){return e.server}function Mo(e){const t=qo(e),r=t?.createMessage;if(!r)throw new Error("Sampling is not supported: no connected client with sampling capability");return r.bind(t)}function jo(e){const t=qo(e),r=t?.elicitInput;if(!r)throw new Error("Elicitation is not supported: no connected client with elicitation capability");return r.bind(t)}const nh=dt("WebModelContext"),$s=e=>typeof e=="object"&&e!==null,ah=e=>{const{$schema:t,...r}=e;return r},sh=e=>{const t=e._def?.typeName;return t==="ZodOptional"||t==="ZodDefault"};function oh(e){if(!$s(e)||"type"in e&&typeof e.type=="string")return!1;const t=Object.values(e);return t.length===0?!1:t.some(r=>$s(r)&&"_def"in r)}function ih(e){const t={},r=[];for(const[a,s]of Object.entries(e))t[a]=ah(fp(s,{strictUnions:!0,$refStrategy:"none"})),sh(s)||r.push(a);const n={type:"object",properties:t};return r.length>0&&(n.required=r),n}function un(e){try{return eh(e)}catch(t){return nh.warn("jsonSchemaToZod failed:",t),U({}).passthrough()}}function ut(e){if(oh(e)){const t=ih(e);return{jsonSchema:t,zodValidator:un(t)}}return{jsonSchema:e,zodValidator:un(e)}}function nn(e,t){const r=t.safeParse(e);return r.success?{success:!0,data:r.data}:{success:!1,error:`Validation failed:
${r.error.issues.map(n=>`  - ${n.path.join(".")||"root"}: ${n.message}`).join(`
`)}`}}const Xe=dt("NativeAdapter"),Ss=dt("ModelContextTesting"),Ts="__isWebMCPPolyfill",Ps="__webMCPConsumerShimInstalled",Do="__webMCPCallToolShimInstalled",ch="navigator.modelContextTesting is deprecated. Use navigator.modelContext.callTool() and addEventListener('toolschanged', ...) instead.";function lh(){if(typeof window>"u"||typeof navigator>"u")return{hasNativeContext:!1,hasNativeTesting:!1};const e=navigator.modelContext,t=navigator.modelContextTesting;return!e||!t?{hasNativeContext:!!e,hasNativeTesting:!!t}:Ts in t&&t[Ts]===!0?{hasNativeContext:!1,hasNativeTesting:!1}:{hasNativeContext:!0,hasNativeTesting:!0}}function Es(e){let t=!1;try{Object.defineProperty(window.navigator,"modelContextTesting",{configurable:!0,enumerable:!0,get(){return t||(Ss.warn(ch),t=!0),e}})}catch(r){Ss.warn("Failed to install modelContextTesting deprecation accessor:",r)}}function xo(e){try{e.dispatchEvent(new Event("toolschanged"))}catch(t){Xe.warn('Failed to dispatch "toolschanged" event:',t)}}function uh(e,t,r){const n=e;if(n[Ps]===!0)return;let a=!1;if(typeof n.callTool!="function")try{Object.defineProperty(n,"callTool",{configurable:!0,writable:!0,value:t}),a=!0}catch(s){Xe.warn("Failed to install modelContext.callTool shim:",s)}if(!r.hasNativeTesting){const s=()=>{if(r.onToolRegistryMutated){queueMicrotask(r.onToolRegistryMutated);return}queueMicrotask(()=>xo(e))},o=i=>{const l=n[i];if(typeof l=="function")try{Object.defineProperty(n,i,{configurable:!0,writable:!0,value:(...m)=>{const f=l.apply(n,m);if(i==="registerTool"&&f&&typeof f=="object"&&"unregister"in f){const $=f;if(typeof $.unregister=="function"){const y=$.unregister.bind($);$.unregister=()=>{y(),s()}}}return s(),f}})}catch(m){Xe.warn(`Failed to wrap modelContext.${i} for "toolschanged":`,m)}};o("provideContext"),o("registerTool"),o("unregisterTool"),o("clearContext")}try{Object.defineProperty(n,Ps,{configurable:!0,enumerable:!1,writable:!1,value:!0}),a&&Object.defineProperty(n,Do,{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{}}var dh=class{nativeContext;nativeTesting;bridge;syncInProgress=!1;hasCompletedInitialToolSync=!1;constructor(e,t,r){this.bridge=e,this.nativeContext=t,this.nativeTesting=r,this.nativeTesting&&this.nativeTesting.registerToolsChangedCallback(()=>{this.syncToolsFromNative()}),this.syncToolsFromNative()}syncToolsFromNative(){if(!this.syncInProgress){this.syncInProgress=!0;try{const e=this.nativeTesting?.listTools(),t=this.nativeContext.listTools();this.bridge.tools.clear();const r=e??t;for(const n of r)try{const a=e&&"inputSchema"in n&&typeof n.inputSchema=="string"?JSON.parse(n.inputSchema):n.inputSchema??{type:"object"},s={name:n.name,description:n.description,inputSchema:a,execute:async o=>this.executeTool(n.name,o),inputValidator:un(a)};this.bridge.tools.set(n.name,s)}catch(a){Xe.error(`Failed to sync tool "${n.name}":`,a)}this.notifyMCPServers(),this.hasCompletedInitialToolSync?xo(this.nativeContext):this.hasCompletedInitialToolSync=!0}finally{this.syncInProgress=!1}}}refreshToolsFromNative(){this.syncToolsFromNative()}async executeToolViaNative(e,t){const r=this.nativeContext;if(typeof r.callTool=="function"&&r[Do]!==!0){const n=await r.callTool({name:e,arguments:t});return n&&typeof n=="object"&&"content"in n&&Array.isArray(n.content)?n:this.convertToToolResponse(n)}if(this.nativeTesting){const n=await this.nativeTesting.executeTool(e,JSON.stringify(t));return this.convertToToolResponse(n)}if(typeof r.executeTool=="function"){const n=await r.executeTool(e,t);return this.convertToToolResponse(n)}throw new Error("[Native Adapter] Tool execution is not supported by this native implementation")}convertToToolResponse(e){return typeof e=="string"?{content:[{type:"text",text:e}]}:e==null?{content:[{type:"text",text:""}]}:typeof e=="object"?{content:[{type:"text",text:JSON.stringify(e,null,2)}],structuredContent:e}:{content:[{type:"text",text:String(e)}]}}notifyMCPServers(){this.bridge.tabServer?.notification&&this.bridge.tabServer.notification({method:"notifications/tools/list_changed",params:{}}),this.bridge.iframeServer?.notification&&this.bridge.iframeServer.notification({method:"notifications/tools/list_changed",params:{}})}provideContext(e){const{tools:t,...r}=e,n={...r};t&&(n.tools=t.map(a=>({...a,inputSchema:ut(a.inputSchema).jsonSchema}))),this.nativeContext.provideContext(n)}registerTool(e){const t={...e,inputSchema:ut(e.inputSchema).jsonSchema};return this.nativeContext.registerTool(t)}unregisterTool(e){this.nativeContext.unregisterTool(e)}clearContext(){this.nativeContext.clearContext()}async executeTool(e,t,r){try{return await this.executeToolViaNative(e,t)}catch(n){return Xe.error(`Error executing tool "${e}":`,n),{content:[{type:"text",text:`Error: ${n instanceof Error?n.message:String(n)}`}],isError:!0}}}listTools(){return Array.from(this.bridge.tools.values()).map(e=>({name:e.name,description:e.description,inputSchema:e.inputSchema,...e.outputSchema&&{outputSchema:e.outputSchema},...e.annotations&&{annotations:e.annotations}}))}async callTool(e){if(!e?.name||typeof e.name!="string")throw new Error("Tool name is required");if(!this.bridge.tools.has(e.name))throw new Error(`Tool not found: ${e.name}`);return this.executeTool(e.name,e.arguments??{})}registerResource(e){return Xe.warn("registerResource is not supported by native API"),{unregister:()=>{}}}unregisterResource(e){Xe.warn("unregisterResource is not supported by native API")}listResources(){return[]}listResourceTemplates(){return[]}async readResource(e){throw new Error("[Native Adapter] readResource is not supported by native API")}registerPrompt(e){return Xe.warn("registerPrompt is not supported by native API"),{unregister:()=>{}}}unregisterPrompt(e){Xe.warn("unregisterPrompt is not supported by native API")}listPrompts(){return[]}async getPrompt(e,t){throw new Error("[Native Adapter] getPrompt is not supported by native API")}addEventListener(e,t,r){if(e==="toolcall"){this.nativeContext.addEventListener("toolcall",t,r);return}this.nativeContext.addEventListener("toolschanged",t,r)}removeEventListener(e,t,r){if(e==="toolcall"){this.nativeContext.removeEventListener("toolcall",t,r);return}this.nativeContext.removeEventListener("toolschanged",t,r)}dispatchEvent(e){return this.nativeContext.dispatchEvent(e)}async createMessage(e){return Mo(this.bridge.tabServer)(e)}async elicitInput(e){return jo(this.bridge.tabServer)(e)}};const G=dt("WebModelContext"),an=dt("MCPBridge"),lt=dt("ModelContextTesting"),fh="__isWebMCPPolyfill";var ph=class extends Event{name;arguments;_response=null;_responded=!1;constructor(e,t){super("toolcall",{cancelable:!0}),this.name=e,this.arguments=t}respondWith(e){if(this._responded)throw new Error("Response already provided for this tool call");this._response=e,this._responded=!0}getResponse(){return this._response}hasResponse(){return this._responded}};const ht=50;var mh=class{[fh]=!0;toolCallHistory=[];mockResponses=new Map;toolsChangedCallbacks=new Set;bridge;constructor(e){this.bridge=e}recordToolCall(e,t){this.toolCallHistory.push({toolName:e,arguments:t,timestamp:Date.now()})}hasMockResponse(e){return this.mockResponses.has(e)}getMockResponse(e){return this.mockResponses.get(e)}notifyToolsChanged(){for(const e of this.toolsChangedCallbacks)try{e()}catch(t){lt.error("Error in tools changed callback:",t)}}async executeTool(e,t){let r;try{r=JSON.parse(t)}catch(a){throw new SyntaxError(`Invalid JSON input: ${a instanceof Error?a.message:String(a)}`)}if(!this.bridge.tools.get(e))throw new Error(`Tool not found: ${e}`);const n=await this.bridge.modelContext.executeTool(e,r);if(!n.isError){if(n.structuredContent)return n.structuredContent;if(n.content&&n.content.length>0){const a=n.content[0];if(a&&a.type==="text")return a.text}}}listTools(){return this.bridge.modelContext.listTools().map(e=>({name:e.name,description:e.description,inputSchema:JSON.stringify(e.inputSchema)}))}registerToolsChangedCallback(e){this.toolsChangedCallbacks.add(e)}getToolCalls(){return[...this.toolCallHistory]}clearToolCalls(){this.toolCallHistory=[]}setMockToolResponse(e,t){this.mockResponses.set(e,t)}clearMockToolResponse(e){this.mockResponses.delete(e)}clearAllMockToolResponses(){this.mockResponses.clear()}getRegisteredTools(){return this.bridge.modelContext.listTools()}reset(){this.clearToolCalls(),this.clearAllMockToolResponses()}},ks=class{bridge;eventTarget;provideContextTools;dynamicTools;provideContextResources;dynamicResources;provideContextPrompts;dynamicPrompts;toolRegistrationTimestamps;resourceRegistrationTimestamps;promptRegistrationTimestamps;toolUnregisterFunctions;resourceUnregisterFunctions;promptUnregisterFunctions;pendingNotifications=new Set;testingAPI;constructor(e){this.bridge=e,this.eventTarget=new EventTarget,this.provideContextTools=new Map,this.dynamicTools=new Map,this.toolRegistrationTimestamps=new Map,this.toolUnregisterFunctions=new Map,this.provideContextResources=new Map,this.dynamicResources=new Map,this.resourceRegistrationTimestamps=new Map,this.resourceUnregisterFunctions=new Map,this.provideContextPrompts=new Map,this.dynamicPrompts=new Map,this.promptRegistrationTimestamps=new Map,this.promptUnregisterFunctions=new Map}setTestingAPI(e){this.testingAPI=e}addEventListener(e,t,r){this.eventTarget.addEventListener(e,t,r)}removeEventListener(e,t,r){this.eventTarget.removeEventListener(e,t,r)}dispatchEvent(e){return this.eventTarget.dispatchEvent(e)}provideContext(e){this.provideContextTools.clear(),this.provideContextResources.clear(),this.provideContextPrompts.clear();for(const t of e.tools??[]){if(t.name.startsWith("_")&&G.warn(` Warning: Tool name "${t.name}" starts with underscore. This may cause compatibility issues with some MCP clients. Consider using a letter as the first character.`),/^[0-9]/.test(t.name)&&G.warn(` Warning: Tool name "${t.name}" starts with a number. This may cause compatibility issues. Consider using a letter as the first character.`),t.name.startsWith("-")&&G.warn(` Warning: Tool name "${t.name}" starts with hyphen. This may cause compatibility issues. Consider using a letter as the first character.`),this.dynamicTools.has(t.name))throw new Error(`[Web Model Context] Tool name collision: "${t.name}" is already registered via registerTool(). Please use a different name or unregister the dynamic tool first.`);const{jsonSchema:r,zodValidator:n}=ut(t.inputSchema),a=t.outputSchema?ut(t.outputSchema):null,s={name:t.name,description:t.description,inputSchema:r,...a&&{outputSchema:a.jsonSchema},...t.annotations&&{annotations:t.annotations},execute:t.execute,inputValidator:n,...a&&{outputValidator:a.zodValidator}};this.provideContextTools.set(t.name,s)}for(const t of e.resources??[]){if(this.dynamicResources.has(t.uri))throw new Error(`[Web Model Context] Resource URI collision: "${t.uri}" is already registered via registerResource(). Please use a different URI or unregister the dynamic resource first.`);const r=this.validateResource(t);this.provideContextResources.set(t.uri,r)}for(const t of e.prompts??[]){if(this.dynamicPrompts.has(t.name))throw new Error(`[Web Model Context] Prompt name collision: "${t.name}" is already registered via registerPrompt(). Please use a different name or unregister the dynamic prompt first.`);const r=this.validatePrompt(t);this.provideContextPrompts.set(t.name,r)}this.updateBridgeTools(),this.updateBridgeResources(),this.updateBridgePrompts(),this.scheduleListChanged("tools"),this.scheduleListChanged("resources"),this.scheduleListChanged("prompts")}validateResource(e){const t=/\{([^}]{1,100})\}/g,r=[];for(const n of e.uri.matchAll(t)){const a=n[1];typeof a=="string"&&r.push(a)}return{uri:e.uri,name:e.name,description:e.description,mimeType:e.mimeType,read:e.read,isTemplate:r.length>0,templateParams:r}}validatePrompt(e){let t,r;if(e.argsSchema){const n=ut(e.argsSchema);t=n.jsonSchema,r=n.zodValidator}return{name:e.name,description:e.description,argsSchema:t,get:e.get,argsValidator:r}}registerTool(e){e.name.startsWith("_")&&G.warn(` Warning: Tool name "${e.name}" starts with underscore. This may cause compatibility issues with some MCP clients. Consider using a letter as the first character.`),/^[0-9]/.test(e.name)&&G.warn(` Warning: Tool name "${e.name}" starts with a number. This may cause compatibility issues. Consider using a letter as the first character.`),e.name.startsWith("-")&&G.warn(` Warning: Tool name "${e.name}" starts with hyphen. This may cause compatibility issues. Consider using a letter as the first character.`);const t=Date.now(),r=this.toolRegistrationTimestamps.get(e.name);if(r&&t-r<ht){G.warn(`Tool "${e.name}" registered multiple times within ${ht}ms. This is likely due to React Strict Mode double-mounting. Ignoring duplicate registration.`);const l=this.toolUnregisterFunctions.get(e.name);if(l)return{unregister:l}}if(this.provideContextTools.has(e.name))throw new Error(`[Web Model Context] Tool name collision: "${e.name}" is already registered via provideContext(). Please use a different name or update your provideContext() call.`);if(this.dynamicTools.has(e.name))throw new Error(`[Web Model Context] Tool name collision: "${e.name}" is already registered via registerTool(). Please unregister it first or use a different name.`);const{jsonSchema:n,zodValidator:a}=ut(e.inputSchema),s=e.outputSchema?ut(e.outputSchema):null,o={name:e.name,description:e.description,inputSchema:n,...s&&{outputSchema:s.jsonSchema},...e.annotations&&{annotations:e.annotations},execute:e.execute,inputValidator:a,...s&&{outputValidator:s.zodValidator}};this.dynamicTools.set(e.name,o),this.toolRegistrationTimestamps.set(e.name,t),this.updateBridgeTools(),this.scheduleListChanged("tools");const i=()=>{if(this.provideContextTools.has(e.name))throw new Error(`[Web Model Context] Cannot unregister tool "${e.name}": This tool was registered via provideContext(). Use provideContext() to update the base tool set.`);if(!this.dynamicTools.has(e.name)){G.warn(`Tool "${e.name}" is not registered, ignoring unregister call`);return}this.dynamicTools.delete(e.name),this.toolRegistrationTimestamps.delete(e.name),this.toolUnregisterFunctions.delete(e.name),this.updateBridgeTools(),this.scheduleListChanged("tools")};return this.toolUnregisterFunctions.set(e.name,i),{unregister:i}}registerResource(e){const t=Date.now(),r=this.resourceRegistrationTimestamps.get(e.uri);if(r&&t-r<ht){G.warn(`Resource "${e.uri}" registered multiple times within ${ht}ms. This is likely due to React Strict Mode double-mounting. Ignoring duplicate registration.`);const s=this.resourceUnregisterFunctions.get(e.uri);if(s)return{unregister:s}}if(this.provideContextResources.has(e.uri))throw new Error(`[Web Model Context] Resource URI collision: "${e.uri}" is already registered via provideContext(). Please use a different URI or update your provideContext() call.`);if(this.dynamicResources.has(e.uri))throw new Error(`[Web Model Context] Resource URI collision: "${e.uri}" is already registered via registerResource(). Please unregister it first or use a different URI.`);const n=this.validateResource(e);this.dynamicResources.set(e.uri,n),this.resourceRegistrationTimestamps.set(e.uri,t),this.updateBridgeResources(),this.scheduleListChanged("resources");const a=()=>{if(this.provideContextResources.has(e.uri))throw new Error(`[Web Model Context] Cannot unregister resource "${e.uri}": This resource was registered via provideContext(). Use provideContext() to update the base resource set.`);if(!this.dynamicResources.has(e.uri)){G.warn(`Resource "${e.uri}" is not registered, ignoring unregister call`);return}this.dynamicResources.delete(e.uri),this.resourceRegistrationTimestamps.delete(e.uri),this.resourceUnregisterFunctions.delete(e.uri),this.updateBridgeResources(),this.scheduleListChanged("resources")};return this.resourceUnregisterFunctions.set(e.uri,a),{unregister:a}}unregisterResource(e){const t=this.provideContextResources.has(e),r=this.dynamicResources.has(e);if(!t&&!r){G.warn(`Resource "${e}" is not registered, ignoring unregister call`);return}t&&this.provideContextResources.delete(e),r&&(this.dynamicResources.delete(e),this.resourceRegistrationTimestamps.delete(e),this.resourceUnregisterFunctions.delete(e)),this.updateBridgeResources(),this.scheduleListChanged("resources")}listResources(){return Array.from(this.bridge.resources.values()).filter(e=>!e.isTemplate).map(e=>({uri:e.uri,name:e.name,description:e.description,mimeType:e.mimeType}))}listResourceTemplates(){return Array.from(this.bridge.resources.values()).filter(e=>e.isTemplate).map(e=>({uriTemplate:e.uri,name:e.name,...e.description!==void 0&&{description:e.description},...e.mimeType!==void 0&&{mimeType:e.mimeType}}))}registerPrompt(e){const t=Date.now(),r=this.promptRegistrationTimestamps.get(e.name);if(r&&t-r<ht){G.warn(`Prompt "${e.name}" registered multiple times within ${ht}ms. This is likely due to React Strict Mode double-mounting. Ignoring duplicate registration.`);const s=this.promptUnregisterFunctions.get(e.name);if(s)return{unregister:s}}if(this.provideContextPrompts.has(e.name))throw new Error(`[Web Model Context] Prompt name collision: "${e.name}" is already registered via provideContext(). Please use a different name or update your provideContext() call.`);if(this.dynamicPrompts.has(e.name))throw new Error(`[Web Model Context] Prompt name collision: "${e.name}" is already registered via registerPrompt(). Please unregister it first or use a different name.`);const n=this.validatePrompt(e);this.dynamicPrompts.set(e.name,n),this.promptRegistrationTimestamps.set(e.name,t),this.updateBridgePrompts(),this.scheduleListChanged("prompts");const a=()=>{if(this.provideContextPrompts.has(e.name))throw new Error(`[Web Model Context] Cannot unregister prompt "${e.name}": This prompt was registered via provideContext(). Use provideContext() to update the base prompt set.`);if(!this.dynamicPrompts.has(e.name)){G.warn(`Prompt "${e.name}" is not registered, ignoring unregister call`);return}this.dynamicPrompts.delete(e.name),this.promptRegistrationTimestamps.delete(e.name),this.promptUnregisterFunctions.delete(e.name),this.updateBridgePrompts(),this.scheduleListChanged("prompts")};return this.promptUnregisterFunctions.set(e.name,a),{unregister:a}}unregisterPrompt(e){const t=this.provideContextPrompts.has(e),r=this.dynamicPrompts.has(e);if(!t&&!r){G.warn(`Prompt "${e}" is not registered, ignoring unregister call`);return}t&&this.provideContextPrompts.delete(e),r&&(this.dynamicPrompts.delete(e),this.promptRegistrationTimestamps.delete(e),this.promptUnregisterFunctions.delete(e)),this.updateBridgePrompts(),this.scheduleListChanged("prompts")}listPrompts(){return Array.from(this.bridge.prompts.values()).map(e=>({name:e.name,description:e.description,arguments:e.argsSchema?.properties?Object.entries(e.argsSchema.properties).map(([t,r])=>({name:t,description:r.description,required:e.argsSchema?.required?.includes(t)??!1})):void 0}))}unregisterTool(e){const t=this.provideContextTools.has(e),r=this.dynamicTools.has(e);if(!t&&!r){G.warn(`Tool "${e}" is not registered, ignoring unregister call`);return}t&&this.provideContextTools.delete(e),r&&(this.dynamicTools.delete(e),this.toolRegistrationTimestamps.delete(e),this.toolUnregisterFunctions.delete(e)),this.updateBridgeTools(),this.scheduleListChanged("tools")}clearContext(){this.provideContextTools.clear(),this.dynamicTools.clear(),this.toolRegistrationTimestamps.clear(),this.toolUnregisterFunctions.clear(),this.provideContextResources.clear(),this.dynamicResources.clear(),this.resourceRegistrationTimestamps.clear(),this.resourceUnregisterFunctions.clear(),this.provideContextPrompts.clear(),this.dynamicPrompts.clear(),this.promptRegistrationTimestamps.clear(),this.promptUnregisterFunctions.clear(),this.updateBridgeTools(),this.updateBridgeResources(),this.updateBridgePrompts(),this.scheduleListChanged("tools"),this.scheduleListChanged("resources"),this.scheduleListChanged("prompts")}updateBridgeTools(){this.bridge.tools.clear();for(const[e,t]of this.provideContextTools)this.bridge.tools.set(e,t);for(const[e,t]of this.dynamicTools)this.bridge.tools.set(e,t)}notifyToolsListChanged(){this.bridge.tabServer.notification&&this.bridge.tabServer.notification({method:"notifications/tools/list_changed",params:{}}),this.bridge.iframeServer?.notification&&this.bridge.iframeServer.notification({method:"notifications/tools/list_changed",params:{}}),this.testingAPI&&"notifyToolsChanged"in this.testingAPI&&this.testingAPI.notifyToolsChanged(),this.dispatchEvent(new Event("toolschanged"))}updateBridgeResources(){this.bridge.resources.clear();for(const[e,t]of this.provideContextResources)this.bridge.resources.set(e,t);for(const[e,t]of this.dynamicResources)this.bridge.resources.set(e,t)}notifyResourcesListChanged(){this.bridge.tabServer.notification&&this.bridge.tabServer.notification({method:"notifications/resources/list_changed",params:{}}),this.bridge.iframeServer?.notification&&this.bridge.iframeServer.notification({method:"notifications/resources/list_changed",params:{}})}updateBridgePrompts(){this.bridge.prompts.clear();for(const[e,t]of this.provideContextPrompts)this.bridge.prompts.set(e,t);for(const[e,t]of this.dynamicPrompts)this.bridge.prompts.set(e,t)}notifyPromptsListChanged(){this.bridge.tabServer.notification&&this.bridge.tabServer.notification({method:"notifications/prompts/list_changed",params:{}}),this.bridge.iframeServer?.notification&&this.bridge.iframeServer.notification({method:"notifications/prompts/list_changed",params:{}})}scheduleListChanged(e){this.pendingNotifications.has(e)||(this.pendingNotifications.add(e),queueMicrotask(()=>{switch(this.pendingNotifications.delete(e),e){case"tools":this.notifyToolsListChanged();break;case"resources":this.notifyResourcesListChanged();break;case"prompts":this.notifyPromptsListChanged();break;default:{const t=e;G.error(`Unknown list type: ${t}`)}}}))}async readResource(e){const t=this.bridge.resources.get(e);if(t&&!t.isTemplate)try{let r;try{r=new URL(e)}catch{r=new URL(`custom-scheme:///${encodeURIComponent(e)}`),r.originalUri=e}return await t.read(r)}catch(r){throw G.error(`Error reading resource ${e}:`,r),r}for(const r of this.bridge.resources.values()){if(!r.isTemplate)continue;const n=this.matchUriTemplate(r.uri,e);if(n)try{let a;try{a=new URL(e)}catch{a=new URL(`custom-scheme:///${encodeURIComponent(e)}`),a.originalUri=e}return await r.read(a,n)}catch(a){throw G.error(`Error reading resource ${e}:`,a),a}}throw new Error(`Resource not found: ${e}`)}matchUriTemplate(e,t){const r=[];let n=e.replace(/[.*+?^${}()|[\]\\]/g,i=>i==="{"||i==="}"?i:`\\${i}`);n=n.replace(/\{([^}]+)\}/g,(i,l)=>(r.push(l),"(.+)"));const a=new RegExp(`^${n}$`),s=t.match(a);if(!s)return null;const o={};for(let i=0;i<r.length;i++){const l=r[i],m=s[i+1];typeof l!="string"||typeof m!="string"||(o[l]=m)}return o}async getPrompt(e,t){const r=this.bridge.prompts.get(e);if(!r)throw new Error(`Prompt not found: ${e}`);if(r.argsValidator&&t){const n=nn(t,r.argsValidator);if(!n.success)throw G.error(`Argument validation failed for prompt ${e}:`,n.error),new Error(`Argument validation error for prompt "${e}":
${n.error}`)}try{return await r.get(t??{})}catch(n){throw G.error(`Error getting prompt ${e}:`,n),n}}async executeTool(e,t,r){const n=this.bridge.tools.get(e);if(!n)throw new Error(`Tool not found: ${e}`);let a;if(r?.skipValidation)a=t;else{const o=nn(t,n.inputValidator);if(!o.success)return G.error(`Input validation failed for ${e}:`,o.error),{content:[{type:"text",text:`Input validation error for tool "${e}":
${o.error}`}],isError:!0};a=o.data}if(this.testingAPI&&this.testingAPI.recordToolCall(e,a),this.testingAPI?.hasMockResponse(e)){const o=this.testingAPI.getMockResponse(e);if(o)return o}const s=new ph(e,a);if(this.dispatchEvent(s),s.defaultPrevented&&s.hasResponse()){const o=s.getResponse();if(o)return o}try{const o=await n.execute(a);if(n.outputValidator&&o.structuredContent){const i=nn(o.structuredContent,n.outputValidator);i.success||G.warn(`Output validation failed for ${e}:`,i.error)}return o.metadata&&typeof o.metadata=="object"&&"willNavigate"in o.metadata&&G.info(`Tool "${e}" will trigger navigation`,o.metadata),o}catch(o){return G.error(`Error executing tool ${e}:`,o),{content:[{type:"text",text:`Error: ${o instanceof Error?o.message:String(o)}`}],isError:!0}}}listTools(){return Array.from(this.bridge.tools.values()).map(e=>({name:e.name,description:e.description,inputSchema:e.inputSchema,...e.outputSchema&&{outputSchema:e.outputSchema},...e.annotations&&{annotations:e.annotations}}))}async callTool(e){if(!e?.name||typeof e.name!="string")throw new Error("Tool name is required");if(!this.bridge.tools.has(e.name))throw new Error(`Tool not found: ${e.name}`);return this.executeTool(e.name,e.arguments??{})}async createMessage(e){return Mo(this.bridge.tabServer)(e)}async elicitInput(e){return jo(this.bridge.tabServer)(e)}};function Rs(e){const t=window.location.hostname||"localhost",r=e?.transport,n=(f,$)=>{f.setRequestHandler(po,async()=>({tools:$.modelContext.listTools()})),f.setRequestHandler(An,async y=>{const v=y.params.name,w=y.params.arguments||{};try{const S=await $.modelContext.executeTool(v,w);return{content:S.content,isError:S.isError,...S.structuredContent&&{structuredContent:S.structuredContent}}}catch(S){throw an.error(`Error calling tool ${v}:`,S),S}}),f.setRequestHandler(io,async()=>({resources:$.modelContext.listResources()})),f.setRequestHandler(co,async y=>{try{return await $.modelContext.readResource(y.params.uri)}catch(v){throw an.error(`Error reading resource ${y.params.uri}:`,v),v}}),f.setRequestHandler(lo,async()=>({prompts:$.modelContext.listPrompts()})),f.setRequestHandler(uo,async y=>{try{return await $.modelContext.getPrompt(y.params.name,y.params.arguments)}catch(v){throw an.error(`Error getting prompt ${y.params.name}:`,v),v}})},a=r?.create?.();if(a){const f=new tn({name:t,version:"1.0.0"},{capabilities:{tools:{listChanged:!0},resources:{listChanged:!0},prompts:{listChanged:!0}}}),$={tabServer:f,tools:new Map,resources:new Map,prompts:new Map,modelContext:void 0,isInitialized:!0};return $.modelContext=new ks($),n(f,$),f.connect(a),$}const s=r?.tabServer!==!1,o=new tn({name:`${t}-tab`,version:"1.0.0"},{capabilities:{tools:{listChanged:!0},resources:{listChanged:!0},prompts:{listChanged:!0}}}),i={tabServer:o,tools:new Map,resources:new Map,prompts:new Map,modelContext:void 0,isInitialized:!0};if(i.modelContext=new ks(i),n(o,i),s){const{allowedOrigins:f,...$}=typeof r?.tabServer=="object"?r.tabServer:{},y=new Am({allowedOrigins:f??["*"],...$});o.connect(y)}const l=typeof window<"u"&&window.parent!==window,m=r?.iframeServer;if(m!==!1&&(m!==void 0||l)){const f=new tn({name:`${t}-iframe`,version:"1.0.0"},{capabilities:{tools:{listChanged:!0},resources:{listChanged:!0},prompts:{listChanged:!0}}});n(f,i);const{allowedOrigins:$,...y}=typeof m=="object"?m:{},v=new Nm({allowedOrigins:$??["*"],...y});f.connect(v),i.iframeServer=f}return i}function hh(e){if(typeof window>"u"){G.warn("Not in browser environment, skipping initialization");return}const t=e??window.__webModelContextOptions,r=lh();if(r.hasNativeContext){const n=window.navigator.modelContext,a=r.hasNativeTesting?window.navigator.modelContextTesting:void 0;if(!n){G.error("Native API detection mismatch");return}G.info(" Native Chromium API detected"),a?(G.info("   Using native implementation with MCP bridge synchronization"),G.info("   Native API will automatically collect tools from embedded iframes")):G.info("   Native modelContextTesting not detected; installing consumer shim on modelContext");try{const s=Rs(t),o=new dh(s,n,a);s.modelContext=o,a&&(s.modelContextTesting=a,Es(a)),uh(n,i=>o.callTool(i),{hasNativeTesting:!!a,...!a&&{onToolRegistryMutated:()=>o.refreshToolsFromNative()}}),Object.defineProperty(window,"__mcpBridge",{value:s,writable:!1,configurable:!0}),G.info(" MCP bridge synced with native API"),a?G.info("   MCP clients will receive automatic tool updates from native registry"):G.warn("   Native testing callbacks are unavailable; tool list change events are best-effort.")}catch(s){throw G.error("Failed to initialize native adapter:",s),s}return}if(window.navigator.modelContext){G.warn("window.navigator.modelContext already exists, skipping initialization");return}G.info("Native API not detected, installing polyfill");try{const n=Rs(t);Object.defineProperty(window.navigator,"modelContext",{value:n.modelContext,writable:!1,configurable:!1}),Object.defineProperty(window,"__mcpBridge",{value:n,writable:!1,configurable:!0}),G.info(" window.navigator.modelContext initialized successfully"),lt.info("Installing polyfill"),lt.info("    To use the native implementation in Chromium:"),lt.info("      - Navigate to chrome://flags"),lt.info('      - Enable "Experimental Web Platform Features"'),lt.info("      - Or launch with: --enable-experimental-web-platform-features");const a=new mh(n);n.modelContextTesting=a,n.modelContext.setTestingAPI(a),Es(a),lt.info(" Polyfill installed at window.navigator.modelContextTesting")}catch(n){throw G.error("Failed to initialize:",n),n}}function bh(){if(typeof window>"u")return;if(window.__mcpBridge)try{window.__mcpBridge.tabServer.close(),window.__mcpBridge.iframeServer&&window.__mcpBridge.iframeServer.close()}catch(t){G.warn("Error closing MCP servers:",t)}const e=t=>{if(Object.getOwnPropertyDescriptor(window.navigator,t)?.configurable===!1){G.debug(`Skipping cleanup for navigator.${t} because property is non-configurable`);return}try{delete window.navigator[t]}catch(r){G.warn(`Failed to remove navigator.${t} during cleanup:`,r)}};e("modelContext"),e("modelContextTesting"),delete window.__mcpBridge,G.info("Cleaned up")}const zo=dt("WebModelContext");function gh(e,t){return e?t?{...e,...t,tabServer:{...e.tabServer??{},...t.tabServer??{}}}:e:t}function yh(e,t){return e?t?{...e,...t,transport:gh(e.transport??{},t.transport??{})}:e:t}function vh(e){if(!e||!e.dataset)return;const{dataset:t}=e;if(t.webmcpOptions)try{return JSON.parse(t.webmcpOptions)}catch(o){zo.error("Invalid JSON in data-webmcp-options:",o);return}const r={};let n=!1;t.webmcpAutoInitialize!==void 0&&(r.autoInitialize=t.webmcpAutoInitialize!=="false",n=!0);const a={};let s=!1;if(t.webmcpAllowedOrigins){const o=t.webmcpAllowedOrigins.split(",").map(i=>i.trim()).filter(i=>i.length>0);o.length>0&&(a.allowedOrigins=o,n=!0,s=!0)}return t.webmcpChannelId&&(a.channelId=t.webmcpChannelId,n=!0,s=!0),s&&(r.transport={...r.transport??{},tabServer:{...r.transport?.tabServer??{},...a}}),n?r:void 0}if(typeof window<"u"&&typeof document<"u"){const e=window.__webModelContextOptions,t=document.currentScript,r=vh(t),n=yh(e,r)??e??r;n&&(window.__webModelContextOptions=n);const a=n?.autoInitialize!==!1;try{a&&hh(n)}catch(s){zo.error("Auto-initialization failed:",s)}}export{bh as cleanupWebModelContext,dt as createLogger,hh as initializeWebModelContext,ih as zodToJsonSchema};
