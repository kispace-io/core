import{w as u,j as l,R as m,t as r,r as s,G as f}from"./main-CKpV1Fmo.js";import{P as p}from"./pyservice-CqDybKAp.js";import{p as h}from"./package-manager-CNKaEkWk.js";const i=new WeakMap,y="k-monaco-editor";let c=!1;function E(){if(c)return;const t=customElements.get(y);if(!t?.prototype)return;const n=t.prototype,a=n.disconnectedCallback;n.disconnectedCallback=function(){const e=i.get(this);e&&(e.close(),i.delete(this)),a?.call(this)},c=!0}function k(t){return!!t&&typeof t.execCode=="function"&&typeof t.close=="function"}async function g(t){E();const n=i.get(t);if(k(n))return n;const a=await u.getWorkspace();if(!a)throw new Error("No workspace selected");const e=new p;return await e.init(a),i.set(t,e),e}const v=/^#\s*@gs-packages:\s*(.+)$/i;function d(t){for(const n of t.split(`
`)){const a=n.match(v);if(a)return a[1].split(",").map(e=>e.trim()).filter(e=>e.length>0)}return[]}const P="toolbar:monaco-editor";function w(){return!!f.get()?.isLanguage?.("python")}l.registerHandler(m,{ranking:0,canExecute:t=>!!t.activeEditor?.isLanguage?.("python"),execute:async t=>{const n=t.activeEditor;if(!n){r("No active editor");return}const a=n?.getContent?.()?.trim();if(!a){r("No content to run");return}try{const e=await g(n),o=d(a);o.length>0&&await e.loadPackages(o),await e.execCode(a)}catch(e){r(e instanceof Error?e.message:String(e))}}});s({command:{id:"python",name:"Run Python Script",description:"Executes a Python script given its file path",parameters:[{name:"script",description:"the path to a Python script to run",required:!1}]},handler:{execute:async t=>{const n=t.params?.script;if(!n)return;const a=new p;await a.init(void 0,{params:t.params}),await a.execScript(n)}}});s({command:{id:"python.openEditorPackageManager",name:"Manage packages",description:"Manage Python packages for the editor environment",parameters:[]},handler:{canExecute:t=>!!t.activeEditor?.isLanguage?.("python"),execute:async t=>{const n=t.activeEditor;if(!n){r("No active editor");return}const a=n?.getContent?.()??"",e=d(a);try{const o=await g(n);h.showPackageManager({packages:e,pyenv:o})}catch(o){r(o instanceof Error?o.message:String(o))}}},contribution:{target:P,command:"python.openEditorPackageManager",icon:"box",label:"Packages",disabled:()=>!w()}});export{p as PyEnv,h as pythonPackageManagerService};
