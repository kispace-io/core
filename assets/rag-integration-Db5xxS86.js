import{S as c,s as f,R as p,d as h,g as y,a as g,r as x}from"./rag-system-extension-C9N1yghz.js";import{B as w,b as l,C as P,r as A}from"./main-BEYAOB-D.js";const o=P("RAGIntegration"),u=new p(new g),I={priority:10,async enhance(e,t){try{return(await h.getStats()).totalDocuments===0?e:`${e}

IMPORTANT: When a user mentions a specific file name or path:
1. ALWAYS first check if the file is indexed using rag.check-indexed with the file path
2. If indexed: Use rag.search-documents with filePath parameter to get relevant content from the indexed document
3. If not indexed: Read the file directly using file commands (cat_file, ls, etc.)

NEVER use filePath or fileName parameters in rag.search-documents without first verifying the file is indexed with rag.check-indexed. If you use a non-indexed file path/name, the search will return no results.

For general searches (not specific files), use rag.search-documents with just the query parameter to search across all indexed documents. This is more efficient than reading files one by one.`}catch(r){return o.warn(`RAG enhancement failed: ${r}`),e}}};function N(){return async(e,t)=>{if(e==="search_workspace_documents"){const r=t.query||"",n=Math.min(t.limit||c.DEFAULT_LIMIT,c.MAX_LIMIT),i=t.fileType,a=t.filePath,s=t.fileName,m=t.includePaths||t.excludePaths||t.pathPattern?{includePaths:t.includePaths,excludePaths:t.excludePaths,pathPattern:t.pathPattern}:void 0,d=await f(r,{limit:n,fileType:i,filePath:a,fileName:s,documentSearchScope:m});return{results:u.formatSearchResults(d),total:d.length}}throw new Error(`Unknown RAG tool: ${e}`)}}function k(){l({command:{id:"rag.search-documents",name:"Search Workspace Documents (RAG)",description:"Search indexed workspace documents for relevant content. IMPORTANT: Only use filePath or fileName if you have already verified the file is indexed using rag.check-indexed. If the file is not indexed, this will return no results.",parameters:[{name:"query",description:"Search query (optional if filePath or fileName is provided)",required:!1},{name:"limit",description:"Maximum number of results",required:!1},{name:"fileType",description:"Filter by file type",required:!1},{name:"filePath",description:"Exact file path to search (relative to workspace root). Only use if you verified the file is indexed with rag.check-indexed.",required:!1},{name:"fileName",description:"File name to search for (partial match supported). Only use if you verified the file is indexed with rag.check-indexed.",required:!1}]},handler:{canExecute:()=>!0,execute:async e=>{const t=e.params?.query||"",r=e.params?.limit?Math.min(parseInt(e.params.limit),c.MAX_LIMIT):c.DEFAULT_LIMIT,n=e.params?.fileType,i=e.params?.filePath,a=e.params?.fileName;if(!t&&!i&&!a)throw new Error("Either query, filePath, or fileName parameter must be provided");const s=await f(t,{limit:r,fileType:n,filePath:i,fileName:a});return(i||a)&&s.length===0?{query:t||(i?`filePath: ${i}`:`fileName: ${a}`),results:[],warning:`No indexed document found for ${i?`file path "${i}"`:`file name "${a}"`}. The file may not be indexed. Use rag.check-indexed to verify if a file is indexed before searching.`}:{query:t||(i?`filePath: ${i}`:a?`fileName: ${a}`:""),results:u.formatCommandResults(s)}}}}),l({command:{id:"rag.check-indexed",name:"Check if File is Indexed",description:"Check if a specific file is indexed in the document index. Use this to determine if you should use RAG search or read the file directly.",parameters:[{name:"filePath",description:"The file path to check (relative to workspace root)",required:!0}]},handler:{canExecute:()=>!0,execute:async e=>{const t=e.params?.filePath;if(!t)throw new Error("File path parameter required");const r=await y();if(!r)return{indexed:!1,reason:"No workspace connected"};const{workspacePath:n}=r,i=await h.getDocumentByPath(n,t);return i?{indexed:!0,filePath:i.filePath,fileName:i.fileName,fileType:i.fileType,indexedAt:new Date(i.indexedAt).toISOString(),size:i.metadata.size}:{indexed:!1,filePath:t,reason:"File not found in document index"}}}})}function R(){try{k();const e=w.promptBuilder;e&&typeof e.addEnhancer=="function"?(e.addEnhancer(I),o.info("RAG prompt enhancer and commands registered - AI will be instructed to use RAG before reading files")):(o.warn("AI service prompt builder not available yet, will retry"),setTimeout(()=>R(),1e3))}catch(e){o.warn(`Failed to integrate RAG with AI: ${e}`)}}A.put("ragService",x);export{N as createRAGToolExecutor,R as integrateRAGWithAI,I as ragPromptEnhancer,k as registerRAGCommands};
