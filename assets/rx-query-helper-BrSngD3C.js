function Z(e){"@babel/helpers - typeof";return Z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(e)}function Nt(e,t){if(Z(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Z(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Pt(e){var t=Nt(e,"string");return Z(t)=="symbol"?t:t+""}function Mt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Pt(n.key),n)}}function tt(e,t,r){return t&&Mt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function vn(e){return e[e.length-1]}function mn(e){return e.slice(0).sort(()=>Math.random()-.5)}function On(e){var t=e[Math.floor(Math.random()*e.length)];return t}function Rt(e){return Array.isArray(e)?e.slice(0):[e]}function En(e,t){e=e.slice(0);for(var r=[];e.length;){var n=e.splice(0,t);r.push(n)}return r}function wn(e,t){e=e.slice();for(var r=e.length,n=!1;r--&&!n;)t(e[r])&&(n=!0,e.splice(r,1));return e}function rt(e){return Array.isArray(e)}function _n(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=t.includes(n);if(i)return!0}return!1}function An(e){return e!=null}function ve(e,t){var r=0,n=-1;for(var i of e){n=n+1;var s=t(i,n);if(s)r=r+1;else break}return r}async function $n(e,t){var r=await Promise.all(e.map(t));return e.filter((...[,n])=>r[n])}function bn(e){for(var t=0,r=e.length;r--;)t+=e[r];return t}function Sn(e){return Math.max(...e)}function Ct(e,t){var r=t.length;if(r!==0){var n=e.length;e.length=n+t.length;for(var i=0;i<r;++i)e[n+i]=t[i]}}function In(e){return e.filter(function(t,r,n){return n.indexOf(t)===r})}function xn(e){return(t,r)=>r[e]-t[e]}function Tt(e){return Object.freeze(e),Object.getOwnPropertyNames(e).forEach(function(t){Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==null&&(typeof e[t]=="object"||typeof e[t]=="function")&&!Object.isFrozen(e[t])&&Tt(e[t])}),e}function kt(e){var t=e.split("."),r=t.length;return r===1?n=>n[e]:n=>{for(var i=n,s=0;s<r;++s){var o=t[s];if(i=i[o],typeof i>"u")return i}return i}}function Nn(e,t){var r=e[t];if(!r)throw new Error("missing value from object "+t);return r}function Lt(e){var t={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))if(typeof e[r]=="object"){var n=Lt(e[r]);for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[r+"."+i]=n[i])}else t[r]=e[r];return t}function ue(e){return Object.assign({},e)}function Ft(e){return Object.keys(e)[0]}function Pn(e){var t=Object.keys(e)[0];return e[t]}function we(e,t=!1){if(!e)return e;if(!t&&Array.isArray(e))return e.sort((n,i)=>typeof n=="string"&&typeof i=="string"?n.localeCompare(i):typeof n=="object"?1:-1).map(n=>we(n,t));if(typeof e=="object"&&!Array.isArray(e)){var r={};return Object.keys(e).sort((n,i)=>n.localeCompare(i)).forEach(n=>{r[n]=we(e[n],t)}),r}return e}function _e(e){if(!e||e===null||typeof e!="object")return e;if(Array.isArray(e)){for(var t=new Array(e.length),r=t.length;r--;)t[r]=_e(e[r]);return t}var n={};for(var i in e)n[i]=_e(e[i]);return n}var Kt=_e;function Mn(e,t,r){return Object.defineProperty(e,t,{get:function(){return r}}),r}function Ke(e,t){if(e.hasOwnProperty(t))return!0;if(Array.isArray(e)){var r=!!e.find(i=>Ke(i,t));return r}for(var n in e)if(typeof e[n]=="object"&&e[n]!==null&&Ke(e[n],t))return!0;return!1}var nt=1;function Rn(){return{lwt:nt}}function Cn(){return""}function Tn(e){return Object.assign({},e,{_meta:void 0,_deleted:void 0,_rev:void 0})}function kn(e,t,r){if(t.length!==r.length)return!1;for(var n=0,i=t.length;n<i;){var s=t[n],o=r[n];if(n++,s._rev!==o._rev||s[e]!==o[e])return!1}return!0}function Dt(e){return(t,r)=>t._meta.lwt===r._meta.lwt?r[e]<t[e]?1:-1:t._meta.lwt-r._meta.lwt}function Ln(e,t){return t.sort(Dt(e))}function Fn(e){return e=ue(e),e._deleted=!!e._deleted,Object.assign(e,{_attachments:void 0,_meta:void 0,_rev:void 0})}var qt=/\./g,Kn=/\|/g,De="abcdefghijklmnopqrstuvwxyz";function Dn(e=10){for(var t="",r=0;r<e;r++)t+=De.charAt(Math.floor(Math.random()*De.length));return t}var qn="Fz7SZXPmYJujkzjY1rpXWvlWBqoGAfAX";function zn(e){e+="";var t=e.charAt(0).toUpperCase();return t+e.substr(1)}function zt(e){for(;e.charAt(0)===".";)e=e.substr(1);for(;e.slice(-1)===".";)e=e.slice(0,-1);return e}function Un(e){return e.charAt(e.length-1)}function Bn(e){return!!(e.includes("/")||e.includes("\\"))}function Gn(e){return new TextDecoder().decode(e)}function jn(e){return new TextEncoder().encode(e)}function Wn(e){return e.trim().replace(/[\n\s]+/g,"")}var k=e=>{var t=typeof e;return e!==null&&(t==="object"||t==="function")},me=new Set(["__proto__","prototype","constructor"]),Ut=new Set("0123456789");function le(e){var t=[],r="",n="start",i=!1;for(var s of e)switch(s){case"\\":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd")throw new Error("Invalid character after an index");i&&(r+=s),n="property",i=!i;break}case".":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd"){n="property";break}if(i){i=!1,r+=s;break}if(me.has(r))return[];t.push(r),r="",n="property";break}case"[":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd"){n="index";break}if(i){i=!1,r+=s;break}if(n==="property"){if(me.has(r))return[];t.push(r),r=""}n="index";break}case"]":{if(n==="index"){t.push(Number.parseInt(r,10)),r="",n="indexEnd";break}if(n==="indexEnd")throw new Error("Invalid character after an index")}default:{if(n==="index"&&!Ut.has(s))throw new Error("Invalid character in an index");if(n==="indexEnd")throw new Error("Invalid character after an index");n==="start"&&(n="property"),i&&(i=!1,r+="\\"),r+=s}}switch(i&&(r+="\\"),n){case"property":{if(me.has(r))return[];t.push(r);break}case"index":throw new Error("Index was not closed");case"start":{t.push("");break}}return t}function Ce(e,t){if(typeof t!="number"&&Array.isArray(e)){var r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}function it(e,t){if(Ce(e,t))throw new Error("Cannot use string index")}function st(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!t.includes(".")&&!t.includes("["))return e[t];if(!k(e)||typeof t!="string")return r===void 0?e:r;var n=le(t);if(n.length===0)return r;for(var i=0;i<n.length;i++){var s=n[i];if(Ce(e,s)?e=i===n.length-1?void 0:null:e=e[s],e==null){if(i!==n.length-1)return r;break}}return e===void 0?r:e}function Xn(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!k(e)||typeof t!="string")return e;for(var n=e,i=le(t),s=0;s<i.length;s++){var o=i[s];it(e,o),s===i.length-1?e[o]=r:k(e[o])||(e[o]=typeof i[s+1]=="number"?[]:{}),e=e[o]}return n}function Qn(e,t){if(!k(e)||typeof t!="string")return!1;for(var r=le(t),n=0;n<r.length;n++){var i=r[n];if(it(e,i),n===r.length-1)return delete e[i],!0;if(e=e[i],!k(e))return!1}}function Hn(e,t){if(!k(e)||typeof t!="string")return!1;var r=le(t);if(r.length===0)return!1;for(var n of r){if(!k(e)||!(n in e)||Ce(e,n))return!1;e=e[n]}return!0}function Bt(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[\\.[]/g,"\\$&")}function ot(e){return Array.isArray(e)?e.map((t,r)=>[r,t]):Object.entries(e)}function Gt(e){var t="";for(var[r,n]of ot(e))typeof n=="number"?t+="["+n+"]":(n=Bt(n),t+=r===0?n:"."+n);return t}function*at(e,t=[]){if(!k(e)){t.length>0&&(yield Gt(t));return}for(var[r,n]of ot(e))yield*at(n,[...t,r])}function Yn(e){return[...at(e)]}function Jn(e,t){new Array(e).fill(0).forEach((r,n)=>t(n))}function jt(e,t){if(!e)throw t||(t=""),new Error("ensureNotFalsy() is falsy: "+t);return e}function Vn(e){if(!Number.isInteger(e))throw new Error("ensureInteger() is falsy");return e}var Zn={bufferSize:1,refCount:!0};function ei(e,t){return{[e](...r){return t.apply(this,r)}}[e]}function ee(e,t){return ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},ee(e,t)}function ut(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ee(e,t)}function Ae(e){return Ae=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ae(e)}function Wt(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}}function ft(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ft=function(){return!!e})()}function Xt(e,t,r){if(ft())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return r&&ee(i,r.prototype),i}function fe(e){var t=typeof Map=="function"?new Map:void 0;return fe=function(n){if(n===null||!Wt(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return Xt(n,arguments,Ae(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),ee(i,n)},fe(e)}var ct={isDevMode(){return!1},deepFreezeWhenDevMode(e){return e},tunnelErrorMessage(e){return"RxDB Error-Code "+e+`.
        Error messages are not included in RxDB core to reduce build size.
        `}};function Qt(e){var t="";return Object.keys(e).length===0||(t+=`Given parameters: {
`,t+=Object.keys(e).map(r=>{var n="[object Object]";try{r==="errors"?n=e[r].map(i=>JSON.stringify(i,Object.getOwnPropertyNames(i))):n=JSON.stringify(e[r],function(i,s){return s===void 0?null:s},2)}catch{}return r+":"+n}).join(`
`),t+="}"),t}function lt(e,t,r){return"RxError ("+t+`):
`+e+`
`+Qt(r)}var Ht=(function(e){function t(n,i,s={}){var o,a=lt(i,n,s);return o=e.call(this,a)||this,o.code=n,o.message=a,o.url=Te(n),o.parameters=s,o.rxdb=!0,o}ut(t,e);var r=t.prototype;return r.toString=function(){return this.message},tt(t,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}])})(fe(Error)),Yt=(function(e){function t(n,i,s={}){var o,a=lt(i,n,s);return o=e.call(this,a)||this,o.code=n,o.message=a,o.url=Te(n),o.parameters=s,o.rxdb=!0,o}ut(t,e);var r=t.prototype;return r.toString=function(){return this.message},tt(t,[{key:"name",get:function(){return"RxTypeError ("+this.code+")"}},{key:"typeError",get:function(){return!0}}])})(fe(TypeError));function Te(e){return"https://rxdb.info/errors.html?console=errors#"+e}function pt(e){return`
 You can find out more about this error here: `+Te(e)+" "}function G(e,t){return new Ht(e,ct.tunnelErrorMessage(e)+pt(e),t)}function ti(e,t){return new Yt(e,ct.tunnelErrorMessage(e)+pt(e),t)}function ri(e){return e&&e.status===409?e:!1}var Jt={409:"document write conflict",422:"schema validation error",510:"attachment data missing"};function ni(e){return G("COL20",{name:Jt[e.status],document:e.documentId,writeError:e})}function ii(e,t){var r=er({version:e,type:"object",primaryKey:t,properties:{[t]:{type:"string",maxLength:100}},indexes:[[t]],required:[t]});return r}function dt(e,t){var r=t;r=r.replace(qt,".properties."),r="properties."+r,r=zt(r);var n=st(e,r);return n}function si(e,t,r){if(typeof t.primaryKey=="string")return r;var n=Vt(t,r),i=r[e];if(i&&i!==n)throw G("DOC19",{args:{documentData:r,existingPrimary:i,newPrimary:n},schema:t});return r[e]=n,r}function pe(e){return typeof e=="string"?e:e.key}function oi(e){var t=pe(e.primaryKey),r=dt(e,t);return jt(r.maxLength)}function Vt(e,t){if(typeof e.primaryKey=="string")return t[e.primaryKey];var r=e.primaryKey;return r.fields.map(n=>{var i=st(t,n);if(typeof i>"u")throw G("DOC18",{args:{field:n,documentData:t}});return i}).join(r.separator)}function ai(e){var t=we(e,!0);return t}function Zt(e){return["_deleted",e]}function er(e){e=ue(e);var t=pe(e.primaryKey);e.properties=ue(e.properties),e.additionalProperties=!1,Object.prototype.hasOwnProperty.call(e,"keyCompression")||(e.keyCompression=!1),e.indexes=e.indexes?e.indexes.slice(0):[],e.required=e.required?e.required.slice(0):[],e.encrypted=e.encrypted?e.encrypted.slice(0):[],e.properties._rev={type:"string",minLength:1},e.properties._attachments={type:"object"},e.properties._deleted={type:"boolean"},e.properties._meta=tr,e.required=e.required?e.required.slice(0):[],e.required.push("_deleted"),e.required.push("_rev"),e.required.push("_meta"),e.required.push("_attachments");var r=rr(e);Ct(e.required,r),e.required=e.required.filter(s=>!s.includes(".")).filter((s,o,a)=>a.indexOf(s)===o),e.version=e.version||0;var n=e.indexes.map(s=>{var o=rt(s)?s.slice(0):[s];return o.includes(t)||o.push(t),o[0]!=="_deleted"&&o.unshift("_deleted"),o});n.length===0&&n.push(Zt(t)),n.push(["_meta.lwt",t]),e.internalIndexes&&e.internalIndexes.map(s=>{n.push(s)});var i=new Set;return n.filter(s=>{var o=s.join(",");return i.has(o)?!1:(i.add(o),!0)}),e.indexes=n,e}var tr={type:"object",properties:{lwt:{type:"number",minimum:nt,maximum:1e15,multipleOf:.01}},additionalProperties:!0,required:["lwt"]};function rr(e){var t=Object.keys(e.properties).filter(n=>e.properties[n].final),r=pe(e.primaryKey);return t.push(r),typeof e.primaryKey!="string"&&e.primaryKey.fields.forEach(n=>t.push(n)),t}function ui(e,t){for(var r=Object.keys(e.defaultValues),n=0;n<r.length;++n){var i=r[n];(!Object.prototype.hasOwnProperty.call(t,i)||typeof t[i]>"u")&&(t[i]=e.defaultValues[i])}return t}var fi={type:"object",properties:{id:{type:"string"},lwt:{type:"number"}},required:["id","lwt"],additionalProperties:!1},Y="ï¿¿",J=Number.MIN_SAFE_INTEGER;function ci(e,t){var r=t.selector,n=e.indexes?e.indexes.slice(0):[];t.index&&(n=[t.index]);var i=!!t.sort.find(f=>Object.values(f)[0]==="desc"),s=new Set;Object.keys(r).forEach(f=>{var l=dt(e,f);l&&l.type==="boolean"&&Object.prototype.hasOwnProperty.call(r[f],"$eq")&&s.add(f)});var o=t.sort.map(f=>Object.keys(f)[0]),a=o.filter(f=>!s.has(f)).join(","),c=-1,u;if(n.forEach(f=>{var l=!0,h=!0,p=f.map(m=>{var A=r[m],R=A?Object.keys(A):[],v={};if(!A||!R.length){var Q=h?J:Y;v={startKey:Q,endKey:l?Y:J,inclusiveStart:!0,inclusiveEnd:!0}}else R.forEach(N=>{if(ke.has(N)){var ye=A[N],ge=or(N,ye);v=Object.assign(v,ge)}});return typeof v.startKey>"u"&&(v.startKey=J),typeof v.endKey>"u"&&(v.endKey=Y),typeof v.inclusiveStart>"u"&&(v.inclusiveStart=!0),typeof v.inclusiveEnd>"u"&&(v.inclusiveEnd=!0),h&&!v.inclusiveStart&&(h=!1),l&&!v.inclusiveEnd&&(l=!1),v}),d=p.map(m=>m.startKey),y=p.map(m=>m.endKey),b={index:f,startKeys:d,endKeys:y,inclusiveEnd:l,inclusiveStart:h,sortSatisfiedByIndex:!i&&a===f.filter(m=>!s.has(m)).join(","),selectorSatisfiedByIndex:sr(f,t.selector,d,y)},w=ar(e,t,b);(w>=c||t.index)&&(c=w,u=b)}),!u)throw G("SNH",{query:t});return u}var ke=new Set(["$eq","$gt","$gte","$lt","$lte"]),nr=new Set(["$eq","$gt","$gte"]),ir=new Set(["$eq","$lt","$lte"]);function sr(e,t,r,n){var i=Object.entries(t),s=i.find(([N,ye])=>{if(!e.includes(N))return!0;var ge=Object.entries(ye).find(([xt,gn])=>!ke.has(xt));return ge});if(s||t.$and||t.$or)return!1;var o=[],a=new Set;for(var[c,u]of Object.entries(t)){if(!e.includes(c))return!1;var f=Object.keys(u).filter(N=>nr.has(N));if(f.length>1)return!1;var l=f[0];if(l&&a.add(c),l!=="$eq"){if(o.length>0)return!1;o.push(l)}}var h=[],p=new Set;for(var[d,y]of Object.entries(t)){if(!e.includes(d))return!1;var b=Object.keys(y).filter(N=>ir.has(N));if(b.length>1)return!1;var w=b[0];if(w&&p.add(d),w!=="$eq"){if(h.length>0)return!1;h.push(w)}}var m=0;for(var A of e){for(var R of[a,p]){if(!R.has(A)&&R.size>0)return!1;R.delete(A)}var v=r[m],Q=n[m];if(v!==Q&&a.size>0&&p.size>0)return!1;m++}return!0}function or(e,t){switch(e){case"$eq":return{startKey:t,endKey:t,inclusiveEnd:!0,inclusiveStart:!0};case"$lte":return{endKey:t,inclusiveEnd:!0};case"$gte":return{startKey:t,inclusiveStart:!0};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}function ar(e,t,r){var n=0,i=f=>{f>0&&(n=n+f)},s=10,o=ve(r.startKeys,f=>f!==J&&f!==Y);i(o*s);var a=ve(r.startKeys,f=>f!==Y&&f!==J);i(a*s);var c=ve(r.startKeys,(f,l)=>f===r.endKeys[l]);i(c*s*1.5);var u=r.sortSatisfiedByIndex?5:0;return i(u),n}class j extends Error{}const ur=2147483647,fr=-2147483648,cr=Number.MAX_SAFE_INTEGER,lr=Number.MIN_SAFE_INTEGER,P=Symbol("missing"),ht=Object.freeze(new Error("mingo: cycle detected while processing object/array")),pr="[object Object]",dr=/^\[object ([a-zA-Z0-9]+)\]$/,re=e=>{const t=Or(e);let r=0,n=t.length;for(;n;)r=(r<<5)-r^t.charCodeAt(--n);return r>>>0},yt=new Set(["null","undefined","boolean","number","string","date","regexp"]),hr={null:0,undefined:0,number:1,string:2,object:3,array:4,boolean:5,date:6,regexp:7,function:8},x=(e,t)=>{e===P&&(e=void 0),t===P&&(t=void 0);const[r,n]=[e,t].map(i=>hr[te(i).toLowerCase()]);return r!==n?r-n:r===1||r===2||r===6?e<t?-1:e>t?1:0:L(e,t)?0:e<t?-1:e>t?1:0};function S(e,t){if(!e)throw new j(t)}const te=e=>dr.exec(Object.prototype.toString.call(e))[1],Oe=e=>typeof e=="boolean",M=e=>typeof e=="string",C=e=>!isNaN(e)&&typeof e=="number",E=Array.isArray,g=e=>{if(!e)return!1;const t=Object.getPrototypeOf(e);return(t===Object.prototype||t===null)&&pr===Object.prototype.toString.call(e)},de=e=>e===Object(e),$e=e=>e instanceof Date,V=e=>e instanceof RegExp,gt=e=>typeof e=="function",O=e=>e==null,z=(e,t)=>e.includes(t),vt=(e,t)=>!z(e,t),yr=(e,t=!0)=>!!e||t&&e==="",W=e=>O(e)||M(e)&&!e||e instanceof Array&&e.length===0||g(e)&&Object.keys(e).length===0,qe=e=>e===P,ne=e=>e instanceof Array?e:[e],T=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),Le=e=>typeof ArrayBuffer<"u"&&ArrayBuffer.isView(e),gr=[$e,V,Le],be=(e,t)=>{if(O(e))return e;if(t.has(e))throw ht;const r=e.constructor;if(gr.some(n=>n(e)))return new r(e);try{if(t.add(e),E(e))return e.map(n=>be(n,t));if(g(e)){const n={};for(const i in e)n[i]=be(e[i],t);return n}}finally{t.delete(e)}return e},ze=e=>be(e,new Set),vr=(e,t)=>g(e)&&g(t)||E(e)&&E(t);function Se(e,t,r){if(r=r||{flatten:!1},qe(e)||O(e))return t;if(qe(t)||O(t))return e;if(!vr(e,t)){if(r.skipValidation)return t||e;throw Error("mismatched types. must both be array or object")}if(r.skipValidation=!0,E(e)){const n=e,i=t;if(r.flatten){let s=0,o=0;for(;s<n.length&&o<i.length;)n[s]=Se(n[s++],i[o++],r);for(;o<i.length;)n.push(t[o++])}else ie(n,i)}else for(const n in t)e[n]=Se(e[n],t[n],r);return e}function Ie(e,t=re){const r=new Map;return e.forEach((n,i)=>{const s=Et(n,t);r.has(s)?r.get(s).some(o=>L(e[o],n))||r.get(s).push(i):r.set(s,[i])}),r}function mt(e,t=re){if(e.some(a=>a.length==0))return[];if(e.length===1)return Array.from(e);const r=Er(e.map((a,c)=>[c,a.length]),a=>a[1]),n=e[r[0][0]],i=Ie(n,t),s=new Map,o=new Array;return i.forEach((a,c)=>{const u=a.map(p=>n[p]),f=u.map(p=>0),l=u.map(p=>[r[0][0],0]);let h=!1;for(let p=1;p<e.length;p++){const[d,y]=r[p],b=e[d];if(s.has(p)||s.set(p,Ie(b)),s.get(p).has(c)){const w=s.get(p).get(c).map(m=>b[m]);h=u.map((m,A)=>w.some((R,v)=>{const Q=f[A];return L(m,R)&&(f[A]++,d<l[A][0]&&(l[A]=[d,s.get(p).get(c)[v]])),Q<f[A]})).some(Boolean)}if(!h)return}h&&ie(o,f.map((p,d)=>p===e.length-1?[u[d],l[d]]:P).filter(p=>p!==P))}),o.sort((a,c)=>{const[u,[f,l]]=a,[h,[p,d]]=c,y=x(f,p);return y!==0?y:x(l,d)}).map(a=>a[0])}function Ot(e,t=0){const r=new Array;function n(i,s){for(let o=0,a=i.length;o<a;o++)E(i[o])&&(s>0||s<0)?n(i[o],Math.max(-1,s-1)):r.push(i[o])}return n(e,t),r}const mr=e=>{let[t,r]=[Object.getPrototypeOf(e),Object.getOwnPropertyNames(e)],n=t;for(;!r.length&&t!==Object.prototype&&t!==Array.prototype;)n=t,r=Object.getOwnPropertyNames(t),t=Object.getPrototypeOf(t);const i={};return r.forEach(s=>i[s]=e[s]),[i,n]};function L(e,t){if(e===t||Object.is(e,t))return!0;const r=!!e&&e.constructor||e;if(e===null||t===null||e===void 0||t===void 0||r!==t.constructor||r===Function)return!1;if(r===Array||r===Object){const s=Object.keys(e),o=Object.keys(t);if(s.length!==o.length||new Set([...s,...o]).size!=s.length)return!1;for(const a of s)if(!L(e[a],t[a]))return!1;return!0}const n=Object.getPrototypeOf(e);return(Le(e)||n!==Object.prototype&&n!==Array.prototype&&Object.prototype.hasOwnProperty.call(n,"toString"))&&e.toString()===t.toString()}function li(e,t=re){const r=e.map(n=>P);return Ie(e,t).forEach((n,i)=>{n.forEach(s=>r[s]=e[s])}),r.filter(n=>n!==P)}const oe=(e,t)=>{if(e===null)return"null";if(e===void 0)return"undefined";const r=e.constructor;switch(r){case RegExp:case Number:case Boolean:case Function:case Symbol:return e.toString();case String:return JSON.stringify(e);case Date:return e.toISOString()}if(Le(e))return r.name+"["+e.toString()+"]";if(t.has(e))throw ht;try{if(t.add(e),E(e))return"["+e.map(o=>oe(o,t)).join(",")+"]";if(r===Object)return"{"+Object.keys(e).sort().map(o=>o+":"+oe(e[o],t)).join(",")+"}";const n=Object.getPrototypeOf(e);if(n!==Object.prototype&&n!==Array.prototype&&Object.prototype.hasOwnProperty.call(n,"toString"))return r.name+"("+JSON.stringify(e.toString())+")";const[i,s]=mr(e);return r.name+oe(i,t)}finally{t.delete(e)}},Or=e=>oe(e,new Set);function Et(e,t){return t=t||re,O(e)?null:t(e).toString()}function Er(e,t,r=x){if(W(e))return e;const n=new Array,i=new Array;for(let s=0;s<e.length;s++){const o=e[s],a=t(o,s);O(a)?i.push(o):n.push([a,o])}return n.sort((s,o)=>r(s[0],o[0])),ie(i,n.map(s=>s[1]))}function wr(e,t,r=re){if(e.length<1)return new Map;const n=new Map,i=new Map;for(let s=0;s<e.length;s++){const o=e[s],a=t(o,s),c=Et(a,r);if(c===null)i.has(null)?i.get(null).push(o):i.set(null,[o]);else{const u=n.has(c)?n.get(c).find(f=>L(f,a)):null;O(u)?(i.set(a,[o]),n.has(c)?n.get(c).push(a):n.set(c,[a])):i.get(u).push(o)}}return i}const Ee=5e4;function ie(e,...t){return e instanceof Array?t.reduce((r,n)=>{let i=Math.ceil(n.length/Ee),s=0;for(;i-- >0;)Array.prototype.push.apply(r,n.slice(s,s+Ee)),s+=Ee;return r},e):t.filter(de).reduce((r,n)=>(Object.assign(r,n),r),e)}function xe(e,t){return de(e)?e[t]:void 0}function _r(e,t){if(t<1)return e;for(;t--&&e.length===1;)e=e[0];return e}function Fe(e,t,r){let n=0;function i(o,a){let c=o;for(let u=0;u<a.length;u++){const f=a[u];if(/^\d+$/.exec(f)===null&&c instanceof Array){if(u===0&&n>0)break;n+=1;const h=a.slice(u);c=c.reduce((p,d)=>{const y=i(d,h);return y!==void 0&&p.push(y),p},[]);break}else c=xe(c,f);if(c===void 0)break}return c}const s=yt.has(te(e).toLowerCase())?e:i(e,t.split("."));return s instanceof Array&&r?.unwrapArray?_r(s,n):s}function ae(e,t,r){const n=t.split("."),i=n[0],s=n.slice(1).join("."),o=/^\d+$/.exec(i)!==null,a=n.length>1;let c,u;if(e instanceof Array)if(o)c=xe(e,Number(i)),a&&(c=ae(c,s,r)),c=[c];else{c=[];for(const f of e)u=ae(f,t,r),r?.preserveMissing?(u===void 0&&(u=P),c.push(u)):u!==void 0&&c.push(u)}else{if(u=xe(e,i),a&&(u=ae(u,s,r)),u===void 0)return;c=r?.preserveKeys?{...e}:{},c[i]=u}return c}function Ne(e){if(e instanceof Array)for(let t=e.length-1;t>=0;t--)e[t]===P?e.splice(t,1):Ne(e[t]);else if(g(e))for(const t in e)T(e,t)&&Ne(e[t])}const Ue=/^\d+$/;function ce(e,t,r,n){const i=t.split("."),s=i[0],o=i.slice(1).join(".");if(i.length===1)(g(e)||E(e)&&Ue.test(s))&&r(e,s);else{n?.buildGraph&&O(e[s])&&(e[s]={});const a=e[s];if(!a)return;const c=!!(i.length>1&&Ue.test(i[1]));a instanceof Array&&n?.descendArray&&!c?a.forEach(u=>ce(u,o,r,n)):ce(a,o,r,n)}}function Ar(e,t,r){ce(e,t,(n,i)=>{n[i]=gt(r)?r(n[i]):r},{buildGraph:!0})}function Be(e,t,r){ce(e,t,(n,i)=>{if(n instanceof Array){if(/^\d+$/.test(i))n.splice(parseInt(i),1);else if(r&&r.descendArray)for(const s of n)g(s)&&delete s[i]}else g(n)&&delete n[i]},r)}const $r=/^\$[a-zA-Z0-9_]+$/;function X(e){return $r.test(e)}function wt(e){if(yt.has(te(e).toLowerCase()))return V(e)?{$regex:e}:{$eq:e};if(de(e)){if(!Object.keys(e).some(X))return{$eq:e};if(T(e,"$regex")){const r={...e};return r.$regex=new RegExp(e.$regex,e.$options),delete r.$options,r}}return e}var H=(e=>(e.CLONE_ALL="CLONE_ALL",e.CLONE_INPUT="CLONE_INPUT",e.CLONE_OUTPUT="CLONE_OUTPUT",e.CLONE_OFF="CLONE_OFF",e))(H||{});class K{constructor(t,r,n,i=Date.now()){this._opts=t,this._root=r,this._local=n,this.timestamp=i,this.update(r,n)}static init(t,r,n){return t instanceof K?new K(t._opts,O(t.root)?r:t.root,Object.assign({},t.local,n)):new K(t,r,n)}update(t,r){return this._root=t,this._local=r&&Object.assign({},r,{variables:Object.assign({},this._local?.variables,r?.variables)}),this}getOptions(){return Object.freeze({...this._opts,context:q.from(this._opts.context)})}get root(){return this._root}get local(){return this._local}get idKey(){return this._opts.idKey}get collation(){return this._opts?.collation}get processingMode(){return this._opts?.processingMode||"CLONE_OFF"}get useStrictMode(){return this._opts?.useStrictMode}get scriptEnabled(){return this._opts?.scriptEnabled}get useGlobalContext(){return this._opts?.useGlobalContext}get hashFunction(){return this._opts?.hashFunction}get collectionResolver(){return this._opts?.collectionResolver}get jsonSchemaValidator(){return this._opts?.jsonSchemaValidator}get variables(){return this._opts?.variables}get context(){return this._opts?.context}}function _t(e){return e instanceof K?e.getOptions():Object.freeze({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:"CLONE_OFF",...e,context:e?.context?q.from(e?.context):q.init({})})}var U=(e=>(e.ACCUMULATOR="accumulator",e.EXPRESSION="expression",e.PIPELINE="pipeline",e.PROJECTION="projection",e.QUERY="query",e.WINDOW="window",e))(U||{});class q{constructor(t){this.operators={accumulator:{},expression:{},pipeline:{},projection:{},query:{},window:{}};for(const[r,n]of Object.entries(t))this.addOperators(r,n)}static init(t={}){return new q(t)}static from(t){return new q(t.operators)}addOperators(t,r){for(const[n,i]of Object.entries(r))this.getOperator(t,n)||(this.operators[t][n]=i);return this}addAccumulatorOps(t){return this.addOperators("accumulator",t)}addExpressionOps(t){return this.addOperators("expression",t)}addQueryOps(t){return this.addOperators("query",t)}addPipelineOps(t){return this.addOperators("pipeline",t)}addProjectionOps(t){return this.addOperators("projection",t)}addWindowOps(t){return this.addOperators("window",t)}getOperator(t,r){return t in this.operators&&this.operators[t][r]||null}}const F=q.init();function Ge(e,t){for(const[r,n]of Object.entries(t)){S(gt(n)&&X(r),`'${r}' is not a valid operator`);const i=D(e,r,null);S(!i||n===i,`${r} already exists for '${e}' operators. Cannot change operator function once registered.`)}switch(e){case"accumulator":F.addAccumulatorOps(t);break;case"expression":F.addExpressionOps(t);break;case"pipeline":F.addPipelineOps(t);break;case"projection":F.addProjectionOps(t);break;case"query":F.addQueryOps(t);break;case"window":F.addWindowOps(t);break}}function D(e,t,r){const{context:n,useGlobalContext:i}=r||{},s=n?n.getOperator(e,t):null;return!s&&i?F.getOperator(e,t):s}const je={$$ROOT(e,t,r){return r.root},$$CURRENT(e,t,r){return e},$$REMOVE(e,t,r){},$$NOW(e,t,r){return new Date(r.timestamp)}},Pe={$$KEEP(e,t,r){return e},$$PRUNE(e,t,r){},$$DESCEND(e,t,r){if(!T(t,"$cond"))return e;let n;for(const[i,s]of Object.entries(e))if(de(s)){if(s instanceof Array){const o=[];for(let a of s)g(a)&&(a=We(a,t,r.update(a))),O(a)||o.push(a);n=o}else n=We(s,t,r.update(s));O(n)?delete e[i]:e[i]=n}return e}};function I(e,t,r,n){const i=K.init(n,e);if(r=r||"",X(r)){const s=D("expression",r,n);if(s)return s(e,t,i);const o=D("accumulator",r,n);if(o)return e instanceof Array||(e=I(e,t,null,i),t=null),S(e instanceof Array,`'${r}' target must be an array.`),o(e,t,i.update(null,i.local));throw new j(`operator '${r}' is not registered`)}if(M(t)&&t.length>0&&t[0]==="$"){if(T(Pe,t))return t;let s=i.root;const o=t.split(".");if(T(je,o[0]))s=je[o[0]](e,null,i),t=t.slice(o[0].length+1);else if(o[0].slice(0,2)==="$$"){s=Object.assign({},i.variables,{this:e},i.local?.variables);const a=o[0].slice(2);S(T(s,a),`Use of undefined variable: ${a}`),t=t.slice(2)}else t=t.slice(1);return t===""?s:Fe(s,t)}if(E(t))return t.map(s=>I(e,s,null,i));if(g(t)){const s={};for(const[o,a]of Object.entries(t))if(s[o]=I(e,a,o,i),["expression","accumulator"].some(c=>!!D(c,o,n)))return S(Object.keys(t).length===1,"Invalid aggregation expression '"+JSON.stringify(t)+"'"),s[o];return s}return t}function We(e,t,r){const n=I(e,t,null,r);return T(Pe,n)?Pe[n](e,t,r):n}function B(e){return e instanceof Xe?e:new Xe(e)}function br(...e){let t=0;return B(()=>{for(;t<e.length;){const r=e[t].next();if(!r.done)return r;t++}return{done:!0}})}function Sr(e){return!!e&&typeof e=="object"&&e?.next instanceof Function}function Ir(e,t){const r=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,r)}const Me=new Error;function xr(e,t,r){let n=!1,i=-1,s=0;return function(o){try{e:for(;!n;){let a=e();i++;let c=-1;const u=t.length;let f=!1;for(;++c<u;){const l=t[c];switch(l.action){case 0:a=l.func(a,i);break;case 1:if(!l.func(a,i))continue e;break;case 2:--l.count,l.count||(f=!0);break;case 3:--l.count,l.count||Ir(t,c);continue e;default:break e}}if(n=f,o)r[s++]=a;else return{value:a,done:!1}}}catch(a){if(a!==Me)throw a}return n=!0,{done:n}}}class Xe{constructor(t){this.iteratees=[],this.yieldedValues=[],this.isDone=!1;let r;if(t instanceof Function&&(t={next:t}),Sr(t)){const n=t;r=()=>{const i=n.next();if(i.done)throw Me;return i.value}}else if(t instanceof Array){const n=t,i=n.length;let s=0;r=()=>{if(s<i)return n[s++];throw Me}}else if(!(t instanceof Function))throw new j("Lazy must be initialized with an array, generator, or function.");this.getNext=xr(r,this.iteratees,this.yieldedValues)}push(t,r){return typeof r=="function"?this.iteratees.push({action:t,func:r}):typeof r=="number"&&this.iteratees.push({action:t,count:r}),this}next(){return this.getNext()}map(t){return this.push(0,t)}filter(t){return this.push(1,t)}take(t){return t>0?this.push(2,t):this}drop(t){return t>0?this.push(3,t):this}transform(t){const r=this;let n;return B(()=>(n||(n=B(t(r.value()))),n.next()))}value(){return this.isDone||(this.isDone=this.getNext(!0).done),this.yieldedValues}each(t){for(;;){const r=this.next();if(r.done)break;if(t(r.value)===!1)return!1}return!0}reduce(t,r){let n=this.next();for(r===void 0&&!n.done&&(r=n.value,n=this.next());!n.done;)r=t(r,n.value),n=this.next();return r}size(){return this.reduce((t,r)=>++t,0)}[Symbol.iterator](){return this}}class Nr{constructor(t,r){this.pipeline=t,this.options=_t(r)}stream(t){let r=B(t);const n=this.options.processingMode;(n==H.CLONE_ALL||n==H.CLONE_INPUT)&&r.map(ze);const i=new Array;if(!W(this.pipeline))for(const s of this.pipeline){const o=Object.keys(s),a=o[0],c=D(U.PIPELINE,a,this.options);S(o.length===1&&!!c,`invalid pipeline operator ${a}`),i.push(a),r=c(r,s[a],this.options)}return(n==H.CLONE_OUTPUT||n==H.CLONE_ALL&&mt([["$group","$unwind"],i]).length)&&r.map(ze),r}run(t){return this.stream(t).value()}}class Pr{constructor(t,r,n,i){this.source=t,this.predicate=r,this.projection=n,this.options=i,this.operators=[],this.result=null,this.buffer=[]}fetch(){return this.result?this.result:(g(this.projection)&&this.operators.push({$project:this.projection}),this.result=B(this.source).filter(this.predicate),this.operators.length>0&&(this.result=new Nr(this.operators,this.options).stream(this.result)),this.result)}fetchAll(){const t=B([...this.buffer]);return this.buffer=[],br(t,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(t){return this.operators.push({$skip:t}),this}limit(t){return this.operators.push({$limit:t}),this}sort(t){return this.operators.push({$sort:t}),this}collation(t){return this.options={...this.options,collation:t},this}next(){if(this.buffer.length>0)return this.buffer.pop();const t=this.fetch().next();if(!t.done)return t.value}hasNext(){if(this.buffer.length>0)return!0;const t=this.fetch().next();return t.done?!1:(this.buffer.push(t.value),!0)}map(t){return this.all().map(t)}forEach(t){this.all().forEach(t)}[Symbol.iterator](){return this.fetchAll()}}class se{constructor(t,r){this.condition=t,this.options=_t(r),this.compiled=[],this.compile()}compile(){S(g(this.condition),`query criteria must be an object: ${JSON.stringify(this.condition)}`);const t={};for(const[r,n]of Object.entries(this.condition)){if(r==="$where")Object.assign(t,{field:r,expr:n});else if(z(["$and","$or","$nor","$expr","$jsonSchema"],r))this.processOperator(r,r,n);else{S(!X(r),`unknown top level operator: ${r}`);for(const[i,s]of Object.entries(wt(n)))this.processOperator(r,i,s)}t.field&&this.processOperator(t.field,t.field,t.expr)}}processOperator(t,r,n){const i=D(U.QUERY,r,this.options);if(!i)throw new j(`unknown query operator ${r}`);const s=i(t,n,this.options);this.compiled.push(s)}test(t){for(let r=0,n=this.compiled.length;r<n;r++)if(!this.compiled[r](t))return!1;return!0}find(t,r){return new Pr(t,n=>this.test(n),r||{},this.options)}remove(t){return t.reduce((r,n)=>(this.test(n)||r.push(n),r),[])}}const Mr=(e,t,r)=>{if(W(t)||!g(t))return e;let n=x;const i=r.collation;return g(i)&&M(i.locale)&&(n=Cr(i)),e.transform(s=>{const o=Object.keys(t);for(const a of o.reverse()){const c=wr(s,f=>Fe(f,a),r.hashFunction),u=Array.from(c.keys()).sort(n);t[a]===-1&&u.reverse(),s=[],u.reduce((f,l)=>ie(f,c.get(l)),s)}return s})},Rr={1:"base",2:"accent",3:"variant"};function Cr(e){const t={sensitivity:Rr[e.strength||3],caseFirst:e.caseFirst==="off"?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:e.alternate==="shifted"};(e.caseLevel||!1)===!0&&(t.sensitivity==="base"&&(t.sensitivity="case"),t.sensitivity==="accent"&&(t.sensitivity="variant"));const r=new Intl.Collator(e.locale,t);return(n,i)=>{if(!M(n)||!M(i))return x(n,i);const s=r.compare(n,i);return s<0?-1:s>0?1:0}}function _(e){const t=(r,n,i)=>{const s={unwrapArray:!0},o=Math.max(1,r.split(".").length-1);return a=>{const c=Fe(a,r,s);return e(c,n,{...i,depth:o})}};return t.op="query",t}function pi(e){return(t,r,n)=>{const i=I(t,r,null,n);return e(...i)}}function At(e,t,r){if(L(e,t)||O(e)&&O(t))return!0;if(e instanceof Array){const n=L.bind(null,t);return e.some(n)||Ot(e,r?.depth).some(n)}return!1}function Tr(e,t,r){return!At(e,t,r)}function $t(e,t,r){return O(e)?t.some(n=>n===null):mt([ne(e),t],r?.hashFunction).length>0}function kr(e,t,r){return!$t(e,t,r)}function Lr(e,t,r){return he(e,t,(n,i)=>x(n,i)<0)}function Fr(e,t,r){return he(e,t,(n,i)=>x(n,i)<=0)}function Kr(e,t,r){return he(e,t,(n,i)=>x(n,i)>0)}function Dr(e,t,r){return he(e,t,(n,i)=>x(n,i)>=0)}function qr(e,t,r){return ne(e).some(n=>t.length===2&&n%t[0]===t[1])}function zr(e,t,r){const n=ne(e),i=s=>M(s)&&yr(t.exec(s),r?.useStrictMode);return n.some(i)||Ot(n,1).some(i)}function Ur(e,t,r){return(t===!1||t===0)&&e===void 0||(t===!0||t===1)&&e!==void 0}function Br(e,t,r){if(!E(e)||!E(t)||!e.length||!t.length)return!1;let n=!0;for(const i of t){if(!n)break;g(i)&&z(Object.keys(i),"$elemMatch")?n=bt(e,i.$elemMatch,r):i instanceof RegExp?n=e.some(s=>typeof s=="string"&&i.test(s)):n=e.some(s=>L(i,s))}return n}function Gr(e,t,r){return Array.isArray(e)&&e.length===t}function jr(e){return X(e)&&["$and","$or","$nor"].indexOf(e)===-1}function bt(e,t,r){if(E(e)&&!W(e)){let n=o=>o,i=t;Object.keys(t).every(jr)&&(i={temp:t},n=o=>({temp:o}));const s=new se(i,r);for(let o=0,a=e.length;o<a;o++)if(s.test(n(e[o])))return!0}return!1}const Qe=e=>e===null,He=e=>C(e)&&e>=fr&&e<=ur&&e.toString().indexOf(".")===-1,Ye=e=>C(e)&&e>=lr&&e<=cr&&e.toString().indexOf(".")===-1,Wr={array:E,bool:Oe,boolean:Oe,date:$e,decimal:C,double:C,int:He,long:Ye,number:C,null:Qe,object:g,regex:V,regexp:V,string:M,undefined:O,function:e=>{throw new j("unsupported type key `function`.")},1:C,2:M,3:g,4:E,6:O,8:Oe,9:$e,10:Qe,11:V,16:He,18:Ye,19:C};function Je(e,t,r){const n=Wr[t];return n?n(e):!1}function Xr(e,t,r){return Array.isArray(t)?t.findIndex(n=>Je(e,n))>=0:Je(e,t)}function he(e,t,r){return ne(e).some(n=>te(n)===te(t)&&r(n,t))}const Ve=(e,t)=>{const r={};return e.split("").forEach((n,i)=>r[n]=t*(i+1)),r};({...Ve("ABCDEFGHIKLM",1),...Ve("NOPQRSTUVWXY",-1)});const Ze={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function $(e,t=Ze){const r=Object.assign({},Ze,t),n=new Set(Object.keys(r));return(i,s,o)=>{const a=I(i,s,null,o);if(n.has(`${a}`)){const c=r[`${a}`];if(c instanceof Error)throw new j(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return c}return e(a)}}$(Math.acos,{Infinity:1/0,0:new Error});$(Math.acosh,{Infinity:1/0,0:new Error});$(Math.asin);$(Math.asinh,{Infinity:1/0,"-Infinity":-1/0});$(Math.atan);$(Math.atanh,{1:1/0,"-1":-1/0});$(Math.cos);$(Math.cosh,{"-Infinity":1/0,Infinity:1/0});const Qr=Math.PI/180;$(e=>e*Qr,{Infinity:1/0,"-Infinity":1/0});const Hr=180/Math.PI;$(e=>e*Hr,{Infinity:1/0,"-Infinity":-1/0});$(Math.sin);$(Math.sinh,{"-Infinity":-1/0,Infinity:1/0});$(Math.tan);const Yr=(e,t,r)=>{if(W(t))return e;let n=Object.keys(t),i=!1;St(t,r);const s=r.idKey;if(z(n,s)){const a=t[s];(a===0||a===!1)&&(n=n.filter(vt.bind(null,[s])),i=n.length==0)}else n.push(s);const o=K.init(r);return e.map(a=>Re(a,t,o.update(a),n,i))};function Re(e,t,r,n,i){let s={},o=!1,a=!1;const c=[];i&&c.push(r.idKey);for(const u of n){let f;const l=t[u];if(u!==r.idKey&&z([0,!1],l)&&(a=!0),u===r.idKey&&W(l))f=e[u];else if(M(l))f=I(e,l,u,r);else if(!z([1,!0],l))if(l instanceof Array)f=l.map(p=>{const d=I(e,p,null,r);return O(d)?null:d});else if(g(l)){const p=l,d=Object.keys(l),y=d.length==1?d[0]:"",b=D(U.PROJECTION,y,r);if(b)y==="$slice"?ne(p[y]).every(C)?(f=b(e,p[y],u,r),o=!0):f=I(e,p,u,r):f=b(e,p[y],u,r);else if(X(y))f=I(e,p[y],y,r);else if(T(e,u)){St(p,r);let w=e[u];w instanceof Array?f=w.map(m=>Re(m,p,r,d,!1)):(w=g(w)?w:e,f=Re(w,p,r,d,!1))}else f=I(e,l,null,r)}else{c.push(u);continue}const h=ae(e,u,{preserveMissing:!0});h!==void 0&&Se(s,h,{flatten:!0}),vt([0,1,!1,!0],l)&&(f===void 0?Be(s,u,{descendArray:!0}):Ar(s,u,f))}if(Ne(s),(o||a||i)&&(s=ie({},e,s),c.length>0))for(const u of c)Be(s,u,{descendArray:!0});return s}function St(e,t){const r=[!1,!1];for(const[n,i]of Object.entries(e)){if(n===t?.idKey)return;i===0||i===!1?r[0]=!0:(i===1||i===!0)&&(r[1]=!0),S(!(r[0]&&r[1]),"Projection cannot have a mix of inclusion and exclusion.")}}const Jr=(e,t,r)=>{S(E(t),"Invalid expression: $and expects value to be an Array.");const n=t.map(i=>new se(i,r));return i=>n.every(s=>s.test(i))},It=(e,t,r)=>{S(E(t),"Invalid expression. $or expects value to be an Array");const n=t.map(i=>new se(i,r));return i=>n.some(s=>s.test(i))},Vr=(e,t,r)=>{S(E(t),"Invalid expression. $nor expects value to be an array.");const n=It("$or",t,r);return i=>!n(i)},Zr=(e,t,r)=>{const n={};n[e]=wt(t);const i=new se(n,r);return s=>!i.test(s)},en=_(At),tn=_(Kr),rn=_(Dr),nn=_($t),sn=_(Lr),on=_(Fr),an=_(Tr),un=_(kr),fn=_(qr),cn=_(zr),di=_(Br),ln=_(bt),pn=_(Gr),dn=_(Ur),hn=_(Xr);var et=!1;function yn(e){return et||(Ge(U.PIPELINE,{$sort:Mr,$project:Yr}),Ge(U.QUERY,{$and:Jr,$eq:en,$elemMatch:ln,$exists:dn,$gt:tn,$gte:rn,$in:nn,$lt:sn,$lte:on,$ne:an,$nin:un,$mod:fn,$nor:Vr,$not:Zr,$or:It,$regex:cn,$size:pn,$type:hn}),et=!0),new se(e)}function hi(e,t){var r=pe(e.primaryKey);t=ue(t);var n=Kt(t);if(typeof n.skip!="number"&&(n.skip=0),n.selector?(n.selector=n.selector,Object.entries(n.selector).forEach(([u,f])=>{(typeof f!="object"||f===null)&&(n.selector[u]={$eq:f})})):n.selector={},n.index){var i=Rt(n.index);i.includes(r)||i.push(r),n.index=i}if(n.sort){var c=n.sort.find(u=>Ft(u)===r);c||(n.sort=n.sort.slice(0),n.sort.push({[r]:"asc"}))}else if(n.index)n.sort=n.index.map(u=>({[u]:"asc"}));else{if(e.indexes){var s=new Set;Object.entries(n.selector).forEach(([u,f])=>{var l=!1;typeof f=="object"&&f!==null?l=!!Object.keys(f).find(h=>ke.has(h)):l=!0,l&&s.add(u)});var o=-1,a;e.indexes.forEach(u=>{var f=rt(u)?u:[u],l=f.findIndex(h=>!s.has(h));l>0&&l>o&&(o=l,a=f)}),a&&(n.sort=a.map(u=>({[u]:"asc"})))}n.sort||(n.sort=[{[r]:"asc"}])}return n}function yi(e,t){if(!t.sort)throw G("SNH",{query:t});var r=[];t.sort.forEach(i=>{var s=Object.keys(i)[0],o=Object.values(i)[0];r.push({key:s,direction:o,getValueFn:kt(s)})});var n=(i,s)=>{for(var o=0;o<r.length;++o){var a=r[o],c=a.getValueFn(i),u=a.getValueFn(s);if(c!==u){var f=a.direction==="asc"?x(c,u):x(u,c);return f}}};return n}function gi(e,t){if(!t.sort)throw G("SNH",{query:t});var r=yn(t.selector),n=i=>r.test(i);return n}async function vi(e,t){var r=await e.exec();if(!r)return null;if(Array.isArray(r))return Promise.all(r.map(i=>t(i)));if(r instanceof Map)return Promise.all([...r.values()].map(i=>t(i)));var n=await t(r);return n}export{Ke as $,pt as A,ui as B,si as C,fi as D,er as E,Ft as F,Pn as G,Lt as H,J as I,Vt as J,Zt as K,ke as L,Cn as M,Rn as N,Te as O,rr as P,Nn as Q,qn as R,oi as S,or as T,ir as U,st as V,ii as W,gi as X,ci as Y,yi as Z,Dt as _,Y as a,fn as a$,Hn as a0,ri as a1,Bn as a2,rt as a3,_n as a4,sr as a5,Un as a6,vn as a7,Sn as a8,ei as a9,In as aA,tt as aB,ut as aC,I as aD,yr as aE,ne as aF,pi as aG,At as aH,Kr as aI,Dr as aJ,Lr as aK,Fr as aL,Tr as aM,j as aN,S as aO,gt as aP,_ as aQ,di as aR,Jr as aS,ln as aT,en as aU,dn as aV,tn as aW,rn as aX,nn as aY,sn as aZ,on as a_,G as aa,ti as ab,hi as ac,ai as ad,Wn as ae,ct as af,Mn as ag,Dn as ah,On as ai,ar as aj,wn as ak,vi as al,Jn as am,ni as an,Xn as ao,mn as ap,xn as aq,Ln as ar,we as as,jn as at,Tn as au,bn as av,Rt as aw,Fn as ax,zt as ay,zn as az,pe as b,an as b0,un as b1,Vr as b2,Zr as b3,It as b4,cn as b5,pn as b6,hn as b7,se as b8,ce as b9,Fe as ba,E as bb,$e as bc,g as bd,ze as be,T as bf,mt as bg,li as bh,C as bi,x as bj,X as bk,L as bl,_t as bm,nr as c,qt as d,jt as e,ue as f,dt as g,Kn as h,Zn as i,nt as j,tr as k,Ht as l,Yt as m,Ct as n,kt as o,kn as p,Gn as q,An as r,$n as s,En as t,Kt as u,ve as v,Tt as w,Yn as x,Qn as y,Vn as z};
