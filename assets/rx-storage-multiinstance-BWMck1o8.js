import{a0 as p,a1 as N,o as S,a2 as i,a3 as L,a4 as d,a5 as m,$ as R}from"./rx-query-Dvpq4Rjc.js";import{B as A}from"./broadcast-channel-637we1sM.js";var M={},O="6da4936d1425ff3a5c44c02342c6daf791d266be3ae8479b8ec59e261df41b93";function B(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];var r=p(a),s=N(a,1/0);return S(function(t,u){i(s)(L(d([t],m(a)),r)).subscribe(u)})}function I(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];return B.apply(void 0,d([],m(a)))}var n=new Map;function w(a,e,r,s){var t=n.get(e);return t||(t={bc:new A(["RxDB:",a,r].join("|")),refs:new Set},n.set(e,t)),t.refs.add(s),t.bc}function b(a,e){var r=n.get(a);if(r&&(r.refs.delete(e),r.refs.size===0))return n.delete(a),r.bc.close()}function _(a,e,r,s){if(e.multiInstance){var t=s||w(a,e.databaseInstanceToken,r.databaseName,r),u=new R,f=o=>{o.storageName===a&&o.databaseName===e.databaseName&&o.collectionName===e.collectionName&&o.version===e.schema.version&&u.next(o.eventBulk)};t.addEventListener("message",f);var c=r.changeStream(),v=!1,l=c.subscribe(o=>{v||t.postMessage({storageName:a,databaseName:e.databaseName,collectionName:e.collectionName,version:e.schema.version,eventBulk:o})});r.changeStream=function(){return u.asObservable().pipe(I(c))};var g=r.close.bind(r);r.close=async function(){return v=!0,l.unsubscribe(),t.removeEventListener("message",f),s||await b(e.databaseInstanceToken,r),g()};var h=r.remove.bind(r);r.remove=async function(){return v=!0,l.unsubscribe(),t.removeEventListener("message",f),s||await b(e.databaseInstanceToken,r),h()}}}export{n as B,O as P,M as R,_ as a,w as g,b as r};
