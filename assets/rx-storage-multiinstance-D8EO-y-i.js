import{B as h}from"./broadcast-channel-C4zYqVB1.js";import{p as N,a as S,o as i,m as L,f as R,_ as m,b as d,S as A}from"./rx-query-FXZmDUEV.js";var y={},M="6da4936d1425ff3a5c44c02342c6daf791d266be3ae8479b8ec59e261df41b93";function B(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];var r=N(a),s=S(a,1/0);return i(function(t,u){L(s)(R(m([t],d(a)),r)).subscribe(u)})}function I(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];return B.apply(void 0,m([],d(a)))}var f=new Map;function w(a,e,r,s){var t=f.get(e);return t||(t={bc:new h(["RxDB:",a,r].join("|")),refs:new Set},f.set(e,t)),t.refs.add(s),t.bc}function b(a,e){var r=f.get(a);if(r&&(r.refs.delete(e),r.refs.size===0))return f.delete(a),r.bc.close()}function O(a,e,r,s){if(e.multiInstance){var t=s||w(a,e.databaseInstanceToken,r.databaseName,r),u=new A,n=o=>{o.storageName===a&&o.databaseName===e.databaseName&&o.collectionName===e.collectionName&&o.version===e.schema.version&&u.next(o.eventBulk)};t.addEventListener("message",n);var c=r.changeStream(),v=!1,l=c.subscribe(o=>{v||t.postMessage({storageName:a,databaseName:e.databaseName,collectionName:e.collectionName,version:e.schema.version,eventBulk:o})});r.changeStream=function(){return u.asObservable().pipe(I(c))};var g=r.close.bind(r);r.close=async function(){return v=!0,l.unsubscribe(),t.removeEventListener("message",n),s||await b(e.databaseInstanceToken,r),g()};var p=r.remove.bind(r);r.remove=async function(){return v=!0,l.unsubscribe(),t.removeEventListener("message",n),s||await b(e.databaseInstanceToken,r),p()}}}export{f as B,M as P,y as R,O as a,w as g,b as r};
