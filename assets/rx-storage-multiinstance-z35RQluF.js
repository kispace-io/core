import{B as p}from"./broadcast-channel-D7u8GVKY.js";import{a2 as N,ag as S,o as i,ah as L,a4 as R,a0 as d,a1 as m,ac as A}from"./rx-query-_watRbMu.js";var M={},O="6da4936d1425ff3a5c44c02342c6daf791d266be3ae8479b8ec59e261df41b93";function B(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];var r=N(a),s=S(a,1/0);return i(function(t,u){L(s)(R(d([t],m(a)),r)).subscribe(u)})}function I(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];return B.apply(void 0,d([],m(a)))}var n=new Map;function w(a,e,r,s){var t=n.get(e);return t||(t={bc:new p(["RxDB:",a,r].join("|")),refs:new Set},n.set(e,t)),t.refs.add(s),t.bc}function b(a,e){var r=n.get(a);if(r&&(r.refs.delete(e),r.refs.size===0))return n.delete(a),r.bc.close()}function _(a,e,r,s){if(e.multiInstance){var t=s||w(a,e.databaseInstanceToken,r.databaseName,r),u=new A,f=o=>{o.storageName===a&&o.databaseName===e.databaseName&&o.collectionName===e.collectionName&&o.version===e.schema.version&&u.next(o.eventBulk)};t.addEventListener("message",f);var v=r.changeStream(),c=!1,l=v.subscribe(o=>{c||t.postMessage({storageName:a,databaseName:e.databaseName,collectionName:e.collectionName,version:e.schema.version,eventBulk:o})});r.changeStream=function(){return u.asObservable().pipe(I(v))};var g=r.close.bind(r);r.close=async function(){return c=!0,l.unsubscribe(),t.removeEventListener("message",f),s||await b(e.databaseInstanceToken,r),g()};var h=r.remove.bind(r);r.remove=async function(){return c=!0,l.unsubscribe(),t.removeEventListener("message",f),s||await b(e.databaseInstanceToken,r),h()}}}export{n as B,O as P,M as R,_ as a,w as g,b as r};
